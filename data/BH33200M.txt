 /**********************************************************************
 * PROJEKT:     EVS SLUT 2001                                          *
 * PROGRAMNAVN: BH33200M.                                              *
 * PROGRAMTYPE: MAKRO.                                                 *
 * FUNKTION:    SQL UDTRÆK ALLE AKTIVE OG VALIDE EJENDOMME FRA         *
 *              EVS SLUT 2000 PR. PERSON. IND I ESR-UDTRÆK STRUKTUR    *
 *              MED ELBNR = 1 , EGENNR = 1 OG CKOPI = '1'              *
 * PROGRAMMØR:  ESBEN BRODERSEN       ESB, PUS/T&S BRØNDBY 22.11.2001. *
 * ÆNDRINGSLOG: XXXXXX XXXXXX         XXX, PUS/T&S BRØNDBY 00.00.2000. *
 **********************************************************************/
 /*********************************************************************/
 /* DECLARE CURSOR TIL LÆS AF TABEL BQ00700T OG BQ00600T       RUTINE */
 /*********************************************************************/
 DECLARE_PERSONEJENDOMSOPL: PROC;                                       
                                                                        
         EXEC SQL DECLARE PERSON_CURSOR CURSOR FOR                      
                                                                        
              SELECT T1.DCPRN,                                          
                     T1.DINDKAAR,                                       
                     T1.EKOMNR,                                         
                     T1.EEJDNR,                                         
                     T1.ELBNR,                                          
                     T1.EGENNR,                                         
                     T1.DFRAGLD,                                        
                     T1.DTILGLD,                                        
                     T1.CÆGTOPR,                                        
                     T1.CSKPLOMF,                                       
                     T1.CEJBEVS,                                        
                     T1.CEJDTYPE,                                       
                     T1.CFRED,                                          
                     T1.CNEDSL1,                                        
                     T1.DATO0107,                                       
                     T1.DOVTG,                                          
                     T1.DAFSTAA,                                        
                     T1.GPCTEJER,                                       
                     T1.FDAGUDLE,                                       
                     T1.GPCTUDLE,                                       
                     T1.FUDL100,                                        
                     T1.FDAGERHV,                                       
                     T1.GPCTERHV,                                       
                     T1.FERHVFLER,                                      
                     T1.BPROM1,                                         
                     T1.BPROM2,                                         
                     T1.BNEDSL1,                                        
                     T1.BNEDSL2,                                        
                     T1.BPENSNED,                                       
                     T1.BPENSNÆ,                                        
                     T1.BNETTO,                                         
                     T1.BEJERAN,                                        
                     T1.BEVSMAN,                                        
                     T1.BMANEVSSTI,                                     
                     T1.MANPENSSTI,                                     
                     T1.BMANNEDSL,                                      
                     T1.CENKE,                                          
                     T1.CSLET,                                          
                     T1.BEJBOL1,                                        
                     T1.BEJBOL2,                                        
                     T1.CANVEBOL,                                       
                     T1.CSTIBEGR,                                       
                     T1.CPTYPSLUT,                                      
                     T1.CPENSNED,                                       
                     T1.CFRÅR,                                          
                     T1.COMPLA,                                         
                     T1.DOMPLACPR,                                      
                     T1.GPCTEJER,                                       
                     T1.CKOPI,                                          
                     T1.DCPRNKOPI,                                      
                     T2.EJDBELIG,                                       
                     T2.CBENYT,                                         
                     T2.BBERGRL,                                        
                     T2.CEJBOLTYP1,                                     
                     T2.BEJBOL1,                                        
                     T2.CEJBOLTYP2,                                     
                     T2.BEJBOL2,                                        
                     T2.FLEJL                                           
                                                                        
         FROM   BQ00700T T1, BQ00600T T2                                
         WHERE  T1.DINDKAAR = 2000                                      
         AND    T1.DINDKAAR = T2.DINDKAAR                               
         AND    T1.EKOMNR   = T2.EKOMNR                                 
         AND    T1.EEJDNR   = T2.EEJDNR                                 
         AND    T1.EGENNR   = 1                                         
         AND    T1.ELBNR    = 1                                         
         AND    T1.CKOPI    ='1'                                        
         ORDER BY T1.DCPRN,                                             
                  T1.DINDKAAR,                                          
                  T1.EKOMNR,                                            
                  T1.EEJDNR,                                            
                  T1.ELBNR,                                             
                  T1.EGENNR;                                            
                                                                        
         IF SQLCA.SQLCODE ^= 0 THEN                                     
           DO;                                                          
             FEJLTEKST = 'DECLARE PERSONEJDOPL';                        
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
 END DECLARE_PERSONEJENDOMSOPL;                                         
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF PERSONTABEL BQ00200T               RUTINE */
 /*********************************************************************/
 FETCH_PERSONEJENDOMSOPL: PROC;                                         
                                                                        
         EXEC SQL FETCH PERSON_CURSOR                                   
                                                                        
         INTO :TESTPERSON.DCPRN,                                        
              :TESTPERSON.DINDKAAR,                                     
              :TESTPERSON.EKOMNR,                                       
              :TESTPERSON.EEJDNR,                                       
              :TESTPERSON.ELBNR,                                        
              :TESTPERSON.EGENNR,                                       
              :TESTPERSON.DFRAGLD,                                      
              :TESTPERSON.DTILGLD,                                      
              :TESTPERSON.CÆGTOPR,                                      
              :TESTPERSON.CSKPLOMF,                                     
              :TESTPERSON.CEJBEVS,                                      
              :TESTPERSON.CEJDTYPE,                                     
              :TESTPERSON.CFRED,                                        
              :TESTPERSON.CNEDSL1,                                      
              :TESTPERSON.DATO0107,                                     
              :TESTPERSON.DOVTG,                                        
              :TESTPERSON.DAFSTAA,                                      
              :TESTPERSON.GPCTEJER,                                     
              :TESTPERSON.FDAGUDLE,                                     
              :TESTPERSON.GPCTUDLE,                                     
              :TESTPERSON.FUDL100,                                      
              :TESTPERSON.FDAGERHV,                                     
              :TESTPERSON.GPCTERHV,                                     
              :TESTPERSON.FERHVFLER,                                    
              :TESTPERSON.BPROM1,                                       
              :TESTPERSON.BPROM2,                                       
              :TESTPERSON.BNEDSL1,                                      
              :TESTPERSON.BNEDSL2,                                      
              :TESTPERSON.BPENSNED,                                     
              :TESTPERSON.BPENSNÆ,                                      
              :TESTPERSON.BNETTO,                                       
              :TESTPERSON.BEJERAN,                                      
              :TESTPERSON.BEVSMAN:INDK_PERS.BEVSMAN_I,                  
              :TESTPERSON.BMANEVSSTI,                                   
              :TESTPERSON.MANPENSSTI,                                   
              :TESTPERSON.BMANNEDSL,                                    
              :TESTPERSON.CENKE,                                        
              :TESTPERSON.CSLET,                                        
              :TESTPERSON.BEJBOL1:INDK_PERS.BEJBOL1_I,                  
              :TESTPERSON.BEJBOL2:INDK_PERS.BEJBOL2_I,                  
              :TESTPERSON.CANVEBOL,                                     
              :TESTPERSON.CSTIBEGR,                                     
              :TESTPERSON.CPTYPSLUT,                                    
              :TESTPERSON.CPENSNED,                                     
              :TESTPERSON.CFRÅR,                                        
              :TESTPERSON.COMPLA,                                       
              :TESTPERSON.DOMPLACPR,                                    
              :TESTPERSON.GPCTEJER,                                     
              :TESTPERSON.CKOPI,                                        
              :TESTPERSON.DCPRNKOPI,                                    
              :TESTEJENDOM.EJDBELIG,                                    
              :TESTEJENDOM.CBENYT,                                      
              :TESTEJENDOM.BBERGRL:INDK_PERS.BBERGRL_I,                 
              :TESTEJENDOM.CEJBOLTYP1,                                  
              :TESTEJENDOM.BEJBOL1:INDK_PERS.BEJBOL1_I,                 
              :TESTEJENDOM.CEJBOLTYP2,                                  
              :TESTEJENDOM.BEJBOL2:INDK_PERS.BEJBOL2_I,                 
              :TESTEJENDOM.FLEJL                                        
         ;                                                              
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               ANTLÆS_PERSON = ANTLÆS_PERSON + 1;                       
             END;                                                       
                                                                        
           WHEN (100);                                                  
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST  = 'FETCH PERSONEJDOPL';                       
               PUT SKIP LIST('SQLKODE',SQLCODE);                        
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
 END FETCH_PERSONEJENDOMSOPL;                                           
