 BQ99900: /* MQ GENNEMSTILLING TIL EVS */                               
         PROC(COMPTR) OPTIONS(MAIN,REENTRANT) REORDER;                  
 /**********************************************************************
 **                                                                   **
 **     NAVN              -   BQ99900                                 **
 **                                                                   **
 **     FUNKTION          -   GENNEMSTILLLER MQ FORESPØRGSLER TIL     **
 **                           EVS SYSTEMET.                           **
 **                                                                   **
 **     INDIVIDTYPER      -   811 EVSOPDAT                            **
 **                           813 EVSBERES                            **
 **                           814 OMPLA                               **
 **                           815 EVSBERES (ONLINE)                   **
 **                           816 EVSOPDAT (SKATTEPLIGTSOMFANG)       **
 **                                                                   **
 **     PROGRAMMØR        -   HENRIK KNIGGE, USE UST UTI 04.10.01     **
 ***********************************************************************
 **     RETTET AF         -   BO SCHMIDT, BOB, PKF/T&S 09.11.2006     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2006     **
 **     RETTET AF         -   INGRID FISCHER IFI PKF   15.11.2007     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2007     **
 **     RETTET AF         -   BO SCHMIDT, BOB, PKF     15.11.2008     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2008     **
 **     RETTET AF         -   BO SCHMIDT, BOB, PKF     08.10.2009     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2009     **
 **     RETTET AF         -   GERD HOLM-PEDERSEN PKF   15.10.2010     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2010     **
 **     RETTET AF         -   GERD HOLM-PEDERSEN PKF   15.11.2011     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2011     **
 **     RETTET AF         -   LARS KAAE HARRITSHØJ, PR, SEP 2012      **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2012     **
 **     RETTET AF         -   JØRGEN SAUGMANN     , PR, OKT 2013      **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2013     **
 **     RETTET AF         -   JØRGEN SAUGMANN     , AM, OKT 2014      **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2014     **
 **     RETTET AF         -   JNK                        OKT 2015     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2015     **
 **     RETTET AF         -   QLE                       JUNI 2016     **
 **                           TILRETTET TIL BEHANDLING AF ÅR 2016     **
 **     RETTET AF         -   QEB                       OKT  2016     **
 **                           INDIVID 813 UDGÅR FOR SLUT 2016 #01     **
 **     RETTET AF         -   QEB                       JUN  2017     **
 **                           ÅRSTILRETTET                            **
 **     RETTET AF         -   QLE                       JUN  2018     **
 **                           ÅRSTILRETTET                            **
 **********************************************************************/
 DCL  COMPTR               PTR;                                         
 DCL  HLPPTR               PTR;                                         
 DCL 1 LINKAREAL           BASED(HLPPTR),                               
      2 INPUTLENGTH        BIN FIXED(31,0),                             
      2 INPUTPTR           PTR,                                         
      2 OUTPUTLENGTH       BIN FIXED(31,0),                             
      2 OUTPUTPTR          PTR,                                         
      2 FEJLNR             BIN FIXED (15),                              
      2 FEJLTEKST          CHAR      (70);                              
                                                                        
 DCL 1 BRUGERDATA BASED(LINKAREAL.INPUTPTR),                            
      3 INDVNR               BIN FIXED (15),                            
      3 INDVLGD              BIN FIXED (15),                            
      3 FELTLGD              BIN FIXED (15),                            
      3 HEADER               CHAR(8),                                   
      3 DINDKAAR             CHAR(4); /* INDKOMSTÅR             */      
                                                                        
 DCL 1 FEJLDATA BASED(LINKAREAL.OUTPUTPTR) UNAL,                        
      3 INDVNR               BIN FIXED (15),                            
      3 INDVLGD              BIN FIXED (15),                            
      3 FELTLGD              BIN FIXED (15),                            
      3 HEADER               CHAR(8),                                   
      3 DINDKAAR             CHAR(4), /* INDKOMSTÅR             */      
      3 FEJLNR               CHAR(4); /* FEJLNR                 */      
                                                                        
 /**********************************************************************
 *    LOG-/ABEND RUTINE.                                               *
 **********************************************************************/
 %INCLUDE ZS37800M;                                                     
                                                                        
 /**********************************************************************
 *    ØVRIGE DECLARES                                                  *
 **********************************************************************/
 DCL  PROGRAM              CHAR(8) INIT('BQ99900');                     
 DCL  CICSRC               FIXED BIN (31);                              
 DCL  LINKRC               FIXED BIN (31);                              
 DCL (ADDR,STG,CSTG,NULL) BUILTIN;                                      
 DCL  CICS_LOG   CHAR(1) INIT('N');        /* UDSKRIVNING PÅ CICS LOG */
 /**********************************************************************
 **     HOVED STYRING.                                                **
 **********************************************************************/
                                                                        
  HLPPTR = COMPTR;                                                      
  SELECT(BRUGERDATA.INDVNR);                                            
   WHEN(811) /* EVSOPDAT */   /* RUL */                                 
     DO;                                                                
     SELECT;                                                            
      WHEN(BRUGERDATA.DINDKAAR = '2018') PROGRAM = 'BQ18000';           
      WHEN(BRUGERDATA.DINDKAAR = '2017') PROGRAM = 'BQ17000';           
      WHEN(BRUGERDATA.DINDKAAR = '2016') PROGRAM = 'BQ16000';           
      WHEN(BRUGERDATA.DINDKAAR = '2015') PROGRAM = 'BQ15000';           
      WHEN(BRUGERDATA.DINDKAAR = '2014') PROGRAM = 'BQ14000';           
      WHEN(BRUGERDATA.DINDKAAR = '2013') PROGRAM = 'BQ13000';           
      WHEN(BRUGERDATA.DINDKAAR = '2012') PROGRAM = 'BQ12000';           
      WHEN(BRUGERDATA.DINDKAAR = '2011') PROGRAM = 'BQ11000';           
      WHEN(BRUGERDATA.DINDKAAR = '2010') PROGRAM = 'BQ10000';           
      WHEN(BRUGERDATA.DINDKAAR = '2009') PROGRAM = 'BQ09000';           
      WHEN(BRUGERDATA.DINDKAAR = '2008') PROGRAM = 'BQ08000';           
      WHEN(BRUGERDATA.DINDKAAR = '2007') PROGRAM = 'BQ07000';           
      WHEN(BRUGERDATA.DINDKAAR = '2006') PROGRAM = 'BQ06000';           
      WHEN(BRUGERDATA.DINDKAAR = '2005') PROGRAM = 'BQ05000';           
      WHEN(BRUGERDATA.DINDKAAR = '2004') PROGRAM = 'BQ04000';           
      WHEN(BRUGERDATA.DINDKAAR = '2003') PROGRAM = 'BQ03000';           
      WHEN(BRUGERDATA.DINDKAAR = '2002') PROGRAM = 'BQ02000';           
      WHEN(BRUGERDATA.DINDKAAR = '2001') PROGRAM = 'BQ01000';           
      WHEN(BRUGERDATA.DINDKAAR = '2000') PROGRAM = 'BQ00000';           
      OTHER LINKAREAL.FEJLNR = 2;                                       
                /* SENDER FEJLMEDD. TIL CSC - INDKOMSTÅR IKKE VALIDT */ 
     END;                                                               
   END;                                                                 
   WHEN(813) /* BATCH EVSBERES ÅRSOPGØRELSE AFVISES EFTER 2015*/        
     DO;                                                                
     SELECT;                                                            
    /*WHEN(BRUGERDATA.DINDKAAR = '2016') PROGRAM = 'BQ16030'; #01*/     
      WHEN(BRUGERDATA.DINDKAAR = '2015') PROGRAM = 'BQ15030';           
      WHEN(BRUGERDATA.DINDKAAR = '2014') PROGRAM = 'BQ14030';           
      WHEN(BRUGERDATA.DINDKAAR = '2013') PROGRAM = 'BQ13030';           
      WHEN(BRUGERDATA.DINDKAAR = '2012') PROGRAM = 'BQ12030';           
      WHEN(BRUGERDATA.DINDKAAR = '2011') PROGRAM = 'BQ11030';           
      WHEN(BRUGERDATA.DINDKAAR = '2010') PROGRAM = 'BQ10030';           
      WHEN(BRUGERDATA.DINDKAAR = '2009') PROGRAM = 'BQ09030';           
      WHEN(BRUGERDATA.DINDKAAR = '2008') PROGRAM = 'BQ08030';           
      WHEN(BRUGERDATA.DINDKAAR = '2007') PROGRAM = 'BQ07030';           
      WHEN(BRUGERDATA.DINDKAAR = '2006') PROGRAM = 'BQ06030';           
      WHEN(BRUGERDATA.DINDKAAR = '2005') PROGRAM = 'BQ05030';           
      WHEN(BRUGERDATA.DINDKAAR = '2004') PROGRAM = 'BQ04030';           
      WHEN(BRUGERDATA.DINDKAAR = '2003') PROGRAM = 'BQ03030';           
      WHEN(BRUGERDATA.DINDKAAR = '2002') PROGRAM = 'BQ02030';           
      WHEN(BRUGERDATA.DINDKAAR = '2001') PROGRAM = 'BQ01030';           
      WHEN(BRUGERDATA.DINDKAAR = '2000') PROGRAM = 'BQ00030';           
      OTHER LINKAREAL.FEJLNR = 2;                                       
                /* SENDER FEJLMEDD. TIL CSC - INDKOMSTÅR IKKE VALIDT */ 
     END;                                                               
   END;                                                                 
   WHEN(814) /* OMPLACERINGSANMODNING */  /*RUL */                      
     DO;                                                                
     SELECT;                                                            
      WHEN(BRUGERDATA.DINDKAAR = '2018') PROGRAM = 'BQ18070';           
      WHEN(BRUGERDATA.DINDKAAR = '2017') PROGRAM = 'BQ17070';           
      WHEN(BRUGERDATA.DINDKAAR = '2016') PROGRAM = 'BQ16070';           
      WHEN(BRUGERDATA.DINDKAAR = '2015') PROGRAM = 'BQ15070';           
      WHEN(BRUGERDATA.DINDKAAR = '2014') PROGRAM = 'BQ14070';           
      WHEN(BRUGERDATA.DINDKAAR = '2013') PROGRAM = 'BQ13070';           
      WHEN(BRUGERDATA.DINDKAAR = '2012') PROGRAM = 'BQ12070';           
      WHEN(BRUGERDATA.DINDKAAR = '2011') PROGRAM = 'BQ11070';           
      WHEN(BRUGERDATA.DINDKAAR = '2010') PROGRAM = 'BQ10070';           
      WHEN(BRUGERDATA.DINDKAAR = '2009') PROGRAM = 'BQ09070';           
      WHEN(BRUGERDATA.DINDKAAR = '2008') PROGRAM = 'BQ08070';           
      WHEN(BRUGERDATA.DINDKAAR = '2007') PROGRAM = 'BQ07070';           
      WHEN(BRUGERDATA.DINDKAAR = '2006') PROGRAM = 'BQ06070';           
      WHEN(BRUGERDATA.DINDKAAR = '2005') PROGRAM = 'BQ05070';           
      WHEN(BRUGERDATA.DINDKAAR = '2004') PROGRAM = 'BQ04070';           
      WHEN(BRUGERDATA.DINDKAAR = '2003') PROGRAM = 'BQ03070';           
      WHEN(BRUGERDATA.DINDKAAR = '2002') PROGRAM = 'BQ02070';           
      WHEN(BRUGERDATA.DINDKAAR = '2001') PROGRAM = 'BQ01070';           
      WHEN(BRUGERDATA.DINDKAAR = '2000') PROGRAM = 'BQ00070';           
      OTHER LINKAREAL.FEJLNR = 2;                                       
                /* SENDER FEJLMEDD. TIL CSC - INDKOMSTÅR IKKE VALIDT */ 
     END;                                                               
   END;                                                                 
   WHEN(815) DO; /* ONLINE EVSBERES ÅRSOPGØRELSE */                     
     SELECT;                                                            
      WHEN(BRUGERDATA.DINDKAAR = '2003') PROGRAM = 'BQ03030';           
      WHEN(BRUGERDATA.DINDKAAR = '2002') PROGRAM = 'BQ02030';           
      WHEN(BRUGERDATA.DINDKAAR = '2001') PROGRAM = 'BQ01035';           
      WHEN(BRUGERDATA.DINDKAAR = '2000') PROGRAM = 'BQ00035';           
      OTHER LINKAREAL.FEJLNR = 2;                                       
                /* SENDER FEJLMEDD. TIL CSC - INDKOMSTÅR IKKE VALIDT */ 
     END;                                                               
   END;                                                                 
   WHEN(816) /* EVSOPDAT MED ÆNDRING AF SKATTEPLIGTSOMFANG */           
     DO;                                                                
     SELECT;                                                            
      /* BRUGERDATA.DINDKAAR >= 2015 så skal det fejle */               
      WHEN(BRUGERDATA.DINDKAAR = '2014') PROGRAM = 'BQ14000';           
      WHEN(BRUGERDATA.DINDKAAR = '2013') PROGRAM = 'BQ13000';           
      WHEN(BRUGERDATA.DINDKAAR = '2012') PROGRAM = 'BQ12000';           
      WHEN(BRUGERDATA.DINDKAAR = '2011') PROGRAM = 'BQ11000';           
      WHEN(BRUGERDATA.DINDKAAR = '2010') PROGRAM = 'BQ10000';           
      WHEN(BRUGERDATA.DINDKAAR = '2009') PROGRAM = 'BQ09000';           
      WHEN(BRUGERDATA.DINDKAAR = '2008') PROGRAM = 'BQ08000';           
      WHEN(BRUGERDATA.DINDKAAR = '2007') PROGRAM = 'BQ07000';           
      WHEN(BRUGERDATA.DINDKAAR = '2006') PROGRAM = 'BQ06000';           
      WHEN(BRUGERDATA.DINDKAAR = '2005') PROGRAM = 'BQ05000';           
      WHEN(BRUGERDATA.DINDKAAR = '2004') PROGRAM = 'BQ04000';           
      WHEN(BRUGERDATA.DINDKAAR = '2003') PROGRAM = 'BQ03000';           
      WHEN(BRUGERDATA.DINDKAAR = '2002') PROGRAM = 'BQ02000';           
      WHEN(BRUGERDATA.DINDKAAR = '2001') PROGRAM = 'BQ01000';           
      WHEN(BRUGERDATA.DINDKAAR = '2000') PROGRAM = 'BQ00000';           
      OTHER LINKAREAL.FEJLNR = 2;                                       
                /* SENDER FEJLMEDD. TIL CSC - INDKOMSTÅR IKKE VALIDT */ 
     END;                                                               
   END;                                                                 
   OTHER LINKAREAL.FEJLNR = 1;                                          
  END;                                                                  
                                                                        
  IF CICS_LOG = 'J' THEN DO;                                            
      PUT SKIP LIST ('BQ99900 - INDVNR  : '!!BRUGERDATA.INDVNR);        
      PUT SKIP LIST ('          DINDKAAR: '!!BRUGERDATA.DINDKAAR);      
      PUT SKIP LIST ('          PROGRAM : '!!PROGRAM);                  
    END;                                                                
                                                                        
  IF PROGRAM = 'BQ99900'                                                
  THEN DO;                                                              
    LINKAREAL.OUTPUTLENGTH = STG(FEJLDATA);                             
    CALL GETMAIN(LINKAREAL.OUTPUTPTR,LINKAREAL.OUTPUTLENGTH);           
                                                                        
    FEJLDATA = BRUGERDATA, BY NAME;                                     
                                                                        
    IF LINKAREAL.FEJLNR = 1 THEN                                        
       FEJLDATA.FEJLNR = '5068';                                        
    ELSE DO;                                                            
       FEJLDATA.FEJLNR = '5069';                                        
       PUT SKIP LIST('BQ99900 - 5069 FEJL');                            
    END;                                                                
                                                                        
    EXEC CICS RETURN;                                                   
  END;                                                                  
                                                                        
  EXEC CICS LINK PROGRAM(PROGRAM)                                       
                 COMMAREA(LINKAREAL)                                    
                 RESP(LINKRC);                                          
                                                                        
  IF LINKAREAL.FEJLNR < 0 THEN                                          
    CALL FREEMAIN(LINKAREAL.OUTPUTPTR);                                 
                                                                        
  IF LINKRC ^= DFHRESP(NORMAL) THEN DO;                                 
    ZS378TEKST = 'FEJL VED LINK TIL PROGRAM ' !! PROGRAM;               
    CALL ABEND_PROCEDURE;                                               
  END;                                                                  
  EXEC CICS RETURN;                                                     
 /**********************************************************************
 *    ABEND PÅ EN PÆN MÅDE                                             *
 **********************************************************************/
 ABEND_PROCEDURE:  PROC;                                                
   ZS378FUNK  = '04';         /* AFSLUT, COMMAREA SLETTES     */        
   ZS378TYPE  = 'CICS';                                                 
   ZS378MODUL = 'BQ99900';                                              
   %INCLUDE ZS37802M;                                                   
 END ABEND_PROCEDURE;                                                   
                                                                        
 %INCLUDE ZX23000G;        /* GETMAIN RUTINE     */                     
 %INCLUDE ZX23000F;        /* FREEMAIN RUTINE    */                     
 END BQ99900;                                                           
