 PROCESS OPT(TIME);                                                     
 BH46100:/* DAN DATA TIL EVS PERSONTABEL SAMT SLUT PÅ CSC */            
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /********************************************************************/ 
         DCL COPYRIGHT   CHAR      (30) STATIC                          
                         INIT ('COPYRIGHT KMD A/S 2018');               
 /**********************************************************************
 *                                                                     *
 * FORMÅL :  DAN DATA TIL EVS EJERSKABSTABELLER SAMT SLUT PÅ CSC       *
 *                                                                     *
 **********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL BQ200I  FILE RECORD INPUT;  /* BEREGN.BÅND EFTER BEREGN.         */
 DCL BQ210I  FILE RECORD INPUT;  /* BEREGN.BÅND EFTER BEREGN.         */
 DCL BQ300I  FILE RECORD INPUT;  /* BEREGN.BÅND EFTER BEREGN.         */
 DCL BQ310I  FILE RECORD INPUT;  /* BEREGN.BÅND EFTER BEREGN.         */
                                                                        
 DCL BQ200O  FILE RECORD OUTPUT; /* LOADFIL EJERSKABSTABEL            */
 DCL BQ210O  FILE RECORD OUTPUT; /* LOADFIL EJERSKABSFELTTABEL        */
 DCL BQ300O  FILE RECORD OUTPUT; /* LOADFIL EJERSKABSTABEL            */
 DCL BQ310O  FILE RECORD OUTPUT; /* LOADFIL EJERSKABSFELTTABEL        */
                                                                        
 /********************************************************************* 
 *       DECLARE AF UDTRÆK (LOAD-GRUNDLAG)                            * 
 *********************************************************************/ 
 DCL     1 BQ200_STRUK,         /* EJENDOMSTABEL */                     
           %INCLUDE BQ20000N;;                                          
                                                                        
 DCL     1 BQ210_STRUK,         /* EJENDOMSFELTTABEL  */                
           %INCLUDE BQ21000N;;                                          
                                                                        
 DCL     1 BQ300_STRUK,         /* EJERSKABSTABEL */                    
           %INCLUDE BQ30000N;;                                          
                                                                        
 DCL     1 BQ310_STRUK,         /* EJERSKABSFELTTABEL  */               
           %INCLUDE BQ31000N;;                                          
                                                                        
 /********************************************************************* 
 *       DECLARE AF BUILTIN'S                                         * 
 *********************************************************************/ 
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 /********************************************************************* 
 *       DECLARE AF ENTRY'S                                           * 
 *********************************************************************/ 
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     EOF_BQ200I      BIT       (1);                                 
 DCL     EOF_BQ210I      BIT       (1);                                 
 DCL     EOF_BQ300I      BIT       (1);                                 
 DCL     EOF_BQ310I      BIT       (1);                                 
                                                                        
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
                                                                        
 DCL     TV_BQ200_LÆS    BIN FIXED(31) INIT(0);                         
 DCL     TV_BQ200_SKRIV  BIN FIXED(31) INIT(0);                         
 DCL     TV_BQ210_LÆS    BIN FIXED(31) INIT(0);                         
 DCL     TV_BQ210_SKRIV  BIN FIXED(31) INIT(0);                         
 DCL     TV_BQ300_LÆS    BIN FIXED(31) INIT(0);                         
 DCL     TV_BQ300_SKRIV  BIN FIXED(31) INIT(0);                         
 DCL     TV_BQ310_LÆS    BIN FIXED(31) INIT(0);                         
 DCL     TV_BQ310_SKRIV  BIN FIXED(31) INIT(0);                         
                                                                        
                                                                        
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
                                                                        
         ON ERROR                                                       
            CALL PLIDUMP ('SNHOB');                                     
                                                                        
         OPEN FILE (BQ200I)  TITLE ('BH46120I');                        
         OPEN FILE (BQ210I)  TITLE ('BH46121I');                        
         OPEN FILE (BQ300I)  TITLE ('BH46130I');                        
         OPEN FILE (BQ310I)  TITLE ('BH46131I');                        
                                                                        
         OPEN FILE (BQ200O)  TITLE ('BH46120O');                        
         OPEN FILE (BQ210O)  TITLE ('BH46121O');                        
         OPEN FILE (BQ300O)  TITLE ('BH46130O');                        
         OPEN FILE (BQ310O)  TITLE ('BH46131O');                        
                                                                        
                                                                        
         ON ENDFILE (BQ200I)                                            
            EOF_BQ200I = JA;                                            
                                                                        
         ON ENDFILE (BQ210I)                                            
            EOF_BQ210I = JA;                                            
                                                                        
         ON ENDFILE (BQ300I)                                            
            EOF_BQ300I = JA;                                            
                                                                        
         ON ENDFILE (BQ310I)                                            
            EOF_BQ310I = JA;                                            
                                                                        
                                                                        
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL LÆS_BQ200;                                                
                                                                        
         DO WHILE (EOF_BQ200I = NEJ);                                   
            BQ200_STRUK.DINDKAAR    = 2018;                             
            CALL SKRIV_BQ200;                                           
            CALL LÆS_BQ200;                                             
         END;                                                           
                                                                        
         CALL LÆS_BQ210;                                                
                                                                        
         DO WHILE (EOF_BQ210I = NEJ);                                   
            BQ210_STRUK.DINDKAAR    = 2018;                             
            CALL SKRIV_BQ210;                                           
            CALL LÆS_BQ210;                                             
         END;                                                           
                                                                        
         CALL LÆS_BQ300;                                                
                                                                        
         DO WHILE (EOF_BQ300I = NEJ);                                   
            BQ300_STRUK.DINDKAAR    = 2018;                             
            CALL SKRIV_BQ300;                                           
            CALL LÆS_BQ300;                                             
         END;                                                           
                                                                        
         CALL LÆS_BQ310;                                                
                                                                        
         DO WHILE (EOF_BQ310I = NEJ);                                   
            BQ310_STRUK.DINDKAAR    = 2018;                             
            CALL SKRIV_BQ310;                                           
            CALL LÆS_BQ310;                                             
         END;                                                           
                                                                        
         CLOSE FILE (BQ200I);                                           
         CLOSE FILE (BQ210I);                                           
         CLOSE FILE (BQ300I);                                           
         CLOSE FILE (BQ310I);                                           
                                                                        
         CLOSE FILE (BQ200O);                                           
         CLOSE FILE (BQ210O);                                           
         CLOSE FILE (BQ300O);                                           
         CLOSE FILE (BQ310O);                                           
                                                                        
         PUT SKIP LIST('TV_BQ200_LÆS   = ',TV_BQ200_LÆS);               
         PUT SKIP LIST('TV_BQ200_SKRIV = ',TV_BQ200_SKRIV);             
                                                                        
         PUT SKIP LIST('TV_BQ210_LÆS   = ',TV_BQ210_LÆS);               
         PUT SKIP LIST('TV_BQ210_SKRIV = ',TV_BQ210_SKRIV);             
                                                                        
         PUT SKIP LIST('TV_BQ300_LÆS   = ',TV_BQ300_LÆS);               
         PUT SKIP LIST('TV_BQ300_SKRIV = ',TV_BQ300_SKRIV);             
                                                                        
         PUT SKIP LIST('TV_BQ310_LÆS   = ',TV_BQ310_LÆS);               
         PUT SKIP LIST('TV_BQ310_SKRIV = ',TV_BQ310_SKRIV);             
                                                                        
 /*********************************************************************/
 SKRIV_BQ200: PROC;                                                     
                                                                        
      WRITE FILE(BQ200O) FROM(BQ200_STRUK);                             
                                                                        
      TV_BQ200_SKRIV = TV_BQ200_SKRIV + 1;                              
                                                                        
 END SKRIV_BQ200;                                                       
 /*********************************************************************/
 LÆS_BQ200: PROC;                                                       
                                                                        
      READ FILE(BQ200I) INTO (BQ200_STRUK);                             
                                                                        
      TV_BQ200_LÆS = TV_BQ200_LÆS + 1;                                  
                                                                        
 END LÆS_BQ200;                                                         
                                                                        
 /*********************************************************************/
 SKRIV_BQ210: PROC;                                                     
                                                                        
      WRITE FILE(BQ210O) FROM(BQ210_STRUK);                             
                                                                        
      TV_BQ210_SKRIV = TV_BQ210_SKRIV + 1;                              
                                                                        
 END SKRIV_BQ210;                                                       
 /*********************************************************************/
 LÆS_BQ210: PROC;                                                       
                                                                        
      READ FILE(BQ210I) INTO (BQ210_STRUK);                             
                                                                        
      TV_BQ210_LÆS = TV_BQ210_LÆS + 1;                                  
                                                                        
 END LÆS_BQ210;                                                         
 /*********************************************************************/
 SKRIV_BQ300: PROC;                                                     
                                                                        
      WRITE FILE(BQ300O) FROM(BQ300_STRUK);                             
                                                                        
      TV_BQ300_SKRIV = TV_BQ300_SKRIV + 1;                              
                                                                        
 END SKRIV_BQ300;                                                       
 /*********************************************************************/
 LÆS_BQ300: PROC;                                                       
                                                                        
      READ FILE(BQ300I) INTO (BQ300_STRUK);                             
                                                                        
      TV_BQ300_LÆS = TV_BQ300_LÆS + 1;                                  
                                                                        
 END LÆS_BQ300;                                                         
 /*********************************************************************/
 SKRIV_BQ310: PROC;                                                     
                                                                        
      WRITE FILE(BQ310O) FROM(BQ310_STRUK);                             
                                                                        
      TV_BQ310_SKRIV = TV_BQ310_SKRIV + 1;                              
                                                                        
 END SKRIV_BQ310;                                                       
 /*********************************************************************/
 LÆS_BQ310: PROC;                                                       
                                                                        
      READ FILE(BQ310I) INTO (BQ310_STRUK);                             
                                                                        
      TV_BQ310_LÆS = TV_BQ310_LÆS + 1;                                  
                                                                        
 END LÆS_BQ310;                                                         
 /*********************************************************************/
 END  BH46100;                                                          
                                                                        
