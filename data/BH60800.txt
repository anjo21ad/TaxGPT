 PROCESS AG,A(F),GOSTMT,OPT(TIME);                                      
 BH60800: /***  PRINT EJENDOMSSKEMA  ***/                               
         PROC (EXECPARM) OPTIONS (MAIN) REORDER;                        
 /*********************************************************************/
         DCL COPYRIGHT   CHAR      (30) STATIC                          
                         INIT ('COPYRIGHT KOMMUNEDATA I/S 1999');       
 /*********************************************************************/
 /*                                                                   */
 /*          OPGAVE   :   AT UDSKRIVE EJENDOMSSKEMA                   */
 /*                                                                   */
 /*          INPUT    :   B.H62011D  SORTERET EJD.UDTRÆK              */
 /*                       VB.R90200D KOMMUNETABEL (FORSKUD)           */
 /*                       PARMKORT                                    */
 /*                                                                   */
 /*          OUTPUT   :   BH60801Y  KOMMUNETOTALER                    */
 /*                       BH60802Y  EJD.SKEMA TIL KOMMUNEN IKKE FALSET*/
 /*                       BH60803Y  EJD.SKEMA DER SKAL FALSES         */
 /*                       BH60804Y  EJD.SKEMA TIL KUVERTERING         */
 /*                       OBS.:     KUVERTERING IKKE TILBUDT          */
 /*                       BH60805Y  TOTALLISTE FOR RC                 */
 /*                       BH60806Y  EVT. FEJLLISTE FRA MASK. AFSTEMN. */
 /*                                                                   */
 /*          EXT. REF.:   BH60810  PRINT STREGKODER PÅ EJENDOMSSKEMA  */
 /*                       OBS.:     KUVERTERING IKKE TILBUDT,         */
 /*                                 DERFOR BRUGES BH60810 HELLER IKKE.*/
 /*                       BH60830  REDIGERING AF PRINTLINIER          */
 /*                                                                   */
 /*          STRUKTURER   BH62010N UDTRÆK, BEREGNINGSRECORD           */
 /*                       BH60199N UDTRÆK, OPTÆLLINGSRECORD           */
 /*                       ZZ20301M SPOOL MACRO                        */
 /*                                                                   */
 /*          PROGRAMMØR:  MARGIT PEDERSBÆK,  SEPTEMBER 1990           */
 /*          RETTET    :  AAGE RASMUSSEN,    NOVEMBER  1991           */
 /*          RETTET    :  AAGE RASMUSSEN,    NOVEMBER  1992           */
 /*          RETTET    :  AAGE RASMUSSEN,    JANUAR    1994           */
 /*          RETTET    :  AAGE RASMUSSEN,    DECEMBER  1994           */
 /*          RETTET    :  AAGE RASMUSSEN,    FEBRUAR   1995           */
 /*          RETTET    :  AAGE RASMUSSEN,    DECEMBER  1995           */
 /*          RETTET    :  AAGE RASMUSSEN PFB JANUAR    1997           */
 /*          RETTET    :  AAGE RASMUSSEN PFB JANUAR    1998           */
 /*          RETTET    :  AAGE RASMUSSEN PFB JANUAR    1999           */
 /*          RETTET    :  AAGE RASMUSSEN PFB DECEMBER  1999           */
 /*********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /*      PARAMETER TIL MARKERING PÅ SKEMA I FORBINDELSE MED  TEST     */
 DCL     EXECPARM        CHAR      (7) VAR;                             
 DCL     TESTNUM         CHAR      (5);                                 
         TESTNUM = EXECPARM;                                            
 DCL     PLIXOPT         CHAR (40) VARYING STATIC EXTERNAL              
                         INIT ('NOTEST(ALL,,;)');                       
 /*********************************************************************/
 /*       INPUT REGISTRE                                              */
 /*********************************************************************/
 DCL     BH6201I         FILE RECORD INPUT;                             
 /*********************************************************************/
 /*      STRUKTUR FOR INPUT                                           */
 /*********************************************************************/
 DCL     BH620_AR        CHAR (2000) VAR;                               
 DCL     1 BH620         BASED(ADDR(BH620_AR)),                         
           2 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH62010N;                                           
 DCL     1 BH62001       BASED (ADDR(BH620_AR)),                        
           2 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH60101N;                                           
 DCL     1 BH62099       BASED (ADDR(BH620_AR)),                        
           2 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH60199N;                                           
 DCL     HJ_CLIN(16)     PIC       '9'       BASED (ADDR(BH620.CLIN01));
                                                                        
         %INCLUDE ZZ20301M;                                             
                                                                        
 /*********************************************************************/
 /*               LINIER TIL EJENDOMSSKEMA                            */
 /*********************************************************************/
 DCL     LIN_IDX         BIN FIXED (15);                                
 DCL     LIN_TÆL         FIXED     (05) INIT (0);                       
 DCL     1 LIN_SKEMA,                                                   
           2 CCE         CHAR      (1),                                 
           2 FONT        CHAR      (1),                 /* XEROX FONT */
           2 PRINTLIN    CHAR      (131);                               
 DCL     1 SK0           BASED (ADDR(LIN_SKEMA)),                       
           2 CCE         CHAR      (1),                                 
           2 FONT        CHAR      (1),                 /* XEROX FONT */
           2 NAVN        CHAR      (43),                                
           2 REST        CHAR      (88);                                
 DCL     1 SK1           BASED (ADDR(LIN_SKEMA)),                       
           2 CCE         CHAR      (1),                                 
           2 FONT        CHAR      (1),                 /* XEROX FONT */
           2 NAVN        CHAR      (35),                                
           2 DISP1       CHAR      (7),                                 
           2 CVÆRGE      CHAR      (1),                                 
           2 CSMUDS      CHAR      (6),                                 
           2 DISP2       CHAR      (2),                                 
           2 CPR         CHAR      (11),                                
           2 REST        CHAR      (69);                                
 DCL     SK1_ESKYNR      PIC       '(10)ZB'  BASED (ADDR (SK1.CPR));    
 DCL     1 SK2           BASED (ADDR(LIN_SKEMA)),                       
           2 CCE         CHAR      (1),                                 
           2 FONT        CHAR      (1),                 /* XEROX FONT */
           2 DISP1       CHAR      (38),                                
           2 CLEJE       PIC       'Z',                                 
           2 DISP2       CHAR      (22),                                
           2 REST        CHAR      (70);                                
 DCL     1 SK3           BASED (ADDR(LIN_SKEMA)),                       
           2 CCE         CHAR      (1),                                 
           2 FONT        CHAR      (1),                 /* XEROX FONT */
           2 TEKST       CHAR      (100),                               
           2 REST        CHAR      (31);                                
 DCL     1 SK4           BASED (ADDR(LIN_SKEMA)),                       
           2 CCE         CHAR      (1),                                 
           2 FONT        CHAR      (1),                 /* XEROX FONT */
           2 F1          CHAR      (91),  /* OBS. LÆNGDE AFHÆNGER AF  */
                                          /*      FONTNR. PÅ GRUND AF */
                                          /*      PLACERING AF CPRNR. */
           2 CPR         CHAR      (14),                                
           2 REST        CHAR      (26);                                
                                                                        
 DCL     1 BOX_LIN1,                                                    
           2 CCE              CHAR  (1),                                
           2 FONT             CHAR  (1)   INIT ('4'),                   
           2 PNR              CHAR (14),                                
           2 REST             CHAR(117)   INIT (' ');                   
                                                                        
 DCL     1 BOX_LIN2,                                                    
           2 CCE              CHAR  (1),                                
           2 FONT             CHAR  (1)   INIT ('4'),                   
           2 PNR              CHAR (14),                                
           2 REST             CHAR(117)   INIT (' ');                   
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      AFSLUTTENDE RECORD (PARAGRAFTEGN X'B5' = IKKE PRINTBAR).     */
 /*                                                                   */
 /*********************************************************************/
                                                                        
 DCL     1 REC_AFSLUT,                                                  
           2 CCE              CHAR  (1),                                
           2 FONT             CHAR  (1),                                
           2 AFSLUTNING       CHAR(131)   INIT ('¤');                   
                                                                        
 /*********************************************************************/
 /*          LINIER TIL KOMMUNETOTALER                                */
 /*********************************************************************/
 DCL     1 KOM_LIN,                                                     
           2 CCE           CHAR      (1),                               
           2 PRINTLIN      CHAR      (132);                             
 DCL     1 KOM_LIN01       BASED (ADDR(KOM_LIN)),                       
           2 CCE           CHAR      (1),                               
           2 TXT1          CHAR      (62),                              
           2 TXT2          CHAR      (46),                              
           2 TXT3          CHAR      (14),                              
           2 DATO          CHAR      (10);                              
 DCL     1 KOM_LIN02,                                                   
           2 CCE           CHAR      (1),                               
           2 TXT1          CHAR      (12) INIT ('KOMMUNE'),             
           2 TXT2          CHAR      (15) INIT ('    ANT. EJD'),        
           2 TXT3          CHAR      (15) INIT ('ANTAL LINIER'),        
           2 TXT4          CHAR      (15) INIT ('ANTAL SIDER '),        
           2 TXT5          CHAR      (15) INIT ('ANTAL BLANKET.'),      
           2 TXT6          CHAR      (15) INIT ('ANTAL SKATTEYD.'),     
           2 TXT7          CHAR      (45) INIT (' ');                   
 /**       2 TXT7          CHAR      (15) INIT ('ANTAL SIDER '),        
           2 TXT8          CHAR      (15) INIT ('ANTAL BLANKET.'),      
           2 TXT9          CHAR      (15) INIT ('ANTAL SKATTEYD.'); **/ 
 DCL     1 KOM_LIN03,                                                   
           2 CCE           CHAR      (1),                               
           2 TXT1          CHAR      (12) INIT ('       '),             
           2 TXT2          CHAR      (15) INIT ('        '),            
           2 TXT3          CHAR      (15) INIT ('        '),            
           2 TXT4          CHAR      (15) INIT ('TIL KOMMUNE'),         
           2 TXT5          CHAR      (15) INIT ('TIL KOMMUNE'),         
           2 TXT6          CHAR      (15) INIT ('TIL KOMMUNE'),         
           2 TXT7          CHAR      (45) INIT (' ');                   
 /**       2 TXT7          CHAR      (15) INIT ('TIL KUVERT.'),         
           2 TXT8          CHAR      (15) INIT ('TIL KUVERT.'),         
           2 TXT9          CHAR      (15) INIT ('TIL KUVERT.');  **/    
 DCL     1 KOM_LIN04       BASED (ADDR (KOM_LIN)),                      
           2 CCE           CHAR      (1),                               
           2 DISP1         CHAR      (04),                              
           2 KOMNR         PIC       '999',                             
           2 DISP2         CHAR      (05),                              
           2 ANT2          PIC       'ZZZ.ZZZ.ZZ9',                     
           2 DISP3         CHAR      (01),                              
           2 ANT3          PIC       'ZZ.ZZZ.ZZZ.ZZ9',                  
           2 DISP4         CHAR      (01),                              
           2 ANT4          PIC       'ZZZ.ZZZ.ZZ9',                     
           2 DISP5         CHAR      (04),                              
           2 ANT5          PIC       'ZZZ.ZZZ.ZZ9',                     
           2 DISP6         CHAR      (04),                              
           2 ANT6          PIC       'ZZZ.ZZZ.ZZ9',                     
           2 DISP7         CHAR      (45) INIT (' ');                   
 /**       2 DISP7         CHAR      (04),                              
           2 ANT7          PIC       'ZZZ.ZZZ.ZZ9',                     
           2 DISP8         CHAR      (04),                              
           2 ANT8          PIC       'ZZZ.ZZZ.ZZ9',                     
           2 DISP9         CHAR      (04),                              
           2 ANT9          PIC       'ZZZ.ZZZ.ZZ9';  **/                
 DCL     KOM_IALT          CHAR      (4) BASED(ADDR(KOM_LIN04.KOMNR));  
 /*********************************************************************/
 /*          LINIER TIL TOTALLISTE FOR RC                             */
 /*********************************************************************/
 DCL     1 TOT_LIN,                                                     
           2 CCE           CHAR      (1),                               
           2 PRINTLIN      CHAR      (132);                             
 DCL     1 TOT_LIN01       BASED (ADDR(TOT_LIN)),                       
           2 CCE           CHAR      (1),                               
           2 TXT1          CHAR      (40),                              
           2 TXT2          CHAR      (68),                              
           2 TXT3          CHAR      (14),                              
           2 DATO          CHAR      (10);                              
 DCL     1 TOT_LIN02       BASED (ADDR(TOT_LIN)),                       
           2 CCE           CHAR      (1),                               
           2 TXT1          CHAR      (44),                              
           2 SIDER         PIC       'ZZZ.ZZZ.ZZZ.ZZ9',                 
           2 TXT2          CHAR      (44),                              
           2 LINIER        PIC       'ZZZ.ZZZ.ZZZ.ZZ9',                 
           2 REST          CHAR      (14);                              
 DCL     1 TOT_LIN03       BASED (ADDR(TOT_LIN)),                       
           2 CCE           CHAR      (1),                               
           2 TEXT (13),                                                 
             3 BLANK       CHAR      (2),                               
             3 TEKST       CHAR      (6),                               
             3 LINNR       PIC       'Z9',                              
           2 REST          CHAR      (2);                               
 DCL     1 TOT_LIN04       BASED (ADDR(TOT_LIN)),                       
           2 CCE           CHAR      (1),                               
           2 ANTAL(13),                                                 
             3 BLANK       CHAR      (1),                               
             3 ANT_LIN     PIC       'Z.ZZZ.ZZ9',                       
           2 REST          CHAR      (2);                               
                                                                        
 /*********************************************************************/
 /*                DIVERSE TÆLLE- OG HJÆLPEFELTER                     */
 /*********************************************************************/
 DCL     1 FEJL,                                /* FEJLMARKERINGER    */
           2 KODE        PIC       '9',         /*     KODE           */
           2 TEKST       CHAR      (41),        /*     TEKST          */
           2 LINIE       CHAR      (133);       /* FEJLLINIE LOGGES   */
 DCL     1 GEM,                                 /* GEMMEFELTER        */
           2 DCPRCIR     FIXED     (10),        /* SKATTEYDEREN       */
           2 ANAVN       CHAR      (35),        /* NAVN               */
           2 ACONA       CHAR      (35),        /* CO-NAVN            */
           2 AUADR       CHAR      (35),        /* ADRESSE            */
           2 ABYNA       CHAR      (35),        /* BYNAVN             */
           2 APADR       CHAR      (35),        /* POSTADRESSE        */
           2 AUDLADR     CHAR      (35),        /* UDENLANDSK ADRESSE */
           2 SORT_EÆKNR  FIXED     (3),         /* KOMMUNENR          */
           2 CAJOUR      CHAR      (1);         /* KØRSELSKODE=S EL P */
 DCL     NAVNTAB(6)      CHAR      (35) BASED(ADDR(GEM.ANAVN));         
 DCL   1 STREGKODE,                                                     
         2 NY_GRUPPE     BIT   (1),             /*       SLUT SK.YD. */ 
         2 NY_KOMMUNE    BIT   (1);             /*       NY KOMMUNE  */ 
 DCL     SIDETÆL         FIXED     (5) INIT (0);/* SIDETÆLLER PR.SKY */ 
 DCL     ANT_SIDELIN     FIXED     (5) INIT (0);/* LINIER PR. SIDE   */ 
                                                /* MED EJD.OPL.      */ 
 DCL     KOMBRUD         BIT       (1);                                 
 DCL     LBNR(99)        PIC       '(5)Z9';     /* LBNR. KOMM/LISTID */ 
 DCL     LISTIDENT       CHAR      (8);         /* LISTEID BH608XXY  */ 
 DCL     LISTID          PIC       '99';      /* LISTEIDENT 02,03,04 */ 
 DCL     LIST_ID         CHAR      (2) BASED (ADDR(LISTID));            
 DCL     1 KOM_ADR (101:910),                                           
           2 KOMINDV_OK  BIT        (1),/*KOMINDV SKRIVES I KØRSEL USA*/
           2 MYNVNADR    CHAR      (43),/*SLUTLIGN.KOMM.NAVN          */
           2 MYPOSTADR   CHAR      (37),/*SLUTLIGN.KOMM.ADRESSE       */
           2 MYPOSTNR    CHAR      (35);/*SLUTLIGN.KOMM.POSTNR        */
 DCL   1 OPTÆL,                                 /* TOTALLISTE FOR RC */ 
         2 LÆSTE_KOM     FIXED     (9),                                 
         2 LÆSTE_EJD     FIXED     (9),                                 
         2 LÆSTE_SKY     FIXED     (9),                                 
         2 SIDER         FIXED     (9),                                 
         2 LINIER        FIXED     (13),                                
         2 SIDE_02Y      FIXED     (7),                                 
         2 SIDE_04Y      FIXED     (7),                                 
         2 EJD_02Y       FIXED     (7),                                 
         2 EJD_04Y       FIXED     (7),                                 
         2 CLIN(16)      FIXED     (7),         /* TOTALLISTE FOR RC */ 
         2 CPERIOD       FIXED     (7);                                 
 DCL   1 KOMTAB(300),                           /* TOTALLISTE PR. KOM*/ 
         2 KOMNR         PIC       '999',                               
         2 FEJD          FIXED     (9),                                 
         2 FLIN          FIXED     (13),                                
         2 FSIDEKOM      FIXED     (9),                                 
         2 FSKMKOM       FIXED     (9),                                 
         2 FSKYKOM       FIXED     (9),                                 
         2 FSIDEKUV      FIXED     (9),                                 
         2 FSKMKUV       FIXED     (9),                                 
         2 FSKYKUV       FIXED     (9);                                 
 DCL     KOMINDX         BIN FIXED (15);                                
 DCL     HJCPR           CHAR      (14) INIT (' ');                     
 DCL     PICCPR          PIC       '99B99B99B99B99' DEF HJCPR;          
 DCL     STREG1          CHAR      (1)  DEF HJCPR  POS (9);             
 DCL     HJEJD           CHAR      (7)  INIT (' ');                     
 DCL     PICEJD          PIC       '99999B9' DEF HJEJD;                 
 DCL     STREG2          CHAR      (1)  DEF HJEJD  POS (6);             
 DCL   ( I, J, K, N )    BIN FIXED (15);                                
 DCL     EOF_BH620       BIT       (1);                                 
 DCL     JA              BIT       (1)        INIT ('1'B);              
 DCL     NEJ             BIT       (1)        INIT ('0'B);              
 DCL     FØRSTEGANG      BIT       (1);                                 
 DCL     BOX_LIN1_OK     BIT       (1);                                 
 DCL     BOX_LIN2_OK     BIT       (1);                                 
                                                                        
 DCL     UDDATO          CHAR      (10);                                
                                                                        
 DCL     DATO1           CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
                                                                        
 DCL     TVLIN           FIXED     (3);                                 
 DCL     TEKSTTABEL      CHAR      (1600);                              
 DCL     TEKSTTAB(16)    CHAR      (100) BASED (ADDR (TEKSTTABEL));     
 /*********************************************************************/
 /*             FELTER TIL ENTRY POINTS OG BUILTIN FUNCTIONS.         */
 /*********************************************************************/
 DCL     BH60830     ENTRY;                 /* REDIGER LINIER         */
 DCL     ZS30101     ENTRY;                 /* ABENDRUTINE            */
 DCL     ZS34900     ENTRY OPTIONS(INTER ASM);                          
 DCL     ZS38100     ENTRY OPTIONS(INTER ASM);        /* TIMESTAMP    */
 DCL     ZS61900     ENTRY;                 /* SKRIV SSI-DATO I LOG   */
 DCL     ADDR        BUILTIN;                                           
 DCL     STG         BUILTIN;                                           
 DCL     SUM         BUILTIN;                                           
 DCL     INDEX       BUILTIN;                                           
 DCL     LOW         BUILTIN;                                           
 DCL     MOD         BUILTIN;                                           
 DCL     PLIDUMP     BUILTIN;                                           
 DCL     SUBSTR      BUILTIN;                                           
 DCL     VERIFY      BUILTIN;                                           
 %INCLUDE AS27100N;                                                     
 /*********************************************************************/
 /*                 DEFINITIONER TIL PARM.KORT                        */
 /*********************************************************************/
 DCL     1 PARMTAB(101:999),                                            
           2 KOMNR        FIXED    (2),                                 
           2 FALSN        CHAR     (1);                                 
 DCL     PARMTÆL          FIXED    (3)      INIT (0);                   
 DCL     1  PARM_KORT,                                                  
            2  IDENT      CHAR     (9),                                 
            2  BLANK1     CHAR     (1),                                 
            2  KOMMUNE    CHAR     (3),                                 
            2  FALSN      CHAR     (1),                                 
            2  BLANK2     CHAR     (66);                                
 DCL     PARM_KOM         PIC   '999'   BASED (ADDR(PARM_KORT.KOMMUNE));
 /*********************************************************************/
 /*                        HOUSEKEEPING.                              */
 /*********************************************************************/
         CALL ZS61900;                      /* SSI DATO I LOGLISTE    */
         ON ERROR                                                       
            CALL PLIDUMP('SNHOB');                                      
         ON ENDFILE (BH6201I)                                           
            EOF_BH620 = JA;                                             
         FØRSTEGANG  = JA;                                              
         FEJL        =  '';                                             
         GEM         =  '';                                             
         OPTÆL       =  '';                                             
         KOMTAB(*)   =  '';                                             
         KOM_ADR(*)  =  '';                                             
         KOMINDX     =   0;                                             
         STREGKODE   =  '';                                             
         BOX_LIN1_OK = NEJ; /* EJERS PERSONNUMMER */                    
         BOX_LIN2_OK = NEJ; /* ÆGTEFÆLLES PERSONNUMMER */               
         OPEN FILE(BH6201I) TITLE('BH62011I');                          
         CALL ZZ20390 ('*OPEN','BH60801Y');                             
         CALL ZZ20390 ('*OPEN','BH60802Y');                             
         CALL ZZ20390 ('*OPEN','BH60803Y');                             
      /* CALL ZZ20390 ('*OPEN','BH60804Y'); */                          
         CALL ZZ20390 ('*OPEN','BH60805Y');                             
         CALL ZZ20390 ('*OPEN','BH60806Y');                             
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         CALL SKAF_PARM_OPLYSNINGER;                                    
 /*********************************************************************/
 /*                                                                   */
 /*                  H O V E D S T Y R I N G                          */
 /*                                                                   */
 /*********************************************************************/
                                                                        
         CALL SKAF_INPUT;                                               
                                                                        
         DO WHILE (EOF_BH620 = NEJ & BH620.SORT_KOMNR < 999);           
                                                                        
            CALL SKRIV_SKEMA;                                           
            CALL SKAF_INPUT;                                            
                                                                        
         END;                                                           
                                                                        
         IF OPTÆL.LÆSTE_EJD > 0                                         
         THEN                                                           
            CALL AFSLUT_SIDSTE_PERSON;                                  
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /*********************************************************************/
 /*       AFSLUT       - SIDSTE PERSON FÆRDIGBEHANDLES OG OPTÆLLES    */
 /*                    - SIDSTE KOMMUNE FAKTURERES                    */
 /*********************************************************************/
 AFSLUT_SIDSTE_PERSON:                                                  
         PROC;                                                          
                                                                        
         IF BOX_LIN1_OK = JA                                            
         THEN                                                           
            CALL SKRIV_BOX;                                             
                                                                        
         IF MOD (SIDETÆL,2) =1               /* ULIGE SIDETAL        */ 
         THEN                                /* SÅ SKRIV BLK SIDE 2  */ 
            DO;                                                         
               STREGKODE.NY_GRUPPE  =  '1'B;                            
               CALL SKRIV_STREGKODE;                                    
               CALL SKRIV_SIDE2_U_DATA;                                 
            END;                                                        
                                                                        
         CALL OPTÆL_NYSKY;                        /* SIDSTE PERSON    */
         CALL FAKTURERING;                        /* SIDSTE KOMMUNE   */
                                                                        
 END AFSLUT_SIDSTE_PERSON;                                              
 /*********************************************************************/
 /*       AFSLUT       - TOTALLISTE UDSKRIVES                         */
 /*                    - DATASÆT OG SPOOL LUKKES                      */
 /*********************************************************************/
 AFSLUT:                                                                
         PROC;                                                          
                                                                        
         CALL TOTALLISTE;                         /* TOTALLISTE F. RC */
         CALL SKRIV_KOMMUNETOTAL;                 /* TOTALLISTE F. KM */
                                                                        
         CALL MASK_AFSTEMNING;                    /* MASKINEL AFSTEMN.*/
                                                                        
         CALL ZZ20301((133)' ','99');             /* CLOSE SPOOL      */
                                                                        
         CLOSE FILE   (BH6201I);                  /* CLOSE UDTRÆKSFIL */
                                                                        
 END AFSLUT;                                                            
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      KONTROLLER OM PARM-OPLYSNINGER SKAL TAGES FRA VB.R90200D     */
 /*      (FORSKUDS KOMMUNETABEL)  E L L E R  FRA PARAMETERKORT.       */
 /*                                                                   */
 /*      VB.R90200D BRUGES  K U N  HVIS DD-NAVN PARM ER SAT LIG DUMMY */
 /*      I JCL-LET, D.V.S. AT OPLYSNINGER  A L T I D  TAGES FRA EVT.  */
 /*      PARAMETERKORT HVIS DD-NAVN  I K K E  ER SAT LIG DUMMY.       */
 /*                                                                   */
 /*********************************************************************/
 SKAF_PARM_OPLYSNINGER: PROC;                                           
                                                                        
 DCL     BR902I  FILE RECORD INPUT SEQUENTIAL KEYED ENV(VSAM);          
 DCL     PARMFIL FILE RECORD INPUT;                                     
                                                                        
 DCL     1 BR902,                                                       
         %INCLUDE BR90200N;                                             
                                                                        
 DCL     EOF_BR902        BIT      (1);                                 
 DCL     EOF_PARM         BIT      (1);                                 
                                                                        
 DCL     ZS61500         ENTRY OPTIONS(INTER ASM); /* SKAF DSN-NAVN   */
                                                                        
 DCL     DDNAVN          CHAR      (8);                                 
 DCL     DSNNAVN         CHAR      (44);                                
 DCL     VOLNR           CHAR      (6);                                 
                                                                        
         PARMTAB(*) = '';                                               
                                                                        
         DDNAVN = 'PARM    ';                                           
         CALL ZS61500(DDNAVN,DSNNAVN,VOLNR);                            
                                                                        
         IF SUBSTR(DSNNAVN,1,8) = 'NULLFILE'                            
         THEN                                                           
            DO;                                                         
               /* D.V.S. DDNAVN PARM ER SAT LIG DUMMY */                
                                                                        
               EOF_BR902 = NEJ;                                         
               OPEN FILE (BR902I) TITLE ('BR90200I');                   
               ON ENDFILE (BR902I)                                      
                  EOF_BR902 = JA;                                       
                                                                        
               CALL SKAF_BESTILLINGER;                                  
                                                                        
               CLOSE FILE (BR902I);                                     
                                                                        
            END;                                                        
         ELSE                                                           
            DO;                                                         
                                                                        
               EOF_PARM = NEJ;                                          
               OPEN FILE (PARMFIL) TITLE ('PARM');                      
               ON ENDFILE (PARMFIL)                                     
                  EOF_PARM = JA;                                        
                                                                        
               CALL INDLÆS_PARM;                                        
                                                                        
               CLOSE FILE (PARMFIL);                                    
                                                                        
            END;                                                        
                                                                        
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      SKAF PARM-OPLYSNINGER FRA VB.R90200D (FORSKUD-KOMMUNETABEL)  */
 /*                                                                   */
 /*********************************************************************/
 SKAF_BESTILLINGER: PROC;                                               
                                                                        
         READ FILE(BR902I) INTO (BR902);                                
                                                                        
         DO WHILE (EOF_BR902 = NEJ);                                    
                                                                        
            IF BR902.EMYND > 100                                        
            THEN                                                        
               DO;                                                      
                  PARMTAB(BR902.EMYND).KOMNR = BR902.EMYND;             
            /**   PARMTAB(BR902.EMYND).KUVERT = BR902.ESKMKUVE; **/     
                  PARMTAB(BR902.EMYND).FALSN = BR902.ESKMFALS;          
               END;                                                     
                                                                        
            READ FILE(BR902I) INTO (BR902);                             
                                                                        
         END;                                                           
                                                                        
 END SKAF_BESTILLINGER;                                                 
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*                OPSÆTNING AF PARMTAB FRA PARAMETERKORT             */
 /*                                                                   */
 /*********************************************************************/
 INDLÆS_PARM:                                                           
         PROC;                                                          
         READ FILE (PARMFIL) INTO (PARM_KORT);                          
         DO WHILE (EOF_PARM = NEJ);                                     
            IF  PARM_KORT.IDENT  ^= '>>BH60800'        !                
                PARM_KORT.BLANK1 ^= ' '                !                
                SUBSTR(PARM_KORT.BLANK2,1,57)  ^= ' '          !        
                VERIFY (PARM_KORT.KOMMUNE,'0123456789')  >  0           
            THEN                                                        
               DO;                                                      
                  FEJL.KODE    =  1;                                    
                  FEJL.TEKST   =  'SYNTAXFEJL I PARM.KORT, KOMMUNE ' !! 
                                   PARM_KORT.KOMMUNE;                   
               END;                                                     
            IF  PARM_KORT.KOMMUNE  < '101'         !                    
                PARM_KORT.KOMMUNE  > '998'                              
            THEN                                                        
               DO;                                                      
                  FEJL.KODE    =  2;                                    
                  FEJL.TEKST   =  'FORKERT KOMMUNENR I PARM.KORT : ' !! 
                                   PARM_KORT.KOMMUNE;                   
               END;                                                     
     /**    IF  PARM_KORT.KUVERT ^= ' ' &                               
                PARM_KORT.KUVERT ^= '1'                                 
            THEN                                                        
               DO;                                                      
                  FEJL.KODE    =  2;                                    
                  FEJL.TEKST   =  'FORKERT KODE FOR KUVERTERING    ' !! 
                                   PARM_KORT.KOMMUNE;                   
               END;   **/                                               
            IF  PARM_KORT.FALSN  ^= ' ' &                               
                PARM_KORT.FALSN  ^= '1'                                 
            THEN                                                        
               DO;                                                      
                  FEJL.KODE    =  2;                                    
                  FEJL.TEKST   =  'FORKERT KODE FOR FALSNING       ' !! 
                                   PARM_KORT.KOMMUNE;                   
               END;                                                     
            PARMTÆL =  PARMTÆL  +  1;                                   
            IF  PARMTÆL > 276                                           
            THEN                                                        
               DO;                                                      
                  FEJL.KODE    =  3;                                    
                  FEJL.TEKST   =  'ANTALLET  AF PARM.KORT ' !!          
                                  'OVERSTIGER MAXIMUM';                 
               END;                                                     
            IF  FEJL.KODE  >  0    /*  AFBRYD KØRSEL MED FEJL ..... */  
            THEN                                                        
               CALL ZS30101(5,'BH60800 ** 251 '!!FEJL.TEKST,2);         
            ELSE                                                        
               DO;                                                      
                  PARMTAB(PARM_KOM).KOMNR  = PARM_KOM;                  
            /**   PARMTAB(PARM_KOM).KUVERT = PARM_KORT.KUVERT;  **/     
                  PARMTAB(PARM_KOM).FALSN  = PARM_KORT.FALSN;           
               END;                                                     
            READ FILE (PARMFIL) INTO (PARM_KORT);                       
         END;    /* DO WHILE */                                         
                                                                        
 END INDLÆS_PARM;                                                       
                                                                        
 END SKAF_PARM_OPLYSNINGER;                                             
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*                LÆS_INPUT_FIL                                      */
 /*                                                                   */
 /*********************************************************************/
 SKAF_INPUT:   PROC;                                                    
         READ  FILE (BH6201I) INTO (BH620_AR);                          
         IF BH620.SORT_KOMNR < 999 & EOF_BH620 = NEJ                    
         THEN                                                           
            DO;                                                         
               IF BH620.SORT_CPR = 0   /* KOMMUNEINDIVID */             
               THEN                                                     
                  DO;                                                   
                     OPTÆL.LÆSTE_KOM = OPTÆL.LÆSTE_KOM + 1;             
                     CALL BEHANDL_KOMINDV;                              
                  END;                                                  
               ELSE                                                     
                  OPTÆL.LÆSTE_EJD = OPTÆL.LÆSTE_EJD + 1;                
            END;                                                        
 END SKAF_INPUT;                                                        
                                                                        
 /********************************************************************* 
 *       OPSAML AF KOMMUNEADRESSER FRA B.H62011D'S KOMMUNEINDIVIDER   * 
 *********************************************************************/ 
 BEHANDL_KOMINDV:                                                       
         PROC;                                                          
                                                                        
         DO WHILE ( BH620.SORT_CPR = 0 & ^EOF_BH620 );                  
            K = BH62001.EÆKNR;                                          
            KOM_ADR(K).KOMINDV_OK = '1'B;                               
            KOM_ADR(K).MYNVNADR  = BH62001.MYNVNADR;                    
            KOM_ADR(K).MYPOSTADR = BH62001.MYPOSTADR;                   
            KOM_ADR(K).MYPOSTNR  = BH62001.MYPOSTNR;                    
            CALL SKAF_INPUT;                                            
         END;                                                           
                                                                        
 END BEHANDL_KOMINDV;                                                   
 /*********************************************************************/
 /*                                                                   */
 /*                KOMMUNEBRUD                                        */
 /*                                                                   */
 /*********************************************************************/
 KOMMUNEBRUD:                                                           
         PROC;                                                          
                                                                        
 DCL     SPOOL_KOMNR    CHAR (8) INIT ((8)' '); /*  TIL SPOOL KALD . */ 
 DCL     SPOOL_KOMP     PIC '9999' BASED(ADDR(SPOOL_KOMNR));            
                                                                        
         IF FØRSTEGANG = NEJ                                            
         THEN                                                           
            DO;                                                         
               CALL SKRIV_KOMMUNETOTAL; /* TOTALLISTE F. KM */          
               CALL FAKTURERING;                                        
            END;                                                        
                                                                        
         FØRSTEGANG = NEJ;                                              
                                                                        
   /**   STREGKODE.NY_KOMMUNE = '1'B;  **/                              
                                                                        
         LBNR(*) =  0;                                                  
                                                                        
         SPOOL_KOMP = BH620.SORT_EÆKNR;                                 
                                                                        
   /**   IF PARMTAB(BH620.SORT_EÆKNR).KUVERT = '1'                      
         THEN                                                           
            CALL ZZ20390('*SUB','BH60804Y',SPOOL_KOMNR);  **/           
                                                                        
         IF PARMTAB(BH620.SORT_EÆKNR).FALSN = '1'                       
         THEN                                                           
            CALL ZZ20390('*SUB','BH60803Y',SPOOL_KOMNR);                
         ELSE                                                           
            CALL ZZ20390('*SUB','BH60802Y',SPOOL_KOMNR);                
                                                                        
         CALL ZZ20390('*SUB','BH60801Y',SPOOL_KOMNR);                   
                                                                        
 END KOMMUNEBRUD;                                                       
 /*********************************************************************/
 /*                                                                   */
 /*       SKRIV EJENDOMSSKEMA                                         */
 /*                                                                   */
 /*********************************************************************/
 SKRIV_SKEMA:                                                           
         PROC;                                                          
         IF GEM.DCPRCIR   ^= BH620.DCPRCIR    !                         
            BH620.DCPRCIR <    0100000000     !                         
            BH620.DCPRCIR >=   3200000000                               
         THEN                                                           
            DO;                                                         
               IF GEM.SORT_EÆKNR > 0   /* IKKE FØRSTE GANG */           
               THEN                                                     
                 CALL OPTÆL_NYSKY;                                      
               CALL NY_SKATTEYDER;                                      
            END;                                                        
                                            /* OPBYG TEKSTLINIER */     
         CALL BH60830  (BH620_AR,TEKSTTABEL,TVLIN);                     
                                                                        
         IF SIDETÆL = 1                                                 
         THEN                                                           
            DO;                                                         
               IF ANT_SIDELIN + TVLIN > 47  /* MAX. ANT. LINIER SIDE 1*/
               THEN                                                     
                  CALL SIDESKIFT;                                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               IF ANT_SIDELIN + TVLIN > 58 /* MAX. ANT. LINIER BAGSIDE*/
               THEN                                                     
                  CALL SIDESKIFT;                                       
            END;                                                        
                                                                        
         CALL UDSKRIV_EJD;                                              
                                                                        
         CALL OPTÆL_CLIN;                                               
         KOMTAB.FEJD(KOMINDX) = KOMTAB.FEJD(KOMINDX) + 1;               
         IF LISTIDENT = 'BH60802Y' ! LISTIDENT = 'BH60803Y'             
         THEN                                                           
            OPTÆL.EJD_02Y   = OPTÆL.EJD_02Y + 1;                        
         ELSE                                                           
            OPTÆL.EJD_04Y   = OPTÆL.EJD_04Y + 1;                        
                                                                        
 END SKRIV_SKEMA;                                                       
 /*********************************************************************/
 /*                                                                   */
 /*      BOX MED PERSONNUMRE TIL FØRSTE SIDE                          */
 /*                                                                   */
 /*********************************************************************/
 OPSÆT_BOX:                                                             
         PROC;                                                          
                                                                        
         BOX_LIN1.CCE  =  ZZWS2;                                        
         PICCPR  =  BH620.DCPRCIR;                                      
         STREG1  =  '-';                                                
         BOX_LIN1.PNR  =  HJCPR;                                        
         BOX_LIN1_OK   =  JA;                                           
                                                                        
         IF BH620.DHENVN_SL > 0                                         
         THEN                                                           
            DO;                                                         
               BOX_LIN2.CCE  =  ZZWS1;                                  
               PICCPR  =  BH620.DHENVN_SL;                              
               STREG1  =  '-';                                          
               BOX_LIN2.PNR  =  HJCPR;                                  
               BOX_LIN2_OK   =  JA;                                     
            END;                                                        
                                                                        
 END OPSÆT_BOX;                                                         
 /*********************************************************************/
 /*                                                                   */
 /*      BOX MED PERSONNUMRE PÅ FØRSTE SIDE                           */
 /*                                                                   */
 /*********************************************************************/
 SKRIV_BOX:                                                             
         PROC;                                                          
                                                                        
         /* SKRIV RECORD M. PARAGRAFTEGN */                             
         REC_AFSLUT.CCE = ZZIK12;                                       
         REC_AFSLUT.FONT = '4';                                         
         CALL ZZ20300 (REC_AFSLUT,LIST_ID);                             
                                                                        
         CALL ZZ20301 (BOX_LIN1,LIST_ID);                               
         BOX_LIN1_OK = NEJ;                                             
                                                                        
         IF BOX_LIN2_OK = JA                                            
         THEN                                                           
            DO;                                                         
               CALL ZZ20301 (BOX_LIN2,LIST_ID);                         
               BOX_LIN2_OK = NEJ;                                       
            END;                                                        
                                                                        
         /* SKRIV RECORD M. PARAGRAFTEGN */                             
         REC_AFSLUT.CCE = ZZWS1;                                        
         REC_AFSLUT.FONT = '1';                                         
         CALL ZZ20300 (REC_AFSLUT,LIST_ID);                             
                                                                        
 END SKRIV_BOX;                                                         
 /*********************************************************************/
 /*       START PÅ SIDE 2                                             */
 /*********************************************************************/
 SIDESKIFT:   PROC;                                                     
 DCL     S_KOMNR PIC '999';                                             
         CALL SKRIV_STREGKODE;                                          
                                                                        
         IF BOX_LIN1_OK = JA                                            
         THEN                                                           
            CALL SKRIV_BOX;                                             
                                                                        
         SIDETÆL     = SIDETÆL + 1;                                     
         LIN_SKEMA   = '';                                              
         LIN_SKEMA.CCE = ZZIK1;                                         
         LIN_SKEMA.FONT= '1';                                           
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
         CALL ZZ20390 ('*CTL',LISTIDENT,'FORM','616201');               
         ANT_SIDELIN = 0;                                               
         IF MOD (SIDETÆL,2) = 1              /* ULIGE SIDETAL        */ 
         THEN                                                           
            DO;                                                         
               IF LISTIDENT = 'BH60802Y' ! LISTIDENT = 'BH60803Y'       
               THEN                                                     
                   KOMTAB(KOMINDX).FSKMKOM =                            
                                           KOMTAB(KOMINDX).FSKMKOM + 1; 
        /**    ELSE                                                     
                   KOMTAB(KOMINDX).FSKMKUV =                            
                                           KOMTAB(KOMINDX).FSKMKUV + 1; 
        **/                                                             
            END;                                                        
         LIN_SKEMA.PRINTLIN = ' ';                                      
         LIN_SKEMA.CCE =  ZZWK3;                 /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         LBNR (LISTID) = LBNR (LISTID) + 1;                             
         S_KOMNR = BH620.SORT_EÆKNR;                                    
         SK1.NAVN   =  S_KOMNR !! LBNR (LISTID);                        
         SK1_ESKYNR =  BH620.ESKYNR;                                    
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
         LIN_SKEMA.PRINTLIN = ' ';                                      
         LIN_SKEMA.CCE = ZZWS1;                                         
         LIN_SKEMA.FONT = '4';                   /* XEROX FONT    */    
         PICCPR = BH620.DCPRCIR;                                        
         STREG1 = '-';                                                  
         SK4.CPR  = HJCPR;                                              
         SK4.F1   = (91)''''; /* BLANKE FØR PNR AFHÆNGER AF FONTNR. */  
         LIN_TÆL  = LIN_TÆL  +  1;                                      
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 END SIDESKIFT;                                                         
 /*********************************************************************/
 /*       NY SKATTEYDER  -  DER SKIFTES TIL NY FORSIDE                */
 /*********************************************************************/
 NY_SKATTEYDER:                                                         
         PROC;                                                          
         IF BOX_LIN1_OK = JA                                            
         THEN                                                           
            CALL SKRIV_BOX;                                             
         IF MOD (SIDETÆL,2) = 1              /* ULIGE SIDETAL        */ 
         THEN                                /* SÅ SKRIV BLK SIDE 2  */ 
            DO;                                                         
               STREGKODE.NY_GRUPPE  =  '1'B;                            
               CALL SKRIV_STREGKODE;                                    
               CALL SKRIV_SIDE2_U_DATA;                                 
            END;                                                        
         IF GEM.SORT_EÆKNR ^= BH620.SORT_EÆKNR                          
         THEN                                                           
            DO;                                                         
               CALL KOMMUNEBRUD;                                        
               KOMINDX = KOMINDX + 1;                                   
               KOMTAB(KOMINDX).KOMNR = BH620.SORT_EÆKNR;                
            END;                                                        
         ANT_SIDELIN = 0;                                               
         SIDETÆL  =  0;                                                 
         BOX_LIN1_OK = NEJ; /* EJERS PERSONNUMMER */                    
         BOX_LIN2_OK = NEJ; /* ÆGTEFÆLLES PERSONNUMMER */               
         GEM = BH620, BY NAME;                                          
         GEM = BH620.ESR, BY NAME;                                      
         IF BH620.CKUNNAVN = '1'                                        
         THEN                                                           
            DO;                                                         
               /* KUN NAVN SKAL UDSKRIVES I ADRESSE- */                 
               /* LINIERNE JVF. SLUTMANDTAL          */                 
               DO I = 2 TO 6;                                           
                  NAVNTAB(I) = (35)' ';                                 
               END;                                                     
            END;                                                        
         CALL BESTEM_LISTID;                                            
         CALL FORSIDE;                                                  
         CALL UDSKRIV_NAVN;                                             
 END NY_SKATTEYDER;                                                     
 /*********************************************************************/
 /*       BESTEM LISTEIDENT (SKAL RETTES HVIS KUVERTERING TILBYDES)   */
 /*********************************************************************/
 BESTEM_LISTID:                                                         
         PROC;                                                          
         /* BESTEM LISTEIDENT FOR EJENDOMSSKEMAET */                    
         IF PARMTAB(BH620.SORT_EÆKNR).FALSN = '1'                       
         THEN                                                           
            LISTIDENT  = 'BH60803Y'; /* TIL KOMMUNEN EFTER FALSNING */  
         ELSE                                                           
            LISTIDENT  = 'BH60802Y'; /* TIL KOMMUNEN UDEN FALSNING  */  
         LIST_ID  = SUBSTR (LISTIDENT,6,2);                             
 END BESTEM_LISTID;                                                     
 /*********************************************************************/
 /*       DER SKIFTES TIL SIDE 1 BLANKET                              */
 /*       NAVN OG ADRESSE UDSKRIVES ØVERSTE                           */
 /*********************************************************************/
 FORSIDE:                                                               
         PROC;                                                          
         SIDETÆL     = SIDETÆL + 1;                                     
         LIN_SKEMA   = '';               /* SKIFT TIL SIDE 1 BLANKET */ 
         LIN_SKEMA.CCE = ZZIK1;                                         
         LIN_SKEMA.FONT= '1';                                           
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
         CALL ZZ20390 ('*CTL',LISTIDENT,'FORM','616200');               
         LIN_IDX  =  1;                          /* IDX NAVNTAB   */    
         LIN_TÆL  =  0;                                                 
 END FORSIDE;                                                           
 /*********************************************************************/
 /*                      OPBYG LINIE  1                               */
 /*              KOMM.NR., LB.NR., SKATTEYDERNR.                      */
 /*********************************************************************/
 UDSKRIV_NAVN:                                                          
         PROC;                                                          
 DCL     S_KOMNR PIC '999';                                             
         CALL OPSÆT_BOX;                                                
         IF MOD (SIDETÆL,2) = 1              /* ULIGE SIDETAL        */ 
         THEN                                                           
            DO;                                                         
               IF LISTIDENT = 'BH60802Y' ! LISTIDENT = 'BH60803Y'       
               THEN                                                     
                   KOMTAB(KOMINDX).FSKMKOM =                            
                                           KOMTAB(KOMINDX).FSKMKOM + 1; 
        /**    ELSE                                                     
                   KOMTAB(KOMINDX).FSKMKUV =                            
                                           KOMTAB(KOMINDX).FSKMKUV + 1; 
        **/                                                             
            END;                                                        
         LIN_SKEMA     = '';                                            
         LIN_SKEMA.CCE =  ZZWK2;                 /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         LBNR (LISTID) = LBNR (LISTID) + 1;                             
         S_KOMNR    = BH620.SORT_EÆKNR;                                 
         SK1.NAVN   = S_KOMNR !! LBNR (LISTID);                         
         SK1_ESKYNR =  BH620.ESKYNR;                                    
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 /*********************************************************************/
 /*                      OPBYG LINIE  2 - 4                           */
 /*              SLUTLIGNINGSKOMMUNENS NAVN OG ADRESSE                */
 /*********************************************************************/
         N = BH620.SORT_EÆKNR;                                          
         LIN_SKEMA     = '';                                            
         LIN_SKEMA.CCE =  ZZWS1;                 /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '3';                   /* XEROX FONT    */    
         SK0.NAVN = KOM_ADR(N).MYNVNADR;                                
         LIN_TÆL  = LIN_TÆL  +  1;                                      
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);       /* LINIE  2      */    
         LIN_SKEMA     = '';                                            
         LIN_SKEMA.CCE =  ZZWS1;                 /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '3';                   /* XEROX FONT    */    
         SK0.NAVN = KOM_ADR(N).MYPOSTADR;                               
         LIN_TÆL  = LIN_TÆL  +  1;                                      
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);       /* LINIE  3      */    
         LIN_SKEMA     = '';                                            
         LIN_SKEMA.CCE =  ZZWS3;                 /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '3';                   /* XEROX FONT    */    
         SK0.NAVN = KOM_ADR(N).MYPOSTNR;                                
         LIN_TÆL  = LIN_TÆL  +  1;                                      
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);       /* LINIE  4      */    
 /*********************************************************************/
 /*                      OPBYG LINIE  5                               */
 /*       1. NAVNELINIE  OG  VÆRGE/SELVANG.TYPE                       */
 /*********************************************************************/
         LIN_SKEMA      = '';                                           
         LIN_SKEMA.CCE  =  ZZWS1;                /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         IF BH620.CSÆREJD = 4                                           
         THEN                                                           
            SK1.CVÆRGE = 'V';                                           
         SELECT (BH620.CSMUDS);                                         
            WHEN ('B')                                                  
               SK1.CSMUDS = 'USAU  ';                                   
            WHEN ('C')                                                  
               SK1.CSMUDS = 'USAM  ';                                   
            WHEN ('D')                                                  
               SK1.CSMUDS = 'USAC  ';                                   
            WHEN ('E')                                                  
               SK1.CSMUDS = 'BSAU  ';                                   
            WHEN ('F')                                                  
               SK1.CSMUDS = 'BSAM  ';                                   
            WHEN ('G')                                                  
               SK1.CSMUDS = 'BSAC  ';                                   
            WHEN ('M')                                                  
               SK1.CSMUDS = 'PSAD  ';                                   
            WHEN ('N')                                                  
               SK1.CSMUDS = 'PSAK  ';                                   
            OTHERWISE;                                                  
         END;                                                           
         SELECT (BH620.CKNAVF);                                         
            WHEN (0)                                                    
               DO;                                                      
                  DO LIN_IDX = LIN_IDX TO 6                             
                     WHILE (NAVNTAB(LIN_IDX) = ' ');                    
                  END;                                                  
                  IF LIN_IDX  <  7                                      
                  THEN                                                  
                     SK1.NAVN = NAVNTAB(LIN_IDX);                       
                  LIN_IDX = LIN_IDX + 1;                                
               END;                                                     
            WHEN (1)                                                    
               SK1.CSMUDS = 'D MT  ';                                   
            OTHERWISE                                                   
               SK1.CSMUDS = 'EJMT  ';                                   
         END;                                                           
         LIN_TÆL = LIN_TÆL + 1;                                         
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 /*********************************************************************/
 /*                      OPBYG LINIE  6                               */
 /*       2. NAVNELINIE                                               */
 /*********************************************************************/
         LIN_SKEMA      = '';                                           
         LIN_SKEMA.CCE  =  ZZWS1;                /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         IF BH620.CKNAVF   =  0  &                                      
            BH620.CSÆREJD ^=  4                                         
         THEN                                                           
            DO;                                                         
               DO LIN_IDX = LIN_IDX TO 6                                
                  WHILE (NAVNTAB(LIN_IDX) = ' ');                       
               END;                                                     
               IF LIN_IDX < 7                                           
               THEN                                                     
                  SK1.NAVN = NAVNTAB(LIN_IDX);                          
               LIN_IDX = LIN_IDX + 1;                                   
            END;                                                        
         LIN_TÆL = LIN_TÆL + 1;                                         
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 /*********************************************************************/
 /*                      OPBYG LINIE  7                               */
 /*       3. NAVNELINIE  OG  ÆGTEFÆLLES PERSONNR.                     */
 /*********************************************************************/
         LIN_SKEMA      = '';                                           
         LIN_SKEMA.CCE  =  ZZWS1;                /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         IF BH620.CKNAVF   =  0  &                                      
            BH620.CSÆREJD ^=  4                                         
         THEN                                                           
            DO;                                                         
               DO LIN_IDX = LIN_IDX TO 6                                
                  WHILE (NAVNTAB(LIN_IDX) = ' ');                       
               END;                                                     
               IF LIN_IDX < 7                                           
               THEN                                                     
                  SK1.NAVN = NAVNTAB(LIN_IDX);                          
               LIN_IDX = LIN_IDX + 1;                                   
            END;                                                        
         LIN_TÆL = LIN_TÆL + 1;                                         
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 /*********************************************************************/
 /*                      OPBYG LINIE  8                               */
 /*       4. NAVNELINIE                                               */
 /*********************************************************************/
         LIN_SKEMA      = '';                                           
         LIN_SKEMA.CCE  =  ZZWS1;                /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         IF BH620.CKNAVF   =  0  &                                      
            BH620.CSÆREJD ^=  4                                         
         THEN                                                           
            DO;                                                         
               DO LIN_IDX = LIN_IDX TO 6                                
                  WHILE (NAVNTAB(LIN_IDX) = ' ');                       
               END;                                                     
               IF LIN_IDX < 7                                           
               THEN                                                     
                  SK1.NAVN = NAVNTAB(LIN_IDX);                          
               LIN_IDX = LIN_IDX + 1;                                   
            END;                                                        
         LIN_TÆL = LIN_TÆL + 1;                                         
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 /*********************************************************************/
 /*                      OPBYG LINIE  9                               */
 /*       5. NAVNELINIE                                               */
 /*********************************************************************/
         LIN_SKEMA      = '';                                           
         LIN_SKEMA.CCE  =  ZZWS1;                /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         IF BH620.CKNAVF   =  0  &                                      
            BH620.CSÆREJD ^=  4                                         
         THEN                                                           
            DO;                                                         
               DO LIN_IDX = LIN_IDX TO 6                                
                  WHILE (NAVNTAB(LIN_IDX) = ' ');                       
               END;                                                     
               IF LIN_IDX < 7                                           
               THEN                                                     
                  SK1.NAVN = NAVNTAB(LIN_IDX);                          
               LIN_IDX = LIN_IDX + 1;                                   
            END;                                                        
         LIN_TÆL = LIN_TÆL + 1;                                         
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 /*********************************************************************/
 /*                      OPBYG LINIE  10                              */
 /*       6. NAVNELINIE (HVIS UDENLANDSK ADDRESSE)                    */
 /*********************************************************************/
         LIN_SKEMA      = '';                                           
         LIN_SKEMA.CCE  =  ZZWS1;                /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         IF BH620.CKNAVF   =  0  &                                      
            BH620.CSÆREJD ^=  4                                         
         THEN                                                           
            DO;                                                         
               DO LIN_IDX = LIN_IDX TO 6                                
                  WHILE (NAVNTAB(LIN_IDX) = ' ');                       
               END;                                                     
               IF LIN_IDX < 7                                           
               THEN                                                     
                  SK1.NAVN = NAVNTAB(LIN_IDX);                          
               LIN_IDX = LIN_IDX + 1;                                   
            END;                                                        
         LIN_TÆL = LIN_TÆL + 1;                                         
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 /*********************************************************************/
 /*                      OPBYG LINIE  11                              */
 /*                      (KUN TIL TEST)                               */
 /*********************************************************************/
         LIN_SKEMA     = '';                                            
         LIN_SKEMA.CCE =  ZZWS2;                 /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '1';                   /* XEROX FONT    */    
         IF TESTNUM ^= ' '                                              
         THEN                                                           
            SK2.DISP1 = TESTNUM;                                        
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 END UDSKRIV_NAVN;                                                      
 /*********************************************************************/
 /*          UDSKRIV SKEMAER                                          */
 /*          LINIERNE FRA TEKSTTABELLEN UDSKRIVES                     */
 /*********************************************************************/
 UDSKRIV_EJD:                                                           
         PROC;                                                          
         LIN_SKEMA     = '';                                            
         LIN_SKEMA.CCE =  ZZWS1;                 /* STYREKARAKTER */    
         LIN_SKEMA.FONT = '2';                   /* XEROX FONT    */    
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
         ANT_SIDELIN = ANT_SIDELIN + 1;                                 
                                                                        
         DO I = 1 TO TVLIN;                                             
            LIN_SKEMA   = '';                                           
            LIN_SKEMA.CCE = ZZWS1;                                      
            LIN_SKEMA.FONT = '2';                                       
            SK3.TEKST = TEKSTTAB(I);                                    
            LIN_TÆL = LIN_TÆL + 1;                                      
            CALL ZZ20301 (LIN_SKEMA,LIST_ID);                           
         END;                                                           
                                                                        
         ANT_SIDELIN = ANT_SIDELIN + TVLIN;                             
                                                                        
 END UDSKRIV_EJD;                                                       
 /*********************************************************************/
 /*                SKRIV SIDE 2  (UDEN DATA)   SOM BLANK FORMULAR     */
 /*********************************************************************/
 SKRIV_SIDE2_U_DATA:   PROC;                                            
         LIN_SKEMA   = '';                                              
         LIN_SKEMA.CCE = ZZIK1;                                         
         LIN_SKEMA.FONT = '1';                                          
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
         CALL ZZ20390 ('*CTL',LISTIDENT,'FORM','NONE  ');               
         LIN_SKEMA   = '';                                              
         LIN_SKEMA.CCE = ZZWS1;                                         
         LIN_SKEMA.FONT = '1';                                          
         CALL ZZ20301 (LIN_SKEMA,LIST_ID);                              
 END SKRIV_SIDE2_U_DATA;                                                
 /*********************************************************************/
 /*                HALVAUTOMATISK FAKTURERING PÅ SMF                  */
 /*********************************************************************/
 FAKTURERING:  PROC;                                                    
 DCL   1 SMF,                                                           
         2 RETURKODE     BIT       (8),                                 
         2 KONST1        CHAR      (1)  INIT('0'),                      
         2 EKOMNR        PIC       '999',                               
         2 KONST2        CHAR      (3)  INIT('000'),                    
         2 ANTENH        PIC       '(7)9',                              
         2 CENHED        CHAR      (3),                                 
         2 AENHED        CHAR      (20);                                
         SMF.EKOMNR =  GEM.SORT_EÆKNR;                                  
         FEJL.LINIE =  ZZWS2         !!                                 
                       (44)'*'       !!  '  KOMMUNENR '!! SMF.EKOMNR !! 
                       '  FEJL I HALVAUTOMATISK FAKTURERING        ' !! 
                       (30)'*';                                         
         IF KOMTAB(KOMINDX).FSKMKOM > 0   /** !                         
            KOMTAB(KOMINDX).FSKMKUV > 0 **/                             
         THEN                                                           
            DO;                                                         
               /* ANTAL BLANKETTER EJENDOMSSKEMAER */                   
               SMF.ANTENH = KOMTAB(KOMINDX).FSKMKOM;                    
     /**                  + KOMTAB(KOMINDX).FSKMKUV;  **/               
               IF GEM.CAJOUR = 'S'                                      
               THEN                                                     
                  SMF.CENHED = '920'; /* KØRSEL USA */                  
               ELSE                                                     
                  SMF.CENHED = '921'; /* KØRSEL PSA EJ PLADS M.V. */    
               SMF.AENHED = 'EJD.SKEMA,ANT.SKEMA';                      
               CALL ZS34900 (SMF);                                      
            END;                                                        
         /* FAKTURERING AF FALSNING */                                  
     /** IF KOMTAB(KOMINDX).FSKMKUV > 0 !   **/                         
         IF PARMTAB(GEM.SORT_EÆKNR).FALSN = '1'                         
         THEN                                                           
            DO;                                                         
               /* ANTAL BLANKETTER TIL FALSNING */                      
     /**       SMF.ANTENH = KOMTAB(KOMINDX).FSKMKUV;                    
               IF PARMTAB(GEM.SORT_EÆKNR).FALSN = '1'                   
               THEN                                                     
                  SMF.ANTENH = SMF.ANTENH + KOMTAB(KOMINDX).FSKMKOM; **/
                  SMF.ANTENH = KOMTAB(KOMINDX).FSKMKOM;                 
               IF GEM.CAJOUR = 'S'                                      
               THEN                                                     
                  SMF.CENHED = '910'; /* KØRSEL USA */                  
               ELSE                                                     
                  SMF.CENHED = '911'; /* KØRSEL PSA EJ PLADS M.V. */    
               SMF.AENHED = 'ANT SKEMAER TIL FALS';                     
               CALL ZS34900 (SMF);                                      
            END;                                                        
    /**  IF KOMTAB(KOMINDX).FSKYKUV  > 0                                
         THEN                                                           
            DO;                                    ANTAL BILAG          
               SMF.ANTENH = KOMTAB(KOMINDX).FSKYKUV;                    
               SMF.CENHED = '911';                                      
               SMF.AENHED = 'ANT BILAG TIL FALS';                       
               CALL ZS34900 (SMF);                                      
            END;     ***/                                               
         /* ANTAL KUVERTER     */                                       
   /**   IF KOMTAB(KOMINDX).FSKYKUV > 0                                 
         THEN                                                           
            DO;                                                         
               SMF.ANTENH = KOMTAB(KOMINDX).FSKYKUV;                    
               SMF.CENHED = '912';                                      
               SMF.AENHED = 'ANTAL SKY. TIL KUV.';                      
               CALL ZS34900 (SMF);                                      
            END;  **/                                                   
         IF SMF.RETURKODE ^= '00000000'B                                
         THEN                                                           
            DO;                                                         
               CALL ZZ20301 (FEJL.LINIE,'07');                          
            END;                                                        
 END FAKTURERING;                                                       
 /*********************************************************************/
 /*       STREGKODER UDSKRIVES EFTER AT SIDEN ER UDSKREVET            */
 /*********************************************************************/
 SKRIV_STREGKODE:                                                       
         PROC;                                                          
                                                                        
         RETURN; /* STREGKODER SKAL  I K K E  PÅSÆTTES, DA KUVERTE- */  
                 /* RING  I K K E  TILBYDES P.T.                    */  
                                                                        
         IF LISTIDENT = 'BH60804Y'                                      
         THEN                                                           
            DO;                                                         
               LIN_SKEMA   = '';                /*  SKIP TIL K 12 */    
               LIN_SKEMA.CCE = ZZWK12;          /*  STYREKARAKTER */    
               LIN_SKEMA.FONT= '2';             /*  XEROX FONT    */    
               CALL ZZ20301 (LIN_SKEMA,LIST_ID);                        
               IF  MOD (SIDETÆL,2)  =  1        /* ULIGE SIDENR   */    
               THEN; /* OBS. *************/     /* MED STREGKODER */    
      /********** CALL  BH60810 (STREGKODE.NY_GRUPPE,                   
                                 STREGKODE.NY_KOMMUNE); ********* */    
               ELSE                             /*  LIGE SIDENR   */    
                  DO;                           /*  SKIP TIL K1   */    
                     LIN_SKEMA   = '';                                  
                     LIN_SKEMA.CCE = ZZWS1;                             
                     LIN_SKEMA.FONT = '2';                              
                     CALL ZZ20301 (LIN_SKEMA,LIST_ID);                  
                  END;                          /*  INGEN STREGER */    
            END;                                                        
         ELSE                                                           
            DO;                                                         
               LIN_SKEMA   = '';                /*  INGEN STREGER */    
               LIN_SKEMA.CCE = ZZWK1;                                   
               LIN_SKEMA.FONT = '2';                                    
               CALL ZZ20301 (LIN_SKEMA,LIST_ID);                        
            END;                                                        
                                                                        
         STREGKODE = '';                                                
                                                                        
 END SKRIV_STREGKODE;                                                   
 /*********************************************************************/
 /*         OPTÆLLINGER TIL TOTALLISTE FOR RC                         */
 /*********************************************************************/
 OPTÆL_CLIN: PROC;                                                      
         DO  J =  1 TO 16;                                              
            OPTÆL.CLIN (J) = OPTÆL.CLIN (J) + HJ_CLIN (J);              
         END;                                                           
         OPTÆL.CPERIOD  = OPTÆL.CPERIOD + BH620.CPERIOD;                
 END OPTÆL_CLIN;                                                        
 /*********************************************************************/
 /*         OPTÆLLINGER VED SKIFT PÅ PERSONNR                         */
 /*********************************************************************/
 OPTÆL_NYSKY: PROC;                                                     
         OPTÆL.LÆSTE_SKY = OPTÆL.LÆSTE_SKY + 1;                         
         OPTÆL.SIDER     = OPTÆL.SIDER  + SIDETÆL;                      
         OPTÆL.LINIER    = OPTÆL.LINIER + LIN_TÆL;                      
         KOMTAB(KOMINDX).FLIN = KOMTAB(KOMINDX).FLIN + LIN_TÆL;         
         IF LISTIDENT = 'BH60802Y' ! LISTIDENT = 'BH60803Y'             
         THEN                                                           
            DO;                                                         
               OPTÆL.SIDE_02Y  = OPTÆL.SIDE_02Y + SIDETÆL;              
               KOMTAB(KOMINDX).FSIDEKOM =                               
                                   KOMTAB(KOMINDX).FSIDEKOM + SIDETÆL;  
               KOMTAB(KOMINDX).FSKYKOM =                                
                                   KOMTAB(KOMINDX).FSKYKOM + 1;         
            END;                                                        
    /**  ELSE                                                           
            DO;                                                         
               OPTÆL.SIDE_04Y  = OPTÆL.SIDE_04Y + SIDETÆL;              
               KOMTAB(KOMINDX).FSIDEKUV =                               
                                   KOMTAB(KOMINDX).FSIDEKUV + SIDETÆL;  
               KOMTAB(KOMINDX).FSKYKUV =                                
                                   KOMTAB(KOMINDX).FSKYKUV + 1;         
            END;  **/                                                   
 END OPTÆL_NYSKY;                                                       
 /*********************************************************************/
 /*       TOTALLISTE   UDSKRIVES                                      */
 /*********************************************************************/
 TOTALLISTE:   PROC;                                                    
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN.CCE    =  ZZIK1;                                       
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN01.CCE  =  ZZWS2;                                       
         TOT_LIN01.TXT1 = 'PROGRAM: BH60800L                       ';   
         TOT_LIN01.TXT2 = 'UDSKRIVNING AF EJENDOMSSKEMAER          ';   
         TOT_LIN01.TXT3 = 'UDSKREVET DEN ';                             
         TOT_LIN01.DATO =  UDDATO;                                      
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN01.CCE  =  ZZWS3;                                       
         TOT_LIN01.TXT2 = 'TOTALLISTE FOR RC  (ALLE KOMMUNER)      ';   
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN02.CCE  =  ZZWS1;                                       
         TOT_LIN02.TXT1 = 'ANTAL LÆSTE KOMMUNEINDIVIDER............:';  
         TOT_LIN02.SIDER      = OPTÆL.LÆSTE_KOM;                        
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN02.CCE  =  ZZWS1;                                       
         TOT_LIN02.TXT1 = 'ANTAL LÆSTE EJENDOMME...................:';  
         TOT_LIN02.SIDER      = OPTÆL.LÆSTE_EJD;                        
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN02.CCE  =  ZZWS2;                                       
         TOT_LIN02.TXT1 = 'ANTAL LÆSTE SKATTEYDERE.................:';  
         TOT_LIN02.SIDER      = OPTÆL.LÆSTE_SKY;                        
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN02.CCE  =  ZZWS2;                                       
         TOT_LIN02.TXT1 = 'ANTAL SKREVNE SIDER.....................:';  
         TOT_LIN02.SIDER      = OPTÆL.SIDER;                            
         TOT_LIN02.TXT2 = '      SKREVNE LINIER IALT ..............:';  
         TOT_LIN02.LINIER = OPTÆL.LINIER;                               
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN02.CCE  =  ZZWS3;                                       
         TOT_LIN02.TXT1 = 'ANTAL SKREVNE SIDER TIL KOMMUNE.........:';  
         TOT_LIN02.SIDER      = OPTÆL.SIDE_02Y;                         
         TOT_LIN02.TXT2 = '      SKREVNE EJENDOMME TIL KOMMUNE.....:';  
         TOT_LIN02.LINIER = OPTÆL.EJD_02Y;                              
         CALL ZZ20301 (TOT_LIN,'05');                                   
 /**     TOT_LIN02.CCE  =  ZZWS3;                                       
         TOT_LIN02.TXT1 = 'ANTAL SKREVNE SIDER TIL KUVERTERING.....:';  
         TOT_LIN02.SIDER = OPTÆL.SIDE_04Y;                              
         TOT_LIN02.TXT2 = '      SKREVNE EJENDOMME TIL KUVERTERING.:';  
         TOT_LIN02.LINIER = OPTÆL.EJD_04Y;                              
         CALL ZZ20301 (TOT_LIN,'05'); **/                               
 /*  UDSKRIV ANTALLET AF LINIER  ( CLIN )  NR.   1 -  16  +  CPERIOD  */
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN01.CCE  =  ZZWS2;                                       
         TOT_LIN01.TXT1 = 'ANTAL AF SKREVNE LINIER SPECIFICERET PÅ ';   
         TOT_LIN01.TXT2 = 'LINIERNE  1-16 SAMT PERIOD:             ';   
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN03.CCE  =  ZZWS1;                                       
         TOT_LIN03.TEXT(*).TEKST  = 'LINIE ';                           
         DO  N =  1  TO  13;                                            
            TOT_LIN03.TEXT(N).LINNR = N;                                
         END;                                                           
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN04.CCE  =  ZZWS3;                                       
         DO  N =  1  TO  13;                                            
            TOT_LIN04.ANTAL(N).ANT_LIN  =  OPTÆL.CLIN(N);               
         END;                                                           
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN03.CCE  =  ZZWS1;                                       
         DO  N = 14  TO  16;                                            
            TOT_LIN03.TEXT(N-13).TEKST = 'LINIE ';                      
            TOT_LIN03.TEXT(N-13).LINNR =  N;                            
         END;                                                           
         TOT_LIN03.TEXT(5).TEKST = 'PERIOD';                            
         CALL ZZ20301 (TOT_LIN,'05');                                   
         TOT_LIN.PRINTLIN = ' ';                                        
         TOT_LIN04.CCE  =  ZZWS3;                                       
         DO  N = 14  TO  16;                                            
            TOT_LIN04.ANTAL(N-13).ANT_LIN = OPTÆL.CLIN(N);              
         END;                                                           
         TOT_LIN04.ANTAL(5).ANT_LIN = OPTÆL.CPERIOD;                    
         CALL ZZ20301 (TOT_LIN,'05');                                   
 /*********************************************************************/
 /*       KOMMUNETOTALER UDSKRIVES PR. RC                             */
 /*********************************************************************/
                                                                        
         CALL NY_SIDE05Y;                                               
                                                                        
         KOM_LIN04.CCE  =  ZZWS1;                                       
         LIN_TÆL = 0;                                                   
                                                                        
         DO I = 1 TO 300 WHILE (KOMTAB(I).KOMNR > 0);                   
            IF LIN_TÆL > 45                                             
            THEN                                                        
               DO;                                                      
                  CALL NY_SIDE05Y;                                      
                  LIN_TÆL = 0;                                          
               END;                                                     
            KOM_LIN.PRINTLIN = ' ';                                     
            KOM_LIN04.CCE    =  ZZWS1;                                  
            KOM_LIN04.KOMNR = KOMTAB(I).KOMNR;                          
            KOM_LIN04.ANT2  = KOMTAB(I).FEJD;                           
            KOM_LIN04.ANT3  = KOMTAB(I).FLIN;                           
            KOM_LIN04.ANT4  = KOMTAB(I).FSIDEKOM;                       
            KOM_LIN04.ANT5  = KOMTAB(I).FSKMKOM;                        
            KOM_LIN04.ANT6  = KOMTAB(I).FSKYKOM;                        
      /**   KOM_LIN04.ANT7  = KOMTAB(I).FSIDEKUV;                       
            KOM_LIN04.ANT8  = KOMTAB(I).FSKMKUV;                        
            KOM_LIN04.ANT9  = KOMTAB(I).FSKYKUV;  **/                   
            CALL ZZ20301 (KOM_LIN,'05');                                
            LIN_TÆL = LIN_TÆL + 1;                                      
        END;                                                            
        KOM_IALT        = 'IALT';                                       
        KOM_LIN04.ANT2  = SUM(KOMTAB(*).FEJD);                          
        KOM_LIN04.ANT3  = SUM(KOMTAB(*).FLIN);                          
        KOM_LIN04.ANT4  = SUM(KOMTAB(*).FSIDEKOM);                      
        KOM_LIN04.ANT5  = SUM(KOMTAB(*).FSKMKOM);                       
        KOM_LIN04.ANT6  = SUM(KOMTAB(*).FSKYKOM);                       
  /**   KOM_LIN04.ANT7  = SUM(KOMTAB(*).FSIDEKUV);                      
        KOM_LIN04.ANT8  = SUM(KOMTAB(*).FSKMKUV);                       
        KOM_LIN04.ANT9  = SUM(KOMTAB(*).FSKYKUV);  **/                  
        CALL ZZ20301 (KOM_LIN,'05');                                    
 END TOTALLISTE;                                                        
 /********************************************************************* 
 *      SKRIV OVERSKRIFTER PÅ KOMMUNETOTALER PR. RC                   * 
 *********************************************************************/ 
 NY_SIDE05Y:        PROC;                                               
         KOM_LIN.PRINTLIN = ' ';                                        
         KOM_LIN.CCE    =  ZZIK1;                                       
         CALL ZZ20301 (KOM_LIN,'05');                                   
         KOM_LIN.PRINTLIN = ' ';                                        
         KOM_LIN01.CCE  =  ZZWS2;                                       
         KOM_LIN01.TXT1 = ' ';                                          
         KOM_LIN01.TXT2 = 'UDSKRIVNING AF EJENDOMSSKEMAER';             
         KOM_LIN01.TXT3 = 'UDSKREVET DEN ';                             
         KOM_LIN01.DATO =  UDDATO;                                      
         CALL ZZ20301 (KOM_LIN,'05');                                   
         KOM_LIN.PRINTLIN = ' ';                                        
         KOM_LIN01.CCE  =  ZZWS3;                                       
         KOM_LIN01.TXT2 = '        KOMMUNETOTALER        ';             
         CALL ZZ20301 (KOM_LIN,'05');                                   
         KOM_LIN02.CCE  =  ZZWS1;                                       
         KOM_LIN02.TXT1 = 'KOMMUNE';                                    
         CALL ZZ20301 (KOM_LIN02,'05');                                 
         KOM_LIN03.CCE  =  ZZWS2;                                       
         CALL ZZ20301 (KOM_LIN03,'05');                                 
 END NY_SIDE05Y;                                                        
 /*********************************************************************/
 /*       KOMMUNETOTALER UDSKRIVES PR. KOMMUNE                        */
 /*********************************************************************/
 SKRIV_KOMMUNETOTAL:                                                    
         PROC;                                                          
                                                                        
 DCL     SPOOL_KOMNR    CHAR (8) INIT ((8)' '); /*  TIL SPOOL KALD . */ 
 DCL     SPOOL_KOMP     PIC '9999' BASED(ADDR(SPOOL_KOMNR));            
                                                                        
         CALL NY_SIDE01Y;                                               
                                                                        
         KOM_LIN04.CCE  =  ZZWS1;                                       
         KOM_LIN.PRINTLIN = ' ';                                        
         KOM_LIN04.ANT2  = KOMTAB(KOMINDX).FEJD;                        
         KOM_LIN04.ANT3  = KOMTAB(KOMINDX).FLIN;                        
         KOM_LIN04.ANT4  = KOMTAB(KOMINDX).FSIDEKOM;                    
         KOM_LIN04.ANT5  = KOMTAB(KOMINDX).FSKMKOM;                     
         KOM_LIN04.ANT6  = KOMTAB(KOMINDX).FSKYKOM;                     
                                                                        
   /**   KOM_LIN04.ANT7  = KOMTAB(KOMINDX).FSIDEKUV;                    
         KOM_LIN04.ANT8  = KOMTAB(KOMINDX).FSKMKUV;                     
         KOM_LIN04.ANT9  = KOMTAB(KOMINDX).FSKYKUV; **/                 
                                                                        
         CALL ZZ20301 (KOM_LIN,'01');                                   
                                                                        
 END SKRIV_KOMMUNETOTAL;                                                
 /********************************************************************* 
 *      SKRIV OVERSKRIFTER PÅ KOMMUNETOTALER                          * 
 *********************************************************************/ 
 NY_SIDE01Y:        PROC;                                               
         KOM_LIN.PRINTLIN = ' ';                                        
         KOM_LIN.CCE    =  ZZIK1;                                       
         CALL ZZ20301 (KOM_LIN,'01');                                   
         KOM_LIN.PRINTLIN = ' ';                                        
         KOM_LIN01.CCE  =  ZZWS2;                                       
         N = KOMTAB(KOMINDX).KOMNR;                                     
         KOM_LIN01.TXT1 = KOMTAB(KOMINDX).KOMNR !! ' ' !!               
                          KOM_ADR(N).MYNVNADR;                          
         KOM_LIN01.TXT2 = 'UDSKRIVNING AF EJENDOMSSKEMAER';             
         KOM_LIN01.TXT3 = 'UDSKREVET DEN ';                             
         KOM_LIN01.DATO =  UDDATO;                                      
         CALL ZZ20301 (KOM_LIN,'01');                                   
         KOM_LIN.PRINTLIN = ' ';                                        
         KOM_LIN01.CCE  =  ZZWS3;                                       
         KOM_LIN01.TXT2 = '        KOMMUNETOTALER        ';             
         CALL ZZ20301 (KOM_LIN,'01');                                   
         KOM_LIN02.CCE  =  ZZWS2;                                       
         KOM_LIN02.TXT1 = ' ';                                          
         CALL ZZ20301 (KOM_LIN02,'01');                                 
 END NY_SIDE01Y;                                                        
 /********************************************************************* 
 *            MASKINEL AFSTEMNING. UDSKRIVNING AF EVT. FEJLLISTE      * 
 *********************************************************************/ 
 MASK_AFSTEMNING:   PROC;                                               
         IF BH620.SORT_CPR ^= 99999999999                               
         THEN                                                           
            FEJL.KODE = 1;                                              
         IF BH62099.ANT_SKEMA ^= OPTÆL.LÆSTE_EJD                        
         THEN                                                           
            FEJL.KODE = 2;                                              
         IF FEJL.KODE > 0                     /* SKRIVES KUN,       */  
         THEN                                 /* NÅR DER ER FEJL    */  
            DO;                                                         
               TOT_LIN        = '';                                     
               TOT_LIN.CCE    =  ZZIK1;                                 
               CALL ZZ20301 (TOT_LIN,'06');                             
               TOT_LIN        = '';                                     
               TOT_LIN.CCE    =  ZZWS2;                                 
               TOT_LIN01.TXT1 = 'PROGRAM: BH60800L                 ';   
               TOT_LIN01.TXT2 = 'UDSKRIVNING AF EJENDOMSSKEMAER    ';   
               TOT_LIN01.TXT3 = 'UDSKREVET DEN ';                       
               TOT_LIN01.DATO =  UDDATO;                                
               CALL ZZ20301 (TOT_LIN,'06');                             
               TOT_LIN        = '';                                     
               TOT_LIN01.CCE  =  ZZWS3;                                 
               TOT_LIN01.TXT2 = 'MASKINEL AFSTEMNING M. DIFFERENCER';   
               CALL ZZ20301 (TOT_LIN,'06');                             
               TOT_LIN        = '';                                     
               TOT_LIN01.CCE  =  ZZWS3;                                 
               CALL ZZ20301 (TOT_LIN,'06');                             
               TOT_LIN        = '';                                     
               TOT_LIN01.CCE  =  ZZWS3;                                 
               SELECT (FEJL.KODE);                                      
                  WHEN (1)                                              
                     DO;                                                
                        FEJL.TEKST     =                                
                        'AFSTEMNINGSFEJL, INPUT UDEN SUMRECORD    ';    
                        TOT_LIN02.TXT1 =                                
                        '** SUMRECORD MANGLER PÅ B.H62011D. **   ';     
                        CALL ZZ20301 (TOT_LIN,'06');                    
                        CALL ZS30101(5,'BH60800 ** 252 '!!FEJL.TEKST,2);
                     END;                                               
                  WHEN (2)                                              
                     DO;                                                
                        FEJL.TEKST     =                                
                        'AFSTEMNINGSFEJL, DIFF. I ANT. RECORDS    ';    
                        TOT_LIN02.TXT1 =                                
                        ' ANTAL RECORDS LÆST FRA B.H62011D ..... ';     
                        TOT_LIN02.SIDER      =  OPTÆL.LÆSTE_EJD;        
                        TOT_LIN02.TXT2 =                                
                        '   OG ANTALLET I SUMRECORD PÅ INPUTTET: ';     
                        TOT_LIN02.LINIER =      BH62099.ANT_SKEMA;      
                        CALL ZZ20301 (TOT_LIN,'06');                    
                        CALL ZS30101(5,'BH60800 ** 252 '!!FEJL.TEKST,2);
                     END;                                               
                  OTHERWISE;                                            
               END;    /* SELECT AFSLUTTET */                           
            END;                                                        
 END MASK_AFSTEMNING;                                                   
 END BH60800;                                                           
