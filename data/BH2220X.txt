 BH22200: /* SKAF HENVISNINGSNR. FRA NYT SLUTÅR TIL ESR-UDTRÆK */       
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /********************************************************************* 
 *                                                                    * 
 *  N.B.  Denne version indeholder KUN fra DODCURS og videre          * 
 *        Der startes fra cprnr  > 306400886 i prod                   * 
 *                               > 101241505 i test BZ                * 
 *                                                                    * 
 * FORMÅL : AT SKAFFE NUVÆRENDE ELLER TIDLIGERE ÆGTEFÆLLES PERSONNUM- * 
 *          MER FRA MINI MT-FIL FRA NYT SLUTÅR TIL PÅSÆTNING PÅ ESR   * 
 *          UDTRÆK FOR NYT SLUTÅR AF HENSYN TIL BEHANDLING AF ÆGTE-   * 
 *          FÆLLEFORDELINGER.                                         * 
 *                                                                    * 
 *          HVIS ÆGTEFÆLLE PERSONNUMMER SKAFFES SKRIVES TO INDIVIDER  * 
 *          1 MED SORTCPR=DHENVN OG 1 MED SORTCPR=DCPRCIR A.H.T.      * 
 *          EFTERFØLGENDE DANNELSE AF 1 INDIVID PR. PERSON INDEHOLDEN-* 
 *          DE BÅDE EGNE OG EVT. ÆGTEFÆLLES 'PERSONLIGE' ESR-OPLYSNIN-* 
 *          GER SAMT DE 'FÆLLES' ESR-STAMOPLYSNINGER. DER SKAL DOG    * 
 *          IKKE SKRIVES TO INDIVIDER HVIS DEN AKTUELLE EJER ER OM-   * 
 *          PLACERET TIL ET NYT PERSONNUMMER D.V.S. HVIS COMPLA=1.    * 
 *                                                                    * 
 * INPUT  : BQ75000T   UDTRÆK FRA ESR EFTER 2-EJER-BEHANDLING         * 
 *          BQ76000T   MINI MT-FIL FRA EVS NYT SLUTÅR (HOVEDLEV.).    * 
 *                                                                    * 
 * OUTPUT : BQ75000T   ESR UDTRÆK EFTER PÅFØRSEL AF EVT. ÆGTEFÆLLE    * 
 *                     PERSONNUMMER.                                  * 
 *          BH22201Y   KØRSELSKONTROLLISTE                            * 
 *                                                                    * 
 * PROGRAMMØR: AAGE RASMUSSEN   LSU T&S EVS            NOV 2001       * 
 * RETTET:     OLUF MØRK        LSU T&S EVS            JUN 2002       * 
 * RETTET:     BO SCHMIDT       LSU T&S EVS            JUL 2003       * 
 * RETTET:     GGP              LSU T&S EVS            NOV 2003       * 
 * RETTET:     BO SCHMIDT       LSU T&S EVS            JUN 2004       * 
 * RETTET:     AAGE RASMUSSEN   LSU T&S EVS            NOV 2004       * 
 *             (OPSÆTNING AF FORSKUDT REGNSKABSÅR FJERNET             * 
 *              ---> FLYTTET TIL BH65300 FRA OG MED EVS SLUT 2004)    * 
 *  OMCOMPILERET P.G.A.                            LKA, OKTOBER 2012  * 
 *  NYT FELT CEANV I STRUKTUR BH32200N (BH32202N)                     * 
 *  KRAV 18-01 - BENYTTELSESKODE 25                                   * 
 *  FLYTTER INFORMATIONEN I CEANV IMELLEM BH326 OG BH323 BY NAME      * 
 *                                                                    * 
 * FORSKUD2014 Lars Harritshøj                         Maj 2013       * 
 *             Compileret ingen ændringer                             * 
 * Slut 2013   Jørgen Saugmann                         Okt 2013       * 
 *             Compileret ingen ændringer                             * 
 * FORSKUD2015 Jørgen Saugmann                         jun 2014       * 
 *             Compileret Ingen ændringer                             * 
 * SLUT2014    Jørgen Saugmann                         OKT 2014       * 
 *             Compileret Ingen ændringer                             * 
 * FORSKUD2016 Z6JNK                                    08.06.2015    * 
 *             Compileret. Ingen ændringer                            * 
 * FORSKUD2017 Z8QEB                                    12.06.2016    * 
 *             Compileret. Ingen ændringer                            * 
 * DB2 OMLÆGNING OPRETTET SOM KOPI AF BH32200           26-05-2016    * 
 * QLE/QEB                                                            * 
 *********************************************************************/ 
                                                                        
   DCL COPYRIGHT   CHAR  (30) STATIC  INIT ('COPYRIGHT KMD A/S 2004');  
                                                                        
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL     BH222I   FILE RECORD INPUT;     /* PARAMETERINPUT */           
 DCL     SYSPRINT EXTERNAL FILE PRINT;                                  
 /********************************************************************* 
 *                       DECLARE AF tabel-hjælpestrukturer            * 
 *********************************************************************/ 
 DCL     1 ESR_WORK,                                                    
         %INCLUDE BQ7500TN;                                             
                                                                        
 DCL     1 ESR_PERS,                                                    
         %INCLUDE BQ7500TN;                                             
                                                                        
 DCL     1 ESR_PERS1,                                                   
         %INCLUDE BQ7500TN;                                             
                                                                        
 DCL     1 ESR_PERS2,                                                   
         %INCLUDE BQ7500TN;                                             
                                                                        
 DCL     1 ESR_ÆGTF,                                                    
         %INCLUDE BQ7500TN;                                             
                                                                        
 DCL     1 MT_ÆGTF,                                                     
         %INCLUDE BQ7600TN;                                             
                                                                        
 DCL     1 MT_DOD,                                                      
         %INCLUDE BQ7600TN;                                             
                                                                        
 DCL     1 KOPIFRA,                                                     
         %INCLUDE BQ7500TN;                                             
                                                                        
 DCL     1 KOPITIL,                                                     
         %INCLUDE BQ7500TN;                                             
                                                                        
 DCL     1 SPEC,                                                        
         %INCLUDE BQ7500TN;                                             
                                                                        
         %INCLUDE BQ70000T;  /* csrp */                                 
 /***************************************************************       
 /*      DECLARE AF ABEND-RUTINE                                        
 /**************************************************************/       
 DCL     ABENDKODE     FIXED       (2) INIT(5);                         
 DCL     1 ABENDMEDD,                                                   
          2 ABENDMODUL CHAR      (7) INIT ('BH22200'),                  
          2 ABENDFILL1 CHAR      (1) INIT (' '),                        
          2 ABENDMEDNR CHAR      (2) INIT ('**'),                       
          2 ABENDFILL2 CHAR      (1) INIT (' '),                        
          2 ABENDTXT   CHAR      (45);                                  
                                                                        
 DCL     ABENDRTKODE   FIXED     (1) INIT (2);                          
 /***************************************************************       
 /*      DECLARE AF DB2-variabler                                       
 /**************************************************************/       
   EXEC SQL INCLUDE SQLCA;                                              
 DCL    SQLKODE         FIXED     (5);                                  
 DCL    SQLCODE_CH      CHAR      (5);                                  
 DCL    SQLCODE_PIC     PIC       'SSSS9' DEF SQLCODE_CH;               
 /********************************************************************* 
 *               DECLARE AF DIV. TÆLLEVÆRKER                          * 
 *********************************************************************/ 
 DCL     1 TV,                        /* TÆLLEVÆRKER TIL TOTALLISTEN */ 
           2 LÆS_MT   FIXED DEC (7),                                    
           2 LÆS_MT_ÆGTF FIXED DEC (7),                                 
           2 LÆS_ESR_ÆGTF FIXED DEC (7),                                
           2 LÆS_ESR_PERS FIXED DEC (7),                                
           2 OPDAT_ÆGTF  FIXED DEC (7),                                 
           2 FETCH_ESR   FIXED DEC (7),                                 
           2 FETCH_DODCURS   FIXED DEC (7),                             
           2 SALG_FØR    FIXED DEC (7),                                 
           2 KØB_EFTER   FIXED DEC (7),                                 
           2 FUNDET      FIXED DEC (7),                                 
           2 FDHENVN     FIXED DEC (7),                                 
           2 HANDLET     FIXED DEC (7),                                 
           2 SKREVET     FIXED DEC (7),                                 
           2 ANT_UPD     FIXED DEC (7) INIT (0),                        
           2 ANT_UPD_DOD FIXED DEC (7) INIT (0),                        
           2 ANT_DEL_GLEJER FIXED DEC (7) INIT (0),                     
           2 ANT_COMM    FIXED DEC (7) INIT (0);                        
                                                                        
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     1 WS_CHK_HVOR,                                                 
         3 WS_HVOR_PROCESS      CHAR(20) init (' '),                    
         3 WS_HVOR_PERS1        DEC FIXED(11,0) init (0),               
         3 WS_HVOR_PERS2        DEC FIXED(11,0) init (0);               
                                                                        
 DCL     PUTSKIP                BIT(1)   INIT ('0'B);                   
 DCL     TEST_PUT               BIT(1)   INIT ('0'B);                   
                                                                        
 DCL     WS_FORSKUD_SLUT_TXT    CHAR(16) INIT (' ');                    
                                                                        
 DCL     WS_TIL_EVS_AAR                 BIN FIXED (15);                 
                                                                        
 DCL     WS_TIL_EVS_AAR_GL              BIN FIXED (15);                 
 DCL     WS_SLUT_AFVIKLINGS_ID          CHAR(16) INIT (' ');            
                                                                        
 DCL     WS_PROGRAMNAVN         CHAR(8)  INIT ('BH22200');              
                                                                        
 DCL     EOF_BH222             BIT       (1)     INIT ('0'B);           
                                                                        
 DCL     SLUTÅR0101         FIXED     (09)      INIT (0);               
                                                                        
 DCL     1 BH222_PARM,                                                  
           %INCLUDE BH54900N;                                           
                                                                        
 DCL     1 BH65300M,                                                    
           %INCLUDE BH65300M; /* OPSÆT AKTUELT INDKOMSTÅR M.V. */       
                                                                        
 DCL     MT_FUNDET        BIT       (1)     INIT ('0'B);                
 DCL     MT_ÆGTF_FUNDET   BIT       (1)     INIT ('0'B);                
 DCL     ESR_FUNDET       BIT       (1)     INIT ('0'B);                
 DCL     CSRP_FUNDET      BIT       (1)     INIT ('0'B);                
 DCL     ESR_PERS_FUNDET  BIT       (1)     INIT ('0'B);                
 DCL     ESR_PERS1_FUNDET BIT       (1)     INIT ('0'B);                
 DCL     ESR_PERS2_FUNDET BIT       (1)     INIT ('0'B);                
 DCL     ESR_ÆGTF_FUNDET  BIT       (1)     INIT ('0'B);                
 DCL     DOD_EJER_FUNDET  BIT       (1)     INIT ('0'B);                
 DCL     CURSOR_SKAL_GENAABNES BIT  (1)     INIT ('0'B);                
 DCL     FLERE_GENERATIONER BIT     (1)     INIT ('0'B);                
 DCL     RÆKKE_TIL_KOPIERING_FUNDET BIT (1) INIT ('0'B);                
 DCL     ÆGTEFÆLLE_OPRETTES_FIKTIVT BIT (1) INIT ('0'B);                
 DCL     JA               BIT       (1)     INIT ('1'B);                
 DCL     NEJ              BIT       (1)     INIT ('0'B);                
                                                                        
 DCL     WS_START_DCPRCIR DEC FIXED (11);                               
 DCL     WS_START_EKOMNR BIN FIXED(15);                                 
 DCL     WS_START_EEJDNR BIN FIXED(31);                                 
 DCL     WS_START_EGENNR BIN FIXED(15);                                 
                                                                        
 DCL     UNE_DCPRCIR DEC FIXED (11);                                    
 DCL     UNE_EKOMNR BIN FIXED(15);                                      
 DCL     UNE_EEJDNR BIN FIXED(31);                                      
 DCL     UNE_EGENNR BIN FIXED(15);                                      
                                                                        
 DCL     WS_CSRP_PNR  DEC FIXED (11);                                   
                                                                        
 DCL     GEM_ESR_ÆGTF_DCPRCIR DEC FIXED (11);                           
                                                                        
 DCL     WS_GEM_EGENNR    BIN FIXED(15);                                
 DCL     WS_ANTAL_GENNR  FIXED DEC (7) INIT (0);                        
                                                                        
 DCL     test_egennr     BIN FIXED(15);                                 
                                                                        
 DCL     FRADATO         FIXED     (9);                                 
 DCL     TILDATO         FIXED     (9);                                 
                                                                        
 DCL     UDDATO          CHAR      (10);                                
 DCL     DATO1           CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
                                                                        
 /********************************************************************* 
 *       DECLARE AF ENTRY OG BUILTIN                                  * 
 *********************************************************************/ 
 DCL     ADDR            BUILTIN;                                       
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     NULL            BUILTIN;                                       
 DCL     CHAR            BUILTIN;                                       
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS67000         ENTRY;                                         
 DCL     ZS30101         ENTRY;                                         
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
         EXTERNAL INIT ('NOTEST(ALL,,;)');                              
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH22200L'),                                        
           2 F1          CHAR      (21)      INIT      (' '),           
           2 TEKST2      CHAR      (52)      INIT      (                
           'SKAF ÆGTEFÆLLE (DHENVN) TIL ESR UDTRÆK'),                   
           2 F2          CHAR      (21)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'Z.ZZZ.ZZ9',                         
           2 F2          CHAR      (63)      INIT      ((63)' ');       
         % INCLUDE ZZ20301M;                                            
 /*********************************************************************/
 /* M A C R O E R der SKAL ligge før koden grundet declare af cursors */
 /*********************************************************************/
 %INCLUDE BH54999M; /* CHECK OM OMKØRSEL, OG UDFØR EVT OPRYDNING */     
                                                                        
 /*********************************************************************/
 /* Declare af CURSORS                                                */
 /*********************************************************************/
                                                                        
          EXEC SQL DECLARE DODCURS CURSOR WITH HOLD FOR                 
              SELECT                                                    
               T75.TIL_EVS_AAR,                                         
               T75.AFVIKLINGS_ID,                                       
               T75.DCPRCIR,                                             
               T75.EKOMNR,                                              
               T75.EEJDNR,                                              
               T75.EGENNR,                                              
               T75.ESR_CCIVS,                                           
               T76.CCIVS,                                               
               T76.HIST_OPD_SIDSTE_DHENVN,                              
               T76.HIST_OPD_DETTE_DHENVN,                               
               T76.HIST_OPD_SIDSTE_DCIÆN                                
          FROM BQ75000T T75, BQ76000T T76                               
          WHERE T75.TIL_EVS_AAR = :WS_TIL_EVS_AAR                       
          AND   T75.AFVIKLINGS_ID = :WS_FORSKUD_SLUT_TXT                
          AND   T75.DCPRCIR > 306400886                                 
          AND   T75.DCPRCIR = T76.DCPRN                                 
          AND   T75.TIL_EVS_AAR = T76.TIL_EVS_AAR                       
          AND   T75.AFVIKLINGS_ID = T76.AFVIKLINGS_ID                   
          AND   T76.CCIVS = 'D' AND                                     
                (T76.HIST_OPD_SIDSTE_DCIÆN > 0 AND                      
                 T76.HIST_OPD_SIDSTE_DCIÆN < :SLUTÅR0101)               
          AND   (T76.HIST_OPD_DETTE_DHENVN > 0 OR                       
                 T76.HIST_OPD_SIDSTE_DHENVN > 0)                        
          ORDER BY T75.dcprCIR;                                         
 /* AND   T75.DCPRCIR > 306400886  PROD*/                               
 /* AND   T75.DCPRCIR > 101241505  TZ */                                
 /* AND   T75.DCPRCIR > 102514017  TS */                                
                                                                        
 /********************************************************************* 
 *       ON CONDITIONS                                                * 
 *********************************************************************/ 
         PUT SKIP LIST ('START ' !! WS_PROGRAMNAVN);                    
                                                                        
         WS_CHK_HVOR = '';                                              
                                                                        
         EOF_BH222 = NEJ;                                               
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
                ON ERROR SYSTEM;                                        
                PUT SKIP LIST ('PROGRAMFEJL');                          
                PUT SKIP LIST ('Behandling var igang med: ' !!          
                                WS_HVOR_PROCESS !!                      
                                ' Pers1: ' !! WS_HVOR_PERS1 !!          
                                ' Pers2: ' !! WS_HVOR_PERS2);           
                CALL PLIDUMP  ('SNHOB','PROGRAM BH22200L');             
            END;                                                        
                                                                        
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
                                                                        
         CALL ZZ20390 ('*OPEN','BH22201Y');                             
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!  '-' !! DATO2.ÅR;      
         OVERLIN1.DATO  = UDDATO;                                       
         SIDELIN.CCA    = ZZIK1;                                        
         OVERLIN1.CCA   = ZZWS2;                                        
         OVERLIN2.CCA   = ZZWS3;                                        
         TV = '';                                                       
                                                                        
         OPEN FILE (BH222I)  TITLE ('BH22200P');                        
         ON ENDFILE (BH222I)                                            
         BEGIN;                                                         
            EOF_BH222 = JA;                                             
         END;                                                           
                                                                        
         SLUTÅR0101 = BH65300M.ÅR0101;                                  
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
         if PUTSKIP = '1'B                                              
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('hovedstyring');                             
            put skip list ('*******************');                      
         end;                                                           
                                                                        
         READ FILE (BH222I) INTO (BH222_PARM);                          
                                                                        
         IF EOF_BH222 = NEJ                                             
         THEN DO;                                                       
            SELECT (BH222_PARM.FS_MRK);                                 
               WHEN ('F')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH222_PARM.FORSKUD_TXT;      
                     WS_TIL_EVS_AAR = BH65300M.FORSKÅR;                 
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH222_PARM.SLUT_TXT;       
                  END;                                                  
               WHEN ('S')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH222_PARM.SLUT_TXT;         
                     WS_TIL_EVS_AAR = BH65300M.SLUTÅR;                  
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH222_PARM.SLUT_TXT;       
                  END;                                                  
               WHEN ('U')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH222_PARM.SUPPL_TXT;        
                     WS_TIL_EVS_AAR = BH65300M.SLUTÅR;                  
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH222_PARM.SLUT_TXT;       
                  END;                                                  
               OTHERWISE                                                
                  DO;                                                   
                     ABENDTXT = '101 PARAMETERFEJL';                    
                     CALL PROGRAM_FEJL;                                 
                  END;                                                  
            END; /* select */                                           
         END;                                                           
                                                                        
 /********************************************************************* 
 *       PROCESS                                                      * 
 *********************************************************************/ 
                                                                        
         WS_START_DCPRCIR = 0;                                          
         WS_START_EKOMNR  = 0;                                          
         WS_START_EEJDNR  = 0;                                          
         WS_START_EGENNR  = 0;                                          
                                                                        
         /* hvis en af parterne er død, skal enkelte felter */          
         /* lige nulstilles igen (ÆGTE_xxx)                 */          
         /* læs døde samt ægtefælle via DODCURS cursor på   */          
         /* MT BQ76000T hvor der findes en ægtefælle       */           
                                                                        
         put skip list ('DEL 2 behandling DODCURS');                    
                                                                        
         CALL CLOSE_DODCURS;                                            
         CALL OPEN_DODCURS;                                             
         CALL FETCH_DODCURS;                                            
                                                                        
         DO WHILE (DOD_EJER_FUNDET); /* død ejer, med ægtefælle */      
            CALL BEHANDL_DOD;                                           
            CALL FETCH_DODCURS;                                         
         END;                                                           
                                                                        
         IF ANT_COMM > 0                                                
         THEN DO;                                                       
            EXEC SQL COMMIT;                                            
            Put skip list ('Commit efter ' !! TV.FETCH_DODCURS !!       
                        ' læsninger af døde.  Ialt ' !! ANT_UPD_DOD !!  
                        ' opdateringer');                               
         END;                                                           
                                                                        
         CALL CLOSE_DODCURS;                                            
                                                                        
         if PUTSKIP = '1'B                                              
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('AFSLUT');                                   
            put skip list ('*******************');                      
         end;                                                           
                                                                        
         CALL AFSLUT;                                                   
                                                                        
                                                                        
 /********************************************************************* 
 *       BEHANDL Døde ægtefæller                                      * 
 *********************************************************************/ 
 BEHANDL_DOD: PROC;                                                     
                                                                        
         WS_HVOR_PROCESS = 'BEHANDL_DOD';                               
         WS_HVOR_PERS1 = dclBQ75000T.dcprcir;                           
         WS_HVOR_PERS2 = 0;                                             
                                                                        
         if test_put                                                    
         then do;                                                       
            put skip list ('behandl_dod: ' !! dclBQ75000T.dcprcir !!    
                                       ' ' !! dclbq75000T.ekomnr  !!    
                                       ' ' !! dclbq75000t.eejdnr  !!    
                                       ' ' !! dclbq75000t.egennr);      
         end;                                                           
                                                                        
         /* Hent ESR oplysninger for den døde PERS1 */                  
         ESR_PERS = '';                                                 
         ESR_PERS1 = '';                                                
         ESR_PERS2 = '';                                                
         ESR_PERS1_FUNDET = '0'B;                                       
         ESR_PERS2_FUNDET = '0'B;                                       
                                                                        
         ESR_PERS.DCPRCIR = DCLBQ75000T.DCPRCIR;                        
         ESR_PERS.EKOMNR  = DCLBQ75000T.EKOMNR;                         
         ESR_PERS.EEJDNR  = DCLBQ75000T.EEJDNR;                         
         ESR_PERS.EGENNR  = DCLBQ75000T.EGENNR;                         
                                                                        
         CALL SELECT_ESR_PERS;                                          
                                                                        
         if esr_pers_fundet                                             
         then do;                                                       
            ESR_PERS1 = ESR_PERS, by name;                              
            ESR_PERS1_FUNDET = '1'B;                                    
            if test_put                                                 
            then do;                                                    
               put skip list ('pers1 (død): ' !! ESR_PERS1.dcprcir !!   
                                          ' ' !! ESR_PERS1.ekomnr  !!   
                                          ' ' !! ESR_PERS1.eejdnr  !!   
                                          ' ' !! ESR_PERS1.egennr);     
               put skip list ('  med ægte_dcprcir: ' !!                 
                                 ESR_PERS1.ÆGTE_dcprcir);               
            end;                                                        
         end;                                                           
         else do;                                                       
            if test_put                                                 
            then do;                                                    
               put skip list ('pers1 (død): ikke fundet');              
            end;                                                        
         end;                                                           
                                                                        
         /* Hent ESR oplysninger for den dødes ægtefælle PERS2 */       
         ESR_PERS = '';                                                 
                                                                        
         if DCLBQ76000T.HIST_OPD_DETTE_DHENVN > 0                       
         then                                                           
             ESR_PERS.DCPRCIR = DCLBQ76000T.HIST_OPD_DETTE_DHENVN;      
         else                                                           
             ESR_PERS.DCPRCIR = DCLBQ76000T.HIST_OPD_SIDSTE_DHENVN;     
                                                                        
         ESR_PERS.EKOMNR  = DCLBQ75000T.EKOMNR;                         
         ESR_PERS.EEJDNR  = DCLBQ75000T.EEJDNR;                         
         ESR_PERS.EGENNR  = DCLBQ75000T.EGENNR;                         
                                                                        
         CALL SELECT_ESR_PERS;                                          
                                                                        
         if esr_pers_fundet                                             
         then do;                                                       
            ESR_PERS2 = ESR_PERS, by name;                              
            ESR_PERS2_FUNDET = '1'B;                                    
            if test_put                                                 
            then do;                                                    
               put skip list ('pers2      : ' !! ESR_PERS2.dcprcir !!   
                                          ' ' !! ESR_PERS2.ekomnr  !!   
                                          ' ' !! ESR_PERS2.eejdnr  !!   
                                          ' ' !! ESR_PERS2.egennr);     
               put skip list ('  med ægte_dcprcir: ' !!                 
                                 ESR_PERS2.ÆGTE_dcprcir);               
            end;                                                        
         end;                                                           
         else do;                                                       
            if test_put                                                 
            then do;                                                    
               put skip list ('pers2 (lev): ikke fundet');              
            end;                                                        
         end;                                                           
                                                                        
         /* alle den dødes ejer-felter overføres til den levendes */    
         /* ægtefælle-felter  dvs.  fra PERS1 til PERS2           */    
                                                                        
         if ESR_PERS1_FUNDET &                                          
            ESR_PERS2_FUNDET                                            
         then do;                                                       
            WS_HVOR_PERS1 = ESR_PERS1.dcprcir;                          
            WS_HVOR_PERS2 = ESR_PERS2.dcprcir;                          
                                                                        
            ESR_PERS2.ÆGTE_DCPRCIR = ESR_PERS1.EJER_DCPRCIR;            
            ESR_PERS2.ÆGTE_CITYP = ESR_PERS1.EJER_CITYP;                
            ESR_PERS2.ÆGTE_CTILKØB = ESR_PERS1.EJER_CTILKØB;            
            ESR_PERS2.ÆGTE_DRGNÅRFRA = ESR_PERS1.EJER_DRGNÅRFRA;        
            ESR_PERS2.ÆGTE_DRGNÅRTIL = ESR_PERS1.EJER_DRGNÅRTIL;        
            ESR_PERS2.ÆGTE_DOVTG = ESR_PERS1.EJER_DOVTG;                
            /* ægte_dovtg_gl er altid 0 og skal ikke overføres */       
            /* ESR_PERS2.ÆGTE_DOVTG_GL = ESR_PERS1.EJER_DOVTG_GL; */    
            ESR_PERS2.ÆGTE_DOVTG_GL = 0;  /* qle 12.12. */              
            ESR_PERS2.ÆGTE_DINDFLYT = ESR_PERS1.EJER_DINDFLYT;          
            ESR_PERS2.ÆGTE_DAFSTÅ = ESR_PERS1.EJER_DAFSTÅ;              
            ESR_PERS2.ÆGTE_DFRAFLYT = ESR_PERS1.EJER_DFRAFLYT;          
            ESR_PERS2.ÆGTE_DAFGDAT = ESR_PERS1.EJER_DAFGDAT;            
            ESR_PERS2.ÆGTE_DSLUTS = ESR_PERS1.EJER_DSLUTS;              
            ESR_PERS2.ÆGTE_DSKØDE = ESR_PERS1.EJER_DSKØDE;              
            ESR_PERS2.ÆGTE_CEJFOER0107 = ESR_PERS1.EJER_CEJFOER0107;    
            ESR_PERS2.ÆGTE_CEJFORH = ESR_PERS1.EJER_CEJFORH;            
            ESR_PERS2.ÆGTE_CPENS = ESR_PERS1.EJER_CPENS;                
            ESR_PERS2.ÆGTE_FEJER = ESR_PERS1.EJER_FEJER;                
            ESR_PERS2.ÆGTE_GANE = ESR_PERS1.EJER_GANE;                  
            ESR_PERS2.ÆGTE_CEJ_100 = ESR_PERS1.EJER_CEJ_100;            
            ESR_PERS2.ÆGTE_CHEJD = ESR_PERS1.EJER_CHEJD;                
            ESR_PERS2.ÆGTE_VEJK_EJER = ESR_PERS1.EJER_VEJK_EJER;        
            ESR_PERS2.ÆGTE_HUSNR_EJER = ESR_PERS1.EJER_HUSNR_EJER;      
            ESR_PERS2.ÆGTE_ETAGE_EJER = ESR_PERS1.EJER_ETAGE_EJER;      
            ESR_PERS2.ÆGTE_SDØR_EJER = ESR_PERS1.EJER_SDØR_EJER;        
            ESR_PERS2.ÆGTE_BOPÆLSKODE = ESR_PERS1.EJER_BOPÆLSKODE;      
            ESR_PERS2.ÆGTE_COMPLA = ESR_PERS1.EJER_COMPLA;              
            ESR_PERS2.ÆGTE_DOMPLACPR = ESR_PERS1.EJER_DOMPLACPR;        
            ESR_PERS2.ÆGTE_DOMPLAÅR = ESR_PERS1.EJER_DOMPLAÅR;          
                                                                        
            /* alle ægtefælle-felter nulstilles på den døde    */       
            /* dvs.  på PERS1   */                                      
            /* qle 12.12   undlad nulstilling hvis den anden */         
            /* er enke eller længstlevende */                           
            if ESR_PERS2.esr_ccivs = 'E' !                              
               ESR_PERS2.esr_ccivs = 'L' !                              
               ESR_PERS2.esr_ccivs = 'D'                                
            then do;                                                    
               ESR_PERS1.ESR_SORTDATO = 99991231;                       
               if test_put                                              
               then do;                                                 
                  put skip list ('den døde har en enke/længstl/død ' !! 
                            'som ægtefælle ' !! esr_pers2.esr_ccivs);   
               end;                                                     
            end;                                                        
            else do;                                                    
               if test_put                                              
               then do;                                                 
                  put skip list ('den døde har en ægtefælle ' !!        
                  'med esr_ccivs ' !! esr_pers2.esr_ccivs);             
               end;                                                     
               ESR_PERS1.ESR_SORTDATO = 99991231;                       
               ESR_PERS1.ÆGTE_DCPRCIR = '';                             
               ESR_PERS1.ÆGTE_CITYP = '';                               
               ESR_PERS1.ÆGTE_CTILKØB = '';                             
               ESR_PERS1.ÆGTE_DRGNÅRFRA = '';                           
               ESR_PERS1.ÆGTE_DRGNÅRTIL = '';                           
               ESR_PERS1.ÆGTE_DOVTG = '';                               
               ESR_PERS1.ÆGTE_DOVTG_GL = '';                            
               ESR_PERS1.ÆGTE_DINDFLYT = '';                            
               ESR_PERS1.ÆGTE_DAFSTÅ = '';                              
               ESR_PERS1.ÆGTE_DFRAFLYT = '';                            
               ESR_PERS1.ÆGTE_DAFGDAT = '';                             
               ESR_PERS1.ÆGTE_DSLUTS = '';                              
               ESR_PERS1.ÆGTE_DSKØDE = '';                              
               ESR_PERS1.ÆGTE_CEJFOER0107 = '';                         
               ESR_PERS1.ÆGTE_CEJFORH = '';                             
               ESR_PERS1.ÆGTE_CPENS = '';                               
               ESR_PERS1.ÆGTE_FEJER = '';                               
               ESR_PERS1.ÆGTE_GANE = '';                                
               ESR_PERS1.ÆGTE_CEJ_100 = '';                             
               ESR_PERS1.ÆGTE_CHEJD = '';                               
               ESR_PERS1.ÆGTE_VEJK_EJER = '';                           
               ESR_PERS1.ÆGTE_HUSNR_EJER = ' ';                         
               ESR_PERS1.ÆGTE_ETAGE_EJER = '';                          
               ESR_PERS1.ÆGTE_SDØR_EJER = ' ';                          
               ESR_PERS1.ÆGTE_BOPÆLSKODE = '';                          
               ESR_PERS1.ÆGTE_COMPLA = '';                              
               ESR_PERS1.ÆGTE_DOMPLACPR = ' ';                          
               ESR_PERS1.ÆGTE_DOMPLAÅR = '';                            
            end;                                                        
                                                                        
            /* til sidst opdateres den døde og den dødes ægtefælle */   
                                                                        
            /* den døde */                                              
            ESR_WORK = ESR_PERS1, by name;                              
            if test_put                                                 
            then do;                                                    
               put skip list ('pers1 ' !! ESR_WORK.DCPRCIR !!           
                              ' opdateres med flg:');                   
               put skip list ('  ÆGTE_DCPRCIR: ' !!                     
                                 ESR_WORK.ÆGTE_DCPRCIR);                
               put skip list ('  ÆGTE_CITYP: ' !!                       
                                 ESR_WORK.ÆGTE_CITYP);                  
            end;                                                        
            CALL UPDATE_DOD_SAMT_AEGT;                                  
                                                                        
            /* og ægtefællen */                                         
            ESR_WORK = ESR_PERS2, by name;                              
            if test_put                                                 
            then do;                                                    
               put skip list ('pers2 ' !! ESR_WORK.DCPRCIR !!           
                              ' opdateres med flg:');                   
               put skip list ('  ÆGTE_DCPRCIR: ' !!                     
                                 ESR_WORK.ÆGTE_DCPRCIR);                
               put skip list ('  ÆGTE_CITYP: ' !!                       
                                 ESR_WORK.ÆGTE_CITYP);                  
            end;                                                        
            CALL UPDATE_DOD_SAMT_AEGT;                                  
         end;                                                           
                                                                        
 END BEHANDL_DOD;                                                       
                                                                        
                                                                        
 /********************************************************************* 
 *       LÆS ESR UDTRÆK   BQ75000T  DØDE                                
 *********************************************************************/ 
 FETCH_DODCURS:                                                         
 PROC;                                                                  
                                                                        
         WS_HVOR_PROCESS = 'FETCH_DODCURS';                             
                                                                        
         DOD_EJER_FUNDET = '0'B;                                        
                                                                        
         DCLBQ75000T = '';                                              
         DCLBQ76000T = '';                                              
                                                                        
         TEST_PUT = NEJ;                                                
                                                                        
         EXEC SQL FETCH DODCURS                                         
                                                                        
         INTO  :DCLBQ75000T.TIL_EVS_AAR,                                
               :DCLBQ75000T.AFVIKLINGS_ID,                              
               :DCLBQ75000T.DCPRCIR,                                    
               :DCLBQ75000T.EKOMNR,                                     
               :DCLBQ75000T.EEJDNR,                                     
               :DCLBQ75000T.EGENNR,                                     
               :DCLBQ75000T.ESR_CCIVS,                                  
               :DCLBQ76000T.CCIVS,                                      
               :DCLBQ76000T.HIST_OPD_SIDSTE_DHENVN,                     
               :DCLBQ76000T.HIST_OPD_DETTE_DHENVN,                      
               :DCLBQ76000T.HIST_OPD_SIDSTE_DCIÆN                       
         ;                                                              
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               DOD_EJER_FUNDET = '1'B;                                  
               TV.FETCH_DODCURS = TV.FETCH_DODCURS + 1;                 
               ANT_COMM = ANT_COMM + 1;                                 
             END;                                                       
           WHEN (100)                                                   
             DO;                                                        
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
               ABENDTXT = '101 FETCH DODCURS';                          
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
                                                                        
         IF ANT_COMM > 9999                                             
         THEN DO;                                                       
            EXEC SQL COMMIT;                                            
            Put skip list ('Commit efter ' !! TV.FETCH_DODCURS !!       
                        ' læsninger af døde.  Ialt ' !! ANT_UPD_DOD !!  
                        ' opdateringer');                               
            ANT_COMM = 0;                                               
         END;                                                           
                                                                        
 END FETCH_DODCURS;                                                     
                                                                        
                                                                        
 /*********************************************************************/
 /* LÆS AF ESR oplysninger til brug for nulstilling ved død ægtefælle */
 /*********************************************************************/
 SELECT_ESR_PERS: PROC;                                                 
                                                                        
         WS_HVOR_PROCESS = 'SELECT_ESR_PERS';                           
                                                                        
         ESR_PERS_FUNDET = NEJ;                                         
                                                                        
         ESR_PERS.TIL_EVS_AAR    = DCLBQ75000T.TIL_EVS_AAR;             
         ESR_PERS.AFVIKLINGS_ID  = DCLBQ75000T.AFVIKLINGS_ID;           
                                                                        
         EXEC SQL                                                       
            SELECT                                                      
            DCPRCIR,                                                    
            EKOMNR,                                                     
            EEJDNR,                                                     
            EGENNR,                                                     
            ESR_CCIVS,                                                  
            EJER_DCPRCIR,                                               
            EJER_CITYP,                                                 
            EJER_CTILKØB,                                               
            EJER_DRGNÅRFRA,                                             
            EJER_DRGNÅRTIL,                                             
            EJER_DOVTG,                                                 
            EJER_DOVTG_GL,                                              
            EJER_DINDFLYT,                                              
            EJER_DAFSTÅ,                                                
            EJER_DFRAFLYT,                                              
            EJER_DAFGDAT,                                               
            EJER_DSLUTS,                                                
            EJER_DSKØDE,                                                
            EJER_CEJFOER0107,                                           
            EJER_CEJFORH,                                               
            EJER_CPENS,                                                 
            EJER_FEJER,                                                 
            EJER_GANE,                                                  
            EJER_CEJ_100,                                               
            EJER_CHEJD,                                                 
            EJER_VEJK_EJER,                                             
            EJER_HUSNR_EJER,                                            
            EJER_ETAGE_EJER,                                            
            EJER_SDØR_EJER,                                             
            EJER_BOPÆLSKODE,                                            
            EJER_COMPLA,                                                
            EJER_DOMPLACPR,                                             
            EJER_DOMPLAÅR,                                              
            ÆGTE_DCPRCIR,                                               
            ÆGTE_CITYP,                                                 
            ÆGTE_CTILKØB,                                               
            ÆGTE_DRGNÅRFRA,                                             
            ÆGTE_DRGNÅRTIL,                                             
            ÆGTE_DOVTG,                                                 
            ÆGTE_DOVTG_GL,                                              
            ÆGTE_DINDFLYT,                                              
            ÆGTE_DAFSTÅ,                                                
            ÆGTE_DFRAFLYT,                                              
            ÆGTE_DAFGDAT,                                               
            ÆGTE_DSLUTS,                                                
            ÆGTE_DSKØDE,                                                
            ÆGTE_CEJFOER0107,                                           
            ÆGTE_CEJFORH,                                               
            ÆGTE_CPENS,                                                 
            ÆGTE_FEJER,                                                 
            ÆGTE_GANE,                                                  
            ÆGTE_CEJ_100,                                               
            ÆGTE_CHEJD,                                                 
            ÆGTE_VEJK_EJER,                                             
            ÆGTE_HUSNR_EJER,                                            
            ÆGTE_ETAGE_EJER,                                            
            ÆGTE_SDØR_EJER,                                             
            ÆGTE_BOPÆLSKODE,                                            
            ÆGTE_COMPLA,                                                
            ÆGTE_DOMPLACPR,                                             
            ÆGTE_DOMPLAÅR                                               
                                                                        
            INTO                                                        
         :ESR_PERS.dcprcir,                                             
         :ESR_PERS.ekomnr,                                              
         :ESR_PERS.eejdnr,                                              
         :ESR_PERS.egennr,                                              
         :ESR_PERS.ESR_CCIVS,                                           
         :ESR_PERS.EJER_DCPRCIR,                                        
         :ESR_PERS.EJER_CITYP,                                          
         :ESR_PERS.EJER_CTILKØB,                                        
         :ESR_PERS.EJER_DRGNÅRFRA,                                      
         :ESR_PERS.EJER_DRGNÅRTIL,                                      
         :ESR_PERS.EJER_DOVTG,                                          
         :ESR_PERS.EJER_DOVTG_GL,                                       
         :ESR_PERS.EJER_DINDFLYT,                                       
         :ESR_PERS.EJER_DAFSTÅ,                                         
         :ESR_PERS.EJER_DFRAFLYT,                                       
         :ESR_PERS.EJER_DAFGDAT,                                        
         :ESR_PERS.EJER_DSLUTS,                                         
         :ESR_PERS.EJER_DSKØDE,                                         
         :ESR_PERS.EJER_CEJFOER0107,                                    
         :ESR_PERS.EJER_CEJFORH,                                        
         :ESR_PERS.EJER_CPENS,                                          
         :ESR_PERS.EJER_FEJER,                                          
         :ESR_PERS.EJER_GANE,                                           
         :ESR_PERS.EJER_CEJ_100,                                        
         :ESR_PERS.EJER_CHEJD,                                          
         :ESR_PERS.EJER_VEJK_EJER,                                      
         :ESR_PERS.EJER_HUSNR_EJER,                                     
         :ESR_PERS.EJER_ETAGE_EJER,                                     
         :ESR_PERS.EJER_SDØR_EJER,                                      
         :ESR_PERS.EJER_BOPÆLSKODE,                                     
         :ESR_PERS.EJER_COMPLA,                                         
         :ESR_PERS.EJER_DOMPLACPR,                                      
         :ESR_PERS.EJER_DOMPLAÅR,                                       
         :ESR_PERS.ÆGTE_DCPRCIR,                                        
         :ESR_PERS.ÆGTE_CITYP,                                          
         :ESR_PERS.ÆGTE_CTILKØB,                                        
         :ESR_PERS.ÆGTE_DRGNÅRFRA,                                      
         :ESR_PERS.ÆGTE_DRGNÅRTIL,                                      
         :ESR_PERS.ÆGTE_DOVTG,                                          
         :ESR_PERS.ÆGTE_DOVTG_GL,                                       
         :ESR_PERS.ÆGTE_DINDFLYT,                                       
         :ESR_PERS.ÆGTE_DAFSTÅ,                                         
         :ESR_PERS.ÆGTE_DFRAFLYT,                                       
         :ESR_PERS.ÆGTE_DAFGDAT,                                        
         :ESR_PERS.ÆGTE_DSLUTS,                                         
         :ESR_PERS.ÆGTE_DSKØDE,                                         
         :ESR_PERS.ÆGTE_CEJFOER0107,                                    
         :ESR_PERS.ÆGTE_CEJFORH,                                        
         :ESR_PERS.ÆGTE_CPENS,                                          
         :ESR_PERS.ÆGTE_FEJER,                                          
         :ESR_PERS.ÆGTE_GANE,                                           
         :ESR_PERS.ÆGTE_CEJ_100,                                        
         :ESR_PERS.ÆGTE_CHEJD,                                          
         :ESR_PERS.ÆGTE_VEJK_EJER,                                      
         :ESR_PERS.ÆGTE_HUSNR_EJER,                                     
         :ESR_PERS.ÆGTE_ETAGE_EJER,                                     
         :ESR_PERS.ÆGTE_SDØR_EJER,                                      
         :ESR_PERS.ÆGTE_BOPÆLSKODE,                                     
         :ESR_PERS.ÆGTE_COMPLA,                                         
         :ESR_PERS.ÆGTE_DOMPLACPR,                                      
         :ESR_PERS.ÆGTE_DOMPLAÅR                                        
            FROM BQ75000T                                               
            WHERE TIL_EVS_AAR   = :ESR_PERS.TIL_EVS_AAR                 
            AND   AFVIKLINGS_ID = :ESR_PERS.AFVIKLINGS_ID               
            AND   DCPRCIR       = :ESR_PERS.DCPRCIR                     
            AND   EKOMNR        = :ESR_PERS.EKOMNR                      
            AND   EEJDNR        = :ESR_PERS.EEJDNR                      
            AND   EGENNR        = :ESR_PERS.EGENNR;                     
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               ESR_PERS_FUNDET = '1'B;                                  
               TV.LÆS_ESR_PERS = TV.LÆS_ESR_PERS + 1;                   
            END;                                                        
            WHEN(100) DO;                                               
            END;                                                        
            OTHERWISE DO;                                               
               ABENDTXT = '101 SELECT BQ75000T PERS';                   
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END SELECT_ESR_PERS;                                                   
                                                                        
 /*********************************************************************/
 /* UPDATE række på EVS UDTRÆK for døde og deres ægtefæller           */
 /*********************************************************************/
 UPDATE_DOD_SAMT_AEGT: PROC;                                            
                                                                        
         WS_HVOR_PROCESS = 'UPDATE_DOD_SAMT_AEGT';                      
                                                                        
         ESR_WORK.PROGRAMNAVN    = WS_PROGRAMNAVN;                      
         ESR_WORK.DB2_FUNKTION    = 'U';                                
         ESR_WORK.TIL_EVS_AAR    = WS_TIL_EVS_AAR;                      
         ESR_WORK.AFVIKLINGS_ID  = WS_FORSKUD_SLUT_TXT;                 
                                                                        
         if test_put                                                    
         then do;                                                       
            put skip list ('Update_dod_samt_aegt for ' !!               
            ESR_WORK.DCPRCIR);                                          
            put skip list ('   med ægte_dcprcir: ' !!                   
                               ESR_WORK.ÆGTE_DCPRCIR);                  
         end;                                                           
                                                                        
         EXEC SQL                                                       
           UPDATE BQ75000T                                              
           SET                                                          
           ÆGTE_DCPRCIR = :ESR_WORK.ÆGTE_DCPRCIR,                       
           ÆGTE_CITYP = :ESR_WORK.ÆGTE_CITYP,                           
           ÆGTE_CTILKØB = :ESR_WORK.ÆGTE_CTILKØB,                       
           ÆGTE_DRGNÅRFRA = :ESR_WORK.ÆGTE_DRGNÅRFRA,                   
           ÆGTE_DRGNÅRTIL = :ESR_WORK.ÆGTE_DRGNÅRTIL,                   
           ÆGTE_DOVTG = :ESR_WORK.ÆGTE_DOVTG,                           
           ÆGTE_DOVTG_GL = :ESR_WORK.ÆGTE_DOVTG_GL,                     
           ÆGTE_DINDFLYT = :ESR_WORK.ÆGTE_DINDFLYT,                     
           ÆGTE_DAFSTÅ = :ESR_WORK.ÆGTE_DAFSTÅ,                         
           ÆGTE_DFRAFLYT = :ESR_WORK.ÆGTE_DFRAFLYT,                     
           ÆGTE_DAFGDAT = :ESR_WORK.ÆGTE_DAFGDAT,                       
           ÆGTE_DSLUTS = :ESR_WORK.ÆGTE_DSLUTS,                         
           ÆGTE_DSKØDE = :ESR_WORK.ÆGTE_DSKØDE,                         
           ÆGTE_CEJFOER0107 = :ESR_WORK.ÆGTE_CEJFOER0107,               
           ÆGTE_CEJFORH = :ESR_WORK.ÆGTE_CEJFORH,                       
           ÆGTE_CPENS = :ESR_WORK.ÆGTE_CPENS,                           
           ÆGTE_FEJER = :ESR_WORK.ÆGTE_FEJER,                           
           ÆGTE_GANE = :ESR_WORK.ÆGTE_GANE,                             
           ÆGTE_CEJ_100 = :ESR_WORK.ÆGTE_CEJ_100,                       
           ÆGTE_CHEJD = :ESR_WORK.ÆGTE_CHEJD,                           
           ÆGTE_VEJK_EJER = :ESR_WORK.ÆGTE_VEJK_EJER,                   
           ÆGTE_HUSNR_EJER = :ESR_WORK.ÆGTE_HUSNR_EJER,                 
           ÆGTE_ETAGE_EJER = :ESR_WORK.ÆGTE_ETAGE_EJER,                 
           ÆGTE_SDØR_EJER = :ESR_WORK.ÆGTE_SDØR_EJER,                   
           ÆGTE_BOPÆLSKODE = :ESR_WORK.ÆGTE_BOPÆLSKODE,                 
           ÆGTE_COMPLA = :ESR_WORK.ÆGTE_COMPLA,                         
           ÆGTE_DOMPLACPR = :ESR_WORK.ÆGTE_DOMPLACPR,                   
           ÆGTE_DOMPLAÅR = :ESR_WORK.ÆGTE_DOMPLAÅR                      
                                                                        
            WHERE TIL_EVS_AAR   = :ESR_WORK.TIL_EVS_AAR                 
            AND   DCPRCIR         = :ESR_WORK.DCPRCIR                   
            AND   EKOMNR          = :ESR_WORK.EKOMNR                    
            AND   EEJDNR          = :ESR_WORK.EEJDNR                    
            AND   EGENNR          = :ESR_WORK.EGENNR                    
            AND   AFVIKLINGS_ID = :ESR_WORK.AFVIKLINGS_ID;              
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               ANT_UPD_DOD = ANT_UPD_DOD + 1;                           
            END;                                                        
            OTHERWISE DO;                                               
               ABENDTXT = '101 UPDATE_DOD_SAMT_AEGT ';                  
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END UPDATE_DOD_SAMT_AEGT;                                              
                                                                        
 /*********************************************************************/
 /* OPEN CURSOR TIL LÆS AF MT-OPLYSNINGER FOR DØDE             RUTINE */
 /*********************************************************************/
 OPEN_DODCURS: PROC;                                                    
                                                                        
         WS_HVOR_PROCESS = 'OPEN_DODCURS';                              
                                                                        
         EXEC SQL OPEN DODCURS;                                         
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              ABENDTXT = '101 OPEN DODCURS';                            
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END OPEN_DODCURS;                                                      
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF ESR for DØDE                       RUTINE */
 /*********************************************************************/
 CLOSE_DODCURS: PROC;                                                   
                                                                        
         WS_HVOR_PROCESS = 'CLOSE_DODCURS';                             
                                                                        
         EXEC SQL CLOSE DODCURS;                                        
                                                                        
 END CLOSE_DODCURS;                                                     
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
         PROC;                                                          
                                                                        
         WS_HVOR_PROCESS = 'TOTALLISTE';                                
                                                                        
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.LÆS_MT;                                     
         DETLIN1.TEKST = 'LÆSTE PÅ MINI MT-FIL NYT SLUTÅR    BQ76000T'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FETCH_ESR;                                  
         DETLIN1.TEKST = 'LÆSTE PÅ ESR UDTRÆK                BQ75000T'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆS_ESR_ÆGTF;                               
         DETLIN1.TEKST = 'LÆSTE ÆGTEFÆLLER PÅ ESR            BQ75000T'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OPDAT_ÆGTF;                                 
         DETLIN1.TEKST = 'OPDAT/SLET ÆGTEFÆLLEOPL PÅ ESR     BQ75000T'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SALG_FØR;                                   
         DETLIN1.TEKST = '      HERAF OVERLÆST SALG FØR REGNSKABSÅR  '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.KØB_EFTER;                                  
         DETLIN1.TEKST = '      HERAF OVERLÆST KØB EFTER REGNSKABSÅR '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FUNDET;                                     
         DETLIN1.TEKST = '      HERAF EJER FUNDET PÅ MINI MT-FIL  ';    
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FDHENVN;                                    
         DETLIN1.TEKST = '            HERAF MED HENVISNINGSNUMMER';     
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SKREVET;                                    
         DETLIN1.TEKST = 'SKREVNE INDIVIDER INCL. DUBLETTER  B.H22200D';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.HANDLET;                                    
         DETLIN1.TEKST = '              HERAF HANDEL I REGNSKABSÅR';    
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
  END TOTALLISTE;                                                       
 /*********************************************************************/
 /*      CLOSE AF FILER OG SPOOL                                      */
 /*********************************************************************/
 AFSLUT:                                                                
         PROC;                                                          
                                                                        
         WS_HVOR_PROCESS = 'AFSLUT';                                    
                                                                        
         CALL TOTALLISTE;                                               
                                                                        
         CALL ZZ20300((133)' ','99');                                   
                                                                        
         if PUTSKIP = '1'B                                              
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('opdater_kØrselstabel SLUT');                
            put skip list ('*******************');                      
         end;                                                           
         CALL OPDATER_KØRSELSTABEL('SLUT',BH222_PARM.FS_MRK);           
                                                                        
 END AFSLUT;                                                            
                                                                        
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         WS_HVOR_PROCESS = 'SQL_FEJL';                                  
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED SQLCODE: ' !! SQLCA.SQLCODE);  
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
                                                                        
         CALL ZS67000(SQLCA);                                           
                                                                        
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /* HER UDSKRIVES ØVRIGE FEJL                                  RUTINE */
 /*********************************************************************/
 PROGRAM_FEJL: PROC;                                                    
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED PROGRAMFEJL');                 
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END PROGRAM_FEJL;                                                      
                                                                        
 %INCLUDE BH54997M;     /* ER FORGÆNGERE KØRT. STOP HVIS IKKE */        
 %INCLUDE BH54998M;     /* OPDATER KØRSELSTABEL GL VERS */              
 END  BH22200;                                                          
