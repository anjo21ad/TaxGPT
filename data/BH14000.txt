 BH14000: PROC(COMPTR)  OPTIONS(MAIN,REENTRANT) REORDER;                
 /**********************************************************************
 *                                                                     *
 *     SKELETPROGRAM GENERERET AF ZSRØR                                *
 *                                                                     *
 *       EXTERN MODUL-BESKRIVELSE                                      *
 *                                                                     *
 *       NAVN          - BH14000                                       *
 *                                                                     *
 *       FUNKTION      - OPDATERING AF UDVALGTE DATA PÅ BQ00700T EVSPE *
 *                                                                     *
 *       TRANSKODE     - B990                                          *
 *                                                                     *
 *       INDDATA       - COMMAREA FRA ZSRØR                            *
 *                                                                     *
 *       UDDATA        - COMMAREA TIL ZSRØR                            *
 *                                                                     *
 *       EXTERNE REF.  -                                               *
 *                                                                     *
 *       GENERERET AF  - BO P SØRENSEN        14.08.01                 *
 *                                                                     *
 *       RETTET        -                                               *
 *                                                                     *
 **********************************************************************/
 /**********************************************************************
 *    COMMAREA.                                                        *
 **********************************************************************/
 %INCLUDE ZX23000M;                                                     
                                                                        
 /**********************************************************************
 *    ZSRØR INCLUDES.                                                  *
 **********************************************************************/
 %INCLUDE BH14000M;                                                     
                                                                        
 /**********************************************************************
 *    LOG-/ABEND RUTINE.                                               *
 **********************************************************************/
 %INCLUDE ZS37800M;                                                     
                                                                        
 /* Z6BPS INCLUDES BEGYNDER HER */                                      
 /*********************************************************************/
 /*      DECLARE AF DB2 - TABEL                                       */
 /*********************************************************************/
 EXEC SQL INCLUDE BQ00700T; /* EVS PERSONTABEL */                       
 EXEC SQL INCLUDE SQLCA;                                                
                                                                        
 DCL RETURKODE BIN FIXED(15);                                           
 DCL CPRNUMERISK      PIC '(10)9';                                      
 DCL CPRTILDB2        DEC FIXED (11,0);                                 
 /**********************************************************************
 *    ØVRIGE DECLARES                                                  *
 **********************************************************************/
 DCL  CICSRC               BIN FIXED(31,0);                             
 DCL (ADDR,CSTG,NULL,STG,SUBSTR)   BUILTIN;                             
                                                                        
 /**********************************************************************
 *    HOUSE-KEEPING                                                    *
 **********************************************************************/
 EXEC CICS HANDLE CONDITION ERROR(ABEND);                               
                                                                        
 /**********************************************************************
 *    HOVEDSTYRING                                                     *
 **********************************************************************/
   CAREA.LÆNGDE_UD = STG(OUTPUT);                                       
   CALL GETMAIN(CAREA.OUTPUTPTR,CAREA.LÆNGDE_UD);                       
   OUTPUT = '';                                                         
   IF INPUT.DCPRN='' ! INPUT.EKOMNR=0 ! INPUT.DINDKAAR=0 !              
      INPUT.EEJDNR=0 ! INPUT.EGENNR=0 THEN                              
    DO;                                                                 
     /*                                                                 
     ZS378TEKST='MANGLER INPUTFELTER DCPRN,EKOMNR,DINDKAAR,ELBNR,EGENR';
     CALL ABEND_PROCEDURE;                                              
     */                                                                 
     OUTPUT.FEJLTEKST='MANGLER INPUTFELTER DCPRN,EKOMNR,DINDKAAR,ELBNR';
     OUTPUT.RCKODE=1;                                                   
     EXEC CICS RETURN;                                                  
    END;                                                                
   CPRNUMERISK = INPUT.DCPRN;                                           
   CPRTILDB2 = CPRNUMERISK;                                             
   RETURKODE=OPDATER_EVSTABEL;                                          
   OUTPUT.RCKODE=RETURKODE;                                             
   OUTPUT.FEJLTEKST='';                                                 
                                                                        
   EXEC CICS RETURN;                                                    
 ABEND:                                                                 
   CALL ABEND_PROCEDURE;                                                
   EXEC CICS RETURN;                                                    
 /**********************************************************************
 *    OPDATER TABEL                                                    *
 **********************************************************************/
 OPDATER_EVSTABEL: PROC RETURNS(BIN FIXED(15));                         
  DCL PIC6             PIC '(6)9';                                      
  DCL GPCTEJER_DEC     DEC FIXED(5,2);                                  
  DCL GPCTEJERFOR_DEC  DEC FIXED(5,2);                                  
  DCL BFORSKAT_I       BIN FIXED(15);                                   
  DCL PIC10            PIC '(10)Z';                                     
  DCL BFORSKAT         BIN FIXED(31);                                   
  DCL DHENVTILDB2      DEC FIXED(11);                                   
  /* KONVETER FØRST TYPER */                                            
  IF INPUT.GPCTEJER='' THEN                                             
    GPCTEJER_DEC=0.00;                                                  
  ELSE                                                                  
   DO;                                                                  
    PIC6=INPUT.GPCTEJER;                                                
    GPCTEJER_DEC=PIC6/100;                                              
   END;                                                                 
  IF INPUT.GPCTEJERFOR='' THEN                                          
    GPCTEJERFOR_DEC=0.00;                                               
  ELSE                                                                  
   DO;                                                                  
    PIC6=INPUT.GPCTEJERFOR;                                             
    GPCTEJERFOR_DEC=PIC6/100;                                           
   END;                                                                 
  IF INPUT.BFORSKAT='' THEN                                             
   BFORSKAT_I=-1;                                                       
  ELSE                                                                  
   DO;                                                                  
    BFORSKAT_I=0;                                                       
    PIC10=INPUT.BFORSKAT;                                               
    BFORSKAT=PIC10;                                                     
   END;                                                                 
  IF INPUT.DHENVNR='' THEN                                              
    DHENVTILDB2=0;                                                      
  ELSE                                                                  
   DO;                                                                  
    PIC10=INPUT.DHENVNR;                                                
    DHENVTILDB2=PIC10;                                                  
   END;                                                                 
  /* KØR SQL */                                                         
  EXEC SQL                                                              
  UPDATE BQ00700T                                                       
     SET                                                                
         CNEDSL1=    :INPUT.CNEDSL1                                     
        ,GPCTEJER=   :GPCTEJER_DEC                                      
        ,DOVTG=      :INPUT.DOVTG                                       
        ,DAFSTAA=    :INPUT.DAFSTAA                                     
        ,CENKE=      :INPUT.CENKE                                       
        ,CSKPLOMF=   :INPUT.CSKPLOMF                                    
        ,BFORSKAT=   :BFORSKAT         :BFORSKAT_I                      
        ,CFORSKAT=   :INPUT.CFORSKAT                                    
        ,DOVTGFOR=   :INPUT.DOVTGFOR                                    
        ,DAFSTAAFOR= :INPUT.DAFSTAAFOR                                  
        ,GPCTEJERFOR=:GPCTEJERFOR_DEC                                   
        ,DHENVNR=    :DHENVTILDB2                                       
     WHERE                                                              
             DCPRN=   :CPRTILDB2                                        
         AND DINDKAAR=:INPUT.DINDKAAR                                   
         AND EKOMNR=  :INPUT.EKOMNR                                     
         AND EEJDNR=  :INPUT.EEJDNR                                     
         AND EGENNR=  :INPUT.EGENNR                                     
         AND ELBNR=   :INPUT.ELBNR                                      
  ;                                                                     
  RETURN (SQLCA.SQLCODE);                                               
 END OPDATER_EVSTABEL;                                                  
 /**********************************************************************
 *    ABEND PÅ EN PÆN MÅDE                                             *
 **********************************************************************/
 ABEND_PROCEDURE:  PROC;                                                
   ZS378FUNK  = '04';         /* AFSLUT, COMMAREA SLETTES     */        
   ZS378TYPE  = 'CICS';                                                 
   ZS378MODUL = 'BH14000';                                              
   %INCLUDE ZS37802M;                                                   
 END ABEND_PROCEDURE;                                                   
                                                                        
 %INCLUDE ZX23000G         /* GETMAIN RUTINE     */;                    
 %INCLUDE ZX23000F         /* FREEMAIN RUTINE     */;                   
 END BH14000;                                                           
