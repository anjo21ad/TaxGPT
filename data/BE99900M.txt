 /*********************************************************************/
 /* Include: BE99900M                                                 */
 /*                                                                   */
 /* Håndter fejl ved udførsel af SQL kald i batch.                    */
 /*                                                                   */
 /* SQLCA'en logges og der foretages user abend.                      */
 /*                                                                   */
 /* Include af denne procedure forudsætter, at der også findes        */
 /* proceduren ABEND med samme parametre som denne procedure og       */
 /* som kan implementeres via include af BE99901M.                    */
 /*********************************************************************/
 SQL_ERROR: PROC (P_PROCNAME, P_USER_ABEND_CODE, P_TEXT);               
                                                                        
 DCL P_PROCNAME                     CHAR(*) VAR;                        
 DCL P_USER_ABEND_CODE              PIC '999';                          
 DCL P_TEXT                         CHAR(*) VAR;                        
                                                                        
 DCL ZS67000                        ENTRY;              /* Log SQLCA */ 
                                                                        
    /* Udskriv SQL fejl information */                                  
    PUT SKIP LIST (' ');                                                
    PUT SKIP LIST ('SQL fejl i procedure ' !! TRIM(P_PROCNAME) !!       
                   ' i program ' !! PACKAGENAME() !! ': ' !!            
                   P_USER_ABEND_CODE !! ' ' !! P_TEXT);                 
    PUT SKIP LIST (' ');                                                
                                                                        
    /* Kald ZS67000 som udskriver indholdet af SQLCA'en via DB2 */      
    /* standard SQLCA formateringsprogrammet DSNTIAR.           */      
    CALL ZS67000(SQLCA);                                                
                                                                        
    /* Foretag user abend med den angivne user abend kode og tekst */   
    CALL ABEND (P_PROCNAME, P_USER_ABEND_CODE, P_TEXT);                 
                                                                        
 END SQL_ERROR;                                                         
                                                                        
