 /**********************************************************************
 * PROJEKT:     EVS SLUT 2001                                          *
 * PROGRAMNAVN: BH34000M.                                              *
 * PROGRAMTYPE: MAKRO.                                                 *
 * FUNKTION:    SQL UDTRÆK ALLE AKTIVE OG VALIDE EJENDOMME FRA         *
 *              EVS SLUT 2000 PR. TESTPERSON.                          *
 *              MAX ELBNR  OG  MAX DTILGLD                             *
 * PROGRAMMØR:  HANS ERIK KJELDSEN    HKS, PUS/T&S BRØNDBY 30.11.2001. *
 * ÆNDRINGSLOG: XXXXXX XXXXXX         XXX, PUS/T&S BRØNDBY 00.00.2000. *
 **********************************************************************/
 /*********************************************************************/
 /* DECLARE CURSOR TIL LÆS AF TABEL BQ00700T OG BQ00100T       RUTINE */
 /*********************************************************************/
 DECLARE_PERSONEJENDOMSOPL_TEST: PROC;                                  
                                                                        
         EXEC SQL DECLARE PERSON_CURSOR CURSOR FOR                      
                                                                        
              SELECT T1.DCPRN                                           
                    ,T1.EKOMNR                                          
                    ,T1.EEJDNR                                          
                    ,T1.ELBNR                                           
                    ,T1.EGENNR                                          
                    ,T1.DHENVNR                                         
                    ,T1.CÆGTOPR                                         
                    ,T1.CFRÅR                                           
                    ,T1.CEJBEVS                                         
                    ,T1.BBERGRL                                         
                    ,T1.CBERGRL                                         
                    ,T1.CEJDTYPE                                        
                    ,T1.CFORNEDSL1                                      
                    ,T1.CNEDSL1                                         
                    ,T1.CSKPLOMF                                        
                    ,T1.CPENSNED                                        
                    ,T1.CSTIBEGR                                        
                    ,T1.CEKSEMP                                         
                    ,T1.DATO0107                                        
                    ,T1.DOVTG                                           
                    ,T1.GPCTEJER                                        
                    ,T1.BBER2FAM                                        
                    ,T1.BEJBOL1                                         
                    ,T1.BEJBOL2                                         
                    ,T1.CANVEBOL                                        
                    ,T1.CFRED                                           
                    ,T1.CELØNCOR                                        
                    ,T1.CENKE                                           
                    ,T1.CPTYPGL                                         
                    ,T1.CPTYPSLUT                                       
                    ,T1.BFORSKAT                                        
                    ,T1.CFORSKAT                                        
                    ,T1.BMANDØD                                         
                    ,T1.DOVTGFOR                                        
                    ,T1.DAFSTAAFOR                                      
                    ,T1.GPCTEJERFOR                                     
                    ,T1.COVTAFSTFOR                                     
                    ,T1.BFSKAT                                          
                    ,T1.BERHVAN                                         
                    ,T1.BPRIVAN                                         
                    ,T1.BPENSNED                                        
                    ,T1.BPENSNÆ                                         
                    ,T1.BNETTO                                          
                    ,T1.BEVSMAN                                         
                    ,T1.BMANEVSSTI                                      
                    ,T1.MANPENSSTI                                      
                    ,T1.CIVILSTAND                                      
                    ,T1.DCPRNKOPI                                       
                    ,T1.FEJLNR                                          
                    ,T1.COMPLA                                          
                    ,T1.DAFSTAA                                         
                    ,T1.DINDKAAR                                        
                    ,T2.EJDBELIG                                        
                    ,T2.CBENYT                                          
                    ,T2.CEJBOLTYP1                                      
                    ,T2.CEJBOLTYP2                                      
                    ,T2.FLEJL                                           
                    ,T2.CEJV                                            
                    ,T2.BEJDVÆR                                         
                                                                        
         FROM   BQ00700T T1, BQ00100T T2                                
         WHERE  T1.DINDKAAR = 2000                                      
         AND    T1.DINDKAAR = T2.DINDKAAR                               
         AND    T1.EKOMNR   = T2.EKOMNR                                 
         AND    T1.EEJDNR   = T2.EEJDNR                                 
         AND    T1.COMPLA   = ' '                                       
         AND   DIGITS(T1.ELBNR) !! CHAR(T1.DTILGLD) =                   
              (SELECT DIGITS(MAX(ELBNR)) !! CHAR(MAX(DTILGLD))          
         FROM      BQ00700T T4                                          
               WHERE T1.DCPRN        = T4.DCPRN                         
               AND   T1.DINDKAAR     = T4.DINDKAAR                      
               AND   T1.EKOMNR       = T4.EKOMNR                        
               AND   T1.EEJDNR       = T4.EEJDNR                        
               AND   T1.COMPLA       = T4.COMPLA)                       
         ORDER BY T1.DCPRN,                                             
                  T1.DINDKAAR,                                          
                  T1.EKOMNR,                                            
                  T1.EEJDNR,                                            
                  T1.ELBNR,                                             
                  T1.EGENNR;                                            
                                                                        
         IF SQLCA.SQLCODE ^= 0 THEN                                     
           DO;                                                          
             FEJLTEKST = 'DECLARE PERSONEJDOPL';                        
             CALL SQL_FEJL_TEST;                                        
           END;                                                         
                                                                        
 END DECLARE_PERSONEJENDOMSOPL_TEST;                                    
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF PERSONTABEL BQ00200T               RUTINE */
 /*********************************************************************/
 FETCH_PERSONEJENDOMSOPL_TEST: PROC;                                    
                                                                        
         EXEC SQL FETCH PERSON_CURSOR                                   
                                                                        
         INTO :TESTPERSON.DCPRN      ,                                  
              :TESTPERSON.EKOMNR     ,                                  
              :TESTPERSON.EEJDNR     ,                                  
              :TESTPERSON.ELBNR      ,                                  
              :TESTPERSON.EGENNR     ,                                  
              :TESTPERSON.DHENVNR    ,                                  
              :TESTPERSON.CÆGTOPR    ,                                  
              :TESTPERSON.CFRÅR      ,                                  
              :TESTPERSON.CEJBEVS    ,                                  
              :TESTPERSON.BBERGRL:INDK_PERS.BBERGRL_I,                  
              :TESTPERSON.CBERGRL    ,                                  
              :TESTPERSON.CEJDTYPE   ,                                  
              :TESTPERSON.CFORNEDSL1 ,                                  
              :TESTPERSON.CNEDSL1    ,                                  
              :TESTPERSON.CSKPLOMF   ,                                  
              :TESTPERSON.CPENSNED   ,                                  
              :TESTPERSON.CSTIBEGR   ,                                  
              :TESTPERSON.CEKSEMP    ,                                  
              :TESTPERSON.DATO0107   ,                                  
              :TESTPERSON.DOVTG      ,                                  
              :TESTPERSON.GPCTEJER   ,                                  
              :TESTPERSON.BBER2FAM:INDK_PERS.BBER2FAM_I,                
              :TESTPERSON.BEJBOL1:INDK_PERS.BEJBOL1_I,                  
              :TESTPERSON.BEJBOL2:INDK_PERS.BEJBOL2_I,                  
              :TESTPERSON.CANVEBOL   ,                                  
              :TESTPERSON.CFRED      ,                                  
              :TESTPERSON.CELØNCOR   ,                                  
              :TESTPERSON.CENKE      ,                                  
              :TESTPERSON.CPTYPGL    ,                                  
              :TESTPERSON.CPTYPSLUT  ,                                  
              :TESTPERSON.BFORSKAT:INDK_PERS.BFORSKAT_I,                
              :TESTPERSON.CFORSKAT   ,                                  
              :TESTPERSON.BMANDØD    ,                                  
              :TESTPERSON.DOVTGFOR   ,                                  
              :TESTPERSON.DAFSTAAFOR ,                                  
              :TESTPERSON.GPCTEJERFOR,                                  
              :TESTPERSON.COVTAFSTFOR,                                  
              :TESTPERSON.BFSKAT     ,                                  
              :TESTPERSON.BERHVAN    ,                                  
              :TESTPERSON.BPRIVAN    ,                                  
              :TESTPERSON.BPENSNED   ,                                  
              :TESTPERSON.BPENSNÆ    ,                                  
              :TESTPERSON.BNETTO     ,                                  
              :TESTPERSON.BEVSMAN:INDK_PERS.BEVSMAN_I,                  
              :TESTPERSON.BMANEVSSTI ,                                  
              :TESTPERSON.MANPENSSTI ,                                  
              :TESTPERSON.CIVILSTAND ,                                  
              :TESTPERSON.DCPRNKOPI  ,                                  
              :TESTPERSON.FEJLNR     ,                                  
              :TESTPERSON.COMPLA     ,                                  
              :TESTPERSON.DAFSTAA    ,                                  
              :TESTPERSON.DINDKAAR   ,                                  
              :EJENDOM.EJDBELIG      ,                                  
              :EJENDOM.CBENYT        ,                                  
              :EJENDOM.CEJBOLTYP1    ,                                  
              :EJENDOM.CEJBOLTYP2    ,                                  
              :EJENDOM.FLEJL         ,                                  
              :EJENDOM.CEJV          ,                                  
              :EJENDOM.BEJDVÆR                                          
                   ;                                                    
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               LÆS_BH960 = LÆS_BH960 + 1;                               
             END;                                                       
                                                                        
           WHEN (100);                                                  
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST  = 'FETCH PERSONEJDOPL';                       
               PUT SKIP LIST('SQLKODE',SQLCODE);                        
               CALL SQL_FEJL_TEST;                                      
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
 END FETCH_PERSONEJENDOMSOPL_TEST;                                      
