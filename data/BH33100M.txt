 /**********************************************************************
 * PROJEKT:     EVS SLUT 2001                                          *
 * PROGRAMNAVN: BH33100M.                                              *
 * PROGRAMTYPE: MAKRO.                                                 *
 * FUNKTION:    SQL UDTRÆK ALLE AKTIVE OG VALIDE EJENDOMME FRA         *
 *              EVS SLUT 2000 PR. PERSON.                              *
 * PROGRAMMØR:  HANS E KJELDSEN       HKS, PUS/T&S BRØNDBY 21.11.2001. *
 * ÆNDRINGSLOG: XXXXXX XXXXXX         XXX, PUS/T&S BRØNDBY 00.00.2000. *
 **********************************************************************/
 /*********************************************************************/
 /* DECLARE CURSOR TIL LÆS AF PERSONTABEL BQ00200T             RUTINE */
 /*********************************************************************/
 DECLARE_PERSONEJENDOMSOPL: PROC;                                       
                                                                        
         EXEC SQL DECLARE PERSON_CURSOR CURSOR FOR                      
                                                                        
              SELECT T1.DCPRN                                           
                    ,T1.DINDKAAR                                        
                    ,T1.EKOMNR                                          
                    ,T1.EEJDNR                                          
                    ,T1.ELBNR                                           
                    ,T1.EGENNR                                          
                    ,T1.DFRAGLD                                         
                    ,T1.DTILGLD                                         
                    ,T1.CEJBEVS                                         
                    ,T1.CEJDTYPE                                        
                    ,T1.CFRED                                           
                    ,T1.CNEDSL1                                         
                    ,T1.DATO0107                                        
                    ,T1.DOVTG                                           
                    ,T1.DAFSTAA                                         
                    ,T1.GPCTEJER                                        
                    ,T1.FDAGUDLE                                        
                    ,T1.GPCTUDLE                                        
                    ,T1.FDAGERHV                                        
                    ,T1.GPCTERHV                                        
                    ,T1.BPROM1                                          
                    ,T1.BEJERAN                                         
                    ,T1.BEVSMAN                                         
                    ,T1.BFORSKAT                                        
                    ,T1.DCPRNKOPI                                       
                    ,T1.CKOPI                                           
                    ,T2.EJDBELIG                                        
                                                                        
                                                                        
         FROM   BQ00700T T1, BQ00600T T2                                
         WHERE (T1.DINDKAAR = 2000                                      
         AND    T1.DINDKAAR = T2.DINDKAAR                               
         AND    T1.EKOMNR   = T2.EKOMNR                                 
         AND    T1.EEJDNR   = T2.EEJDNR                                 
         AND    T1.CKOPI    = '1'                                       
         AND    T1.EGENNR   = 1                                         
         AND    T1.ELBNR    = 1)                                        
         ORDER BY T1.DCPRN,                                             
                  T1.EKOMNR,                                            
                  T1.EEJDNR;                                            
                                                                        
                                                                        
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
           DO;                                                          
             FEJLTEKST = 'DECLARE PERSONEJDOPL_1';                      
             CALL SQL_FEJL;                                             
           END;                                                         
 END DECLARE_PERSONEJENDOMSOPL;                                         
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF PERSONTABEL BQ00200T               RUTINE */
 /*********************************************************************/
 FETCH_PERSONEJENDOMSOPL: PROC;                                         
                                                                        
         EXEC SQL FETCH PERSON_CURSOR                                   
                                                                        
         INTO :TESTPERSON.DCPRN,                                        
              :TESTPERSON.DINDKAAR,                                     
              :TESTPERSON.EKOMNR,                                       
              :TESTPERSON.EEJDNR,                                       
              :TESTPERSON.ELBNR,                                        
              :TESTPERSON.EGENNR,                                       
              :TESTPERSON.DFRAGLD,                                      
              :TESTPERSON.DTILGLD,                                      
              :TESTPERSON.CEJBEVS,                                      
              :TESTPERSON.CEJDTYPE,                                     
              :TESTPERSON.CFRED,                                        
              :TESTPERSON.CNEDSL1,                                      
              :TESTPERSON.DATO0107,                                     
              :TESTPERSON.DOVTG,                                        
              :TESTPERSON.DAFSTAA,                                      
              :TESTPERSON.GPCTEJER,                                     
              :TESTPERSON.FDAGUDLE,                                     
              :TESTPERSON.GPCTUDLE,                                     
              :TESTPERSON.FDAGERHV,                                     
              :TESTPERSON.GPCTERHV,                                     
              :TESTPERSON.BPROM1,                                       
              :TESTPERSON.BEJERAN,                                      
              :TESTPERSON.BEVSMAN:INDK_PERS.BEVSMAN_I,                  
              :TESTPERSON.BFORSKAT:INDK_PERS.BFORSKAT_I,                
              :TESTPERSON.DCPRNKOPI,                                    
              :TESTEJENDOM.EJDBELIG                                     
         ;                                                              
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               ANTLÆS_PERSON = ANTLÆS_PERSON + 1;                       
             END;                                                       
                                                                        
           WHEN (100);                                                  
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST  = 'FETCH PERSONEJDOPL';                       
               PUT SKIP LIST('SQLKODE',SQLCODE);                        
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
 END FETCH_PERSONEJENDOMSOPL;                                           
