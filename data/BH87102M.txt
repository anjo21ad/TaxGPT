 /*********************************************************************/
 /*   DAN DATA TIL SLUT DXC VEDR. SUPPLEMENTSLEVERINGEN               */
 /*   SLUT09    GERD HOLM-PEDERSEN                        22/10-2011  */
 /*             KRAV 18-02: OPSÆTNING AF BEREGNINGSGRL. FOR UDL. EJ   */
 /*             HVOR FELT 614 (BBERGRL_015ANV) NU SKAL ANVENDES BÅDE  */
 /*             TIL DANSKE OG UDENLANDSKE EJENDOMME                   */
 /*  SLUT11    GERD HOLM-PEDERSEN                                     */
 /*            TILRETTET SLUT 2011 SAMT                    11/11-2011 */
 /*            KRAV 18-05: OPSÆTNING AF BEREGNINGSGRL. FOR UDL. EJD.  */
 /*            HVOR FELT 615,616,621,622 OG 626 OVERFØRES SOM 614     */
 /*            FELT 616 OG 626 SKAL IKKE OVERFØRES.        27/12-2011 */
 /*  SLUT13    JØRGEN SAUGMANN                                        */
 /*            TILRETTET SLUT 2013 SAMT                    03/02-2014 */
 /*            IMPLEMENTERING AF 2 NYE FLETER TIL REDUSERING AF       */
 /*            EJENDOMSVÆRSKAT FOR PENSIONISTER BOSIDDENDE I UDLANDET */
 /*  SLUT15    JØRGEN SAUGMANN                                        */
 /*            TILRETTET SLUT 2013 SAMT                    28/12-2015 */
 /*  SLUT15    ESBEN BRODERSEN                             22/02-2016 */
 /*  UDVIDET BRUG AF DATO INCLUDE BH65300M #01                        */
 /*  SLUT16     ESBEN BRODERSEN QEB                        10/10-2016 */
 /*             NYE FELTER: BLANDVÆR_015ANV, BLANDVÆR_02ANV,          */
 /*                         BLANDVÆR_AKT                              */
 /*             UDGÅEDE FELTER: BPROM2, BPROM1, BSTIBEGR, BNEDSL1,    */
 /*             BPENSNED, BNEDSL2, BGRPROM2, CSTIBLB, BGRPROM1        */
 /*  DB2OMLÆG   LENE MAJ JENSEN, QLE                       24/03-2017 */
 /*             Omlægning af beregningsbånd til db2.   BH960->db2     */
 /*  SLUT17     ESBEN BRODERSEN                            OKT 2017   */
 /*             UDGÅEDE FELTER: CSCREGISTMP, BGLSUM1, CNULSTIL        */
 /*  SLUT18     ESBEN BRODERSEN                            DEC 2018   */
 /*             Udgåede felter: CSKPLOMF, BOBEHAKOD,CELØNCOR          */
 /*                             EKOMNR_EJDNR_GL, CSKPLOMFGL           */
 /*             Nye felter:     EENHEDLBNR, VURDOPRIDKOD, EJDBLIGEKMNR*/
 /*                             VEJKOD, HUSNR, HUSBOSTAADR, ETAGENR,  */
 /*                             SIDEDOERNR                            */
 /*  SLUT20     Skift til INDKÅR1 da årstal DINDKAAR ikke blev opsat  */
 /* Slut 2020:  Elena Flygenring EFL                      marts 2021  */
 /*              - struktur BH65300M erstattes med BH55300M           */
 /*********************************************************************/
 DAN_DATA_TIL_SLUT: PROC;                                               
                                                                        
      BH871            = '';                                            
      BH871.INDVNR     = 810;                                           
      BH871.INDVLGD    = 499;                                           
      BH871.FELTLGD    = 499;                                           
      BH871.HEADER     = 'EVSGRUND';                                    
      BH871.DINDKAAR   = BH55300M.INDKÅR1; /*#01*/                      
      BH871.DCPRN      = DCLBQ78000T.DCPRN;                             
      BH871.EKOMNR     = DCLBQ78000T.EKOMNR;                            
      BH871.EEJDNR     = DCLBQ78000T.EEJDNR;                            
      BH871.EENHEDLBNR = DCLBQ78000T.EENHEDLBNR;                        
      BH871.ELBNR      = DCLBQ78000T.UDSKRLBNR;                         
                                                                        
      BH871.EJDBLIGEKMNR  = DCLBQ78000T.EKOMNR;                         
                                                                        
      IF DCLBQ75000T.EJER_DCPRCIR > 0  !                                
         DCLBQ75000T.ÆGTE_DCPRCIR > 0                                   
      THEN                                                              
        BH871.VURDOPRIKOD  = 'ESR';                                     
      ELSE                                                              
        BH871.VURDOPRIKOD  = 'EVS';                                     
                                                                        
      BH871.CSLET      = ' ';                                           
      BH871.CLANDEKODE = DCLBQ78000T.EJENDOM_CLANDEKODE;                
      BH871.CEJBEVS    = DCLBQ78000T.TILEVS_CEJBEVS;                    
      BH871.MANPENSSTI_I = -1;                                          
      BH871.MANPENSSTI = 0;                                             
                                                                        
      IF BH871.EKOMNR = 999    /*SLUT09 18-02 OG SLUT11 FRA*/           
      THEN                                                              
        DO;                                                             
           BH871.BBERGRL_015ANV_I  = DCLBQ78000T.EJERSKAB_UDL_614_SW;   
           BH871.BBERGRL_015ANV    = DCLBQ78000T.EJERSKAB_UDL_614;      
           BH871.BBERGRL_02ANV_I   = DCLBQ78000T.EJERSKAB_UDL_615_SW;   
           BH871.BBERGRL_02ANV     = DCLBQ78000T.EJERSKAB_UDL_615;      
           BH871.BBERGRL_AKT_I     = -1;                                
           BH871.BBERGRL_AKT       = 0;                                 
                                                                        
           BH871.BBER2FAM_015ANV_I = DCLBQ78000T.EJERSKAB_UDL_621_SW;   
           BH871.BBER2FAM_015ANV   = DCLBQ78000T.EJERSKAB_UDL_621;      
           BH871.BBER2FAM_02ANV_I  = DCLBQ78000T.EJERSKAB_UDL_622_SW;   
           BH871.BBER2FAM_02ANV    = DCLBQ78000T.EJERSKAB_UDL_622;      
           BH871.BBER2FAM_AKT_I    = -1;                                
           BH871.BBER2FAM_AKT      = 0;                                 
        END;                                                            
      ELSE                                                              
        DO;                    /*SLUT09 OG SLUT11 TIL*/                 
           BH871.BBERGRL_015ANV_I = DCLBQ78000T.VURD_015ANV_BBERGRL_SW; 
           BH871.BBERGRL_015ANV   = DCLBQ78000T.VURD_015ANV_BBERGRL;    
           BH871.BBERGRL_02ANV_I  = DCLBQ78000T.VURD_02ANV_BBERGRL_SW;  
           BH871.BBERGRL_02ANV    = DCLBQ78000T.VURD_02ANV_BBERGRL;     
           BH871.BBERGRL_AKT_I    = DCLBQ78000T.VURD_A_BBERGRL_A_SW;    
           BH871.BBERGRL_AKT      = DCLBQ78000T.VURD_A_BBERGRL_AKT;     
                                                                        
           BH871.BBER2FAM_015ANV_I =                                    
                                   DCLBQ78000T.VURD_015ANV_BBER2FAM_SW; 
           BH871.BBER2FAM_015ANV  = DCLBQ78000T.VURD_015ANV_BBER2FAM;   
           BH871.BBER2FAM_02ANV_I = DCLBQ78000T.VURD_02ANV_BBER2FAM_SW; 
           BH871.BBER2FAM_02ANV   = DCLBQ78000T.VURD_02ANV_BBER2FAM;    
           BH871.BBER2FAM_AKT_I   = DCLBQ78000T.VURD_A_BBER2FAM_A_SW;   
           BH871.BBER2FAM_AKT     = DCLBQ78000T.VURD_A_BBER2FAM_AKT;    
        END;                                                            
                                                                        
      IF DCLBQ78000T.EENHEDLBNR = 0                                     
      THEN                                                              
        DO;                                                             
          BH871.EJDBELIG     = DCLBQ78000T.EJENDOM_EJDBELIG;            
          BH871.VEJKOD       = DCLBQ78000T.EJENDOM_VEJK_EJD;            
          BH871.HUSNR        =                                          
                SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_EJD,1,3);              
          BH871.HUSBOSTAADR  =                                          
                SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_EJD,4,1);              
          BH871.ETAGENR      = DCLBQ78000T.EJENDOM_ETAGE_EJD;           
          BH871.SIDEDOERNR   = DCLBQ78000T.EJENDOM_SDØR_EJD;            
        END;                                                            
      ELSE                                                              
        DO                                                              
          BH871.EJDBELIG     = DCLBQ78000T.EJENDOM_ENHEDBELIG;          
          BH871.VEJKOD       = DCLBQ78000T.EJENDOM_VEJK_ENHED;          
          BH871.HUSNR        =                                          
                SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_ENHED,1,3);            
          BH871.HUSBOSTAADR  =                                          
                SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_ENHED,4,1);            
          BH871.ETAGENR      = DCLBQ78000T.EJENDOM_ETAGE_ENHED;         
          BH871.SIDEDOERNR   = DCLBQ78000T.EJENDOM_SDØR_ENHED;          
        END;                                                            
                                                                        
      /* Rettelse til defect 154 fra slut 2015 QEB */                   
      IF DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT > '0'                        
      THEN                                                              
        BH871.CEJDTYPE = DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT;             
      ELSE                                                              
        BH871.CEJDTYPE = DCLBQ78000T.EJENDOM_CEJDTYPE;                  
                                                                        
      BH871.CÆGTOPR  = DCLBQ78000T.TILEVS_CÆGTOPR;                      
                                                                        
      IF DCLBQ78000T.TILEVS_DOVTG > 0                                   
      THEN                                                              
         BH871.DOVTG =                                                  
         FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DOVTG);                  
      ELSE                                                              
         BH871.DOVTG = (10)' ';                                         
                                                                        
      IF DCLBQ78000T.TILEVS_DAFSTAA > DCLBQ76000T.DRGNÅRTIL             
      THEN                                                              
         BH871.DAFSTAA = (10)' ';                                       
      ELSE                                                              
         IF DCLBQ78000T.TILEVS_DAFSTAA > 0                              
         THEN                                                           
            BH871.DAFSTAA =                                             
            FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DAFSTAA);             
         ELSE                                                           
            BH871.DAFSTAA = (10)' ';                                    
                                                                        
      BH871.GPCTEJER_I = DCLBQ78000T.TILEVS_GPCTEJER_SW;                
      BH871.GPCTEJER = DCLBQ78000T.TILEVS_GPCTEJER;                     
                                                                        
      BH871.FDAGUDLE = 0;                                               
      BH871.GPCTUDLE = 0;                                               
      BH871.FUDL100  = DCLBQ78000T.TILEVS_FUDL100; /* 18-02 SLUT09 */   
      BH871.GPCTERHV = 0;                                               
      BH871.FDAGERHV = 0;                                               
      BH871.FERHVFLER = DCLBQ78000T.TILEVS_FERHVFLER;                   
      BH871.CENKE     = DCLBQ78000T.TILEVS_CENKE;                       
      BH871.CPTYPSLUT = DCLBQ78000T.TILEVS_CPTYPSLUT;                   
      BH871.CPTYPGL   = DCLBQ78000T.TILEVS_CPTYPGL;                     
      BH871.FELT759   = DCLBQ78000T.TILEVS_FELT759;                     
      BH871.FELT760 = DCLBQ78000T.TILEVS_CFRED;                         
      BH871.BEVSGL_I = DCLBQ78000T.TILEVS_BEVSGL_SW;                    
      BH871.BEVSGL   = DCLBQ78000T.TILEVS_BEVSGL;                       
      BH871.BPENSNEDGL_I = DCLBQ78000T.TILEVS_BPENSNEDGL_SW;            
      BH871.BPENSNEDGL = DCLBQ78000T.TILEVS_BPENSNEDGL;                 
                                                                        
      IF DCLBQ78000T.TILEVS_DINDFLYT > 0                                
      THEN                                                              
         BH871.DINDFLYT =                                               
         FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DINDFLYT);               
                                                                        
      IF DCLBQ78000T.TILEVS_DFRAFLYT > 0                                
      THEN                                                              
         BH871.DFRAFLYT =                                               
         FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DFRAFLYT);               
                                                                        
      BH871.FUBEBOELIG = 0;                                             
      BH871.BFASTSTIGBGR_I = DCLBQ78000T.TILEVS_BFASTSTIGBGR_SW;        
      BH871.BFASTSTIGBGR   = DCLBQ78000T.TILEVS_BFASTSTIGBGR;           
      BH871.CINDFLYT = ' ';                                             
      BH871.CBERGRGLOP   = DCLBQ78000T.EJERSKAB_CBERGRGLOP;             
      BH871.BMANEVSSTI_I = -1;                                          
      BH871.BMANEVSSTI    = 0;                                          
      BH871.BEVSMAN_I     = -1;                                         
      BH871.BEVSMAN       = 0;                                          
      BH871.BMANNEDSL_I   = -1;                                         
      BH871.BMANNEDSL     = 0;                                          
      BH871.CEKSEMP       = ' ';                                        
      BH871.MANNEDSLSTI_I = -1;                                         
      BH871.MANNEDSLSTI   = 0;                                          
      BH871.BUDLSKC_I     = -1;                                         
      BH871.BUDLSKC       = 0;                                          
      BH871.BEJBOL1_AKT_I = DCLBQ78000T.VURD_A_BEJBOL1_A_SW;            
      BH871.BEJBOL1_AKT   = DCLBQ78000T.VURD_A_BEJBOL1_AKT;             
      BH871.BEJBOL2_AKT_I = DCLBQ78000T.VURD_A_BEJBOL2_A_SW;            
      BH871.BEJBOL2_AKT   = DCLBQ78000T.VURD_A_BEJBOL2_AKT;             
      BH871.DAFSTAAFOR = DCLBQ78000T.TILEVS_DAFSTAAFOR;                 
      BH871.BEJBOL1_02ANV_I = DCLBQ78000T.VURD_02ANV_BEJBOL1_SW;        
      BH871.BEJBOL1_02ANV = DCLBQ78000T.VURD_02ANV_BEJBOL1;             
      BH871.BEJBOL2_02ANV_I = DCLBQ78000T.VURD_02ANV_BEJBOL2_SW;        
      BH871.BEJBOL2_02ANV = DCLBQ78000T.VURD_02ANV_BEJBOL2;             
      BH871.CBENYT = DCLBQ78000T.VURD_A_CBENYT_AKT;                     
      BH871.CBERGRL  = DCLBQ78000T.EJENDOM_CBERGRL;                     
      BH871.GPCTEJERFOR = DCLBQ78000T.TILEVS_GPCTEJERFOR;               
      BH871.CERHV = DCLBQ78000T.TILEVS_CERHV;                           
      BH871.CVURDOPR  = DCLBQ78000T.TILEVS_A_V_CVURDOPR;                
      BH871.COMBYG    = DCLBQ78000T.EJENDOM_COMBYG;                     
                                                                        
      /* 3 Nye felter slut 2016 til overførsel af landbrugs opl #01*/   
      IF BH871.CEJDTYPE = '9' &                                         
         BH871.EKOMNR ^= 999                                            
      THEN                                                              
        DO;                                                             
          BH871.BLANDVÆR_015ANV_I =                                     
                          DCLBQ78000T.VURD_015ANV_BEJDVÆR_SW;           
          BH871.BLANDVÆR_015ANV   = DCLBQ78000T.VURD_015ANV_BEJDVÆR;    
          BH871.BLANDVÆR_02ANV_I  =                                     
                          DCLBQ78000T.VURD_02ANV_BEJDVÆR_SW;            
          BH871.BLANDVÆR_02ANV    = DCLBQ78000T.VURD_02ANV_BEJDVÆR;     
          BH871.BLANDVÆR_AKT_I    = DCLBQ78000T.VURD_A_BEJDVÆR_A_SW;    
          BH871.BLANDVÆR_AKT      = DCLBQ78000T.VURD_A_BEJDVÆR_AKT;     
        END;                                                            
      ELSE                                                              
        DO;                                                             
          BH871.BLANDVÆR_015ANV_I = -1;                                 
          BH871.BLANDVÆR_015ANV   = 0;                                  
          BH871.BLANDVÆR_02ANV_I  = -1;                                 
          BH871.BLANDVÆR_02ANV    = 0;                                  
          BH871.BLANDVÆR_AKT_I    = -1;                                 
          BH871.BLANDVÆR_AKT      = 0;                                  
        END;                                                            
                                                                        
      BH871.BBERGRL_I = DCLBQ78000T.EJERSKAB_BBERGRL_SW;                
      BH871.BBERGRL   = DCLBQ78000T.EJERSKAB_BBERGRL;                   
      BH871.CBERGROP  = DCLBQ78000T.EJERSKAB_CBERGROP;                  
                                                                        
      IF DCLBQ78000T.UDSKRLBNR = 1                                      
      THEN                                                              
         DO;                                                            
           BH871.BFORSKAT_I = DCLBQ78000T.TILEVS_BFORSKAT_SW;           
           BH871.BFORSKAT = DCLBQ78000T.TILEVS_BFORSKAT;                
           BH871.CFORSKAT = DCLBQ78000T.TILEVS_CFORSKAT;                
         END;                                                           
      ELSE                                                              
         DO;                                                            
           BH871.BFORSKAT_I = -1;                                       
           BH871.BFORSKAT = 0;                                          
           BH871.CFORSKAT = '2';                                        
         END;                                                           
                                                                        
      BH871.CUDLMAN = DCLBQ78000T.TILEVS_CUDLMAN;                       
      BH871.BBER2FAM_I = DCLBQ78000T.EJERSKAB_BBER2FAM_SW;              
      BH871.BBER2FAM    = DCLBQ78000T.EJERSKAB_BBER2FAM;                
                                                                        
      IF DCLBQ78000T.FEJLNR > 0                                         
      THEN                                                              
         DO;                                                            
            HJ_FEJLNR = DCLBQ78000T.FEJLNR;                             
            BH871.FEJLNR = HJ_FEJLNR;                                   
         END;                                                           
      ELSE                                                              
         BH871.FEJLNR = ' ';                                            
                                                                        
      BH871.BEJBOL1_015ANV_I =                                          
                    DCLBQ78000T.VURD_015ANV_BEJBOL1_SW;                 
      BH871.BEJBOL1_015ANV    =                                         
                    DCLBQ78000T.VURD_015ANV_BEJBOL1;                    
      BH871.BEJBOL2_015ANV_I =                                          
                    DCLBQ78000T.VURD_015ANV_BEJBOL2_SW;                 
      BH871.BEJBOL2_015ANV    =                                         
                    DCLBQ78000T.VURD_015ANV_BEJBOL2;                    
                                                                        
      BH871.DFRAGLD = BQ_UD.PERSON.DFRAGLD; /* OPSAT AF DATAMODUL */    
                                                                        
      BH871.CNEDSL1 = DCLBQ78000T.TILEVS_CNEDSL1;                       
      BH871.FLEJL = DCLBQ78000T.VURD_A_FLEJL_AKT;                       
      BH871.DOVTGFOR = DCLBQ78000T.TILEVS_DOVTGFOR;                     
      BH871.CDATAFRA = DCLBQ78000T.TILEVS_CDATAFRA;                     
      BH871.CUDLHEL   = DCLBQ78000T.TILEVS_CUDLHEL;                     
      BH871.CUDLDEL   = DCLBQ78000T.TILEVS_CUDLDEL;                     
                                                                        
      BH871.BEJDVPUSKTP_I = -1;                                         
      BH871.BEJDVPUSKTP   = 0;                                          
      BH871.BEJDVÆPUSKP_I = -1;                                         
      BH871.BEJDVÆPUSKP   = 0;                                          
                                                                        
      TV.SKREVET = TV.SKREVET + 1;                                      
                                                                        
      WRITE FILE (BH8710O) FROM (BH871);                                
                                                                        
 END DAN_DATA_TIL_SLUT;                                                 
