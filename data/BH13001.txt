 BH13001: PROC(COMPTR)  OPTIONS(MAIN,REENTRANT) REORDER;                
 /**********************************************************************
 *                                                                     *
 *     SKELETPROGRAM GENERERET AF ZSRØR                                *
 *                                                                     *
 *       EXTERN MODUL-BESKRIVELSE                                      *
 *                                                                     *
 *       NAVN          - BH13000                                       *
 *                                                                     *
 *       FUNKTION      - UDSØGNING AF DETALJEDATA I FORB. MED EVS AJOU *
 *                                                                     *
 *       TRANSKODE     - B990                                          *
 *                                                                     *
 *       INDDATA       - COMMAREA FRA ZSRØR                            *
 *                                                                     *
 *       UDDATA        - COMMAREA TIL ZSRØR                            *
 *                                                                     *
 *       EXTERNE REF.  -                                               *
 *                                                                     *
 *       GENERERET AF  - BO PROVSTGAARD SØREN 20.08.01                 *
 *                                                                     *
 *       RETTET        -                                               *
 *                                                                     *
 **********************************************************************/
 /**********************************************************************
 *    COMMAREA.                                                        *
 **********************************************************************/
 %INCLUDE ZX23000M;                                                     
                                                                        
 /**********************************************************************
 *    ZSRØR INCLUDES.                                                  *
 **********************************************************************/
 %INCLUDE BH13001M;                                                     
                                                                        
 /**********************************************************************
 *    LOG-/ABEND RUTINE.                                               *
 **********************************************************************/
 %INCLUDE ZS37800M;                                                     
                                                                        
 /**********************************************************************
 *    ØVRIGE DECLARES                                                  *
 **********************************************************************/
 DCL  CICSRC               BIN FIXED(31,0);                             
 DCL (ADDR,CSTG,NULL,STG,SUBSTR)   BUILTIN;                             
                                                                        
 /* Z6BPS INCLUDES BEGYNDER HER */                                      
 /*********************************************************************/
 /*      DECLARE AF DB2 - TABEL                                       */
 /*********************************************************************/
 EXEC SQL INCLUDE BQ00700T; /* EVS PERSONTABEL */                       
 EXEC SQL INCLUDE BQ00600T; /* EVS EJD TABEL */                         
 EXEC SQL INCLUDE SQLCA;                                                
 /* DECLARE AF ØVRIGE */                                                
 DCL 1 EVSPERSON,                                                       
  %INCLUDE BQ00200N;;                                                   
 DCL 1 EVSPERSON_I,                                                     
  %INCLUDE BQ00006N;;                                                   
 DCL 1 EVSEJDTAB,                                                       
  %INCLUDE BQ00100N;;                                                   
 DCL 1 EVSEJDTAB_I,                                                     
  %INCLUDE BQ00005N;;                                                   
 DCL CPRNUMERISK      PIC '(10)9';                                      
 DCL CPRTILDB2        DEC FIXED (11,0);                                 
 DCL PIC10            PIC '(10)Z';                                      
 DCL PIC10CPR         PIC '(10)9';                                      
 DCL PIC5_2           PIC 'ZZ9V,99';                                    
 DCL RETURKODE        BIN FIXED(15);                                    
 /* SLUT Z6BPS INCLUDES */                                              
                                                                        
 /**********************************************************************
 *    HOUSE-KEEPING                                                    *
 **********************************************************************/
 EXEC CICS HANDLE CONDITION ERROR(ABEND);                               
                                                                        
 /**********************************************************************
 *    HOVEDSTYRING                                                     *
 **********************************************************************/
   CAREA.LÆNGDE_UD = STG(OUTPUT);                                       
   CALL GETMAIN(CAREA.OUTPUTPTR,CAREA.LÆNGDE_UD);                       
   OUTPUT = '';                                                         
                                                                        
   IF INPUT.DCPRN='' ! INPUT.EKOMNR=0 ! INPUT.DINDKAAR=0 !              
      INPUT.EEJDNR=0 ! INPUT.EGENNR=0 THEN                              
    DO;                                                                 
     ZS378TEKST='MANGLER INPUTFELTER DCPRN,EKOMNR,DINDKAAR,ELBNR,EGENR';
     OUTPUT.RETURKODE=1;                                                
     CALL ABEND_PROCEDURE;                                              
     EXEC CICS RETURN;                                                  
    END;                                                                
   /* SÅ KØRER VI DERUD AD */                                           
   CPRNUMERISK = INPUT.DCPRN;                                           
   CPRTILDB2 = CPRNUMERISK;                                             
   RETURKODE = FREMFIND_DATA;                                           
   OUTPUT.SQLKODE=RETURKODE;                                            
   OUTPUT.RETURKODE=0;                                                  
   IF RETURKODE=0 THEN                                                  
    DO;                                                                 
     OUTPUT.DFRAGLD      =    EVSEJDTAB.DFRAGLD     ;                   
     OUTPUT.EJDBELIG     =    EVSEJDTAB.EJDBELIG    ;                   
     IF EVSEJDTAB_I.BBERGRL_I=-1 THEN                                   
      OUTPUT.BBERGRL      = '';                                         
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BBERGRL;                                         
       OUTPUT.BBERGRL =   PIC10;                                        
      END;                                                              
     OUTPUT.CBERGRL      =    EVSEJDTAB.CBERGRL     ;                   
     OUTPUT.CEJDTYPE     =    EVSEJDTAB.CEJDTYPE    ;                   
     OUTPUT.FEJLNR       =    EVSEJDTAB.FEJLNR      ;                   
     OUTPUT.CBENYT       =    EVSEJDTAB.CBENYT      ;                   
     OUTPUT.FLEJL        =    EVSEJDTAB.FLEJL       ;                   
     OUTPUT.CEJV         =    EVSEJDTAB.CEJV        ;                   
     IF EVSEJDTAB_I.BBER2FAM_I=-1 THEN                                  
      OUTPUT.BBER2FAM     = 0;                                          
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BBER2FAM;                                        
       OUTPUT.BBER2FAM=   PIC10;                                        
      END;                                                              
     IF EVSEJDTAB_I.BEJBOL1_I=-1 THEN                                   
      OUTPUT.BEJBOL1      = 0;                                          
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BEJBOL1;                                         
       OUTPUT.BEJBOL1=   PIC10;                                         
      END;                                                              
     OUTPUT.CEJBOLTYP1   =    EVSEJDTAB.CEJBOLTYP1  ;                   
     IF EVSEJDTAB_I.BEJBOL2_I=-1 THEN                                   
      OUTPUT.BEJBOL2      = 0;                                          
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BEJBOL2;                                         
       OUTPUT.BEJBOL2=PIC10;                                            
      END;                                                              
     OUTPUT.CEJBOLTYP2   =    EVSEJDTAB.CEJBOLTYP2  ;                   
     OUTPUT.CFRED        =    EVSEJDTAB.CFRED       ;                   
     IF EVSEJDTAB_I.BALMGL_I=-1 THEN                                    
      OUTPUT.BALMGL      = '';                                          
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BALMGL;                                          
       OUTPUT.BALMGL=   PIC10;                                          
      END;                                                              
     IF EVSEJDTAB_I.BFPGL_I=-1 THEN                                     
      OUTPUT.BFPGL      ='';                                            
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BFPGL;                                           
       OUTPUT.BFPGL=   PIC10;                                           
      END;                                                              
     IF EVSEJDTAB_I.BPENSGL_I=-1 THEN                                   
      OUTPUT.BPENSGL     ='';                                           
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BPENSGL;                                         
       OUTPUT.BPENSGL=   PIC10;                                         
      END;                                                              
     IF EVSEJDTAB_I.BSTDGL_I=-1 THEN                                    
      OUTPUT.BSTDGL     ='';                                            
     ELSE                                                               
      DO;                                                               
       PIC10=EVSEJDTAB.BSTDGL;                                          
       OUTPUT.BSTDGL=   PIC10;                                          
      END;                                                              
     OUTPUT.BEJDVAER     =    EVSEJDTAB.BEJDVÆR     ;                   
     OUTPUT.CNEDSL1      =    EVSPERSON.CNEDSL1     ;                   
                                                                        
     PIC5_2= EVSPERSON.GPCTEJER;                                        
     OUTPUT.GPCTEJER     = PIC5_2;                                      
     OUTPUT.DOVTG        =    EVSPERSON.DOVTG       ;                   
     OUTPUT.DAFSTAA      =    EVSPERSON.DAFSTAA     ;                   
     OUTPUT.CENKE        =    EVSPERSON.CENKE       ;                   
     OUTPUT.CSKPLOMF     =    EVSPERSON.CSKPLOMF    ;                   
     IF EVSPERSON_I.BFORSKAT_I=-1 THEN                                  
      OUTPUT.BFORSKAT     ='';                                          
     ELSE                                                               
      DO;                                                               
       PIC10=EVSPERSON.BFORSKAT;                                        
       OUTPUT.BFORSKAT=   PIC10;                                        
      END;                                                              
     OUTPUT.CFORSKAT     =    EVSPERSON.CFORSKAT    ;                   
     OUTPUT.DOVTGFOR     =    EVSPERSON.DOVTGFOR    ;                   
     OUTPUT.DAFSTAAFOR   =    EVSPERSON.DAFSTAAFOR  ;                   
     PIC5_2=EVSPERSON.GPCTEJERFOR;                                      
     OUTPUT.GPCTEJERFOR  = PIC5_2;                                      
     IF EVSPERSON.DHENVNR=0 THEN                                        
       OUTPUT.DHENVNR='0';                                              
     ELSE                                                               
      DO;                                                               
       PIC10CPR=EVSPERSON.DHENVNR;                                      
       OUTPUT.DHENVNR=PIC10CPR;                                         
      END;                                                              
    END; /* IF RETURKODE=0 */                                           
   EXEC CICS RETURN;                                                    
 ABEND:                                                                 
   CALL ABEND_PROCEDURE;                                                
   EXEC CICS RETURN;                                                    
 /********************************************************************* 
 *    FREMFIND DETALJE DATA                                             
 **********************************************************************/
  FREMFIND_DATA:PROC  RETURNS(BIN FIXED(15));                           
   EXEC SQL SELECT                                                      
            BQ006.DFRAGLD                                               
           ,BQ006.EJDBELIG                                              
           ,BQ006.BBERGRL                                               
           ,BQ006.CBERGRL                                               
           ,BQ006.CEJDTYPE                                              
           ,BQ006.FEJLNR                                                
           ,BQ006.CBENYT                                                
           ,BQ006.FLEJL                                                 
           ,BQ006.CEJV                                                  
           ,BQ006.BBER2FAM                                              
           ,BQ006.BEJBOL1                                               
           ,BQ006.CEJBOLTYP1                                            
           ,BQ006.BEJBOL2                                               
           ,BQ006.CEJBOLTYP2                                            
           ,BQ006.CFRED                                                 
           ,BQ006.BALMGL                                                
           ,BQ006.BFPGL                                                 
           ,BQ006.BPENSGL                                               
           ,BQ006.BSTDGL                                                
           ,BQ006.BEJDVÆR                                               
           ,BQ007.CNEDSL1                                               
           ,BQ007.GPCTEJER                                              
           ,BQ007.DOVTG                                                 
           ,BQ007.DAFSTAA                                               
           ,BQ007.CENKE                                                 
           ,BQ007.CSKPLOMF                                              
           ,BQ007.BFORSKAT                                              
           ,BQ007.CFORSKAT                                              
           ,BQ007.DOVTGFOR                                              
           ,BQ007.DAFSTAAFOR                                            
           ,BQ007.GPCTEJERFOR                                           
           ,BQ007.DHENVNR                                               
   INTO                                                                 
       :EVSEJDTAB.DFRAGLD                                               
      ,:EVSEJDTAB.EJDBELIG                                              
      ,:EVSEJDTAB.BBERGRL      :EVSEJDTAB_I.BBERGRL_I                   
      ,:EVSEJDTAB.CBERGRL                                               
      ,:EVSEJDTAB.CEJDTYPE                                              
      ,:EVSEJDTAB.FEJLNR                                                
      ,:EVSEJDTAB.CBENYT                                                
      ,:EVSEJDTAB.FLEJL                                                 
      ,:EVSEJDTAB.CEJV                                                  
      ,:EVSEJDTAB.BBER2FAM     :EVSEJDTAB_I.BBER2FAM_I                  
      ,:EVSEJDTAB.BEJBOL1      :EVSEJDTAB_I.BEJBOL1_I                   
      ,:EVSEJDTAB.CEJBOLTYP1                                            
      ,:EVSEJDTAB.BEJBOL2      :EVSEJDTAB_I.BEJBOL2_I                   
      ,:EVSEJDTAB.CEJBOLTYP2                                            
      ,:EVSEJDTAB.CFRED                                                 
      ,:EVSEJDTAB.BALMGL       :EVSEJDTAB_I.BALMGL_I                    
      ,:EVSEJDTAB.BFPGL        :EVSEJDTAB_I.BFPGL_I                     
      ,:EVSEJDTAB.BPENSGL      :EVSEJDTAB_I.BPENSGL_I                   
      ,:EVSEJDTAB.BSTDGL       :EVSEJDTAB_I.BSTDGL_I                    
      ,:EVSEJDTAB.BEJDVÆR                                               
      ,:EVSPERSON.CNEDSL1                                               
      ,:EVSPERSON.GPCTEJER                                              
      ,:EVSPERSON.DOVTG                                                 
      ,:EVSPERSON.DAFSTAA                                               
      ,:EVSPERSON.CENKE                                                 
      ,:EVSPERSON.CSKPLOMF                                              
      ,:EVSPERSON.BFORSKAT     :EVSPERSON_I.BFORSKAT_I                  
      ,:EVSPERSON.CFORSKAT                                              
      ,:EVSPERSON.DOVTGFOR                                              
      ,:EVSPERSON.DAFSTAAFOR                                            
      ,:EVSPERSON.GPCTEJERFOR                                           
      ,:EVSPERSON.DHENVNR                                               
  FROM   BQ00700T BQ007                                                 
        ,BQ00600T BQ006                                                 
  WHERE                                                                 
            BQ007.DCPRN=:CPRTILDB2                                      
        AND BQ007.DINDKAAR=:INPUT.DINDKAAR                              
        AND BQ007.EKOMNR=:INPUT.EKOMNR                                  
        AND BQ007.EEJDNR=:INPUT.EEJDNR                                  
        AND BQ007.EGENNR=:INPUT.EGENNR                                  
        AND BQ007.ELBNR=:INPUT.ELBNR                                    
        AND BQ007.DINDKAAR=BQ006.DINDKAAR                               
        AND BQ007.EKOMNR=BQ006.EKOMNR                                   
        AND BQ007.EEJDNR=BQ006.EEJDNR                                   
  ;                                                                     
  RETURN(SQLCA.SQLCODE);                                                
 END FREMFIND_DATA;                                                     
                                                                        
 /**********************************************************************
 *    ABEND PÅ EN PÆN MÅDE                                             *
 **********************************************************************/
 ABEND_PROCEDURE:  PROC;                                                
   ZS378FUNK  = '04';         /* AFSLUT, COMMAREA SLETTES     */        
   ZS378TYPE  = 'CICS';                                                 
   ZS378MODUL = 'BH13001';                                              
   %INCLUDE ZS37802M;                                                   
 END ABEND_PROCEDURE;                                                   
                                                                        
 %INCLUDE ZX23000G         /* GETMAIN RUTINE     */;                    
 %INCLUDE ZX23000F         /* FREEMAIN RUTINE     */;                   
 END BH13001;                                                           
