  PROCESS OPT(TIME);                                                    
 BH95010: /* BEREGN EVS -> SLUT-2013-SAMMENLIGN.GRL. OG FORSKUD 2014 */ 
 PROCEDURE (BH945_AR,BH60101M) REORDER;                                 
 /*********************************************************************/
                                                                        
 DCL COPYRIGHT CHAR (30) STATIC INIT ('COPYRIGHT KOMMUNEDATA A/S 2003');
                                                                        
 /*********************************************************************/
 /*      PROGRAMMERET AF AAGE RASMUSSEN, PUS T&S AUG. 2000            */
 /*      ÅRSRULLET    AF AAGE RASMUSSEN, LSU T&S AUG. 2001            */
 /*      ÅRSRULLET    AF AAGE RASMUSSEN, LSU T&S AUG. 2002            */
 /*      ÅRSRULLET    AF AAGE RASMUSSEN, LSU T&S AUG. 2003            */
 /*      ÅRSRULLET    AF BO SCHMIDT    , LSU T&S AUG. 2004            */
 /*      ÅRSRULLET    AF SUSANNE VILLUMSEN       JUL. 2005            */
 /*      ÅRSRULLET    AF BO SCHMIDT              JUL. 2006            */
 /*      ÅRSRULLET    AF BO SCHMIDT              JUL. 2007            */
 /*      ÅRSRULLET    AF BO SCHMIDT              JUL. 2008            */
 /*      ÅRSRULLET    AF GERD HOLM-PEDERSEN      MAJ  2009            */
 /*      ÅRSRULLET    AF GERD HOLM-PEDERSEN      MAJ  2010            */
 /*      RULLET BR0->BR1 OG RUL                                       */
 /*      ÅRSRULLET    AF GERD HOLM-PEDERSEN      MAJ  2011            */
 /*      RULLET BR1->BR2 OG RUL                                       */
 /*      ÅRSRULLET    AF ESBEN BRODERSEN         JUNI 2012            */
 /*      RULLET BR2->BR3 OG RUL                                       */
 /*      ÅRSRULLET    AF ESBEN BRODERSEN         MAJ  2013            */
 /*      RULLET BR3->BR4 OG RUL                                       */
 /*      ÅRSRULLET    AF JØRGEN SAUGMANN         JUL  2014            */
 /*      RULLET BR4->BR5 OG RUL                                       */
 /*      RETTET       AF JØRGEN SAUGMANN         AUG  2014            */
 /*                   VED OPRETTELSE MÅ DER IKKE BEREGNES             */
 /*                   PENSIONISTNEDSLAG                               */
 /*      ÅRSRULLET    AF JØRGEN SAUGMANN         JUN  2015            */
 /*      RULLET BR5->BR6 OG RUL                                       */
 /*      ÅRSRULLET    AF ESBEN BRODERSEN         JUN  2016            */
 /*      RULLET BR6->BR7 OG RUL                                       */
 /*      Lene Maj Jensen QLE                     JUN 2016             */
 /*           Hårdkodet årstal fjernet.  Istedet benyttes cstopår     */
 /*           eller glslutår fra BH65300M                             */
 /*      Esben Brodersen                                              */
 /*           Rettet afvisning 5002 til at bruge CUOP = 6 #01         */
 /*      ÅRSRULLET    AF ESBEN BRODERSEN         JUN  2017            */
 /*      RULLET BR7->BR8 OG RUL  CHECK 5002                           */
 /*                                                                   */
 /*      SLUT17:  KS02-39-01 Tilretning af felt 705  OKT 2017         */
 /*               CEANV lig 521 og 522 lagt ind  QEB                  */
 /*********************************************************************/
                                                                        
 /*********************************************************************/
 /* OBS.: VED ÅRSRULNING/TILRETNING SKAL 'INDHOLDET' AF BRX8680M+N    */
 /*       D.V.S. OPSÆTNING AF SAMMENLIGNINGSGRUNDLAG FOR SLUTÅR       */
 /*       KOPIERES TIL AKTUELLE MEMBERS UNDER BFSK.                   */
 /*********************************************************************/
         DEFAULT RANGE (*) STATIC;                                      
 /*********************************************************************/
 /*      DECLARE AF INPUT                                             */
 /*********************************************************************/
                                                                        
 DCL     BH945_AR        CHAR      (6000) VAR;                          
                                                                        
 DCL     1 BH945         BASED     (ADDR(BH945_AR)),                    
           2 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH90100N;;                                          
                                                                        
 /*********************************************************************/
 /*      DECLARE AF DIVERSE PARAMETRE TIL BEREGNING AF EVS            */
 /*********************************************************************/
                                                                        
 DCL     BR88680_AR      CHAR (3000) VAR;        /*FORSKUD18 RUL*/      
                                                                        
 DCL     1 BR88680       BASED(ADDR(BR88680_AR)), /*FORSKUD18 RUL*/     
           2 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH95010N;;    /* EVS'S UDGAVE AF BR88680N*/         
                                                                        
 DCL     1 EVS_BOY,                                                     
           %INCLUDE BH95006N;                                           
                                                                        
 /*********************************************************************/
 /*      DECLARE AF DIVERSE                                           */
 /*********************************************************************/
                                                                        
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
 DCL     BH95006         ENTRY;                                         
 DCL     ADDR            BUILTIN;                                       
 DCL     SUBSTR          BUILTIN;                                       
 DCL     MULTIPLY        BUILTIN;                                       
 DCL     HJVÆRDI         FIXED     (15,2);                              
 DCL     HJVÆRDI1        FIXED     (15,2);                              
 DCL     HJVÆRDI2        FIXED     (15,2);                              
 DCL     HJ_CSTOP_DATO_CH  CHAR    (8) BASED(ADDR(HJ_CSTOP_DATO_NUM));  
 DCL     HJ_CSTOP_DATO_NUM PIC    '(8)9';                               
 DCL     HJ_ANVÆND_DATO  FIXED     (9);                                 
                                                                        
 DCL     TFLAG           BIT       (1)     INIT('0'B);                  
 DCL     HJBEGRÆNSET_TP  CHAR      (1);                                 
                                                                        
 DCL     1 BH65300M,                                                    
           %INCLUDE BH65300M;                                           
                                                                        
 DCL     1 BH60101M,                                                    
           %INCLUDE BH60101M;                                           
                                                                        
 /*********************************************************************/
 /*      P R O C E S S                                                */
 /*********************************************************************/
                                                                        
     /*  IF BH945.SORT_CPR = 0101180050                                 
         THEN                                                           
            TFLAG = '1'B;                                               
         ELSE                                                           
            TFLAG = '0'B; */                                            
                                                                        
         IF TFLAG                                                       
         THEN                                                           
            PUT SKIP LIST('BH95010 CPRNR = '!!BH945.SORT_CPR);          
         IF BH945.TIL_EVS.CPTYPSLUT > '0'                               
         THEN                                                           
            BH945.TIL_FORSKUD.COPR_CPTYPSLUT = 'F';                     
                                                                        
         IF BH945.TIL_EVS.CPTYPFOR > '0'                                
         THEN                                                           
            BH945.TIL_FORSKUD.COPR_CPTYPFOR = 'F';                      
                                                                        
         IF BH945.ESR.EKOMNR > 0 &                                      
            BH945.EJENDOM.CEJDTYPE > '0'                                
         THEN                                                           
            BH945.TIL_FORSKUD.COPR_CEJDTYPE = 'E';                      
                                                                        
         IF BH945.SORT_KOMNR < 999 &                                    
            BH945.TIL_EVS.CINVPNR = '0'                                 
         THEN                                                           
            DO;                                                         
               /* hvis cstopår ligger før indkomstår    */              
               /* benyttes cstopår                      */              
               IF BH945.EJENDOM.CSTOPÅR > '2002' &                      
                  BH945.EJENDOM.CSTOPÅR < BH65300M.INDKÅR1              
               THEN                                                     
                 DO;                                                    
                   HJ_CSTOP_DATO_CH = BH945.EJENDOM.CSTOPÅR !! '1001';  
                   HJ_ANVÆND_DATO = HJ_CSTOP_DATO_NUM;                  
                 END;                                                   
               ELSE                                                     
                 DO;  /* ellers benyttes gammelt slutår */              
                   HJ_CSTOP_DATO_CH = BH65300M.GLSLUTÅR1 !! '1001';     
                   HJ_ANVÆND_DATO = HJ_CSTOP_DATO_NUM;                  
                 END;                                                   
                                                                        
               SELECT;                                                  
                 WHEN ((BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'N'))   
                    DO;                                                 
                       CALL OPSÆT_015ANV_NY;  /* NYE EJERE */           
                    END;                                                
                 WHEN ((BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'G'))   
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
                 WHEN ((BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ') &          
  /*FORSKUD06*/         BH945.TIL_EVS.DATO0107 > HJ_ANVÆND_DATO)        
                    DO;                                                 
                       CALL OPSÆT_015ANV_NY;  /* NYE EJERE */           
                    END;                                                
                 WHEN ((BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ') &          
   /*FORSKUD06*/        BH945.TIL_EVS.DATO0107  > 0  &                  
   /*FORSKUD06*/        BH945.TIL_EVS.DATO0107 <= HJ_ANVÆND_DATO)       
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
  /*FORSKUD06*/  WHEN (BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &        
  /*HERFRA*/           BH945.VURD_01OM.CBENYT_01OM ^= '  ' &            
                       BH945.TIL_EVS.BFASTSTIGBGR_SW = 0)               
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
                                                                        
                 WHEN ( BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ' &           
                        BH945.AKT_EJER.DOVTG_GL > HJ_ANVÆND_DATO)       
                    DO;                                                 
  /*FORSKUD06*/        CALL OPSÆT_015ANV_NY;  /* NYE EJERE */           
  /*HERTIL*/        END;                                                
                                                                        
                 OTHERWISE                                              
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
               END; /* SELECT */                                        
                                                                        
                                                                        
               SELECT;                                                  
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'N'))   
                    DO;                                                 
                       CALL OPSÆT_02ANV_NY;  /* NYE EJERE */            
                    END;                                                
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'G'))   
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
                                                                        
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
   /*FORSKUD06*/        BH945.TIL_EVS.DATO0107 > HJ_ANVÆND_DATO)        
                    DO;                                                 
                       CALL OPSÆT_02ANV_NY;  /* NYE EJERE */            
                    END;                                                
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
   /*FORSKUD06*/        BH945.TIL_EVS.DATO0107 > 0 &                    
   /*FORSKUD06*/        BH945.TIL_EVS.DATO0107 <= HJ_ANVÆND_DATO)       
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
                                                                        
   /*FORSKUD06*/ WHEN (BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &        
   /*HERFRA*/          BH945.VURD_02OM.CBENYT_02OM ^= '  ' &            
                       BH945.TIL_EVS.BFASTSTIGBGR_SW = 0)               
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
                                                                        
                 WHEN ( BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ' &           
                        BH945.AKT_EJER.DOVTG_GL > HJ_ANVÆND_DATO)       
                    DO;                                                 
  /*FORSKUD06*/        CALL OPSÆT_02ANV_NY;  /* NYE EJERE */            
  /*HERFRA*/        END;                                                
                                                                        
                 OTHERWISE                                              
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
               END; /* SELECT */                                        
                                                                        
            END;                                                        
                                                                        
         IF BH945.SORT_KOMNR < 999 &                                    
            BH945.VURD_AKT.CBENYT_AKT ^= '  '                           
         THEN                                                           
            DO;                                                         
              BH945.EJENDOM.BEJDVÆR =                                   
              BH945.VURD_AKT.BEJDVÆR_AKT;                               
              BH945.EJENDOM.BEJDVÆR_SW =                                
              BH945.VURD_AKT.BEJDVÆR_AKT_SW;                            
              BH945.EJENDOM.BEJBOL1 =                                   
              BH945.VURD_AKT.BEJBOL1_AKT;                               
              BH945.EJENDOM.BEJBOL1_SW =                                
              BH945.VURD_AKT.BEJBOL1_AKT_SW;                            
              BH945.EJENDOM.CEJBOLTYP1 =                                
              BH945.VURD_AKT.CEJBOLTYP1_AKT;                            
              BH945.EJENDOM.BEJBOL2 =                                   
              BH945.VURD_AKT.BEJBOL2_AKT;                               
              BH945.EJENDOM.BEJBOL2_SW =                                
              BH945.VURD_AKT.BEJBOL2_AKT_SW;                            
              BH945.EJENDOM.CEJBOLTYP2 =                                
              BH945.VURD_AKT.CEJBOLTYP2_AKT;                            
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      OPSÆTNING AF BEREGNINGSGRUNDLAG FOR AKTUEL EJER              */
 /*********************************************************************/
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_AKT.BBERGRL_AKT_SW = 0 &                    
                 BH945.VURD_02ANV.BBERGRL_02ANV_SW = 0 &                
                 BH945.VURD_015ANV.BBERGRL_015ANV_SW = 0)               
             DO;                                                        
               BH945.TIL_FORSKUD.COPR_BBERGRL = 'E';                    
               BH945.TIL_FORSKUD.COPR_BBER2FAM = 'E';                   
               IF BH945.VURD_AKT.BBERGRL_AKT <=                         
                  BH945.VURD_02ANV.BBERGRL_02ANV                        
                & BH945.VURD_AKT.BBERGRL_AKT <=                         
                  BH945.VURD_015ANV.BBERGRL_015ANV                      
               THEN                                                     
                  DO;                                                   
                    /* AKTUEL ÅRSVURD ER MINDRE END  */                 
                    /* ELLER LIG MED ANVENDT 2002 OG */                 
                    /* MINDRE END ELLER LIG MED      */                 
                    /* ANVENDT 2001+5%               */                 
                    BH945.EJERSKAB.BBERGRL =                            
                    BH945.VURD_AKT.BBERGRL_AKT;                         
                    BH945.EJERSKAB.BBERGRL_SW = 0;                      
                    BH945.EJERSKAB.BBER2FAM =                           
                    BH945.VURD_AKT.BBER2FAM_AKT;                        
                    BH945.EJERSKAB.BBER2FAM_SW =                        
                    BH945.VURD_AKT.BBER2FAM_AKT_SW;                     
                    BH945.EJERSKAB.BEJBOLANV =                          
                    BH945.VURD_AKT.BEJBOLANV_AKT;                       
                    BH945.EJERSKAB.BEJBOLANV_SW =                       
                    BH945.VURD_AKT.BEJBOLANV_AKT_SW;                    
                    BH945.EJERSKAB.CANVEBOL =                           
                    BH945.VURD_AKT.CANVEBOL_AKT;                        
                    BH945.EJERSKAB.CBERGROP = 'I';                      
                    IF BH945.VURD_01OMNY.BBERGRL_01OMNY_SW = 0 !        
                       BH945.VURD_01OM.BBERGRL_01OM_SW = 0              
                    THEN                                                
                       BH945.EJERSKAB.CBERGRGLOP =                      
                                     BH945.VURD_015ANV.NY_GL;           
                  END;                                                  
               ELSE                                                     
               IF BH945.VURD_02ANV.BBERGRL_02ANV <=                     
                  BH945.VURD_AKT.BBERGRL_AKT                            
                & BH945.VURD_02ANV.BBERGRL_02ANV <=                     
                  BH945.VURD_015ANV.BBERGRL_015ANV                      
               THEN                                                     
                  DO;                                                   
                    /* 2002 ÅRSVURD ER MINDRE END    */                 
                    /* ELLER LIG MED AKTUEL ÅRSVURD  */                 
                    /* OG MINDRE END ELLER LIG MED   */                 
                    /* ANVENDT 2001+5%               */                 
                    BH945.EJERSKAB.BBERGRL =                            
                    BH945.VURD_02ANV.BBERGRL_02ANV;                     
                    BH945.EJERSKAB.BBERGRL_SW = 0;                      
                    BH945.EJERSKAB.BBER2FAM =                           
                    BH945.VURD_02ANV.BBER2FAM_02ANV;                    
                    BH945.EJERSKAB.BBER2FAM_SW =                        
                    BH945.VURD_02ANV.BBER2FAM_02ANV_SW;                 
                    BH945.EJERSKAB.BEJBOLANV =                          
                    BH945.VURD_02ANV.BEJBOLANV_02ANV;                   
                    BH945.EJERSKAB.BEJBOLANV_SW =                       
                    BH945.VURD_02ANV.BEJBOLANV_02ANV_SW;                
                    BH945.EJERSKAB.CANVEBOL =                           
                    BH945.VURD_02ANV.CANVEBOL_02ANV;                    
                    BH945.EJERSKAB.CBERGROP = 'N';                      
                    IF BH945.VURD_01OMNY.BBERGRL_01OMNY_SW = 0 !        
                       BH945.VURD_01OM.BBERGRL_01OM_SW = 0              
                    THEN                                                
                       BH945.EJERSKAB.CBERGRGLOP =                      
                                   BH945.VURD_015ANV.NY_GL;             
                  END;                                                  
               ELSE                                                     
                  DO;                                                   
                    /* ANVENDT 2001+5% ER MINDRE END */                 
                    /* ELLER LIG MED ANVENDT 2002    */                 
                    /* OG MINDRE END ELLER LIG MED   */                 
                    /* AKTUEL ÅRSVURD                */                 
                    BH945.EJERSKAB.BBERGRL =                            
                    BH945.VURD_015ANV.BBERGRL_015ANV;                   
                    BH945.EJERSKAB.BBERGRL_SW = 0;                      
                    BH945.EJERSKAB.BBER2FAM =                           
                    BH945.VURD_015ANV.BBER2FAM_015ANV;                  
                    BH945.EJERSKAB.BBER2FAM_SW =                        
                    BH945.VURD_015ANV.BBER2FAM_015ANV_SW;               
                    BH945.EJERSKAB.BEJBOLANV =                          
                    BH945.VURD_015ANV.BEJBOLANV_015ANV;                 
                    BH945.EJERSKAB.BEJBOLANV_SW =                       
                    BH945.VURD_015ANV.BEJBOLANV_015ANV_SW;              
                    BH945.EJERSKAB.CANVEBOL =                           
                    BH945.VURD_015ANV.CANVEBOL_015ANV;                  
                    BH945.EJERSKAB.CBERGROP = 'G';                      
                    IF BH945.VURD_01OMNY.BBERGRL_01OMNY_SW = 0 !        
                       BH945.VURD_01OM.BBERGRL_01OM_SW = 0              
                    THEN                                                
                       BH945.EJERSKAB.CBERGRGLOP =                      
                                       BH945.VURD_015ANV.NY_GL;         
                  END;                                                  
             END;                                                       
                                                                        
           OTHERWISE                                                    
             DO;                                                        
             END;                                                       
                                                                        
         END;  /* SELECT */                                             
                                                                        
         IF BH945.EJERSKAB.BBERGRL_SW = 0                               
         THEN                                                           
           DO;                                                          
            BH945.EJERSKAB.BBERGRLGL    = BH945.EJERSKAB.BBERGRL;       
            BH945.EJERSKAB.BBERGRLGL_SW = BH945.EJERSKAB.BBERGRL_SW;    
                                                                        
            BH945.EJERSKAB.BBER2FAMGL    = BH945.EJERSKAB.BBER2FAM;     
            BH945.EJERSKAB.BBER2FAMGL_SW = BH945.EJERSKAB.BBER2FAM_SW;  
           END;                                                         
                                                                        
         CALL OPSÆT_FEJLNR; /*SAMT CEJBEVS OG CBERGRL*/                 
                                                                        
         IF BH945.TIL_EVS.CEJBEVS = '7' !                               
            BH945.TIL_EVS.CEJBEVS = '8' !                               
            BH945.TIL_EVS.CEJBEVS = '9'                                 
         THEN;                                                          
         ELSE                                                           
            DO;                                                         
              IF BH945.FEJLNR = 0              /* DENNE EJENDOM KAN */  
              THEN                             /* ÅBENBART BEREGNES */  
                 BH945.TIL_EVS.CEJBEVS = '0';                           
              ELSE                                                      
                IF BH945.SORT_KOMNR < 999 &                             
                   BH945.CINVPNR = '0' &                                
                /* BH945.AKT_EJER.DCPRCIR > 0 &  ** FORSKUD 2004 */     
                   BH945.EVS_SLUT_EJER.DCPRN > 0 &                      
                   BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &             
                   BH945.EVS_SLUT_EJER.SIDSTE.DAFSTAA = 0 &             
                  (BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !           
                   BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !           
                   BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !           
                   BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6') &          
                   BH945.TIL_EVS.CÆGTOPR < '1'                          
                THEN                           /* KAN MÅSKE BEREGNES */ 
                   DO;                                                  
                     IF BH945.FEJLNR = 5001 !                           
                        BH945.FEJLNR = 5002 !                           
                        BH945.FEJLNR = 5003 !                           
                        BH945.FEJLNR = 5004 !                           
                        BH945.FEJLNR = 5020 !                           
                        BH945.FEJLNR = 5024 !                           
                        BH945.FEJLNR = 5025 !                           
                        BH945.EJERSKAB.BBERGRL_SW = -1 !                
                      ((BH945.EJENDOM.CEJDTYPE = '4' !                  
                        BH945.EJENDOM.CEJDTYPE = '5') &                 
                        BH945.EJERSKAB.BBER2FAM_SW = -1)                
                     THEN;                                              
                     ELSE                                               
                        DO;                                             
                          BH945.TIL_EVS.CDATAFRA = '1';                 
                          BH945.TIL_EVS.CEJBEVS = '0';                  
                          BH945.FEJLNR = 0;                             
                        END;                                            
                   END;                                                 
            END;                                                        
                                                                        
         IF BH945.TIL_EVS.CEJBEVS ^= ' '                                
         THEN                                                           
            BH945.TIL_FORSKUD.COPR_CEJBEVS = 'E';                       
                                                                        
         IF BH945.EJERSKAB.BBERGRL_SW = 0                               
         THEN                                                           
            BH945.TIL_FORSKUD.COPR_BBERGRL = 'E';                       
                                                                        
         IF BH945.EJERSKAB.BBER2FAM_SW = 0                              
         THEN                                                           
            BH945.TIL_FORSKUD.COPR_BBER2FAM = 'E';                      
                                                                        
         BH945.TIL_EVS.CNEDSL2 = ' ';                                   
                                                                        
         IF BH945.TIL_EVS.CNEDSL1 >= '10' &                             
            BH945.TIL_EVS.CNEDSL1 <  '30'                               
         THEN                                                           
            DO;                                                         
               /* DAN KODE FOR 4 PROMILLE NEDSLAG (TIDL. STDFRADRAG.) */
               SELECT;                                                  
                 WHEN (BH945.TIL_EVS.CFRED = '1')                       
                    BH945.TIL_EVS.CNEDSL2 = '3';                        
                 WHEN (BH945.EJENDOM.CEJDTYPE = '4')                    
                    BH945.TIL_EVS.CNEDSL2 = '5';                        
                 WHEN (BH945.EJENDOM.CEJDTYPE = '5')                    
                    BH945.TIL_EVS.CNEDSL2 = '4';                        
                 WHEN (BH945.EJENDOM.CEJDTYPE = '7' !                   
                       BH945.EJENDOM.CEJDTYPE = '8')                    
                    BH945.TIL_EVS.CNEDSL2 = '2';                        
                 OTHERWISE                                              
                    BH945.TIL_EVS.CNEDSL2 = '1';                        
               END;                                                     
            END;                                                        
                                                                        
         /* EFTERFØLGENDE ÆNDRES CPTYPSLUT FRA '3' TIL '2'   */         
         /* FOR BEGRÆNSET SKATTEPLIGTIGE PENSIONISTER A.H.T. */         
         /* BEREGNINGEN AF EVS                               */         
         /* DENNE BEHANDLING FOREGÅR I BH94300L QEB          */         
         /*                                                             
                                                                        
         IF BH945.TIL_EVS.CPTYPSLUT = '3' &                             
           (BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1' !                   
            BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3' !                   
            BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8')                    
         THEN                                                           
            DO;                                                         
               BH945.TIL_EVS.CPTYPSLUT_ÆND = '4';                       
               BH945.TIL_EVS.CPTYPSLUT = '4';                           
            END;    */                                                  
                                                                        
         CALL OPSÆT_PENSNED_FOR;                                        
                                                                        
         IF BH945.TIL_EVS.CPTYPSLUT = '3' &                             
            BH945.TIL_EVS_FOR.CPENSNED1 = ' ' &                         
            BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                    
          ((BH945.EVS_SLUT_EJER.SIDSTE.FELT759 = '1' &                  
            BH945.EJENDOM.CEJDTYPE ^= '3' &                             
            BH945.EJENDOM.CEJDTYPE ^= '8') !                            
           (BH945.EVS_SLUT_EJER.SIDSTE.FELT759 = '2' &                  
           (BH945.EJENDOM.CEJDTYPE = '3' !                              
            BH945.EJENDOM.CEJDTYPE = '8')))                             
         THEN                                                           
            BH945.TIL_EVS_FOR.CPENSNED1 =                               
                          BH945.EVS_SLUT_EJER.SIDSTE.FELT759;           
                                                                        
     /* EFTERFØLGENDE ÆNDRES CPTYPFOR FRA '3' TIL '4'    */             
     /* FOR BEGRÆNSET SKATTEPLIGTIGE PENSIONISTER A.H.T. */             
     /* BEREGNINGEN AF EVS                               */             
                                                                        
                                                                        
     /* DETTE FOREGÅR ALLEREDE I BH94300L QEB HVORFOR HER ??  */        
     /*  IF BH945.TIL_EVS.CPTYPFOR = '3' &                              
           (BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1' !                   
            BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3' !                   
            BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8')                    
         THEN                                                           
            DO;                                                         
               BH945.TIL_EVS.CPTYPFOR_ÆND = '4';                        
               BH945.TIL_EVS.CPTYPFOR = '4';                            
               BH945.TIL_EVS_FOR.CPENSNED1 = ' ';                       
            END;                                                        
                                                                        
         IF TFLAG                                                       
         THEN DO;                                                       
            PUT SKIP LIST('CPTYPFOR  = '!!BH945.TIL_EVS.CPTYPFOR);      
            PUT SKIP LIST('CPENSNED1 = '!!BH945.TIL_EVS_FOR.CPENSNED1); 
         END;                                                           
                                                                        
         IF BH945.TIL_EVS.CPTYPFOR = '4'                                
         THEN                                                           
            BH945.TIL_EVS_FOR.CPENSNED1 = ' '; */                       
                                                                        
         BH945.TIL_EVS_BOY.CPENSNED1 = BH945.TIL_EVS_FOR.CPENSNED1;     
                                                                        
         BH945.TIL_EVS_BOY.BPENSIND = BH945.MT.BPENSIND;                
         BH945.TIL_EVS_BOY.BPENSGR  = BH945.MT.BPENSGR;                 
                                                                        
         IF (BH945.TIL_EVS.CEJBEVS = '0' !                              
             BH945.TIL_EVS.CEJBEVS = '7' !                              
             BH945.TIL_EVS.CEJBEVS = '8' !                              
            (BH945.TIL_EVS.CEJBEVS = '2' &                              
            (BH945.FEJLNR = 5017 ! BH945.FEJLNR = 5018))) &             
             BH945.CINVPNR = '0' &                                      
             BH945.ESR.EKOMNR > 0                                       
         THEN                                                           
            DO;                                                         
               BR88680 = '';                           /*FORSKUD18 RUL*/
                                                                        
               BR88680.CBRUGER = 'H';                                   
               BR88680.TIL = BH945.TIL_EVS, BY NAME;                    
               BR88680.TIL = BH945.EJERSKAB, BY NAME;                   
               BR88680.TIL = BH945.TIL_FORSKUD, BY NAME;                
               BR88680.TIL.BEVSGL_SW = -1;                              
               BR88680.TIL.BPENSNEDGL_SW = -1;                          
               BR88680.TIL.BNYMAN_SW = -1;                              
               BR88680.TIL.COPR_BNYMAN = ' ';                           
               BR88680.TIL.CGLANV = '000000';                           
                                                                        
               IF BH945.EJERSKAB.CEJDTYPE > '0'                         
               THEN                                                     
                  BR88680.TIL.CEJDTYPE = BH945.EJERSKAB.CEJDTYPE;       
               ELSE                                                     
                  BR88680.TIL.CEJDTYPE = BH945.EJENDOM.CEJDTYPE;        
                                                                        
               CALL OPSÆT_TIL_STIGNINGSBEGRÆNSNING(BR88680_AR);         
                                                                        
               BH945.FRA_EVS_SLUT = BR88680.FRA, BY NAME;               
               BH945.TIL_FORSKUD  = BR88680.FRA, BY NAME;               
                                                /*FORSKUD18 RUL HERTIL*/
            END;                                                        
                                                                        
         IF BH945.FRA_EVS_SLUT.RETURNKOD = 0 &                          
            BH945.TIL_EVS.CEJBEVS = '0' &                               
            BH945.CINVPNR = '0' &                                       
            BH945.AKT_EJER.DCPRCIR > 0                                  
         THEN                                                           
            DO;                                                         
               EVS_BOY = '';                                            
               EVS_BOY.TIL = BH945.TIL_EVS, BY NAME;                    
               EVS_BOY.TIL = BH945.EJERSKAB, BY NAME;                   
               EVS_BOY.TIL = BH945.EJENDOM, BY NAME;                    
               EVS_BOY.TIL.BGLSLUTSTI = BH945.FRA_EVS_SLUT.BGLSLUTSTI;  
               EVS_BOY.TIL = BH945.TIL_EVS_BOY, BY NAME;                
               EVS_BOY.TIL.DOVTG = BH945.TIL_EVS.DOVTG;                 
               EVS_BOY.TIL.DAFSTÅ = BH945.TIL_EVS.DAFSTAA;              
                                                                        
               IF BH945.EJERSKAB.CEJDTYPE > '0'                         
               THEN                                                     
                  EVS_BOY.TIL.CEJDTYPE = BH945.EJERSKAB.CEJDTYPE;       
               ELSE                                                     
                  EVS_BOY.TIL.CEJDTYPE = BH945.EJENDOM.CEJDTYPE;        
                                                                        
               CALL BH95006(EVS_BOY);                                   
                                                                        
               BH945.FRA_EVS_BOY = EVS_BOY.FRA, BY NAME;                
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2002 FOR 'NYE EJERE'                 */
 /*********************************************************************/
 OPSÆT_02ANV_NY:                                                        
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02OMNY);                      
                BH945.VURD_02ANV.NY_GL = 'N'; /* OMBEREGN NY EJER */    
             END;                                                       
                                                                        
           WHEN (BH945.VURD_02.CBENYT_02 ^= '  ')                       
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02);                          
                BH945.VURD_02ANV.NY_GL = ' '; /* ÅRSVURDERING */        
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_02ANV_NY;                                                    
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2002 FOR 'ØVRIGE EJERE'              */
 /*********************************************************************/
 OPSÆT_02ANV_ØVR:                                                       
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_02OM.CBENYT_02OM ^= '  ')                   
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02OM);                        
                IF BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &            
                   BH945.VURD_02OM.CBENYT_02OM ^= '  '                  
                THEN                                                    
                   BH945.VURD_02ANV.NY_GL = 'G';/*OMBEREGN ØVR EJERE*/  
                ELSE                                                    
                   BH945.VURD_02ANV.NY_GL = ' ';                        
             END;                                                       
                                                                        
           WHEN (BH945.VURD_02.CBENYT_02 ^= '  ')                       
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02);                          
                BH945.VURD_02ANV.NY_GL = ' '; /* ÅRSVURDERING */        
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_02ANV_ØVR;                                                   
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2001+5% FOR 'NYE EJERE'              */
 /*********************************************************************/
 OPSÆT_015ANV_NY:                                                       
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_01OMNY);                      
                BH945.VURD_015ANV.NY_GL = 'N'; /* OMBEREGN NY EJER */   
             END;                                                       
                                                                        
           WHEN (BH945.VURD_015PCT.CBENYT_015PCT ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_015PCT);                      
                BH945.VURD_015ANV.NY_GL = ' '; /* ÅRSVURDERING */       
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 /* Hvis 02 er mindre, så tag den istedet                            */ 
 /* Stjernet ud efter ønske fra JAM 01.12.2015                          
         IF (BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &                  
             BH945.VURD_02OMNY.BBERGRL_02OMNY <                         
                 BH945.VURD_015ANV.BBERGRL_015ANV) THEN                 
         DO;                                                            
            CALL FLYT_VURD(BH945.VURD_015ANV,                           
                           BH945.VURD_02OMNY);                          
         END; */                                                        
                                                                        
 END OPSÆT_015ANV_NY;                                                   
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2001+5% FOR 'ØVRIGE EJERE'           */
 /*********************************************************************/
 OPSÆT_015ANV_ØVR:                                                      
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_01OM.CBENYT_01OM ^= '  ')                   
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_01OM);                        
                IF BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &            
                   BH945.VURD_01OM.CBENYT_01OM ^= '  '                  
                THEN                                                    
                   BH945.VURD_015ANV.NY_GL = 'G';/*OMBEREGN ØVR EJERE*/ 
                ELSE                                                    
                   BH945.VURD_015ANV.NY_GL = ' ';                       
             END;                                                       
                                                                        
           WHEN (BH945.VURD_015PCT.CBENYT_015PCT ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_015PCT);                      
                BH945.VURD_015ANV.NY_GL = ' '; /* ÅRSVURDERING */       
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 /* Hvis 02 er mindre, så tag den istedet                            */ 
 /* Stjernet ud efter ønske fra JAM 01.12.2015                          
         IF (BH945.VURD_02OM.CBENYT_02OM ^= '  ' &                      
             BH945.VURD_02OM.BBERGRL_02OM <                             
                 BH945.VURD_015ANV.BBERGRL_015ANV) THEN                 
         DO;                                                            
            CALL FLYT_VURD(BH945.VURD_015ANV,                           
                           BH945.VURD_02OM);                            
         END; */                                                        
                                                                        
 END OPSÆT_015ANV_ØVR;                                                  
                                                                        
 /*********************************************************************/
 /* FLYT VALGTE VURDERING TIL ANVENDT VURDERING                       */
 /*********************************************************************/
 FLYT_VURD:                                                             
 PROC(TIL,FRA);                                                         
                                                                        
 DCL     1 FRA,                                                         
  3 CBENYT           CHAR  (2),    /* BENYTTELSESKODE                 */
  3 FLEJL            FIXED (5),    /* ANTAL LEJLIGHEDER               */
  3 BEJDVÆR          FIXED (11),   /* EJENDOMSVÆRDI                   */
  3 BEJDVÆR_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJERL           CHAR  (1),    /* KODE UDLEJET EJERLEJLIGHED      */
  3 BEJBOL1          FIXED (11),   /* EJERBOLIG 1-VÆRDI               */
  3 BEJBOL1_SW      BIN FIXED (15) UNAL,      /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP1       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOL2          FIXED (11),   /* EJERBOLIG 2-VÆRDI               */
  3 BEJBOL2_SW      BIN FIXED (15) UNAL,      /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP2       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOLANV        FIXED (11),   /* EJERBOLIG ?-VÆRDI ANVENDT       */
  3 BEJBOLANV_SW      BIN FIXED (15) UNAL,    /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CANVEBOL         CHAR  (1),    /* ANVENDT EJERBOLIG               */
  3 BOPÆLSKODE       CHAR  (1),    /* BOPÆLSKODE                      */
  3 CEJDTYPE         CHAR  (1),    /* KODE FOR EJENDOMSTYPE           */
  3 CBERGRL          CHAR  (1),    /* KODE FOR BEREGNINGSGRUNDLAG     */
  3 BBERGRL          FIXED (11),   /* BEREGN.GRUNDLAG                 */
  3 BBERGRL_SW      BIN FIXED(15)UNAL,        /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 BBER2FAM         FIXED (11),   /* EJD.VÆRDI 2 FAM.                */
  3 BBER2FAM_SW     BIN FIXED(15)UNAL;        /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                                                        
 DCL     1 TIL,                                                         
  3 NY_GL            CHAR  (1),    /* ER EVT. OMBEREGN FOR NY ELL. ØVR*/
  3 CBENYT           CHAR  (2),    /* BENYTTELSESKODE                 */
  3 FLEJL            FIXED (5),    /* ANTAL LEJLIGHEDER               */
  3 BEJDVÆR          FIXED (11),   /* EJENDOMSVÆRDI                   */
  3 BEJDVÆR_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJERL           CHAR  (1),    /* KODE UDLEJET EJERLEJLIGHED      */
  3 BEJBOL1          FIXED (11),   /* EJERBOLIG 1-VÆRDI               */
  3 BEJBOL1_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP1       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOL2          FIXED (11),   /* EJERBOLIG 2-VÆRDI               */
  3 BEJBOL2_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP2       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOLANV        FIXED (11),   /* EJERBOLIG ?-VÆRDI ANVENDT       */
  3 BEJBOLANV_SW BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CANVEBOL         CHAR  (1),    /* ANVENDT EJERBOLIG               */
  3 BOPÆLSKODE       CHAR  (1),    /* BOPÆLSKODE                      */
  3 CEJDTYPE         CHAR  (1),    /* KODE FOR EJENDOMSTYPE           */
  3 CBERGRL          CHAR  (1),    /* KODE FOR BEREGNINGSGRUNDLAG     */
  3 BBERGRL          FIXED (11),   /* BEREGN.GRUNDLAG                 */
  3 BBERGRL_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 BBER2FAM         FIXED (11),   /* EJD.VÆRDI 2 FAM.                */
  3 BBER2FAM_SW  BIN FIXED (15) UNAL;         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
                                                                        
         TIL = FRA, BY NAME;                                            
         TIL.NY_GL = ' ';                                               
                                                                        
 END FLYT_VURD;                                                         
                                                                        
 /*********************************************************************/
 /*      REGULERING AF BEREGNINGSGRUNDLAG FOR ???? MED ÅRETS PCT.     */
 /*      HUSK AT HJ_PCT SKAL INDEHOLDE AKTUEL VÆRDI, SAMT AT          */
 /*      HJ_VÆRDI SKAL INDEHOLDE AKTUELT BEREGNINGSGRUNDLAG.          */
 /*********************************************************************/
 REGULER_GRUNDLAG:                                                      
 PROC(HJ_VÆRDI,HJ_PCT);                                                 
                                                                        
 DCL     HJ_VÆRDI         FIXED     (15,2);                             
 DCL     HJ_PCT           FIXED     (5,4);                              
                                                                        
      HJ_VÆRDI = MULTIPLY(HJ_VÆRDI,HJ_PCT,13,0);                        
                                                                        
 END REGULER_GRUNDLAG;                                                  
 /*********************************************************************/
 /*      OPSÆT KODE FOR 4 PROMILLE NEDSLAG - 67 ÅRIGE M.V.            */
 /* OBS: GÆLDENDE FOR FORSKUDSÅRET FOREKLET VERSION TAGET FRA SLUT    */
 /* QEB 2018-08-10:                                                   */
 /* ÆNDRET CEJDTYPE_AKT TIL CEJDTYPE DA DET ER DEN SOM ÆNDRES VED     */
 /* HELÅRS BEBOELSE                                                   */
 /*********************************************************************/
 OPSÆT_PENSNED_FOR: PROC;                                               
                                                                        
                                                                        
         IF (BH945.TIL_EVS.CPTYPFOR = '3' !   /* #02 */                 
             BH945.TIL_EVS.CPTYPFOR = '4') &                            
            BH945.EJERSKAB.CEJDTYPE >= '1'                              
         THEN                                                           
            DO;                                                         
               IF BH945.EJERSKAB.CEJDTYPE = '3' !                       
                  BH945.EJERSKAB.CEJDTYPE = '8'                         
               THEN                                                     
                  BH945.TIL_EVS_FOR.CPENSNED1 = '2';                    
               ELSE                                                     
                  BH945.TIL_EVS_FOR.CPENSNED1 = '1';                    
            END;                                                        
         ELSE                                                           
           BH945.TIL_EVS_FOR.CPENSNED1 = ' '; /*OK ?*/                  
                                                                        
                                                                        
         IF TFLAG                                                       
         THEN                                                           
            PUT SKIP LIST('BH95010 CPENSNED1 = '!!                      
                          BH945.TIL_EVS_FOR.CPENSNED1);                 
                                                                        
 END OPSÆT_PENSNED_FOR;                                                 
 /*********************************************************************/
 /*      OPSÆT KODE FOR 4 PROMILLE NEDSLAG - 67 ÅRIGE M.V.            */
 /* OBS: GÆLDENDE FOR FORSKUDSÅRET  GL. VERSION                       */
 /*********************************************************************/
 /*OPSÆT_PENSNED_FOR:                                                   
 PROC;                                                                  
                                                                        
 DCL     HJ_NEDS         CHAR      (2);                                 
 DCL     1 HJ_NEDS_DEF   BASED(ADDR(HJ_NEDS)),                          
           2 POS1        PIC       '9',                                 
           2 POS2        PIC       '9';                                 
                                                                        
         IF TFLAG                                                       
         THEN                                                           
            PUT SKIP LIST('BH95010 CPTYPFOR = '!!                       
                          BH945.TIL_EVS.CPTYPFOR);                      
         HJ_NEDS = '  ';                                                
                                                                        
         IF BH945.AKT_VURD.CBENYT = '08' !                              
            BH945.AKT_VURD.CBENYT = '28' !                              
            BH945.AKT_VURD.CBENYT = '48'                                
         THEN                                                           
            DO;                                                         
               IF BH945.TIL_EVS.CHELÅR > '3'                            
               THEN                                                     
                  HJ_NEDS_DEF.POS1 = 1; /* HELÅRSSOMMERHUS I FORSKUD */ 
 /*              ELSE                                                   
                  HJ_NEDS_DEF.POS1 = 2; /* EJ HELÅRSSOMMERHUS */        
 /*          END;                                                       
         ELSE                                                           
            HJ_NEDS_DEF.POS1 = 1; /* ØVRIGE HELÅRSBOLIGER */            
                                                                        
 /*        SELECT (HJ_NEDS_DEF.POS1);                                   
                                                                        
           WHEN ( 2 )  /* FRITIDSHUSE */                                
 /*             DO;                                                     
                 IF BH945.TIL_EVS.CPTYPFOR = '3'                        
                  ! BH945.TIL_EVS.CPTYPFOR = '4'                        
                 THEN                                                   
                    DO;                                                 
                       IF BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1' !     
                          BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3' !     
                          BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8'       
                       THEN                                             
                          HJ_NEDS_DEF.POS2 = 0;                         
                       ELSE                                             
                          DO;                                           
                             IF BH945.HJ_67 = '1'                       
                             THEN                                       
                                HJ_NEDS_DEF.POS2 = 1;                   
                             ELSE                                       
                                IF BH945.TIL_EVS.CENKE = '3'            
                                THEN                                    
                                   HJ_NEDS_DEF.POS2 = 3;                
                                ELSE                                    
                                   HJ_NEDS_DEF.POS2 = 1;                
                          END;                                          
                    END;                                                
                 ELSE                                                   
                    HJ_NEDS_DEF.POS2 = 0; /* EJ STATUS SOM 67-ÅRIG */   
  /*           END;                                                     
                                                                        
           OTHERWISE                                                    
              DO;                                                       
                 /* HELÅRSBOLIGER */                                    
              /* IF BH945.TIL_EVS.CPTYPFOR ^= '3' !                     
                   (BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1' !           
                    BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3' !           
                    BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8') */         
  /*             IF BH945.TIL_EVS.CPTYPFOR < '3'                        
                 THEN                                                   
                    HJ_NEDS_DEF.POS2 = 0;                               
                 ELSE                                                   
                    DO;                                                 
                       IF BH945.TIL_EVS.CHELÅR < '4'                    
                       THEN                                             
                          DO;                                           
                             /* IKKE HELÅRSSOMMERHUS VED FORSKUD */     
  /*                           IF BH945.HJ_67 = '1'                     
                             THEN                                       
                                HJ_NEDS_DEF.POS2 = 1;                   
                             ELSE                                       
                                IF BH945.TIL_EVS.CENKE = '3'            
                                THEN                                    
                                   HJ_NEDS_DEF.POS2 = 3;                
                                ELSE                                    
                                   HJ_NEDS_DEF.POS2 = 1;                
                          END;                                          
                       ELSE                                             
                          DO;                                           
                             IF BH945.HJ_67 = '1'                       
                             THEN                                       
                                HJ_NEDS_DEF.POS2 = 4;                   
                             ELSE                                       
                                IF BH945.TIL_EVS.CENKE = '3'            
                                THEN                                    
                                   HJ_NEDS_DEF.POS2 = 6;                
                                ELSE                                    
                                   HJ_NEDS_DEF.POS2 = 4;                
                          END;                                          
                    END;                                                
              END;                                                      
                                                                        
         END;                                                           
                                                                        
         SELECT (HJ_NEDS);                                              
           WHEN ('  ','10','20')                                        
              BH945.TIL_EVS_FOR.CPENSNED1 = ' ';                        
           OTHERWISE                                                    
              BH945.TIL_EVS_FOR.CPENSNED1 = HJ_NEDS;                    
         END;                                                           
                                                                        
         IF TFLAG                                                       
         THEN                                                           
            PUT SKIP LIST('BH95010 CPENSNED1 = '!!                      
                          BH945.TIL_EVS_FOR.CPENSNED1);                 
                                                                        
 END OPSÆT_PENSNED_FOR; */                                              
                                                                        
 /*********************************************************************/
 /*      BH95071M:                                                    */
 /*      OPSÆT CEJBEVS (BEREGNINGSKODE), FEJLNR M.V. TIL EVS FORSKUD  */
 /*      HUSK EFTER KALD AF MACROEN AT SÆTTE CEJBEVS = '0'            */
 /*      HVIS FEJLNR = 0.                                             */
 /*      NB.: VED ÅRSRULNING TILRETTES INDHOLDET AF BH95071M VED      */
 /*           SAMMENLIGNING AF GL. BH95071M OG BH96071M (BH96071M     */
 /*           BRUGES I EVS SLUT TIL OPSÆT AF FEJLNR. M.V.) SÅLEDES    */
 /*           AT NYE/ÆNDREDE KONTROLLER FRA SENESTE SLUTÅR SOM OGSÅ   */
 /*           ER RELEVANTE FOR DET NYE FORSKUDSÅR (OG SLUTÅR)         */
 /*           TILFØJES/RETTES.                                        */
 /*********************************************************************/
 OPSÆT_FEJLNR:                                                          
 PROC;                                                                  
                                                                        
         /* FEJLNR. 5007,5008 OG/ELLER 5009 SKAL ALTID OPSÆTTES */      
         /* TO GANGE IDET DE BEVIRKER NULSTILLING AF DIVERSE    */      
         /* BEREGNINGSGRUNDLAG SÅ DISSE IKKE BENYTTES VED EVT.  */      
         /* SENERE OPRETTEDE EJERE.                             */      
         IF BH945.EJER.DCPRCIR             = 0108320346                 
          ! BH945.TIL_EVS.AKT_EJER.DCPRCIR = 0108320346                 
         THEN DO;                                                       
            PUT SKIP LIST('MODUL: BH95010');                            
            PUT SKIP LIST('CPRNR            = '!!'0108320346');         
            PUT SKIP LIST('FEJLNR FØR       = '!!BH945.FEJLNR);         
            PUT SKIP LIST('AKT_VURD.CBENYT  = '!!BH945.AKT_VURD.CBENYT);
            PUT SKIP LIST('AKT_VURD.DVURDÅR = '!!                       
                           BH945.AKT_VURD.DVURDÅR);                     
         END;                                                           
         SELECT;                                                        
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '06' !                        
                  BH945.AKT_VURD.CBENYT = '07' !                        
                  BH945.AKT_VURD.CBENYT = '13' !                        
                  BH945.AKT_VURD.CBENYT = '34' !                        
                  BH945.AKT_VURD.CBENYT = '03' !                        
                  BH945.AKT_VURD.CBENYT = '04' !                        
                  BH945.AKT_VURD.CBENYT = '23' !                        
                  BH945.AKT_VURD.CBENYT = '24' !                        
                  BH945.AKT_VURD.CBENYT = '31' !                        
                  BH945.AKT_VURD.CBENYT = '33' !                        
                  BH945.AKT_VURD.CBENYT = '43' !                        
                  BH945.AKT_VURD.CBENYT = '44' !                        
                  BH945.AKT_VURD.CBENYT = '49' )                        
             DO;                                                        
                IF (BH945.AKT_VURD.ANT_FOR_4 +                          
                    BH945.AKT_VURD.ANT_FOR_5 +                          
                    BH945.AKT_VURD.ANT_FOR_6 +                          
                    BH945.AKT_VURD.ANT_FOR_8 +                          
                    BH945.AKT_VURD.ANT_FOR_9) = 0                       
                THEN                                                    
                   BH945.FEJLNR = 5008;                                 
             END;                                                       
                                                                        
           WHEN (((BH945.AKT_VURD.ANT_FOR_4 +                           
                   BH945.AKT_VURD.ANT_FOR_5 +                           
                   BH945.AKT_VURD.ANT_FOR_6 +                           
                   BH945.AKT_VURD.ANT_FOR_8 +                           
                   BH945.AKT_VURD.ANT_FOR_9) > 1) &                     
                   BH945.EJERSKAB.BBERGRL_SW = -1)                      
             DO;                                                        
                BH945.FEJLNR = 5007;                                    
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '02' !                        
                  BH945.AKT_VURD.CBENYT = '05' !                        
                  BH945.AKT_VURD.CBENYT = '22' !                        
                  BH945.AKT_VURD.CBENYT = '42' )                        
             DO;                                                        
                IF (BH945.AKT_VURD.ANT_FOR_4 +                          
                    BH945.AKT_VURD.ANT_FOR_5 +                          
                    BH945.AKT_VURD.ANT_FOR_6 +                          
                    BH945.AKT_VURD.ANT_FOR_8 +                          
                    BH945.AKT_VURD.ANT_FOR_9) = 0                       
                THEN                                                    
                   BH945.FEJLNR = 5008;                                 
             END;                                                       
                                                                        
           WHEN (((BH945.AKT_VURD.CBENYT = '02' &                       
                   BH945.AKT_VURD.FLEJL = 2) !                          
                  (BH945.AKT_VURD.CBENYT = '22' &                       
                   BH945.AKT_VURD.FLEJL = 2) !                          
                  (BH945.AKT_VURD.CBENYT = '42' &                       
                   BH945.AKT_VURD.FLEJL = 2)) &                         
                   BH945.EJERSKAB.BBERGRL_SW = -1)                      
             DO;                                                        
                BH945.FEJLNR = 5009;                                    
             END;                                                       
                                                                        
           WHEN ((BH945.AKT_VURD.CBENYT = '01' &                        
                  BH945.AKT_VURD.FLEJL = 2) !                           
                 (BH945.AKT_VURD.CBENYT = '41' &                        
                  BH945.AKT_VURD.FLEJL = 2) !                           
                 (BH945.AKT_VURD.CBENYT = '45' &                        
                  BH945.AKT_VURD.FLEJL = 2))                            
             DO;                                                        
                IF (BH945.AKT_VURD.ANT_FOR_4 +                          
                    BH945.AKT_VURD.ANT_FOR_5 +                          
                    BH945.AKT_VURD.ANT_FOR_6 +                          
                    BH945.AKT_VURD.ANT_FOR_8 +                          
                    BH945.AKT_VURD.ANT_FOR_9) = 0                       
                THEN                                                    
                   BH945.FEJLNR = 5008;                                 
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         IF BH945.FEJLNR = 5007 !                                       
            BH945.FEJLNR = 5008 !                                       
            BH945.FEJLNR = 5009                                         
         THEN                                                           
            DO;                                                         
               BH945.EJERSKAB.CBERGROP = ' ';                           
               BH945.EJERSKAB.CBERGRGLOP = ' ';                         
               BH945.EJENDOM.CBERGRL = '9';                             
                                                                        
               BH945.EJERSKAB.BBERGRL = 0;                              
               BH945.EJERSKAB.BBERGRL_SW = -1;                          
               BH945.EJERSKAB.BBER2FAM = 0;                             
               BH945.EJERSKAB.BBER2FAM_SW = -1;                         
               BH945.EJERSKAB.BEJBOLANV = 0;                            
               BH945.EJERSKAB.BEJBOLANV_SW = -1;                        
               BH945.EJERSKAB.CANVEBOL = ' ';                           
                                                                        
               BH945.VURD_AKT.BBERGRL_AKT = 0;                          
               BH945.VURD_AKT.BBERGRL_AKT_SW = -1;                      
               BH945.VURD_AKT.BBER2FAM_AKT = 0;                         
               BH945.VURD_AKT.BBER2FAM_AKT_SW = -1;                     
               BH945.VURD_AKT.CBERGRL_AKT = '9';                        
               BH945.VURD_AKT.BEJBOLANV_AKT = 0;                        
               BH945.VURD_AKT.BEJBOLANV_AKT_SW = -1;                    
               BH945.VURD_AKT.CANVEBOL_AKT = ' ';                       
                                                                        
               BH945.VURD_02OM.BBERGRL_02OM = 0;                        
               BH945.VURD_02OM.BBERGRL_02OM_SW = -1;                    
               BH945.VURD_02OM.BBER2FAM_02OM = 0;                       
               BH945.VURD_02OM.BBER2FAM_02OM_SW = -1;                   
               BH945.VURD_02OM.CBERGRL_02OM = '9';                      
               BH945.VURD_02OM.BEJBOLANV_02OM = 0;                      
               BH945.VURD_02OM.BEJBOLANV_02OM_SW = -1;                  
               BH945.VURD_02OM.CANVEBOL_02OM = ' ';                     
                                                                        
               BH945.VURD_02OMNY.BBERGRL_02OMNY = 0;                    
               BH945.VURD_02OMNY.BBERGRL_02OMNY_SW = -1;                
               BH945.VURD_02OMNY.BBER2FAM_02OMNY = 0;                   
               BH945.VURD_02OMNY.BBER2FAM_02OMNY_SW = -1;               
               BH945.VURD_02OMNY.CBERGRL_02OMNY = '9';                  
               BH945.VURD_02OMNY.BEJBOLANV_02OMNY = 0;                  
               BH945.VURD_02OMNY.BEJBOLANV_02OMNY_SW = -1;              
               BH945.VURD_02OMNY.CANVEBOL_02OMNY = ' ';                 
                                                                        
               BH945.VURD_02.BBERGRL_02 = 0;                            
               BH945.VURD_02.BBERGRL_02_SW = -1;                        
               BH945.VURD_02.BBER2FAM_02 = 0;                           
               BH945.VURD_02.BBER2FAM_02_SW = -1;                       
               BH945.VURD_02.CBERGRL_02 = '9';                          
               BH945.VURD_02.BEJBOLANV_02 = 0;                          
               BH945.VURD_02.BEJBOLANV_02_SW = -1;                      
               BH945.VURD_02.CANVEBOL_02 = ' ';                         
                                                                        
               BH945.VURD_02ANV.BBERGRL_02ANV = 0;                      
               BH945.VURD_02ANV.BBERGRL_02ANV_SW = -1;                  
               BH945.VURD_02ANV.BBER2FAM_02ANV = 0;                     
               BH945.VURD_02ANV.BBER2FAM_02ANV_SW = -1;                 
               BH945.VURD_02ANV.CBERGRL_02ANV = '9';                    
               BH945.VURD_02ANV.BEJBOLANV_02ANV = 0;                    
               BH945.VURD_02ANV.BEJBOLANV_02ANV_SW = -1;                
               BH945.VURD_02ANV.CANVEBOL_02ANV = ' ';                   
                                                                        
               BH945.VURD_01OM.BBERGRL_01OM = 0;                        
               BH945.VURD_01OM.BBERGRL_01OM_SW = -1;                    
               BH945.VURD_01OM.BBER2FAM_01OM = 0;                       
               BH945.VURD_01OM.BBER2FAM_01OM_SW = -1;                   
               BH945.VURD_01OM.CBERGRL_01OM = '9';                      
               BH945.VURD_01OM.BEJBOLANV_01OM = 0;                      
               BH945.VURD_01OM.BEJBOLANV_01OM_SW = -1;                  
               BH945.VURD_01OM.CANVEBOL_01OM = ' ';                     
                                                                        
               BH945.VURD_01OMNY.BBERGRL_01OMNY = 0;                    
               BH945.VURD_01OMNY.BBERGRL_01OMNY_SW = -1;                
               BH945.VURD_01OMNY.BBER2FAM_01OMNY = 0;                   
               BH945.VURD_01OMNY.BBER2FAM_01OMNY_SW = -1;               
               BH945.VURD_01OMNY.CBERGRL_01OMNY = '9';                  
               BH945.VURD_01OMNY.BEJBOLANV_01OMNY = 0;                  
               BH945.VURD_01OMNY.BEJBOLANV_01OMNY_SW = -1;              
               BH945.VURD_01OMNY.CANVEBOL_01OMNY = ' ';                 
                                                                        
               BH945.VURD_015PCT.BBERGRL_015PCT = 0;                    
               BH945.VURD_015PCT.BBERGRL_015PCT_SW = -1;                
               BH945.VURD_015PCT.BBER2FAM_015PCT = 0;                   
               BH945.VURD_015PCT.BBER2FAM_015PCT_SW = -1;               
               BH945.VURD_015PCT.CBERGRL_015PCT = '9';                  
               BH945.VURD_015PCT.BEJBOLANV_015PCT = 0;                  
               BH945.VURD_015PCT.BEJBOLANV_015PCT_SW = -1;              
               BH945.VURD_015PCT.CANVEBOL_015PCT = ' ';                 
                                                                        
               BH945.VURD_015ANV.BBERGRL_015ANV = 0;                    
               BH945.VURD_015ANV.BBERGRL_015ANV_SW = -1;                
               BH945.VURD_015ANV.BBER2FAM_015ANV = 0;                   
               BH945.VURD_015ANV.BBER2FAM_015ANV_SW = -1;               
               BH945.VURD_015ANV.CBERGRL_015ANV = '9';                  
               BH945.VURD_015ANV.BEJBOLANV_015ANV = 0;                  
               BH945.VURD_015ANV.BEJBOLANV_015ANV_SW = -1;              
               BH945.VURD_015ANV.CANVEBOL_015ANV = ' ';                 
            END;                                                        
                                                                        
         IF (BH945.TIL_EVS.CEJBEVS = '7' !                              
             BH945.TIL_EVS.CEJBEVS = '8' !                              
             BH945.TIL_EVS.CEJBEVS = '9') &                             
             BH945.MT.CCIVS ^= 'D'                                      
         THEN                                                           
            DO;                                                         
               /* CEJBEVS 7,8 OG 9 SKAL BEVARES  U D E N  FEJLNR. */    
               BH945.FEJLNR = 0;                                        
               RETURN;                                                  
            END;                                                        
                                                                        
         /* NB. HEREFTER STARTER DEN 'NORMALE' OPSÆTNING AF */          
         /* FEJLNUMRE (OGSÅ FEJLNUMRENE 5007, 5008 OG 5009. */          
                                                                        
         SELECT;                                                        
                                                                        
           WHEN ( BH945.CINVPNR ^= '0' )                                
             DO;                                                        
                BH945.FEJLNR = 5020;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_EJER.CEJFORH = '50' ! /* EJEREN ER   */     
                  BH945.AKT_EJER.CEJFORH = '60' ! /* OFFENTLIG D.V.S. */
                  BH945.AKT_EJER.CEJFORH = '70' ! /* KOMM./AMT/STAT */  
                  BH945.AKT_EJER.CEJFORH = '80' )                       
             DO;                                                        
                BH945.FEJLNR = 5020;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '09' !                        
                  BH945.AKT_VURD.CBENYT = '17' !                        
                  BH945.AKT_VURD.CBENYT = '98' )                        
             DO;                                                        
                BH945.FEJLNR = 5001;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
           WHEN ( BH945.MT.CCIVS = 'D' !               /* EJER ER DØD */
                  BH945.EVS_SLUT_EJER.FØRSTE.CIVILSTAND = 'D' !         
                  BH945.EVS_SLUT_EJER.SIDSTE.CIVILSTAND = 'D' !         
                  BH945.EVS_SLUT_EJER.FØRSTE.FEJLNR = '5004' !          
                 (BH945.EVS_SLUT_EJER.FØRSTE.FEJLNR = '5027' &          
                  BH945.MT.DCPRN = 0) )                /* EJER ER DØD */
             DO;                                                        
                BH945.FEJLNR = 5004;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '03' !                        
                  BH945.AKT_VURD.CBENYT = '04' !                        
                  BH945.AKT_VURD.CBENYT = '23' !                        
                  BH945.AKT_VURD.CBENYT = '24' !                        
                  BH945.AKT_VURD.CBENYT = '31' !                        
                  BH945.AKT_VURD.CBENYT = '33' !                        
                  BH945.AKT_VURD.CBENYT = '43' !                        
                  BH945.AKT_VURD.CBENYT = '44' !                        
                  BH945.AKT_VURD.CBENYT = '49' )                        
             DO;                                                        
                IF (BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !          
                    BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !          
                    BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !          
                    BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6') &         
                    BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &            
                    BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &          
                    BH945.EVS_SLUT_EJER.SIDSTE.DAFSTAA = 0 &            
                    BH945.EVS_SLUT_EJER.SIDSTE.DFRAFLYT = 0 &           
                    BH945.EVS_SLUT_EJER.SIDSTE.CÆGTOPR < '1' &          
                   (BH945.AKT_VURD.ANT_FOR_4 +                          
                    BH945.AKT_VURD.ANT_FOR_5 +                          
                    BH945.AKT_VURD.ANT_FOR_6 +                          
                    BH945.AKT_VURD.ANT_FOR_8 +                          
                    BH945.AKT_VURD.ANT_FOR_9) > 0                       
                THEN;                                                   
                ELSE                                                    
                   DO;                                                  
                      BH945.FEJLNR = 5001;                              
                      BH945.TIL_EVS.CEJBEVS = '1';                      
                   END;                                                 
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.ANT_FOR_2 > 0 )                        
             DO;                                                        
                BH945.FEJLNR = 5003;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
                BH945.EJERSKAB.BBERGRL = 0;                             
                BH945.EJERSKAB.BBERGRL_SW = -1;                         
                BH945.EJENDOM.CBERGRL = '9';                            
             END;                                                       
                                                                        
  /* #01 opsætning af afvisning 5002 ændret efter Forskud 2017*/        
  /*        WHEN ( BH945.AKT_VURD.CBENYT = '70' !                       
                  BH945.AKT_VURD.CBENYT = '71')                         
             DO;                                                        
                BH945.FEJLNR = 5002;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;*/                                                     
                                                                        
 /*  Forskud 2018 FEJLNR = 5002 taget ud efter aftale med JAM */        
 /*        WHEN ( BH945.AKT_VURD.CUOP = '6')                            
             DO;                                                        
                BH945.FEJLNR = 5002;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;*/                                                     
                                                                        
           WHEN ( BH945.STAMOPL.VURDOPLGL.CUOP = '5' )   /*FORSKUD06*/  
             DO;                                                        
                BH945.FEJLNR = 5025;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
                                                                        
           /* Foskud 2018 CEJSO skal ikke bruges mere */                
           WHEN ((BH945.AKT_VURD.CBENYT = '21' !                        
                  BH945.AKT_VURD.CBENYT = '22' !                        
                  BH945.AKT_VURD.CBENYT = '25' !                        
                  BH945.AKT_VURD.CBENYT = '26' !                        
                  BH945.AKT_VURD.CBENYT = '27' !                        
                  BH945.AKT_VURD.CBENYT = '28' !                        
                  BH945.AKT_VURD.CBENYT = '29') &                       
                  BH945.AKT_VURD.CEJERL = '1')                          
             DO;                                                        
                BH945.FEJLNR = 5014;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.FLEJL > 2 &                            
                 (BH945.AKT_VURD.ANT_FOR_4 +                            
                  BH945.AKT_VURD.ANT_FOR_5 +                            
                  BH945.AKT_VURD.ANT_FOR_6 +                            
                  BH945.AKT_VURD.ANT_FOR_8 +                            
                  BH945.AKT_VURD.ANT_FOR_9) = 0 &                       
                  BH945.AKT_VURD.ANT_FOR_1 > 2 )                        
             DO;                                                        
                BH945.FEJLNR = 5003;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
                BH945.EJERSKAB.BBERGRL = 0;                             
                BH945.EJERSKAB.BBERGRL_SW = -1;                         
                BH945.EJERSKAB.BBER2FAM = 0;                            
                BH945.EJERSKAB.BBER2FAM_SW = -1;                        
                BH945.EJENDOM.CBERGRL = '9';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.FLEJL > 2 &                            
                 (BH945.AKT_VURD.ANT_FOR_1 +                            
                  BH945.AKT_VURD.ANT_FOR_4 +                            
                  BH945.AKT_VURD.ANT_FOR_5 +                            
                  BH945.AKT_VURD.ANT_FOR_6 +                            
                  BH945.AKT_VURD.ANT_FOR_8 +                            
                  BH945.AKT_VURD.ANT_FOR_9) = 0 )                       
             DO;                                                        
                BH945.FEJLNR = 5024;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.FLEJL > 2 &                            
                  BH945.AKT_VURD.ANT_FOR_1 = 0 &                        
                 (BH945.AKT_VURD.ANT_FOR_4 +                            
                  BH945.AKT_VURD.ANT_FOR_5 +                            
                  BH945.AKT_VURD.ANT_FOR_6 +                            
                  BH945.AKT_VURD.ANT_FOR_8 +                            
                  BH945.AKT_VURD.ANT_FOR_9) > 2 )                       
             DO;                                                        
                BH945.FEJLNR = 5024;                                    
                BH945.TIL_EVS.CEJBEVS = '1';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '  ' !                        
                  BH945.AKT_VURD.DVURDÅR ^= BH65300M.INDKÅR1)  /*#01*/  
             DO;                                                        
                SELECT;                                                 
                  WHEN ( BH945.ESR.STAMOPL.GL_CBENYT = '09' !           
                         BH945.ESR.STAMOPL.GL_CBENYT = '17' !           
                         BH945.ESR.STAMOPL.GL_CBENYT = '98' )           
                    DO;                                                 
                       BH945.FEJLNR = 5001;                             
                       BH945.TIL_EVS.CEJBEVS = '1';                     
                    END;                                                
                  WHEN ( BH945.ESR.STAMOPL.GL_FLEJL > 2 )               
                    DO;                                                 
                       BH945.FEJLNR = 5024;                             
                       BH945.TIL_EVS.CEJBEVS = '1';                     
                    END;                                                
                  OTHERWISE                                             
                    DO;                                                 
                       BH945.FEJLNR = 5019;                             
                       BH945.EJERSKAB.BBERGRL = 0;                      
                       BH945.EJERSKAB.BBERGRL_SW = -1;                  
                       BH945.EJENDOM.CBERGRL = '9';                     
                       BH945.TIL_EVS.CEJBEVS = '2';                     
                    END;                                                
                END;                                                    
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '45' &                        
                  BH945.AKT_VURD.FLEJL = 0 )                            
             DO;                                                        
                BH945.FEJLNR = 5006;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '29' &                        
                  BH945.AKT_VURD.FLEJL ^= 1 )                           
             DO;                                                        
                BH945.FEJLNR = 5005;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN (((BH945.AKT_VURD.ANT_FOR_4 +                           
                   BH945.AKT_VURD.ANT_FOR_5 +                           
                   BH945.AKT_VURD.ANT_FOR_6 +                           
                   BH945.AKT_VURD.ANT_FOR_8 +                           
                   BH945.AKT_VURD.ANT_FOR_9) > 1) &                     
                  (BH945.FEJLNR = 5007 !                                
                   BH945.FEJLNR = 5009))                                
                /* D.V.S. AT BH945.EJERSKAB.BBERGRL_SW = -1 */          
             DO;                                                        
                BH945.FEJLNR = 5007;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '02' !                        
                  BH945.AKT_VURD.CBENYT = '05' !                        
                  BH945.AKT_VURD.CBENYT = '07' !                        
                  BH945.AKT_VURD.CBENYT = '22' !                        
                  BH945.AKT_VURD.CBENYT = '42' )                        
             DO;                                                        
                IF (BH945.AKT_VURD.ANT_FOR_4 +                          
                    BH945.AKT_VURD.ANT_FOR_5 +                          
                    BH945.AKT_VURD.ANT_FOR_6 +                          
                    BH945.AKT_VURD.ANT_FOR_8 +                          
                    BH945.AKT_VURD.ANT_FOR_9) = 0                       
                THEN                                                    
                   DO;                                                  
                      IF BH945.AKT_EJER.DINDFLYT > 0                    
                       & BH945.AKT_EJER.DINDFLYT <= BH945.MT.DRGNÅRTIL  
                      THEN                                              
                         DO;                                            
                           BH945.FEJLNR = 5008;                         
                           BH945.TIL_EVS.CEJBEVS = '2';                 
                         END;                                           
                      ELSE                                              
                      IF BH945.AKT_EJER.DFRAFLYT > 0                    
                       & BH945.AKT_EJER.DFRAFLYT >= BH945.MT.DRGNÅRFRA  
                      THEN                                              
                         DO;                                            
                           BH945.FEJLNR = 5008;                         
                           BH945.TIL_EVS.CEJBEVS = '2';                 
                         END;                                           
                      ELSE                                              
                         DO;                                            
                           BH945.FEJLNR = 5155;                         
                           BH945.TIL_EVS.CEJBEVS = '1';                 
                         END;                                           
                   END;                                                 
             END;                                                       
                                                                        
           WHEN (((BH945.AKT_VURD.CBENYT = '02' &                       
                   BH945.AKT_VURD.FLEJL = 2) !                          
                  (BH945.AKT_VURD.CBENYT = '22' &                       
                   BH945.AKT_VURD.FLEJL = 2) !                          
                  (BH945.AKT_VURD.CBENYT = '42' &                       
                   BH945.AKT_VURD.FLEJL = 2)) &                         
                  (BH945.FEJLNR = 5007 !                                
                   BH945.FEJLNR = 5009))                                
                /* D.V.S. AT BH945.EJERSKAB.BBERGRL_SW = -1 */          
             DO;                                                        
                BH945.FEJLNR = 5009;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN ((BH945.AKT_VURD.CBENYT = '01' &                        
                  BH945.AKT_VURD.FLEJL = 2) !                           
                 (BH945.AKT_VURD.CBENYT = '41' &                        
                  BH945.AKT_VURD.FLEJL = 2) !                           
                 (BH945.AKT_VURD.CBENYT = '45' &                        
                  BH945.AKT_VURD.FLEJL = 2))                            
             DO;                                                        
                IF (BH945.AKT_VURD.ANT_FOR_1 +                          
                    BH945.AKT_VURD.ANT_FOR_4 +                          
                    BH945.AKT_VURD.ANT_FOR_5 +                          
                    BH945.AKT_VURD.ANT_FOR_6 +                          
                    BH945.AKT_VURD.ANT_FOR_8 +                          
                    BH945.AKT_VURD.ANT_FOR_9) = 0                       
                THEN                                                    
                   DO;                                                  
                      BH945.FEJLNR = 5008;                              
                      BH945.TIL_EVS.CEJBEVS = '2';                      
                   END;                                                 
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '25' )                        
             DO;                                                        
                IF BH945.AKT_VURD.CEJERL = '1' /* D.V.S. ER UDLEJET */  
                THEN                                                    
                  DO;                                                   
                     BH945.FEJLNR = 5014;                               
                     BH945.TIL_EVS.CEJBEVS = '1';                       
                  END;                                                  
                ELSE /*Forskud 2017-KRAV 3201 CEANV */                  
                  DO;                                                   
                    IF (BH945.ESR.CEANV = '150' !     /*KOLLEGIUM*/     
                        BH945.ESR.CEANV = '510' !     /*SOMMERHUS*/     
                        BH945.ESR.CEANV = '520' !     /*FERIEBYGNING*/  
                        BH945.ESR.CEANV = '521' !     /*FERIECENTER*/   
                        BH945.ESR.CEANV = '522')  &   /*FERIELEJL.*/    
                        BH945.EJERSKAB.BBERGRL_SW = 0                   
                    THEN                                                
                      DO; /*SKAL IKKE AFVISES*/                         
                      END;                                              
                    ELSE                                                
                      DO;                                               
                        IF BH945.AKT_VURD.BEJDVÆR <= 25000              
                        THEN                                            
                          BH945.FEJLNR = 5010;                          
                        ELSE                                            
                          BH945.FEJLNR = 5011;                          
                        BH945.TIL_EVS.CEJBEVS = '3';                    
                      END;                                              
                  END;                                                  
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.CBENYT = '06' !                        
                  BH945.AKT_VURD.CBENYT = '07' !                        
                  BH945.AKT_VURD.CBENYT = '13' !                        
                  BH945.AKT_VURD.CBENYT = '34')                         
             DO;                                                        
                IF (BH945.AKT_VURD.ANT_FOR_4 +                          
                    BH945.AKT_VURD.ANT_FOR_5 +                          
                    BH945.AKT_VURD.ANT_FOR_6 +                          
                    BH945.AKT_VURD.ANT_FOR_8 +                          
                    BH945.AKT_VURD.ANT_FOR_9) = 0                       
                THEN                                                    
                   DO;                                                  
                      BH945.FEJLNR = 5008;                              
                      BH945.TIL_EVS.CEJBEVS = '1';                      
                   END;                                                 
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         IF (BH945.FEJLNR = 5010 !                                      
             BH945.FEJLNR = 5011) &                                     
           ((BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !                 
             BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !                 
             BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !                 
             BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6') &                
             BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1') &                  
             BH945.EJERSKAB.BBERGRL_SW = 0                              
         THEN                                                           
            BH945.FEJLNR = 0;                                           
                                                                        
         IF BH945.FEJLNR ^= 0                                           
         THEN                                                           
            RETURN;                                                     
                                                                        
         SELECT;                                                        
                                                                        
           WHEN ( BH945.AKT_VURD.BEJDVÆR = 0 &                          
                  BH945.VURD_02OM.BBERGRL_02OM_SW = -1 &                
                  BH945.VURD_02OMNY.BBERGRL_02OMNY_SW = -1 )            
             DO;                                                        
                BH945.FEJLNR = 5015;                                    
                BH945.TIL_EVS.CEJBEVS = '3';                            
                BH945.EJERSKAB.BBERGRL = 0;                             
                BH945.EJERSKAB.BBERGRL_SW = -1;                         
                BH945.EJENDOM.CBERGRL = '9';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_VURD.BEJDVÆR < 0 )                          
             DO;                                                        
                BH945.FEJLNR = 5016;                                    
                BH945.TIL_EVS.CEJBEVS = '3';                            
                BH945.EJERSKAB.BBERGRL = 0;                             
                BH945.EJERSKAB.BBERGRL_SW = -1;                         
                BH945.EJENDOM.CBERGRL = '9';                            
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         IF BH945.FEJLNR ^= 0                                           
         THEN                                                           
            RETURN;                                                     
                                                                        
         SELECT;                                                        
                                                                        
           WHEN ( BH945.AKT_EJER.FEJER = 1 &                            
                 (BH945.AKT_EJER.GANE > 10000 !                         
                 (BH945.AKT_EJER.GANE > 0 &                             
                  BH945.AKT_EJER.GANE < 10000)) )                       
             DO;                                                        
                BH945.FEJLNR = 5017;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_EJER.FEJER = 2 &                            
                 (BH945.AKT_EJER.GANE = 0 !                             
                 (BH945.AKT_EJER.CEJ_100 ^= '1' &                       
                  BH945.AKT_EJER.CEJ_100 ^= '2')) )                     
             DO;                                                        
                BH945.FEJLNR = 5017;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN ( BH945.AKT_EJER.FEJER > 2 &                            
                 (BH945.AKT_EJER.GANE = 0 !                             
                  BH945.AKT_EJER.CEJ_100 ^= '1') )                      
             DO;                                                        
       /*       UDGÅET SE KS 2007 18.07.01                              
                BH945.FEJLNR = 5017;                                    
                BH945.TIL_EVS.CEJBEVS = '2';   */                       
             END;                                                       
                                                                        
           WHEN ( BH945.MT.DCPRN = 0 &              /* EJER EJ PÅ MT  */
                  BH945.AKT_EJER.DCPRCIR > 0 )      /* EJER JVF. ESR  */
             DO;                                    /* ELLER OPRETTET */
                BH945.FEJLNR = 5059;                /* P.G.A. GL. SLUT*/
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN ( BH945.C5060 = '5060' &                                
                 (BH945.EVS_SLUT_EJER.SIDSTE.GPCTEJER = 0 !             
                  BH945.EVS_SLUT_EJER.SIDSTE.CNEDSL1 = '  ' !           
                  BH945.EVS_SLUT_EJER.SIDSTE.CPTYPSLUT = ' ') )         
             DO;                                                        
                /* EJER OPRETTET MANGELFULDT P.G.A. GL. SLUT */         
                BH945.FEJLNR = 5059;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
           WHEN ( (BH945.VURD_AKT.BBERGRL_AKT_SW = 0 &                  
                   BH945.VURD_02ANV.BBERGRL_02ANV_SW = -1 &             
                   BH945.VURD_015ANV.BBERGRL_015ANV_SW = -1) !          
                  (BH945.VURD_AKT.BBERGRL_AKT_SW = 0 &                  
                   BH945.VURD_02ANV.BBERGRL_02ANV_SW = 0  &             
                   BH945.VURD_015ANV.BBERGRL_015ANV_SW = -1) !          
                  (BH945.VURD_AKT.BBERGRL_AKT_SW = -1 &                 
                   BH945.VURD_02ANV.BBERGRL_02ANV_SW = 0  &             
                   BH945.VURD_015ANV.BBERGRL_015ANV_SW = 0)  !          
                  (BH945.VURD_AKT.BBERGRL_AKT_SW = -1 &                 
                   BH945.VURD_02ANV.BBERGRL_02ANV_SW = -1 &             
                   BH945.VURD_015ANV.BBERGRL_015ANV_SW = 0) )           
             DO;                                                        
                BH945.FEJLNR = 5057;                                    
                BH945.TIL_EVS.CEJBEVS = '3';                            
                BH945.EJERSKAB.BBERGRL = 0;                             
                BH945.EJERSKAB.BBERGRL_SW = -1;                         
                BH945.EJENDOM.CBERGRL = '9';                            
             END;                                                       
                                                                        
                                                                        
           /* KS30 Forskud 2017 afvisning 5164 */                       
           WHEN (BH945.TIL_EVS.CENKE = '5'  &                           
                 BH945.HJ_67 ^= '1'  &                                  
                 BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &               
                 ER_BEGRÆNSET_SKATTEPLIGTIG = NEJ)                      
             DO;                                                        
                BH945.FEJLNR = 5164;                                    
                BH945.TIL_EVS.CEJBEVS = '2';                            
             END;                                                       
                                                                        
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         IF BH945.FEJLNR = 5017 &                                       
            BH945.EVS_SLUT_EJER.DCPRN > 0 &                             
          ((BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !                  
            BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !                  
            BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !                  
            BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6') &                 
            BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1') &                   
            BH945.EJERSKAB.BBERGRL_SW = 0 &                             
            BH945.TIL_EVS.DOVTG < BH945.MT.DRGNÅRFRA &                  
            BH945.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0 &                
           (BH945.TIL_EVS.GPCTEJER_SW = -1 !                            
           (BH945.TIL_EVS.GPCTEJER ^=                                   
            BH945.EVS_SLUT_EJER.SIDSTE.GPCTEJER))                       
         THEN                                                           
            DO;                                                         
               BH945.TIL_EVS.GPCTEJER =                                 
               BH945.EVS_SLUT_EJER.SIDSTE.GPCTEJER;                     
               BH945.TIL_EVS.GPCTEJER_SW = 0;                           
               BH945.TIL_FORSKUD.COPR_GPCTEJER = 'S';                   
               BH945.TIL_EVS.CDATAFRA = '3';                            
               BH945.FEJLNR = 0;                                        
            END;                                                        
                                                                        
 END OPSÆT_FEJLNR;                                                      
 /********************************************************************/ 
 /* UNDERSØG OM EN BORGER ER BEGRÆNSET SKATTEPLIGTIG. FINDES MT DATA */ 
 /* ANVENDES DE ELLERS UNDERSØGES SIDSTE EVS SLUT ÅR                 */ 
 /********************************************************************/ 
 ER_BEGRÆNSET_SKATTEPLIGTIG:PROC RETURNS(BIT(1));                       
                                                                        
   DCL HJBEGRÆNSET_BIT BIT(1);                                          
                                                                        
   HJBEGRÆNSET_BIT = NEJ;                                               
   HJBEGRÆNSET_TP = '0';                                                
                                                                        
   IF BH945.MT.DCPRN > 0 &                                              
      BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM >= '0'                          
   THEN                                                                 
     DO;                                                                
       IF BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1' !                     
          BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3' !                     
          BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8'                       
       THEN                                                             
         DO;                                                            
           HJBEGRÆNSET_BIT = JA;                                        
           HJBEGRÆNSET_TP = BH945.MT.HIST_OPL(SLUTÅR).CSKPLOM;          
         END;                                                           
     END;                                                               
   ELSE                                                                 
     DO;                                                                
       IF BH945.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '1' !        
          BH945.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '3' !        
          BH945.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '8'          
       THEN                                                             
         DO;                                                            
           HJBEGRÆNSET_BIT = JA;                                        
           HJBEGRÆNSET_TP =                                             
               BH945.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF;          
         END;                                                           
     END;                                                               
                                                                        
   RETURN(HJBEGRÆNSET_BIT);                                             
                                                                        
 END ER_BEGRÆNSET_SKATTEPLIGTIG;                                        
                                                                        
     %INCLUDE BH95010M; /* EVS'S UDGAVE AF "BR88680M" OPSÆT EVS 2016 */ 
                                                                        
 END BH95010;                                                           
