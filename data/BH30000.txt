 BH30000: PROCEDURE OPTIONS (MAIN);                                     
 /**********************************************************************
 * PROJEKT:     EVS FORSKUD/EVS SLUT                                  **
 * PROGRAMNAVN: BH30000.                                               *
 * PROGRAMTYPE: BATCH.                                                 *
 * FUNKTION:    PROGRAMMET UDTRÆKKER ALLE AKTIVE OG VALIDE EJENDOMME   *
 *              FRA SENEST EVS SLUT ÅR                                 *
 * PGMFORLØB:   1. ÅBEN EVS UDTRÆKSFIL.                                *
 *              2. DECLARE PERSONEJENDOMSOPL.                          *
 *              3. OPEN PERSONEJENDOMSOPL.                             *
 *              4. LÆS/FETCH RÆKKE PÅ PERSONTABEL.                     *
 *              5. BEHANDL DATA TIL FØRSTE DEL AF RECORDSTRUKTUR.      *
 *              6. LÆS/FETCH RÆKKE PÅ PERSONTABEL.                     *
 *              7. BEHANDL DATA TIL SIDSTE DEL AF RECORDSTRUKTUR.      *
 *              8. CHECK/SKRIV RÆKKE PÅ EVS FIL.                       *
 *              9. GENTAG PUNKT 4 TIL 8 INTIL IKKE FLERE RÆKKER        *
 *             10. LUK PERSONEJENDOMSOPL.                              *
 *             11. LUK EVS UDTRÆKSFIL.                                 *
 *             12. SKRIV KONTROLLISTE.                                 *
 * INDDATA:     VB.Q17500D        - EVS EJENDOMSREGISTER SLUT 2017     *
 *              BQ30000T/BQ31000T - EVS PERSONTABEL.                   *
 *              BQ40000T/BQ41000T - EVS RESULTATTABEL.                 *
 * UDDATA:      BH30000O - UDTRÆK FRA EVS SLUT EXCL. KOMMUNE           *
 *                         999 (UDENLANDSKE EJENDOMME).                *
 *              BH30010O - UDTRÆK FRA EVS SLUT KUN KOMMUNE             *
 *                         999 (UDENLANDSKE EJENDOMME).                *
 *              BH30001Y - KONTROLLISTE.                               *
 * KONSTRUKTØR: THOMAS FLINDT         THF, PUS/T&S BRØNDBY 16.07.2001. *
 * ÆNDRINGSLOG: PROGRAMMET ER TILRETTET TIL EVS 2001                   *
 *              ESBEN BRODERSEN       ESB,    T&S BRØNDBY  16.11.2001. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2002               *
 *              ESBEN BRODERSEN       ESB,    T&S BRØNDBY  26.07.2002. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2003               *
 *              ESBEN BRODERSEN       ESB,    T&S BALLERUP 17.07.2003. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2004               *
 *              BO SCHMIDT            BOB,    T&S BALLERUP 07.06.2004. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2005               *
 * *FORSKUD06*  SUSANNE KROGH VILLUMSEN SKV,  T&S BALLERUP 23.05.2005. *
 *             -PROGRAMMET ER TILRETTET TIL FORSKUD 2006               *
 *             -ANTAL LÆSTE VAR IKKE LIG MED ANTAL SKREVNE - ANTAL     *
 *              AFVISTE.                                               *
 *             -BSUM1 OG BSUM2 BLEV IKKE OVERFØRT TIL OUTPUT-FILEN     *
 * *SLUT05*     SUSANNE KROGH VILLUMSEN SKV,  T&S BALLERUP 07.11.2005. *
 *             -PROGRAMMET ER TILRETTET TIL SLUT 2005                  *
 *              KONVERTERING AF ÆRØ KOMMUNE.  KMNR 443 OG 492  TIL 443 *
 * *FORSKUD07*  BO SCHMIDT            BOB,    PKF BALLERUP 11.05.2006. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2007               *
 * *SLUT06*     BO SCHMIDT            BOB,    PKF BALLERUP 03.11.2006. *
 *             -PROGRAMMET ER TILRETTET TIL SLUT 2006                  *
 *              KONVERTERING AF DE ØVRIGE KOMMUNER I KOMMUNALREFORMEN. *
 * *FORSKUD08*  BO SCHMIDT            BOB,    PKF BALLERUP 22.05.2007. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2008               *
 * *SLUT07*     BO SCHMIDT            BOB,    PKF BALLERUP 03.01.2008. *
 *             -PROGRAMMET ER TILRETTET TIL SLUT 2007                  *
 * *FORSKUD09*  BO SCHMIDT            BOB,    PKF BALLERUP 25.04.2008. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2009               *
 * *FORSKUD10*  GERD HOLM-PEDERSEN    GEH,    PKF BALLERUP 07.04.2009. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2010               *
 *              BUDLSKC(910) TILFØJET I BN30000N OG I UDTRÆKKET.       *
 * *FORSKUD11*  GERD HOLM-PEDERSEN    GEH,    PKF BALLERUP 28.05.2010. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2011               *
 *              BBERGRLUDL_01 OG BOMBTILBUDL_01                        *
 *              FJERNET I BN30000N OG I UDTRÆKKET.                     *
 * *FORSKUD12*  GERD HOLM-PEDERSEN    GEH,    PKF BALLERUP 16.05.2011. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2012               *
 * *FORSKUD13*  ESBEN BRODERSEN       ESB,    PR  BALLERUP 15.05.2012. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2013               *
 * *FORSKUD14*  ESBEN BRODERSEN       ESB,    PR  BALLERUP 22.05.2013. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2014               *
 * *FORSKUD15*  JØRGEN SAUGMANN       QQS,    PR  BALLERUP 27.06.2014. *
 *              PROGRAMMET ER TILRETTET TIL FORSKUD 2015               *
 * *FORSKUD16*  JENS HOLGER KJÆR      JNK,        BALLERUP 08.06.2015. *
 *             PROGRAMMET ER ÅRSRULLET TIL FORSKUD 2016               * 
 * SLUT 2015   ESBEN BRODERSEN Z8QEB              BALLERUP 08.03.2016  *
 *             INDLAGT KONSTANT MACRO BH65300M #01                     *
 * *FORSKUD17* ESBEN BRODERSEN Z8QEB              BALLERUP 08.06.2016  *
 *             PROGRAMMET ER TILRETTET TIL FORSKUD 2017                *
 *             KS30-01 SLETTEDE EJERSKABER SKAL IKKE SKRIVES #01       *
 *             UDVIDDET MED PARMKORT DA KUN KOMMUNE 170 SKAL MED       *
 *             I BRUGTEST                                              *
 * *FORSKUD18* ESBEN BRODERSEN Z8QEB              BALLERUP 05.06.2017  *
 *             PROGRAMMET ER TILRETTET TIL FORSKUD 2018                *
 * *FORSKUD19* ESBEN BRODERSEN Z8QEB              BALLERUP 30.05.2018  *
 *             PROGRAMMET ER TILRETTET TIL FORSKUD 2019                *
 *             BQ16 -> BQ17                                            *
 * *SLUT18*    ESBEN BRODERSEN Z6EBD              BALLERUP 14.09.2018  *
 *             2-FAMILIE BOLIGER 02-23                                 *
 *             felt EENHEDLBNR er indført der mangler tilretning af    *
 *             BQ strukturer og macroer                                *
 * *FORSKUD20* ESBEN BRODERSEN Z6EBD             BALLERUP 22.03.2019   *
 *             PROGRAMMET ER TILRETTET TIL FORSKUD 2020                *
 *             BQ17 -> BQ18                                            *
 *             UDENLANDSKE EJERFORHOLD SOM ER SLETTET SKRIVES          *
 *             DEFECT 248                                              *
 * SLUT 2019   ESBEN BRODERSEN Z6EBD             BALLERUP 22.03.2019   *
 *             SLETTEDE DANSKE EJERSKABER CSLET = 1 SKAL SKRIVES SÅ    *
 *             DE KAN BRUGES TIL FJERNE EVS FORSKUDS OPLYSNINGER       *
 *             I BH317000L KS02-34A                                    *
 * *FORSKUD21* PER BRUNK Z6PBR                   BALLERUP 23.03.2020   *
 *             PROGRAMMET ER TILRETTET TIL FORSKUD 2021                *
 *             BQ18 -> BQ19                                            *
 * FORSKUD2021 z6pbr D14                                  juni 2020    *
 *             Aktive periodeløbenumre skal videreføres selv om der    *
 *             er slettet højere periodeløbenumre på samme ejendom     *
 * FORSKUD2022 Edward Laryea                        21/10-2020         *
 *            TILRETTET FOR FORSKUD2022/SLUT2021                       *
 *            BQ19 -> BQ20                                             *
 *            Mellemperioden - 2022                                    *
 *             Per Brunk                            29/01-2021         *
 *            Ny struktur BH30000N mellemperiode                       *
 * SLUT 2021   Z6SEP                                Marts 2021         *
 *             Rettet BH65300M til BH55300M                            *
 * FORSKUD2023 Per Brunk                            08/06-2022         *
 *            TILRETTET FOR FORSKUD2023/SLUT2022                       *
 *            BQ20 -> BQ21                                             *
 * FORSKUD2024 Tina Carstens (TIC)                  21/02-2023         *
 *            TILRETTET FOR FORSKUD2024/SLUT2023                       *
 *            BQ21 -> BQ22                                             *
 * FORSKUD2025 Tina Carstens (TIC)                  10/01-2024         *
 *            TILRETTET FOR FORSKUD2025/SLUT2024                       *
 *            BQ22 -> BQ23                                              
 * FORSKUD2025 Jan Jensen (JJJ)                     26/06-2024         *
 *            BH55600M erstatter BH55300M                              *
 * SLUT   2024 Jan Erik Jensen (XJY)                25.10.2024         *
 *             #1888924 Konvertering af udenlandske ejendomsnumre:     *
 *             * Implementeret kode i proceduren RET_UDENL_EJDNR til   *
 *               at konvertere udenlandske ejendomsnumre via kald      *
 *               til procedurer i makroen BE83000M.                    *
 *                                                                     *
 **********************************************************************/
                                                                        
 DEFAULT RANGE (*) STATIC; /* LAGERTYPE AHT. KALD AF EKSTERNE MODULER */
                                                                        
 DCL     COPYRIGHT      CHAR (30) INIT ('(C) KMD A/S 2018');            
                                                                        
 /*********************************************************************/
 /* DECLARE AF DB2                                                    */
 /*********************************************************************/
                                                                        
         EXEC SQL INCLUDE SQLCA;        /* SQL KOMMUNIKATIONSAREAL    */
         EXEC SQL INCLUDE BQ30000T;     /* EVS SLUT EJERSKABSTABEL    */
         EXEC SQL INCLUDE BQ31000T;     /* EVS SLUT EJERSKABSFELTTABEL*/
         EXEC SQL INCLUDE BQ40000T;     /* EVS SLUT RESULTATTABEL     */
         EXEC SQL INCLUDE BQ41000T;     /* EVS SLUT RESULTATFELTTABEL */
                                                                        
         EXEC SQL INCLUDE BE83000T;     /* UDL.EJD. MAPNING           */
         EXEC SQL INCLUDE BE83100T;     /* UDL.EJD. LOGNING           */
                                                                        
 /**********************************************************************
 * DECLARE AF ABEND RUTINE                                             *
 **********************************************************************/
                                                                        
 DCL     ZS30101        ENTRY;                                          
 DCL     ZS67000        ENTRY;                                          
 DCL     ZS61900        ENTRY;                        /* KST/SSI INFO */
 DCL     ZS62500        ENTRY OPTIONS(INTER ASM);    /* SKAF JOB INFO */
                                                                        
 /*********************************************************************/
 /* DECLARE AF DIVERSE                                                */
 /*********************************************************************/
                                                                        
 DCL     HJ_DCPRN       CHAR (10);                                      
 DCL     HJ_DCPRN_PIC   PIC  '(10)9' BASED(ADDR(HJ_DCPRN));             
 DCL     HJ_EKOMNR      CHAR (03);                                      
 DCL     HJ_EEJDNR      CHAR (06);                                      
 DCL     HJ_DFRAGLD_DTO CHAR (10);                                      
 DCL     EKOMEEJD_NR    CHAR (09);                                      
 DCL     OK             CHAR (01)        INIT('J');                     
 DCL     FEJLTEKST      CHAR (20)        INIT(' ');                     
 DCL     ABENDMEDD      CHAR (56)        INIT(' ');                     
 DCL     FLAG_EN_RÆKKE  BIT(1)           INIT('0'B);                    
 DCL     DCPRN_NGL      DEC FIXED (11,0);                               
 DCL     KOM_NGL        BIN FIXED (15) UNAL;                            
 DCL     EJD_NGL        BIN FIXED (31) UNAL;                            
 DCL     EENHEDLBNR_NGL BIN FIXED (15) UNAL; /* ??? */                  
 DCL     FETCH_SQLKODE  FIXED BIN(15)    INIT(0);                       
                                                                        
 DCL     PARMKOMNR1     BIN FIXED (15);                                 
 DCL     PARMKOMNR2     BIN FIXED (15);                                 
 DCL     PARMKOMNR3     BIN FIXED (15);                                 
                                                                        
 DCL     DT             CHAR (6);                                       
 DCL     1 DAT          BASED(ADDR(DT)),                                
           2 ÅR         PIC   '99',                                     
           2 MD         PIC   '99',                                     
           2 DAG        PIC   '99';                                     
                                                                        
 DCL     HJ_DATOEN       CHAR (8);                                      
 DCL     1 HJ_DATO       BASED(ADDR(HJ_DATOEN)),                        
           2 AAR         PIC  '9999',                                   
           2 MD          PIC  '99',                                     
           2 DG          PIC  '99';                                     
                                                                        
 DCL     EJD_NØGLEN     CHAR      (10);                                 
 DCL     1 EJD_NØGLE    BASED(ADDR(EJD_NØGLEN)),                        
           2 DINDKAAR   BIN FIXED(15),                                  
           2 EKOMNR     BIN FIXED(15),                                  
           2 EEJDNR     BIN FIXED(31),                                  
           2 EENHEDLBNR BIN FIXED(15);                                  
                                                                        
 DCL     TFLAG          BIT(1)         INIT('0'B);                      
                                                                        
 DCL     1 BH55600M,                                                    
           %INCLUDE BH55600M;                    /* DATO OG ÅR MACRO */ 
                                                                        
 DCL     ZS625P1         CHAR (08); /* Jobnavn */                       
 DCL     ZS625P2         CHAR (16); /* Job step navn/procedure */       
 DCL     ZS625P3         CHAR (08); /* Job step program navn */         
 DCL     ZS625P4         CHAR (04); /* Account info pointer */          
                                                                        
 /*********************************************************************/
 /* PARM KORT                                                         */
 /*********************************************************************/
  DCL     EOF_PARM         BIT (1) INIT ('0'B);                         
  DCL     PARMKORT         FILE RECORD INPUT;                           
  DCL     PARM_AR          CHAR  (80)  INIT (' ');                      
  DCL     PARM_MEDTAGET    BIT (1)       INIT ('0'B);                   
  DCL     PARM_FEJL        BIT (1)       INIT ('0'B);                   
                                                                        
  DCL     1 PARMLINIE  BASED (ADDR (PARM_AR) ),                         
            2 PARMSTART    CHAR      (02),                              
            2 PROGNAVN     CHAR      (07),                              
            2 KOMNR1       CHAR      (03),                              
            2 KOMNR2       CHAR      (03),                              
            2 KOMNR3       CHAR      (03),                              
            2 REST         CHAR      (62);                              
                                                                        
 /*********************************************************************/
 /* DECLARE DATASÆT                                                   */
 /*********************************************************************/
                                                                        
 DCL     SYSPRINT FILE STREAM PRINT;                                    
    /*  RUL HERUNDER  */                                                
 DCL     BQ235I  FILE RECORD DIRECT  /* EVS EJENDOMS REGISTER         */
                 INPUT KEYED ENV (VSAM);                                
                                                                        
 DCL     BH3000O FILE OUTPUT RECORD; /* EVS UDTRÆK EXCL. KOMMUNE 999  */
 DCL     BH3001O FILE OUTPUT RECORD; /* EVS UDTRÆK KUN   KOMMUNE 999  */
                                                                        
 /*********************************************************************/
 /* DECLARE STRUKTURER                                                */
 /*********************************************************************/
                                                                        
 DCL     1 UDTRÆK_SLUT,                                                 
           %INCLUDE BH30000N;;                                          
                                                                        
 DCL     1 EJENDOM,                   /* EVS EJENDOMS REGISTER      */  
           2 FELTER,                                                    
             %INCLUDE BQ22100N;,    /*RUL*/                             
           2 INDK,                                                      
             %INCLUDE BQ22005N;;    /*RUL*/                             
                                                                        
 DCL     1 PERSON,                    /* EVS EJERSKABSTABELEN       */  
           %INCLUDE BQ22200N;;        /*RUL*/                           
                                                                        
 DCL     1 INDK_PERS,                 /* INDIKATOR EJERSKAB OPLYSN. */  
           %INCLUDE BQ22006N;;        /*RUL*/                           
                                                                        
 DCL     1 RESULTAT,                                                    
           5 BEJERAN     DEC FIXED(15,2);                               
                                                                        
 DCL     1 INDK_RES,                                                    
           5 BEJERAN_SW  BIN FIXED (15) UNAL;                           
                                                                        
 DCL     1 EVS_ESK,                     /* EVS EJERSKABSTABELEN       */
           %INCLUDE BQ30000N;;                                          
 DCL     1 EVS_ESK_FELT,                /* EVS EJERSKABSFELTTABELEN   */
           %INCLUDE BQ31000N;;                                          
 DCL     1 EVS_RES,                     /* EVS RESULTATSTABEL         */
           %INCLUDE BQ40000N;;                                          
 DCL     1 EVS_RES_FELT,                /* EVS RESULTATFELTTABELEN    */
           %INCLUDE BQ41000N;;                                          
                                                                        
 DCL     HJ_ELBNR        BIN FIXED (15) INIT (0);                       
 DCL     HJ_CSLET        CHAR (1) INIT ('*');                           
 DCL     GEM_ELBNR       BIN FIXED (15) INIT (0);                       
 DCL     GEM_ELBNR_SLET  BIN FIXED (15) INIT (0);                       
 DCL     GEM_CSLET       CHAR (1) INIT ('*');                           
                                                                        
 /*********************************************************************/
 /* DECLARE AF BUILTIN                                                */
 /*********************************************************************/
                                                                        
 DCL     (ADDR,DATE,VERIFY,NULL,MOD,SUBSTR,PLIDUMP,PROCNAME) BUILTIN;   
                                                                        
 /*********************************************************************/
 /* DECLARE AF TÆLLERE                                                */
 /*********************************************************************/
                                                                        
 DCL   ANTLÆS_PERSON     BIN FIXED (31) INIT(0);/* LÆSTE PERSONTABEL  */
 DCL   ANTSKRIV_PERSON   BIN FIXED (31) INIT(0);/* SKREVET UDTRÆKSFIL */
 DCL   ANTSKRIV_ØVR      BIN FIXED (31) INIT(0);/* SKREVET EXCL UDLAND*/
 DCL   ANTSKRIV_ØVR_CÆG  BIN FIXED (31) INIT(0);/* SKREVET EXCL UDLAND*/
                                                /* OG CÆGTOPR ^= ' '  */
 DCL   ANTSKRIV_UDL      BIN FIXED (31) INIT(0);/* SKREVET KUN  UDLAND*/
 DCL   ANTCEJBEVS_9      BIN FIXED (31) INIT(0);/* CEJBEVS=9(SLETTET) */
 DCL   ANTOMPLACERET     BIN FIXED (31) INIT(0);/* COMPLA = 1         */
 DCL   ANTCSLET_1        BIN FIXED (31) INIT(0);/* CSLET=1  (SLETTET) */
 DCL   ANTEJDNR_UDL_EJ   BIN FIXED (31) INIT(0);/* FORKERT EJENDOMSNR */
                                                /* HOS CSC FOR UDLAND */
 DCL   ANTEJDNR_EEJDNR_0 BIN FIXED (31) INIT(0);/* FORKERT EJENDOMSNR */
                                                                        
 DCL     ANT_ÆA73_TJEKKET               BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_EJ_MAPPET             BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_MAPPET                BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_SLETTET               BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_SAMME                 BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_DUBLET                BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_OK                    BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_SKREVNE               BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_EJDNR_ÆNDRET          BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_EJDNR_UÆNDRET         BIN FIXED (31) INIT(0);         
 DCL     ANT_ÆA73_EJ_SKREVNE            BIN FIXED (31) INIT(0);         
                                                                        
 /*********************************************************************/
 /* PRINTLINIER TIL SPOOL                                             */
 /*********************************************************************/
                                                                        
 DCL     LINIE           CHAR (133);                                    
 DCL     1 LIN           BASED(ADDR(LINIE)),                            
           2 CC          CHAR (1),                                      
           2 TEKST       CHAR (56),                                     
           2 ANT         PIC  '---------9',                             
           2 FIL1        CHAR (66);                                     
                                                                        
         %INCLUDE ZZ20301M;                                             
                                                                        
 /*********************************************************************/
 /* ON - CONDITIONS                                                   */
 /*********************************************************************/
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
                ON ERROR SYSTEM;                                        
                PUT SKIP LIST ('PROGRAMFEJL');                          
                CALL PLIDUMP  ('SBHO','MODUL BH30000');                 
            END;                                                        
                                                                        
         ON KEY (BQ235I)        /*RUL*/                                 
            BEGIN;                                                      
            END;                                                        
                                                                        
 /*********************************************************************/
 /* HOUSEKEEPING                                                      */
 /*********************************************************************/
                                                                        
                                                                        
         UDTRÆK_SLUT       = '';                                        
         PERSON            = '';                                        
         EJENDOM           = '';                                        
         RESULTAT          = '';                                        
                                                                        
         /*BH55600M.GLSLUTÅR1 = '2018'*/ /* skal fjernes efter test */  
                                                                        
         DT = DATE;                                                     
         CALL INIT_INDK;                                                
                                                                        
         CALL OPSTART_INIT;                                             
                                                                        
         OPEN FILE (BQ235I)  TITLE ('BQ23500I');  /*RUL*/               
         OPEN FILE (BH3000O) TITLE ('BH30000O');                        
         OPEN FILE (BH3001O) TITLE ('BH30010O');                        
                                                                        
         CALL ZZ20390('*OPEN','BH30001Y');       /* ÅBEN KONTROLLISTE */
                                                                        
         LINIE = ZZWS3 !! ' KONTROL- & AFSTEMNINGSTOTAL FOR'            
                       !! ' UDTRÆK FRA EVS SLUT '                       
         /*#01*/       !! BH55600M.GLSLUTÅR1 !! ' DATO: '               
                       !!   DAT.DAG !! '.' !! DAT.MD !! '.' !! DAT.ÅR;  
                                                                        
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LINIE = ZZWS3 !! ' PROGRAMID: BH30000 ';                       
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LINIE = ZZWS2;                                                 
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         CALL ZS61900;                              /* KST/SSI INFO   */
                                                                        
         CALL ZS62500 (ZS625P1,                 /* SKAF JOB/STEP INFO */
                       ZS625P2,                                         
                       ZS625P3,                                         
                       ZS625P4);                                        
                                                                        
 /*********************************************************************/
 /* PROCES                                                            */
 /*********************************************************************/
         CALL DECLARE_CURSOR;                                           
         CALL OPEN_PERSONEJENDOMSOPL;                                   
         CALL FETCH_PERSONEJENDOMSOPL;                                  
                                                                        
         SELECT (FETCH_SQLKODE);  /*GEMT SQLCODE FRA FETCH_PERSONEJ. */ 
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               DO WHILE (FETCH_SQLKODE = 0);                            
                  CALL BEHANDL;                                         
                  CALL INIT_INDK;                                       
                  CALL FETCH_PERSONEJENDOMSOPL;                         
               END;                                                     
             END;                                                       
                                                                        
           WHEN (100)                                                   
               PUT SKIP LIST ('INGEN RÆKKER LÆST');                     
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST  = 'FETCH PERSON_CURSOR ';                     
               FEJLTEKST  = 'BH30000 ** 251 ' !! FEJLTEKST;             
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT */                                              
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /*********************************************************************/
 /* BEHANDL                                                    RUTINE */
 /*********************************************************************/
 BEHANDL: PROC;                                                         
                                                                        
         CALL INIT_INDK;                                                
         CALL SKAF_ELBNR;  /* D14 */                                    
         CALL FØRSTE_PERSONEJENDOMSOPL;                                 
         IF SQLCA.SQLCODE = 0                                           
         THEN                         /* LÆST LÆSTE RÆKKE OG I FØSTE */ 
            CALL GEM_FØRSTE;          /* DEL AF STRUKTUREN           */ 
                                                                        
         IF EVS_ESK.DTILGLD = '9999-12-31-23.59.59.999999'              
         THEN                                                           
            DO;                           /* FØRSTE = SIDSTE SÅ GEMMES*/
              FLAG_EN_RÆKKE = '1'B;       /* FØRSTE DEL AF STRUKTUREN */
              CALL GEM_SIDSTE_CHECK_SKRIV;/* RÆKKEN I SIDSTE DEL AF   */
                                          /* STURKTUREN               */
            END;                                                        
         ELSE                                                           
            DO;                                                         
              CALL INIT_INDK;                                           
              CALL SIDSTE_PERSONEJENDOMSOPL;                            
              IF SQLCA.SQLCODE = 0                                      
              THEN                                                      
                 DO;                                                    
                   CALL GEM_SIDSTE_CHECK_SKRIV;                         
                 END;                                                   
              ELSE                                                      
                 DO;                                                    
                   FLAG_EN_RÆKKE = '0'B;                                
                 END;                                                   
            END;                                                        
                                                                        
 END BEHANDL;                                                           
 /*********************************************************************/
 /* HER INDSÆTTES DATA I DEN FØRSTE DEL AF STUKTUR BH30000N           */
 /*********************************************************************/
 GEM_FØRSTE:  PROC;                                                     
 /*********************************************************************/
 /*      STAM/NØGLEDATA/FÆLLESDATA                                    */
 /*********************************************************************/
         IF TFLAG THEN PUT SKIP LIST('***** '!!PROCNAME!!' *****');     
         UDTRÆK_SLUT.DCPRN      = EVS_ESK.DCPRN;                        
         DCPRN_NGL              = UDTRÆK_SLUT.DCPRN;                    
         UDTRÆK_SLUT.EKOMNR     = EVS_ESK.EKOMNR;                       
         UDTRÆK_SLUT.EEJDNR     = EVS_ESK.EEJDNR;                       
         /* nye felter i slut 2018*/                                    
         UDTRÆK_SLUT.EENHEDLBNR  = EVS_ESK.EENHEDLBNR;                  
         UDTRÆK_SLUT.EJDBELIG    = EJENDOM.EJDBELIG;                    
         UDTRÆK_SLUT.VEJK_EJD    = EJENDOM.VEJK_EJD;                    
         UDTRÆK_SLUT.HUSNR_EJD   = EJENDOM.HUSNR_EJD;                   
         UDTRÆK_SLUT.ETAGE_EJD   = EJENDOM.ETAGE_EJD;                   
         UDTRÆK_SLUT.SDØR_EJD    = EJENDOM.SDØR_EJD;                    
         UDTRÆK_SLUT.ENHEDBELIG  = EJENDOM.ENHEDBELIG;                  
         UDTRÆK_SLUT.VEJK_ENHED  = EJENDOM.VEJK_ENHED;                  
         UDTRÆK_SLUT.HUSNR_ENHED = EJENDOM.HUSNR_ENHED;                 
         UDTRÆK_SLUT.ETAGE_ENHED = EJENDOM.ETAGE_ENHED;                 
         UDTRÆK_SLUT.SDØR_ENHED  = EJENDOM.SDØR_ENHED;                  
         /* nye felter i slut 2018 afsluttet*/                          
                                                                        
         UDTRÆK_SLUT.CLANDEKODE = EJENDOM.CLANDEKODE;                   
                                                                        
         KOM_NGL         = EVS_ESK.EKOMNR;                              
         EJD_NGL         = EVS_ESK.EEJDNR;                              
         EENHEDLBNR_NGL  = EVS_ESK.EENHEDLBNR; /*??*/                   
                                                                        
         UDTRÆK_SLUT.CFRATYPE   = '2';                                  
                                                                        
         IF PERSON.DAFSTAA ^= (10)' '                                   
         THEN                                                           
            UDTRÆK_SLUT.DSORTDAT1 = DB2_DATO_TIL_FIX09(PERSON.DAFSTAA); 
         ELSE                                                           
            UDTRÆK_SLUT.DSORTDAT1 = 99991231;                           
                                                                        
         IF PERSON.DOVTG ^= (10)' '                                     
         THEN                                                           
            UDTRÆK_SLUT.DSORTDAT2 = DB2_DATO_TIL_FIX09(PERSON.DOVTG);   
         ELSE                                                           
            UDTRÆK_SLUT.DSORTDAT2 = 0;                                  
                                                                        
         UDTRÆK_SLUT.CBENYT       = EJENDOM.CBENYT;                     
         UDTRÆK_SLUT.CEJBOLTYP1   = EJENDOM.CEJBOLTYP1;                 
         UDTRÆK_SLUT.CEJBOLTYP2   = EJENDOM.CEJBOLTYP2;                 
                                                                        
 /*******************************************************************/  
 /*    VARIABLE DATA FOR RÆKKE MED EGENNR = 1 OG HØJSTE ELBNR       */  
 /*******************************************************************/  
                                                                        
         UDTRÆK_SLUT.FØRSTE.ELBNR      = EVS_ESK.ELBNR;                 
         UDTRÆK_SLUT.FØRSTE.EGENNR     = EVS_ESK.EGENNR;                
         UDTRÆK_SLUT.FØRSTE.DFRAGLD    = EVS_ESK.DFRAGLD;               
         UDTRÆK_SLUT.FØRSTE.DTILGLD    = EVS_ESK.DTILGLD;               
         UDTRÆK_SLUT.FØRSTE.CDATAFRA   = EVS_ESK.CDATAFRA;              
         UDTRÆK_SLUT.FØRSTE.CAJOUR     = EVS_ESK.CAJOUR;                
         UDTRÆK_SLUT.FØRSTE.CSUPPL     = EVS_ESK.CSUPPL;                
         UDTRÆK_SLUT.FØRSTE.DHENVN     = PERSON.DHENVN;                 
         UDTRÆK_SLUT.FØRSTE.FEJLNR     = EVS_ESK.FEJLNR;    /*#101*/    
         UDTRÆK_SLUT.FØRSTE.CÆGTOPR    = PERSON.CÆGTOPR;                
         UDTRÆK_SLUT.FØRSTE.CSKPLOMF   = PERSON.CSKPLOMF;               
                                                                        
         IF PERSON.CEJBEVS ^= '6'             /* #SLUT2006 */           
          & PERSON.CEJBEVS ^= '7'                                       
          & PERSON.CEJBEVS ^= '8'                                       
          & PERSON.CEJBEVS ^= '9'                                       
          & (PERSON.CÆGTOPR = '1' !                                     
             PERSON.CÆGTOPR = '3' !                                     
             PERSON.CÆGTOPR = '4')                                      
          & PERSON.GPCTEJER = 0                                         
          & INDK_PERS.GPCTEJER_I = 0                                    
          & PERSON.CPCTEJER = '8'                                       
         THEN                                                           
            PERSON.CEJBEVS = '9';                                       
                                                                        
         UDTRÆK_SLUT.FØRSTE.CEJBEVS    = PERSON.CEJBEVS;                
         UDTRÆK_SLUT.FØRSTE.BPENSNED   = PERSON.BPENSNED;               
         UDTRÆK_SLUT.FØRSTE.BPENSNÆ    = PERSON.BPENSNÆ ;               
         UDTRÆK_SLUT.FØRSTE.CEJDTYPE   = EJENDOM.CEJDTYPE;              
         IF PERSON.CEJDTYPE_AKT > '0'                                   
         THEN                                                           
           UDTRÆK_SLUT.FØRSTE.CEJDTYPE   = PERSON.CEJDTYPE_AKT;         
         UDTRÆK_SLUT.FØRSTE.FELT760    = PERSON.FELT760;                
         UDTRÆK_SLUT.FØRSTE.CNEDSL1    = PERSON.CNEDSL1;                
                                                                        
         IF PERSON.DATO0107 ^= (10)' '                                  
         THEN                                                           
            UDTRÆK_SLUT.FØRSTE.DATO0107 =                               
            DB2_DATO_TIL_FIX09(PERSON.DATO0107);                        
         ELSE                                                           
            UDTRÆK_SLUT.FØRSTE.DATO0107 = 0;                            
                                                                        
         IF PERSON.DOVTG ^= (10)' '                                     
         THEN                                                           
            UDTRÆK_SLUT.FØRSTE.DOVTG =                                  
            DB2_DATO_TIL_FIX09(PERSON.DOVTG);                           
         ELSE                                                           
            UDTRÆK_SLUT.FØRSTE.DOVTG = 0;                               
                                                                        
         IF PERSON.DAFSTAA ^= (10)' '                                   
         THEN                                                           
            UDTRÆK_SLUT.FØRSTE.DAFSTAA =                                
            DB2_DATO_TIL_FIX09(PERSON.DAFSTAA);                         
         ELSE                                                           
            UDTRÆK_SLUT.FØRSTE.DAFSTAA = 0;                             
                                                                        
         IF PERSON.DINDFLYT ^= (10)' '                                  
         THEN                                                           
            UDTRÆK_SLUT.FØRSTE.DINDFLYT =                               
            DB2_DATO_TIL_FIX09(PERSON.DINDFLYT);                        
         ELSE                                                           
            UDTRÆK_SLUT.FØRSTE.DINDFLYT = 0;                            
                                                                        
         IF PERSON.DFRAFLYT ^= (10)' '                                  
         THEN                                                           
            UDTRÆK_SLUT.FØRSTE.DFRAFLYT =                               
            DB2_DATO_TIL_FIX09(PERSON.DFRAFLYT);                        
         ELSE                                                           
            UDTRÆK_SLUT.FØRSTE.DFRAFLYT = 0;                            
                                                                        
         UDTRÆK_SLUT.FØRSTE.CINDFLYT = PERSON.CINDFLYT;                 
                                                                        
         IF INDK_PERS.GPCTEJER_I = 0                                    
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.GPCTEJER = PERSON.GPCTEJER;           
               UDTRÆK_SLUT.FØRSTE.GPCTEJER_SW = 0;                      
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.GPCTEJER = 0;                         
               UDTRÆK_SLUT.FØRSTE.GPCTEJER_SW = -1;                     
            END;                                                        
                                                                        
         UDTRÆK_SLUT.FØRSTE.FDAGUDLE   = PERSON.FDAGUDLE;               
         UDTRÆK_SLUT.FØRSTE.GPCTUDLE   = PERSON.GPCTUDLE;               
         UDTRÆK_SLUT.FØRSTE.FUDL100    = PERSON.FUDL100;                
         UDTRÆK_SLUT.FØRSTE.FDAGERHV   = PERSON.FDAGERHV;               
         UDTRÆK_SLUT.FØRSTE.GPCTERHV   = PERSON.GPCTERHV;               
         UDTRÆK_SLUT.FØRSTE.FERHVFLER  = PERSON.FERHVFLER;              
         UDTRÆK_SLUT.FØRSTE.CBERGROP   = PERSON.CBERGROP;               
                                                                        
         UDTRÆK_SLUT.FØRSTE.CBERGRGLOP = '';        /*FORSKUD06*/       
                                                                        
         IF INDK_PERS.BBERGRL_015ANV_I = 0          /*FORSKUD06*/       
         &  EJENDOM.INDK.BBERGRL_01OM_I = 0                             
         &  EJENDOM.INDK.BBERGRL_01OMNY_I = 0                           
         &  INDK_PERS.BBERGRL_02ANV_I = 0                               
         &  EJENDOM.INDK.BBERGRL_02OM_I = 0                             
         &  EJENDOM.INDK.BBERGRL_02OMNY_I = 0                           
         &  (PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OM !             
             PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OMNY)            
         &  (PERSON.BBERGRL_02ANV  = EJENDOM.BBERGRL_02OM !             
             PERSON.BBERGRL_02ANV  = EJENDOM.BBERGRL_02OMNY)            
         THEN                                                           
            UDTRÆK_SLUT.FØRSTE.CBERGRGLOP = PERSON.CBERGRGLOP;          
                                                                        
         IF INDK_PERS.BBERGRL_015ANV_I = 0          /*FORSKUD06*/       
         &  EJENDOM.INDK.BBERGRL_01OM_I = 0                             
         &  EJENDOM.INDK.BBERGRL_01OMNY_I = 0                           
         &  INDK_PERS.BBERGRL_02ANV_I = 0                               
         &  EJENDOM.INDK.BBERGRL_02OM_I = -1                            
         &  EJENDOM.INDK.BBERGRL_02OMNY_I = -1                          
         &  (PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OM !             
             PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OMNY)            
         THEN                                                           
            UDTRÆK_SLUT.FØRSTE.CBERGRGLOP = PERSON.CBERGRGLOP;          
                                                                        
         IF INDK_PERS.BBERGRL_I = 0                                     
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BBERGRL = PERSON.BBERGRL;             
               UDTRÆK_SLUT.FØRSTE.BBERGRL_SW = 0;                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BBERGRL = 0;                          
               UDTRÆK_SLUT.FØRSTE.BBERGRL_SW = -1;                      
            END;                                                        
                                                                        
         IF INDK_PERS.BBER2FAM_I = 0                                    
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BBER2FAM = PERSON.BBER2FAM;           
               UDTRÆK_SLUT.FØRSTE.BBER2FAM_SW = 0;                      
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BBER2FAM = 0;                         
               UDTRÆK_SLUT.FØRSTE.BBER2FAM_SW = -1;                     
            END;                                                        
                                                                        
   /*    IF INDK_PERS.BBERGRLUDL_01_I = 0                               
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BBERGRLUDL_01 = PERSON.BBERGRLUDL_01; 
               UDTRÆK_SLUT.FØRSTE.BBERGRLUDL_01_SW = 0;                 
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BBERGRLUDL_01    = 0;                 
               UDTRÆK_SLUT.FØRSTE.BBERGRLUDL_01_SW = -1;                
            END;                                                        
                                                                        
         IF INDK_PERS.BOMBTILBUDL_01_I = 0                              
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BOMBTILBUDL_01 =                      
                 PERSON.BOMBTILBUDL_01;                                 
               UDTRÆK_SLUT.FØRSTE.BOMBTILBUDL_01_SW = 0;                
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BOMBTILBUDL_01    = 0;                
               UDTRÆK_SLUT.FØRSTE.BOMBTILBUDL_01_SW = -1;               
            END;                                           /*FORSKUD11*/
                                                                        
         IF INDK_PERS.BBERGRL_015ANV_I = 0                              
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBERGRL_015ANV = PERSON.BBERGRL_015ANV;
              UDTRÆK_SLUT.FØRSTE.BBERGRL_015ANV_SW = 0;                 
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBERGRL_015ANV    =  0;                
              UDTRÆK_SLUT.FØRSTE.BBERGRL_015ANV_SW = -1;                
            END;                                                        
                                                                        
         IF INDK_PERS.BBER2FAM_015ANV_I = 0                             
         THEN                                                           
            DO;                                                         
            UDTRÆK_SLUT.FØRSTE.BBER2FAM_015ANV = PERSON.BBER2FAM_015ANV;
            UDTRÆK_SLUT.FØRSTE.BBER2FAM_015ANV_SW = 0;                  
            END;                                                        
         ELSE                                                           
            DO;                                                         
             UDTRÆK_SLUT.FØRSTE.BBER2FAM_015ANV    =  0;                
             UDTRÆK_SLUT.FØRSTE.BBER2FAM_015ANV_SW = -1;                
            END;                                                        
                                                                        
         IF INDK_PERS.BBERGRL_02ANV_I = 0       /*FORSKUD06*/           
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBERGRL_02ANV = PERSON.BBERGRL_02ANV;  
              UDTRÆK_SLUT.FØRSTE.BBERGRL_02ANV_SW = 0;                  
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBERGRL_02ANV =  0;                    
              UDTRÆK_SLUT.FØRSTE.BBERGRL_02ANV_SW = -1;                 
            END;                                                        
                                                                        
         IF INDK_PERS.BBER2FAM_02ANV_I = 0            /*FORSKUD06*/     
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_02ANV = PERSON.BBER2FAM_02ANV;
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_02ANV_SW = 0;                 
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_02ANV    =  0;                
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_02ANV_SW = -1;                
            END;                                                        
                                                                        
         IF INDK_PERS.BBERGRL_AKT_I = 0                                 
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBERGRL_AKT = PERSON.BBERGRL_AKT;      
              UDTRÆK_SLUT.FØRSTE.BBERGRL_AKT_SW = 0;                    
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBERGRL_AKT = 0;                       
              UDTRÆK_SLUT.FØRSTE.BBERGRL_AKT_SW = -1;                   
            END;                                                        
                                                                        
         IF INDK_PERS.BBER2FAM_AKT_I = 0                                
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_AKT = PERSON.BBER2FAM_AKT;    
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_AKT_SW = 0;                   
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_AKT   =  0;                   
              UDTRÆK_SLUT.FØRSTE.BBER2FAM_AKT_SW = -1;                  
            END;                                                        
                                                                        
         UDTRÆK_SLUT.FØRSTE.BPROM1     = PERSON.BPROM1;                 
                                                                        
         IF INDK_PERS.BSUM1_I = 0        /*FORSKUD06*/                  
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BSUM1 = PERSON.BSUM1;                 
               UDTRÆK_SLUT.FØRSTE.BSUM1_SW = 0;                         
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BSUM1 = 0;                            
               UDTRÆK_SLUT.FØRSTE.BSUM1_SW = -1;                        
            END;                                                        
                                                                        
         IF INDK_PERS.BSUM3_I = 0        /*FORSKUD06*/                  
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BSUM3 = PERSON.BSUM3;                 
               UDTRÆK_SLUT.FØRSTE.BSUM3_SW = 0;                         
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BSUM3 = 0;                            
               UDTRÆK_SLUT.FØRSTE.BSUM3_SW = -1;                        
            END;                                                        
                                                                        
         IF PERSON.CEJBEVS = '0' ! PERSON.CEJBEVS = '4' !               
            PERSON.CEJBEVS = '5'                                        
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BNETTO    = PERSON.BNETTO;            
               UDTRÆK_SLUT.FØRSTE.BNETTO_SW = 0;                        
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BNETTO    = 0;                        
               UDTRÆK_SLUT.FØRSTE.BNETTO_SW =-1;                        
            END;                                                        
                                                                        
         UDTRÆK_SLUT.FØRSTE.CSTIBLB    = PERSON.CSTIBLB;                
         UDTRÆK_SLUT.FØRSTE.BSTIBEGR   = PERSON.BSTIBEGR;               
                                                                        
         IF INDK_PERS.BFASTSTIGBGR_I = 0                                
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BFASTSTIGBGR = PERSON.BFASTSTIGBGR;   
               UDTRÆK_SLUT.FØRSTE.BFASTSTIGBGR_SW = 0;                  
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BFASTSTIGBGR    = 0;                  
               UDTRÆK_SLUT.FØRSTE.BFASTSTIGBGR_SW =-1;                  
            END;                                                        
                                                                        
         UDTRÆK_SLUT.FØRSTE.BEJERAN    = 0;                             
         UDTRÆK_SLUT.FØRSTE.BEJERAN_SW =-1;                             
                                                                        
         IF INDK_PERS.BEVSMAN_I = 0                                     
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BEVSMAN = PERSON.BEVSMAN;             
               UDTRÆK_SLUT.FØRSTE.BEVSMAN_SW = 0;                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BEVSMAN = 0;                          
               UDTRÆK_SLUT.FØRSTE.BEVSMAN_SW = -1;                      
            END;                                                        
                                                                        
         IF INDK_PERS.BMANEVSSTI_I = 0                                  
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BMANEVSSTI    = PERSON.BMANEVSSTI;     
              UDTRÆK_SLUT.FØRSTE.BMANEVSSTI_SW = 0;                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.BMANEVSSTI    = 0;                     
              UDTRÆK_SLUT.FØRSTE.BMANEVSSTI_SW = -1;                    
            END;                                                        
                                                                        
         UDTRÆK_SLUT.FØRSTE.BMANNEDSL   = PERSON.BMANNEDSL;             
                                                                        
         IF INDK_PERS.MANNEDSLSTI_I = 0                                 
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.MANNEDSLSTI = PERSON.MANNEDSLSTI;      
              UDTRÆK_SLUT.FØRSTE.MANNEDSLSTI_SW = 0;                    
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.MANNEDSLSTI    = 0;                    
              UDTRÆK_SLUT.FØRSTE.MANNEDSLSTI_SW = -1;                   
            END;                                                        
                                                                        
         IF INDK_PERS.MANPENSSTI_I = 0                                  
         THEN                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.MANPENSSTI = PERSON.MANPENSSTI;        
              UDTRÆK_SLUT.FØRSTE.MANPENSSTI_SW = 0;                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
              UDTRÆK_SLUT.FØRSTE.MANPENSSTI = 0;                        
              UDTRÆK_SLUT.FØRSTE.MANPENSSTI_SW = -1;                    
            END;                                                        
                                                                        
         UDTRÆK_SLUT.FØRSTE.CENKE       = PERSON.CENKE;                 
         UDTRÆK_SLUT.FØRSTE.CENKEBOH    = PERSON.CENKEBOH;              
         UDTRÆK_SLUT.FØRSTE.BOBEHAKOD   = PERSON.BOBEHAKOD;             
         UDTRÆK_SLUT.FØRSTE.CIVILSTAND  = PERSON.CIVILSTAND;            
         UDTRÆK_SLUT.FØRSTE.CSLET       = PERSON.CSLET;                 
                                                                        
         IF INDK_PERS.BEJBOL1_I = 0                                     
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BEJBOL1 = PERSON.BEJBOL1;             
               UDTRÆK_SLUT.FØRSTE.BEJBOL1_SW = 0;                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BEJBOL1 = 0;                          
               UDTRÆK_SLUT.FØRSTE.BEJBOL1_SW = -1;                      
            END;                                                        
                                                                        
         IF INDK_PERS.BEJBOL2_I = 0                                     
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BEJBOL2 = PERSON.BEJBOL2;             
               UDTRÆK_SLUT.FØRSTE.BEJBOL2_SW = 0;                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BEJBOL2 = 0;                          
               UDTRÆK_SLUT.FØRSTE.BEJBOL2_SW = -1;                      
            END;                                                        
                                                                        
         IF PERSON.CANVEBOL = ' '                                       
          & INDK_PERS.BPROM1_I = 0                                      
          & EJENDOM.INDK.BEJBOL2_AKT_I = 0                              
          & EJENDOM.BEJBOL1_AKT ^= EJENDOM.BEJBOL2_AKT                  
         THEN                                                           
            DO;                                                         
              IF PERSON.BBERGRL_AKT = PERSON.BEJBOL1_AKT                
              THEN                                                      
                 PERSON.CANVEBOL = '1';                                 
              ELSE                                                      
              IF PERSON.BBERGRL_AKT = PERSON.BEJBOL2_AKT                
              THEN                                                      
                 PERSON.CANVEBOL = '2';                                 
            END;                                                        
                                                                        
         UDTRÆK_SLUT.FØRSTE.CANVEBOL   = PERSON.CANVEBOL;               
         UDTRÆK_SLUT.FØRSTE.CPTYPSLUT  = PERSON.CPTYPSLUT;              
         UDTRÆK_SLUT.FØRSTE.FELT759    = PERSON.FELT759;                
         UDTRÆK_SLUT.FØRSTE.CEKSEMP    = PERSON.CEKSEMP; /*#SLUT07*/    
         UDTRÆK_SLUT.FØRSTE.CFRÅR      = PERSON.CFRÅR;                  
         UDTRÆK_SLUT.FØRSTE.COMPLA     = EVS_ESK.COMPLA;                
         UDTRÆK_SLUT.FØRSTE.DOMPLACPR  = EVS_ESK.DOMPLACPR;             
                                                                        
         IF INDK_PERS.BUDLSKC_I = 0        /*FORSKUD10*/                
         THEN                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BUDLSKC    = PERSON.BUDLSKC;          
               UDTRÆK_SLUT.FØRSTE.BUDLSKC_SW = 0;                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               UDTRÆK_SLUT.FØRSTE.BUDLSKC    = 0;                       
               UDTRÆK_SLUT.FØRSTE.BUDLSKC_SW = -1;                      
            END;                                                        
                                                                        
                                                                        
         CALL OPSÆT_GL_INDKOMSTÅR (UDTRÆK_SLUT.FØRSTE.CFRÅR,            
                                   UDTRÆK_SLUT.FØRSTE.DRGNÅRFRA,        
                                   UDTRÆK_SLUT.FØRSTE.DRGNÅRTIL);       
                                                                        
                                                                        
         PERSON            = ''; /* MED DE NYE TABELLER SKAL VI */      
         EJENDOM           = ''; /* NULSTILLE FØR DEN NÆSTE     */      
         RESULTAT          = ''; /* LÆSNING                     */      
         EVS_RES           = '';                                        
                                                                        
 END GEM_FØRSTE;                                                        
 /*********************************************************************/
 /* HER INDSÆTTES DATA I DEN SIDSTE DEL AF STUKTUR BH30000N           */
 /*********************************************************************/
 GEM_SIDSTE_CHECK_SKRIV: PROC;                                          
 /*******************************************************************/  
 /*    VARIABLE DATA FOR RÆKKE MED HØJESTE DTILGLD OG HØJESTE ELBNR */  
 /*******************************************************************/  
         IF TFLAG THEN PUT SKIP LIST('***** '!!PROCNAME!!' *****');     
         IF FLAG_EN_RÆKKE = '1'B                                        
         THEN                                                           
           DO;                                                          
             UDTRÆK_SLUT.SIDSTE = UDTRÆK_SLUT.FØRSTE;                   
             CALL SKAF_BEJERAN;                                         
                                                                        
             IF INDK_RES.BEJERAN_SW = 0   /* CHEK OM FUNDET */          
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJERAN    = RESULTAT.BEJERAN;    
                   UDTRÆK_SLUT.SIDSTE.BEJERAN_SW = 0;                   
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJERAN    = 0;                   
                   UDTRÆK_SLUT.SIDSTE.BEJERAN_SW =-1;                   
                END;                                                    
           END;                                                         
         ELSE                                                           
           DO;                                                          
             UDTRÆK_SLUT.SIDSTE.ELBNR      = EVS_ESK.ELBNR;             
             UDTRÆK_SLUT.SIDSTE.EGENNR     = EVS_ESK.EGENNR;            
             UDTRÆK_SLUT.SIDSTE.DFRAGLD    = EVS_ESK.DFRAGLD;           
             UDTRÆK_SLUT.SIDSTE.DTILGLD    = EVS_ESK.DTILGLD;           
             UDTRÆK_SLUT.SIDSTE.CDATAFRA   = EVS_ESK.CDATAFRA;          
             UDTRÆK_SLUT.SIDSTE.CAJOUR     = EVS_ESK.CAJOUR;            
             UDTRÆK_SLUT.SIDSTE.CSUPPL     = EVS_ESK.CSUPPL;            
             UDTRÆK_SLUT.SIDSTE.DHENVN     = PERSON.DHENVN;             
             UDTRÆK_SLUT.SIDSTE.FEJLNR     = EVS_ESK.FEJLNR; /*#101*/   
             UDTRÆK_SLUT.SIDSTE.CÆGTOPR    = PERSON.CÆGTOPR;            
             UDTRÆK_SLUT.SIDSTE.CSKPLOMF   = PERSON.CSKPLOMF;           
                                                                        
             IF PERSON.CEJBEVS ^= '6'             /* #SLUT2006 */       
              & PERSON.CEJBEVS ^= '7'                                   
              & PERSON.CEJBEVS ^= '8'                                   
              & PERSON.CEJBEVS ^= '9'                                   
              & (PERSON.CÆGTOPR = '1' !                                 
                 PERSON.CÆGTOPR = '3' !                                 
                 PERSON.CÆGTOPR = '4')                                  
              & INDK_PERS.GPCTEJER_I = 0                                
              & PERSON.GPCTEJER = 0                                     
              & PERSON.CPCTEJER = '8'                                   
             THEN                                                       
                PERSON.CEJBEVS = '9';                                   
                                                                        
             UDTRÆK_SLUT.SIDSTE.CEJBEVS    = PERSON.CEJBEVS;            
             UDTRÆK_SLUT.SIDSTE.BPENSNED   = PERSON.BPENSNED;           
             UDTRÆK_SLUT.SIDSTE.BPENSNÆ    = PERSON.BPENSNÆ ;           
             UDTRÆK_SLUT.SIDSTE.CEJDTYPE   = EJENDOM.CEJDTYPE;          
             IF PERSON.CEJDTYPE_AKT > '0'                               
             THEN                                                       
               UDTRÆK_SLUT.SIDSTE.CEJDTYPE = PERSON.CEJDTYPE_AKT;       
             UDTRÆK_SLUT.SIDSTE.FELT760    = PERSON.FELT760;            
             UDTRÆK_SLUT.SIDSTE.CNEDSL1    = PERSON.CNEDSL1;            
                                                                        
             IF PERSON.DATO0107 ^= (10)' '                              
             THEN                                                       
                UDTRÆK_SLUT.SIDSTE.DATO0107 =                           
                DB2_DATO_TIL_FIX09(PERSON.DATO0107);                    
             ELSE                                                       
                UDTRÆK_SLUT.SIDSTE.DATO0107 = 0;                        
                                                                        
             IF PERSON.DOVTG ^= (10)' '                                 
             THEN                                                       
                UDTRÆK_SLUT.SIDSTE.DOVTG =                              
                DB2_DATO_TIL_FIX09(PERSON.DOVTG);                       
             ELSE                                                       
                UDTRÆK_SLUT.SIDSTE.DOVTG = 0;                           
                                                                        
             IF PERSON.DAFSTAA ^= (10)' '                               
             THEN                                                       
                UDTRÆK_SLUT.SIDSTE.DAFSTAA =                            
                DB2_DATO_TIL_FIX09(PERSON.DAFSTAA);                     
             ELSE                                                       
                UDTRÆK_SLUT.SIDSTE.DAFSTAA = 0;                         
                                                                        
             IF PERSON.DINDFLYT ^= (10)' '                              
             THEN                                                       
                UDTRÆK_SLUT.SIDSTE.DINDFLYT =                           
                DB2_DATO_TIL_FIX09(PERSON.DINDFLYT);                    
             ELSE                                                       
                UDTRÆK_SLUT.SIDSTE.DINDFLYT = 0;                        
                                                                        
             IF PERSON.DFRAFLYT ^= (10)' '                              
             THEN                                                       
                UDTRÆK_SLUT.SIDSTE.DFRAFLYT =                           
                DB2_DATO_TIL_FIX09(PERSON.DFRAFLYT);                    
             ELSE                                                       
                UDTRÆK_SLUT.SIDSTE.DFRAFLYT = 0;                        
                                                                        
             UDTRÆK_SLUT.SIDSTE.CINDFLYT = PERSON.CINDFLYT;             
                                                                        
             IF INDK_PERS.GPCTEJER_I = 0                                
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.GPCTEJER = PERSON.GPCTEJER;         
                 UDTRÆK_SLUT.SIDSTE.GPCTEJER_SW = 0;                    
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.GPCTEJER = 0;                       
                 UDTRÆK_SLUT.SIDSTE.GPCTEJER_SW = -1;                   
               END;                                                     
                                                                        
             UDTRÆK_SLUT.SIDSTE.FDAGUDLE   = PERSON.FDAGUDLE;           
             UDTRÆK_SLUT.SIDSTE.GPCTUDLE   = PERSON.GPCTUDLE;           
             UDTRÆK_SLUT.SIDSTE.FUDL100    = PERSON.FUDL100;            
             UDTRÆK_SLUT.SIDSTE.FDAGERHV   = PERSON.FDAGERHV;           
             UDTRÆK_SLUT.SIDSTE.GPCTERHV   = PERSON.GPCTERHV;           
             UDTRÆK_SLUT.SIDSTE.FERHVFLER  = PERSON.FERHVFLER;          
             UDTRÆK_SLUT.SIDSTE.CBERGROP   = PERSON.CBERGROP;           
                                                                        
             UDTRÆK_SLUT.SIDSTE.CBERGRGLOP = '';   /*FORSKUD06*/        
                                                                        
             IF INDK_PERS.BBERGRL_015ANV_I = 0     /*FORSKUD06*/        
             & EJENDOM.INDK.BBERGRL_01OM_I = 0                          
             & EJENDOM.INDK.BBERGRL_01OMNY_I = 0                        
             & INDK_PERS.BBERGRL_02ANV_I = 0                            
             & EJENDOM.INDK.BBERGRL_02OM_I = 0                          
             & EJENDOM.INDK.BBERGRL_02OMNY_I = 0                        
             & (PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OM !          
                 PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OMNY)        
             & (PERSON.BBERGRL_02ANV = EJENDOM.BBERGRL_02OM !           
                 PERSON.BBERGRL_02ANV = EJENDOM.BBERGRL_02OMNY)         
             THEN                                                       
                UDTRÆK_SLUT.SIDSTE.CBERGRGLOP = PERSON.CBERGRGLOP;      
                                                                        
             IF INDK_PERS.BBERGRL_015ANV_I = 0     /*FORSKUD06*/        
             & EJENDOM.INDK.BBERGRL_01OM_I = 0                          
             & EJENDOM.INDK.BBERGRL_01OMNY_I = 0                        
             & INDK_PERS.BBERGRL_02ANV_I = 0                            
             & EJENDOM.INDK.BBERGRL_02OM_I = -1                         
             & EJENDOM.INDK.BBERGRL_02OMNY_I = -1                       
             & (PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OM !          
                PERSON.BBERGRL_015ANV = EJENDOM.BBERGRL_01OMNY)         
             THEN                                                       
                 UDTRÆK_SLUT.SIDSTE.CBERGRGLOP = PERSON.CBERGRGLOP;     
                                                                        
             IF INDK_PERS.BBERGRL_I = 0                                 
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRL = PERSON.BBERGRL;           
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_SW = 0;                     
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRL = 0;                        
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_SW = -1;                    
               END;                                                     
                                                                        
             IF INDK_PERS.BBER2FAM_I = 0                                
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM = PERSON.BBER2FAM;         
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_SW = 0;                    
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM = 0;                       
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_SW = -1;                   
               END;                                                     
                                                                        
      /*     IF INDK_PERS.BBERGRLUDL_01_I = 0                           
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRLUDL_01 =                     
                                               PERSON.BBERGRLUDL_01;    
                 UDTRÆK_SLUT.SIDSTE.BBERGRLUDL_01_SW = 0;               
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRLUDL_01    = 0;               
                 UDTRÆK_SLUT.SIDSTE.BBERGRLUDL_01_SW = -1;              
               END;                                                     
                                                                        
             IF INDK_PERS.BOMBTILBUDL_01_I = 0                          
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BOMBTILBUDL_01 =                    
                   PERSON.BOMBTILBUDL_01;                               
                 UDTRÆK_SLUT.SIDSTE.BOMBTILBUDL_01_SW = 0;              
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BOMBTILBUDL_01    = 0;              
                 UDTRÆK_SLUT.SIDSTE.BOMBTILBUDL_01_SW = -1;             
               END;                                        /*FORSKUD11*/
                                                                        
             IF INDK_PERS.BBERGRL_015ANV_I = 0                          
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_015ANV =                    
                                              PERSON.BBERGRL_015ANV;    
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_015ANV_SW = 0;              
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_015ANV    =  0;             
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_015ANV_SW = -1;             
               END;                                                     
                                                                        
             IF INDK_PERS.BBER2FAM_015ANV_I = 0                         
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_015ANV =                   
                                            PERSON.BBER2FAM_015ANV;     
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_015ANV_SW = 0;             
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_015ANV    =  0;            
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_015ANV_SW = -1;            
               END;                                                     
                                                                        
             IF INDK_PERS.BBERGRL_02ANV_I = 0        /*FORSKUD06*/      
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_02ANV =                     
                                       PERSON.BBERGRL_02ANV;            
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_02ANV_SW = 0;               
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_02ANV =  0;                 
                 UDTRÆK_SLUT.SIDSTE.BBERGRL_02ANV_SW = -1;              
               END;                                                     
                                                                        
             IF INDK_PERS.BBER2FAM_02ANV_I = 0      /*FORSKUD06*/       
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_02ANV                      
                           = PERSON.BBER2FAM_02ANV;                     
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_02ANV_SW = 0;              
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_02ANV    =  0;             
                 UDTRÆK_SLUT.SIDSTE.BBER2FAM_02ANV_SW = -1;             
               END;                                                     
                                                                        
             IF INDK_PERS.BBERGRL_AKT_I = 0                             
             THEN                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BBERGRL_AKT = PERSON.BBERGRL_AKT;  
                  UDTRÆK_SLUT.SIDSTE.BBERGRL_AKT_SW = 0;                
                END;                                                    
             ELSE                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BBERGRL_AKT = 0;                   
                  UDTRÆK_SLUT.SIDSTE.BBERGRL_AKT_SW = -1;               
                END;                                                    
                                                                        
             IF INDK_PERS.BBER2FAM_AKT_I = 0                            
             THEN                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BBER2FAM_AKT = PERSON.BBER2FAM_AKT;
                  UDTRÆK_SLUT.SIDSTE.BBER2FAM_AKT_SW = 0;               
                END;                                                    
             ELSE                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BBER2FAM_AKT = 0;                  
                  UDTRÆK_SLUT.SIDSTE.BBER2FAM_AKT_SW = -1;              
                END;                                                    
                                                                        
             UDTRÆK_SLUT.SIDSTE.BPROM1     = PERSON.BPROM1;             
                                                                        
             IF INDK_PERS.BSUM1_I = 0    /*SLUT06*/                     
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BSUM1 = PERSON.BSUM1;             
                   UDTRÆK_SLUT.SIDSTE.BSUM1_SW = 0;                     
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BSUM1 = 0;                        
                   UDTRÆK_SLUT.SIDSTE.BSUM1_SW = -1;                    
                END;                                                    
                                                                        
             IF INDK_PERS.BSUM3_I = 0    /*SLUT06*/                     
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BSUM3 = PERSON.BSUM3;             
                   UDTRÆK_SLUT.SIDSTE.BSUM3_SW = 0;                     
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BSUM3 = 0;                        
                   UDTRÆK_SLUT.SIDSTE.BSUM3_SW = -1;                    
                END;                                                    
                                                                        
             IF PERSON.CEJBEVS = '0' ! PERSON.CEJBEVS = '4' !           
                PERSON.CEJBEVS = '5'                                    
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BNETTO    = PERSON.BNETTO;        
                   UDTRÆK_SLUT.SIDSTE.BNETTO_SW = 0;                    
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BNETTO    = 0;                    
                   UDTRÆK_SLUT.SIDSTE.BNETTO_SW =-1;                    
                END;                                                    
                                                                        
             IF INDK_PERS.BFASTSTIGBGR_I = 0                            
             THEN                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BFASTSTIGBGR = PERSON.BFASTSTIGBGR;
                  UDTRÆK_SLUT.SIDSTE.BFASTSTIGBGR_SW = 0;               
                END;                                                    
             ELSE                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BFASTSTIGBGR = 0;                  
                  UDTRÆK_SLUT.SIDSTE.BFASTSTIGBGR_SW =-1;               
                END;                                                    
                                                                        
             UDTRÆK_SLUT.SIDSTE.CSTIBLB    = PERSON.CSTIBLB;            
             UDTRÆK_SLUT.SIDSTE.BSTIBEGR   = PERSON.BSTIBEGR;           
                                                                        
             CALL SKAF_BEJERAN;                                         
             IF INDK_RES.BEJERAN_SW = 0   /* CHEK OM FUNDET */          
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJERAN    = RESULTAT.BEJERAN;    
                   UDTRÆK_SLUT.SIDSTE.BEJERAN_SW = 0;                   
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJERAN    = 0;                   
                   UDTRÆK_SLUT.SIDSTE.BEJERAN_SW =-1;                   
                END;                                                    
                                                                        
             IF INDK_PERS.BEVSMAN_I = 0                                 
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEVSMAN = PERSON.BEVSMAN;         
                   UDTRÆK_SLUT.SIDSTE.BEVSMAN_SW = 0;                   
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEVSMAN = 0;                      
                   UDTRÆK_SLUT.SIDSTE.BEVSMAN_SW = -1;                  
                END;                                                    
                                                                        
             IF INDK_PERS.BMANEVSSTI_I = 0                              
             THEN                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BMANEVSSTI = PERSON.BMANEVSSTI;    
                  UDTRÆK_SLUT.SIDSTE.BMANEVSSTI_SW = 0;                 
                END;                                                    
             ELSE                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.BMANEVSSTI    = 0;                 
                  UDTRÆK_SLUT.SIDSTE.BMANEVSSTI_SW = -1;                
                END;                                                    
                                                                        
             UDTRÆK_SLUT.SIDSTE.BMANNEDSL  = PERSON.BMANNEDSL;          
                                                                        
             IF INDK_PERS.MANNEDSLSTI_I = 0                             
             THEN                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.MANNEDSLSTI = PERSON.MANNEDSLSTI;   
                 UDTRÆK_SLUT.SIDSTE.MANNEDSLSTI_SW = 0;                 
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 UDTRÆK_SLUT.SIDSTE.MANNEDSLSTI    = 0;                 
                 UDTRÆK_SLUT.SIDSTE.MANNEDSLSTI_SW = -1;                
               END;                                                     
                                                                        
             IF INDK_PERS.MANPENSSTI_I = 0                              
             THEN                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.MANPENSSTI = PERSON.MANPENSSTI;    
                  UDTRÆK_SLUT.SIDSTE.MANPENSSTI_SW = 0;                 
                END;                                                    
             ELSE                                                       
                DO;                                                     
                  UDTRÆK_SLUT.SIDSTE.MANPENSSTI = 0;                    
                  UDTRÆK_SLUT.SIDSTE.MANPENSSTI_SW = -1;                
                END;                                                    
                                                                        
             UDTRÆK_SLUT.SIDSTE.CENKE      = PERSON.CENKE;              
             UDTRÆK_SLUT.SIDSTE.CENKEBOH   = PERSON.CENKEBOH;           
             UDTRÆK_SLUT.SIDSTE.BOBEHAKOD  = PERSON.BOBEHAKOD;          
             UDTRÆK_SLUT.SIDSTE.CIVILSTAND = PERSON.CIVILSTAND;         
             UDTRÆK_SLUT.SIDSTE.CSLET      = PERSON.CSLET;              
                                                                        
             IF INDK_PERS.BEJBOL1_I = 0                                 
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJBOL1 = PERSON.BEJBOL1;         
                   UDTRÆK_SLUT.SIDSTE.BEJBOL1_SW = 0;                   
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJBOL1 = 0;                      
                   UDTRÆK_SLUT.SIDSTE.BEJBOL1_SW = -1;                  
                END;                                                    
                                                                        
             IF INDK_PERS.BEJBOL2_I = 0                                 
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJBOL2 = PERSON.BEJBOL2;         
                   UDTRÆK_SLUT.SIDSTE.BEJBOL2_SW = 0;                   
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BEJBOL2 = 0;                      
                   UDTRÆK_SLUT.SIDSTE.BEJBOL2_SW = -1;                  
                END;                                                    
                                                                        
             IF PERSON.CANVEBOL = ' '                                   
              & INDK_PERS.BPROM1_I = 0                                  
              & EJENDOM.INDK.BEJBOL2_AKT_I = 0                          
              & EJENDOM.BEJBOL1_AKT ^= EJENDOM.BEJBOL2_AKT              
             THEN                                                       
                DO;                                                     
                  IF PERSON.BBERGRL_AKT = PERSON.BEJBOL1_AKT            
                  THEN                                                  
                     PERSON.CANVEBOL = '1';                             
                  ELSE                                                  
                  IF PERSON.BBERGRL_AKT = PERSON.BEJBOL2_AKT            
                  THEN                                                  
                     PERSON.CANVEBOL = '2';                             
                END;                                                    
                                                                        
             UDTRÆK_SLUT.SIDSTE.CANVEBOL   = PERSON.CANVEBOL;           
             UDTRÆK_SLUT.SIDSTE.CPTYPSLUT  = PERSON.CPTYPSLUT;          
             UDTRÆK_SLUT.SIDSTE.FELT759    = PERSON.FELT759;            
             UDTRÆK_SLUT.SIDSTE.CEKSEMP    = PERSON.CEKSEMP; /*#SLUT07*/
             UDTRÆK_SLUT.SIDSTE.CFRÅR      = PERSON.CFRÅR;              
             UDTRÆK_SLUT.SIDSTE.COMPLA     = EVS_ESK.COMPLA;            
             UDTRÆK_SLUT.SIDSTE.DOMPLACPR  = EVS_ESK.DOMPLACPR;         
                                                                        
             //Defekt 2416 - start                                      
             IF UDTRÆK_SLUT.EKOMNR      = 999                           
              & UDTRÆK_SLUT.CLANDEKODE  = 'FR'                          
             THEN DO;                                                   
                IF UDTRÆK_SLUT.SIDSTE.CEKSEMP = '1'                     
                THEN                                                    
                   UDTRÆK_SLUT.CLANDEKODE = 'F1';                       
                IF UDTRÆK_SLUT.SIDSTE.CEKSEMP = '2'                     
                THEN                                                    
                   UDTRÆK_SLUT.CLANDEKODE = 'F2';                       
                END;                                                    
              //Defekt 2416 - slut                                      
                                                                        
             IF INDK_PERS.BUDLSKC_I = 0        /*FORSKUD10*/            
             THEN                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BUDLSKC    = PERSON.BUDLSKC;      
                   UDTRÆK_SLUT.SIDSTE.BUDLSKC_SW = 0;                   
                END;                                                    
             ELSE                                                       
                DO;                                                     
                   UDTRÆK_SLUT.SIDSTE.BUDLSKC    = 0;                   
                   UDTRÆK_SLUT.SIDSTE.BUDLSKC_SW = -1;                  
             END;                                                       
                                                                        
             CALL OPSÆT_GL_INDKOMSTÅR (UDTRÆK_SLUT.SIDSTE.CFRÅR,        
                                       UDTRÆK_SLUT.SIDSTE.DRGNÅRFRA,    
                                       UDTRÆK_SLUT.SIDSTE.DRGNÅRTIL);   
           END;                                                         
                                                                        
         PERSON            = ''; /* MED DE NYE TABELLER SKAL VI */      
         EJENDOM           = ''; /* NULSTILLE FØR DEN NÆSTE     */      
         RESULTAT          = ''; /* LÆSNING                     */      
         EVS_ESK           = '';                                        
         EVS_RES           = '';                                        
                                                                        
         FLAG_EN_RÆKKE = '0'B;                                          
                                                                        
 /*******************************************************************/  
 /*    CHECK FOR FORKERTE EJENDOMSNUMMER                            */  
 /*******************************************************************/  
                                                                        
         IF (UDTRÆK_SLUT.SIDSTE.COMPLA = '1')                           
         THEN                                                           
            DO;                                                         
               ANTOMPLACERET = ANTOMPLACERET + 1;                       
               RETURN;                                                  
            END;                                                        
                                                                        
         IF (UDTRÆK_SLUT.EEJDNR = 0)                                    
         THEN                                                           
            DO;                                                         
               ANTEJDNR_EEJDNR_0 = ANTEJDNR_EEJDNR_0 + 1;               
               RETURN;                                                  
            END;                                                        
                                                                        
         IF UDTRÆK_SLUT.EKOMNR ^= 999        &     /*FORSKUD09*/        
            UDTRÆK_SLUT.SIDSTE.CEJBEVS = '9' &                          
            UDTRÆK_SLUT.FØRSTE.CÆGTOPR < '1' &                          
            UDTRÆK_SLUT.SIDSTE.CÆGTOPR < '1' &                          
            UDTRÆK_SLUT.SIDSTE.CINDFLYT < '1'                           
         THEN                                                           
            DO;                                                         
               ANTCEJBEVS_9 = ANTCEJBEVS_9 + 1;                         
               RETURN;                                                  
            END;                                                        
                                                                        
         /* Fra Forskud 2017 skal slettede ejendomme  */                
         /* ikke indgå i oprettelsen KS30-01          */                
         /* Defect 248 udlandske skrives så de senere */                
         /* kan afgører om data fra EVS SLUT/Forskud  */                
         /* skal bruges                               */                
         /* Slut 2019 danske med  CSLET = 1 skrives   */                
                                                                        
         IF UDTRÆK_SLUT.SIDSTE.CSLET = '1'                              
         THEN                                                           
           DO;                                                          
             ANTCSLET_1 = ANTCSLET_1 + 1;                               
           END;                                                         
                                                                        
 /*********************************************************************/
 /* UDSKRIVNING                                                       */
 /*********************************************************************/
         IF UDTRÆK_SLUT.EKOMNR ^= 999 THEN                              
           DO;                                                          
             ANTSKRIV_PERSON = ANTSKRIV_PERSON + 1;                     
                                                                        
             WRITE FILE (BH3000O) FROM (UDTRÆK_SLUT);                   
             ANTSKRIV_ØVR = ANTSKRIV_ØVR + 1;                           
           END;                                                         
         ELSE                                                           
           DO;                                                          
             /* XJY 25.10.2024 ÆA73: Ret udenlandske ejendomsnumre. */  
             /* Ved slettemarkerede ejendomsnumre skrives de ikke   */  
             /* til output filen.                                   */  
             IF RET_UDENL_EJDNR (UDTRÆK_SLUT.EKOMNR,                    
                                 UDTRÆK_SLUT.EEJDNR,                    
                                 UDTRÆK_SLUT.DCPRN) THEN                
             DO;                                                        
                ANTSKRIV_PERSON = ANTSKRIV_PERSON + 1;                  
                                                                        
                WRITE FILE (BH3001O) FROM (UDTRÆK_SLUT);                
                ANTSKRIV_UDL = ANTSKRIV_UDL + 1;                        
                                                                        
                ANT_ÆA73_SKREVNE += 1;                                  
             END;                                                       
             ELSE                                                       
             DO;                                                        
                ANT_ÆA73_EJ_SKREVNE += 1;                               
             END;                                                       
           END;                                                         
                                                                        
 END GEM_SIDSTE_CHECK_SKRIV;                                            
                                                                        
 /*********************************************************************/
 /* Ret de udenlandske ejendomsnumre på baggrund af ændringsanmodning */
 /* ÆA73.                                                             */
 /*                                                                   */
 /* Proceduren returnerer en bit værdi som indikerer, om der skal     */
 /* skrives en record på output filen:                                */
 /* 1/true  = Der skal skrives en record                              */
 /* 0/false = Der skal ikke skrives en record, da mapningen er        */
 /*           slettemarkeret.                                         */
 /*********************************************************************/
 RET_UDENL_EJDNR: PROC (P_EKOMNR                                        
                       ,P_EEJDNR                                        
                       ,P_DCPRN) RETURNS(BIT(1));                       
                                                                        
 DCL P_EKOMNR                       BIN FIXED (15) UNAL;                
 DCL P_EEJDNR                       BIN FIXED (31) UNAL;                
 DCL P_DCPRN                        DEC FIXED (11);                     
                                                                        
 DCL NYT_EEJDNR                     BIN FIXED (31);                     
 DCL SLET_MARK                      CHAR(1);                            
                                                                        
                                                                        
    ANT_ÆA73_TJEKKET += 1;                                              
                                                                        
    /* Tjek om der findes mapning på ejendomsnummeret */                
    IF FINDES_UDENL_EJD_MAPNING (BH55600M.TIL_EVS_AAR                   
                                ,BH55600M.AFVIKLINGS_ID                 
                                ,BH55600M.DATA_ID                       
                                ,(P_EKOMNR)                             
                                ,(P_EEJDNR)                             
                                ,NYT_EEJDNR                             
                                ,SLET_MARK) THEN                        
    DO;                                                                 
       ANT_ÆA73_MAPPET += 1;                                            
                                                                        
       /* Tjek om mapningen indeholder slettemarkering */               
       IF SLET_MARK = '0' THEN                                          
       DO;                                                              
          /* Tjek om der mappes fra og til samme ejendomsnummer  */     
          /* hvilket blot er en bevarelse af det aktuelle        */     
          /* ejendomsnummer.                                     */     
          IF P_EEJDNR = NYT_EEJDNR THEN                                 
          DO;                                                           
             /* Der mappes fra og til samme ejendomsnummer og det  */   
             /* tillades altid ubetinget.                          */   
             ANT_ÆA73_SAMME += 1;                                       
                                                                        
             CALL OPRET_UDENL_EJD_LOGNING (                             
                     BH55600M.TIL_EVS_AAR                               
                    ,BH55600M.AFVIKLINGS_ID                             
                    ,BH55600M.DATA_ID                                   
                    ,(P_EKOMNR)                                         
                    ,(P_EEJDNR)                                         
                    ,NYT_EEJDNR                                         
                    ,PACKAGENAME()                                      
                    ,ZS625P1                                            
                    ,P_DCPRN                                            
                    ,0                                                  
                    ,'U');                                              
                                                                        
             ANT_ÆA73_EJDNR_UÆNDRET += 1;                               
          END;                                                          
          ELSE                                                          
          DO;                                                           
             /* Tjek om der samtidigt mappes fra et andet ejendoms- */  
             /* nummer til det nye ejendomsnummer, hvilket i givet  */  
             /* fald er en ikke tilladt dublet mapning.             */  
             IF ^FINDES_ANDEN_GÆLD_UDENL_EJD_LOGNING (                  
                    BH55600M.TIL_EVS_AAR                                
                   ,BH55600M.AFVIKLINGS_ID                              
                   ,BH55600M.DATA_ID                                    
                   ,(P_EKOMNR)                                          
                   ,(P_EEJDNR)                                          
                   ,NYT_EEJDNR                                          
                   ,PACKAGENAME()                                       
                   ,ZS625P1                                             
                   ,P_DCPRN) THEN                                       
             DO;                                                        
                /* Der er førstegangs-mappet til det nye ejendoms-   */ 
                /* nummer eller i forvejen mappet fra fra-ejendoms-  */ 
                /* nummeret til det nye ejendomsnummer og det er     */ 
                /* tilladt.                                          */ 
                ANT_ÆA73_OK += 1;                                       
                                                                        
                CALL OPRET_UDENL_EJD_LOGNING (                          
                        BH55600M.TIL_EVS_AAR                            
                       ,BH55600M.AFVIKLINGS_ID                          
                       ,BH55600M.DATA_ID                                
                       ,(P_EKOMNR)                                      
                       ,(P_EEJDNR)                                      
                       ,NYT_EEJDNR                                      
                       ,PACKAGENAME()                                   
                       ,ZS625P1                                         
                       ,P_DCPRN                                         
                       ,0                                               
                       ,'J');                                           
                                                                        
                UDTRÆK_SLUT.EEJDNR = NYT_EEJDNR;                        
                ANT_ÆA73_EJDNR_ÆNDRET += 1;                             
             END;                                                       
             ELSE                                                       
             DO;                                                        
                /* Der er mappet fra flere forskellige samtidige    */  
                /* fra-ejendomsnumre til det nye ejendomsnummer     */  
                /* og derfor er det en ikke tilladt dublet mapning. */  
                ANT_ÆA73_DUBLET += 1;                                   
                                                                        
                CALL OPRET_UDENL_EJD_LOGNING (                          
                        BH55600M.TIL_EVS_AAR                            
                       ,BH55600M.AFVIKLINGS_ID                          
                       ,BH55600M.DATA_ID                                
                       ,(P_EKOMNR)                                      
                       ,(P_EEJDNR)                                      
                       ,NYT_EEJDNR                                      
                       ,PACKAGENAME()                                   
                       ,ZS625P1                                         
                       ,P_DCPRN                                         
                       ,0                                               
                       ,'D');                                           
                                                                        
                ANT_ÆA73_EJDNR_UÆNDRET += 1;                            
             END;                                                       
          END;                                                          
       END;                                                             
       ELSE                                                             
       DO;                                                              
          ANT_ÆA73_SLETTET += 1;                                        
                                                                        
          CALL OPRET_UDENL_EJD_LOGNING (                                
                  BH55600M.TIL_EVS_AAR                                  
                 ,BH55600M.AFVIKLINGS_ID                                
                 ,BH55600M.DATA_ID                                      
                 ,(P_EKOMNR)                                            
                 ,(P_EEJDNR)                                            
                 ,NYT_EEJDNR                                            
                 ,PACKAGENAME()                                         
                 ,ZS625P1                                               
                 ,P_DCPRN                                               
                 ,0                                                     
                 ,'N');                                                 
                                                                        
          RETURN ('0'B);                                                
       END;                                                             
    END;                                                                
    ELSE                                                                
    DO;                                                                 
       ANT_ÆA73_EJ_MAPPET += 1;                                         
                                                                        
       CALL OPRET_UDENL_EJD_LOGNING (                                   
               BH55600M.TIL_EVS_AAR                                     
              ,BH55600M.AFVIKLINGS_ID                                   
              ,BH55600M.DATA_ID                                         
              ,(P_EKOMNR)                                               
              ,(P_EEJDNR)                                               
              ,0                                                        
              ,PACKAGENAME()                                            
              ,ZS625P1                                                  
              ,P_DCPRN                                                  
              ,0                                                        
              ,'M');                                                    
                                                                        
       ANT_ÆA73_EJDNR_UÆNDRET += 1;                                     
    END;                                                                
                                                                        
    RETURN ('1'B);                                                      
                                                                        
 END RET_UDENL_EJDNR;                                                   
                                                                        
 /*********************************************************************/
 /* OPSÆT BRUGTE INDIKATORE TIL -1 SOM STARTS VÆRDI            RUTINE */
 /*********************************************************************/
 INIT_INDK: PROC;                                                       
   IF TFLAG THEN PUT SKIP LIST('***** '!!PROCNAME!!' *****');           
   INDK_PERS.BBER2FAM_I         = -1;                                   
   INDK_PERS.BBER2FAM_015ANV_I  = -1;                                   
   INDK_PERS.BBERGRL_I          = -1;                                   
   INDK_PERS.BBERGRL_015ANV_I   = -1;                                   
 /*INDK_PERS.BBERGRLUDL_01_I    = -1;                      /*FORSKUD11*/
   INDK_PERS.BEJBOL1_I          = -1;                                   
   INDK_PERS.BEJBOL1_015ANV_I   = -1;                                   
   INDK_PERS.BEJBOL2_I          = -1;                                   
   INDK_PERS.BEJBOL2_015ANV_I   = -1;                                   
   INDK_PERS.BEJBOLANV_I        = -1;                                   
   INDK_PERS.BEJBOLANV_015ANV_I = -1;                                   
   INDK_PERS.BEJBOLANV_02_I     = -1;                                   
   INDK_PERS.BEJDVÆR_015ANV_I   = -1;                                   
   INDK_PERS.BEVSGL_I           = -1;                                   
   INDK_PERS.BEVSMAN_I          = -1;                                   
   INDK_PERS.BFORSKAT_I         = -1;                                   
   INDK_PERS.BGRPROM1_I         = -1;                                   
   INDK_PERS.BGRPROM2_I         = -1;                                   
   INDK_PERS.BMANNEDSL_I        = -1;                                   
   INDK_PERS.BNEDSL1_I          = -1;                                   
   INDK_PERS.BNEDSL2_I          = -1;                                   
   INDK_PERS.BNETTO_I           = -1;                                   
 /*INDK_PERS.BOMBTILBUDL_01_I   = -1;                      /*FORSKUD11*/
   INDK_PERS.BPENSNED_I         = -1;                                   
   INDK_PERS.BPENSNEDGL_I       = -1;                                   
   INDK_PERS.BPENSNÆ_I          = -1;                                   
   INDK_PERS.BPROM1_I           = -1;                                   
   INDK_PERS.BPROM2_I           = -1;                                   
   INDK_PERS.BSTIBEGR_I         = -1;                                   
   INDK_PERS.BSTITIL_I          = -1;                                   
   INDK_PERS.BSUM1_I            = -1;                                   
   INDK_PERS.BSUM2_I            = -1;                                   
   INDK_PERS.BUDLSKC_I          = -1;                                   
   INDK_PERS.GPCTEJER_I         = -1;                                   
   INDK_PERS.MANNEDSLSTI_I      = -1;                                   
   INDK_PERS.BEJBOLANV_015PCT_I = -1;                                   
   INDK_PERS.BEJBOLANV_02OM_I   = -1;                                   
   INDK_PERS.BEJBOLANV_02OMNY_I = -1;                                   
   INDK_PERS.BBER2FAM_AKT_I     = -1;                                   
   INDK_PERS.BBERGRL_AKT_I      = -1;                                   
   INDK_PERS.BEJBOL1_AKT_I      = -1;                                   
   INDK_PERS.BEJBOL2_AKT_I      = -1;                                   
   INDK_PERS.BEJBOLANV_AKT_I    = -1;                                   
   INDK_PERS.BPENSNÆGL_I        = -1;                                   
   INDK_PERS.BSUM3_I            = -1;                                   
   INDK_PERS.BGLSUM1_I          = -1;                                   
   INDK_PERS.BFASTSTIGBGR_I     = -1;                                   
   INDK_PERS.BMANEVSSTI_I       = -1;                                   
   INDK_PERS.MANPENSSTI_I       = -1;                                   
   INDK_PERS.BBER2FAM_02ANV_I   = -1;                                   
   INDK_PERS.BBERGRL_02ANV_I    = -1;                                   
   INDK_PERS.BEJBOL1_02ANV_I    = -1;                                   
   INDK_PERS.BEJBOL2_02ANV_I    = -1;                                   
   INDK_PERS.BEJBOLANV_01OM_I   = -1;                                   
   INDK_PERS.BEJBOLANV_01OMNY_I = -1;                                   
   INDK_PERS.BEJBOLANV_02ANV_I  = -1;                                   
   INDK_PERS.BEJDVÆR_02ANV_I    = -1;                                   
                                                                        
 END INIT_INDK;                                                         
 /*********************************************************************/
 OPSTART_INIT: PROC;                                                    
                                                                        
   DCL     HJ_KOMNR     PIC '(03)9';                                    
                                                                        
   /* PARMKORT ER EVT. MEDTAGET I KØRSLEN */                            
   ON  ENDFILE (PARMKORT)                                               
   BEGIN;                                                               
      EOF_PARM  = '1'B;                                                 
      GO TO INIT_SLUT;                                                  
   END;                                                                 
                                                                        
   PARMLINIE = '';                                                      
                                                                        
   READ FILE (PARMKORT) INTO  (PARM_AR);                                
                                                                        
   IF PARMLINIE.PROGNAVN ^= 'BH30000'                                   
    THEN                                                                
       PARM_FEJL = '1'B;                                                
                                                                        
    IF VERIFY (PARMLINIE.KOMNR1,'0123456789')  >  0                     
    THEN                                                                
      DO;                                                               
        PARM_FEJL = '1'B;                                               
      END;                                                              
                                                                        
    /*Første kommunenummer skal være udfyldt når der er parmkort*/      
    IF PARMLINIE.KOMNR1  <  '100' !                                     
       PARMLINIE.KOMNR1  >  '999'                                       
    THEN                                                                
      DO;                                                               
        PARM_FEJL = '1'B;                                               
      END;                                                              
                                                                        
    IF PARM_FEJL                                                        
    THEN                                                                
       DO;                                                              
         PUT SKIP LIST ('FEJL I PARMKORT: ',PARM_AR);                   
         ABENDMEDD = '101 FEJL I PARMKORT';                             
         CALL ZS30101(5,ABENDMEDD,2);                                   
       END;                                                             
    ELSE                                                                
       DO;                                                              
         PARM_MEDTAGET  = '1'B;                                         
         PUT SKIP LIST('PARMKORT MEDTAGET: ' !!                         
                PARMLINIE.PROGNAVN  !! PARMLINIE.KOMNR1 !!              
                PARMLINIE.KOMNR2 !! PARMLINIE.KOMNR3);                  
       END;                                                             
                                                                        
   INIT_SLUT:                                                           
                                                                        
   IF PARMLINIE.KOMNR1 = ''                                             
   THEN                                                                 
     DO;                                                                
       PARMKOMNR1 = 0;                                                  
       PARMKOMNR2 = 0;                                                  
       PARMKOMNR3 = 0;                                                  
     END;                                                               
   ELSE                                                                 
     DO;                                                                
       HJ_KOMNR  = PARMLINIE.KOMNR1;                                    
       PARMKOMNR1 = HJ_KOMNR;                                           
       IF PARMLINIE.KOMNR2 > '000'                                      
       THEN                                                             
         DO;                                                            
           HJ_KOMNR  = PARMLINIE.KOMNR2;                                
           PARMKOMNR2 = HJ_KOMNR;                                       
         END;                                                           
                                                                        
       IF PARMLINIE.KOMNR3 > '000'                                      
       THEN                                                             
         DO;                                                            
           HJ_KOMNR  = PARMLINIE.KOMNR3;                                
           PARMKOMNR3 = HJ_KOMNR;                                       
         END;                                                           
                                                                        
       PUT SKIP LIST('PARMLINIE.KOMNR1 =',PARMKOMNR1);                  
       PUT SKIP LIST('PARMLINIE.KOMNR2 =',PARMKOMNR2);                  
       PUT SKIP LIST('PARMLINIE.KOMNR3 =',PARMKOMNR3);                  
     END;                                                               
                                                                        
                                                                        
  END OPSTART_INIT;                                                     
                                                                        
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         PUT SKIP LIST('SQL_FEJL.....');                                
         PUT SKIP LIST('SQLCA',SQLCA);                                  
                                                                        
         CALL DAN_AFSTEMNINGSLISTE;                                     
                                                                        
         CALL LUK_FILER;                                                
                                                                        
         CALL ZS67000(SQLCA);                                           
                                                                        
         ABENDMEDD =  FEJLTEKST;                                        
                                                                        
         CALL ZS30101 (5, ABENDMEDD, 2);                                
                                                                        
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /* LUK FILER, CURSOR OG UDSKRIV AFSTEMNINGS- OG KONTROLLISTE  RUTINE */
 /*********************************************************************/
 AFSLUT: PROC;                                                          
                                                                        
         CALL LUK_FILER;                                                
                                                                        
         CALL CLOSE_PERSONEJENDOMSOPL;                                  
                                                                        
         CALL DAN_AFSTEMNINGSLISTE;                                     
                                                                        
 END AFSLUT;                                                            
                                                                        
 /*********************************************************************/
 /* LUK FILER                                                         */
 /*********************************************************************/
 LUK_FILER: PROC;                                                       
                                                                        
         CLOSE FILE(BQ235I);             /*RUL*/                        
         CLOSE FILE(BH3000O);                                           
         CLOSE FILE(BH3001O);                                           
                                                                        
 END LUK_FILER;                                                         
                                                                        
 /*********************************************************************/
 /* DAN AFSTEMNINGS- OG KONTROLLISTEN                                 */
 /*********************************************************************/
 DAN_AFSTEMNINGSLISTE: PROC;                                            
                                                                        
         LINIE = ZZWS2;                                                 
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL LÆSTE FRA PERSONTABELLEN ................'; 
         LIN.ANT   = ANTLÆS_PERSON;                                     
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL EJ SKRIV MED CEJBEVS = 9 OG CÆGTOPR < 1..'; 
         LIN.ANT   = ANTCEJBEVS_9;                                      
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL EJ SKREVET OMPLACERET ...................'; 
         LIN.ANT   = ANTOMPLACERET;                                     
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL EJ SKREVET MED EJDNR = 0 ................'; 
         LIN.ANT   = ANTEJDNR_EEJDNR_0;                                 
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL EJ SKREVET MED CSLET LIG 1 ..............'; 
         LIN.ANT   = ANTCSLET_1;                                        
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL SKREVNE IALT ............................'; 
         LIN.ANT   = ANTSKRIV_PERSON;                                   
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '      HERAF DANSKE EJENDOMME ..................'; 
         LIN.ANT   = ANTSKRIV_ØVR;                                      
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '      HERAF UDENLANDSKE EJENDOMME .............'; 
         LIN.ANT   = ANTSKRIV_UDL;                                      
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'Antal udenl.ejd. kontrolleret for ejd.nr.skift';  
         LIN.ANT   = ANT_ÆA73_TJEKKET;                                  
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '- heraf med ikke mappet ejd.nr (Mangler) . . .';  
         LIN.ANT   = ANT_ÆA73_EJ_MAPPET;                                
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '- heraf med mappet ejendomsnummer  . . . . . .';  
         LIN.ANT   = ANT_ÆA73_MAPPET;                                   
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '  - heraf mappet som slettet (Slettet) . . . .';  
         LIN.ANT   = ANT_ÆA73_SLETTET;                                  
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '  - heraf mappet til samme (Uændret) . . . . .';  
         LIN.ANT   = ANT_ÆA73_SAMME;                                    
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '  - heraf med anvendt til-ejd.nr (Dublet)  . .';  
         LIN.ANT   = ANT_ÆA73_DUBLET;                                   
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '  - heraf med ikke anvendt til-ejd.nr (OK) . .';  
         LIN.ANT   = ANT_ÆA73_OK;                                       
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'Antal skrevne udenlandske ejendomme  . . . . .';  
         LIN.ANT   = ANT_ÆA73_SKREVNE;                                  
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '- heraf med nyt ejendomsnummer . . . . . . . .';  
         LIN.ANT   = ANT_ÆA73_EJDNR_ÆNDRET;                             
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = '- heraf med nuværende ejendomsnummer . . . . .';  
         LIN.ANT   = ANT_ÆA73_EJDNR_UÆNDRET;                            
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'Antal ikke skrevne udenlandske ejendomme . . .';  
         LIN.ANT   = ANT_ÆA73_EJ_SKREVNE;                               
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         CALL ZZ20300(' ','99');                      /* LUK KMDSPOOL */
                                                                        
 END DAN_AFSTEMNINGSLISTE;                                              
                                                                        
 /*********************************************************************/
 /* HER STARTER APPLIKATIONENS EGNE INCLUDES                          */
 /*********************************************************************/
                                                                        
 %INCLUDE BH30000M;             /* DECLARE OG FETCH SQL STATEMENTS.   */
 %INCLUDE ZM90013M;             /* OMSÆT DATO TIL/FRA DB2-DATOFORMAT  */
 %INCLUDE ZM90051M;             /* KONV BIN15 TIL CHAR                */
 %INCLUDE BS34307M;             /* KONV BF31 TIL CHAR6                */
 %INCLUDE BH30001M;             /* KONV DATO FRA CHAR TIL DEC FIXED   */
 %INCLUDE BH30002M;             /* KONV CHAR(10) TIL DEC FIXED(11)    */
 %INCLUDE BH30003M;             /* OPSÆT GL. REGNSKABS- OG INDKOMSTÅR */
 %INCLUDE BH30010M;             /* FLYT VÆRDIER FRA EJERSKABS FELTER  */
                                                                        
 /**********************************************************************
 * Inkluderede procedurer                                              *
 **********************************************************************/
 %INCLUDE BE99900M; /* SQL_ERROR                                      */
 %INCLUDE BE99901M; /* ABEND                                          */
 %INCLUDE BE83000M; /* FINDES_UDENL_EJD_MAPNING                       */
                    /* FINDES_ANDEN_GÆLD_UDENL_EJD_LOGNING            */
                    /* OPRET_UDENL_EJD_LOGNING                        */
                    /* SÆT_GLNY_LOV_UD_FRA_JOBNAVN                    */
                                                                        
 /*********************************************************************/
 /* Håndter afslutning af programmet umiddelbart før abend.           */
 /*                                                                   */
 /* Kode udført heri og procedurer kaldt herfra bør IKKE kalde        */
 /* SQL_ERROR eller ABEND procedurerne, da det resulterer i et        */
 /* uendeligt loop.                                                   */
 /*********************************************************************/
 AFSLUT_PROGRAM_FØR_ABEND: PROC (P_PROCNAME,                            
                                 P_USER_ABEND_CODE, P_USER_ABEND_TEXT); 
                                                                        
 DCL P_PROCNAME                     CHAR(*) VAR;                        
 DCL P_USER_ABEND_CODE              PIC '999';                          
 DCL P_USER_ABEND_TEXT              CHAR(*) VAR;                        
                                                                        
    /* Udskriv afstemningsliste fra programmet */                       
    CALL DAN_AFSTEMNINGSLISTE;                                          
                                                                        
    /* Luk filer */                                                     
    CALL LUK_FILER;                                                     
                                                                        
 END AFSLUT_PROGRAM_FØR_ABEND;                                          
                                                                        
 END BH30000;                                                           
