 /**********************************************************************
 * PROJEKT:     EVS SLUT ELLER FORSKUD                                 *
 * PROGRAMTYPE: MAKRO.                                                 *
 * FUNKTION:    SQL UDTRÆK ALLE EJENDOMME FRA EJENDOMSTABEL            *
 *              EVS SLUT 2024                                          *
 * PROGRAMMØR:  BO SCHMIDT                                 NOV 2008    *
 *            : DANNET P.G.A. BE07500M                                 *
 * ÆNDRINGER :  GERD HOLM-PEDERSEN                         OKT 2010    *
 *            : DANNET P.G.A. BE09500M                                 *
 * ÆNDRINGER :  GERD HOLM-PEDERSEN                         OKT 2011    *
 *            : DANNET P.G.A. BE10500M                                 *
 * ÆNDRINGER :  LARS KAAE HARRITSHØJ                       SEP 2012    *
 * ÆNDRINGER :  JØRGEN SAUGMANN, QQS                       OKT 2013    *
 * ÆNDRINGER :  JØRGEN SAUGMANN, QQS                       OKT 2014    *
 * ÆNDRINGER :  ESBEN BRODERSEN  QEB                       FEB 2016    *
 * ÅRSRULLET :  LENE MAJ JENSEN  QLE                       JUN 2016    *
 * ÅRSRULLET :  Esben Brodersen  QEB  RUL + BE16 -> BE17   JUN 2017    *
 * UDVIDDET MED EENHEDLBNR TIL SLUT 2018 OPRETTELSEN       SEP 2018    *
 * ÅRSRULLET :  Esben Brodersen  EBD  RUL + BE17 -> BE18   FEB 2020    *
 * ÅRSRULLET :  Esben Brodersen  EBD  RUL + BE18 -> BE19   NOV 2020    *
 * ÆNDRINGSLOG: ÅRSRULLET BE19 -> BE20       EDL           CKT 2020    *
 *                Mellemperioden                                       *
 * ÅRSRULLET  : BE23 -> BE24                 TIC           MAJ 2023    *
 *              EVS GL til EVS Ny                                      *
 **********************************************************************/
 /*********************************************************************/
 /* DECLARE CURSOR TIL LÆS AF EJENDOMSTABEL BE21000T                  */
 /*********************************************************************/
 DECLARE_CURSOR: PROC;                                                  
                                                                        
         EXEC SQL                                                       
         DECLARE EJENDOMS_CUR CURSOR FOR                                
                                                                        
         SELECT T1.DINDKAAR                                             
               ,T1.EKOMNR                                               
               ,T1.EEJDNR                                               
               ,T1.EENHEDLBNR                                           
               ,T1.DFRAGLD                                              
               ,T1.CBENYT                                               
               ,T1.CBERGRL                                              
               ,T1.CEJBOLTYP1                                           
               ,T1.CEJBOLTYP2                                           
               ,T1.CEJDTYPE                                             
               ,T1.CEJV                                                 
               ,T1.EJDBELIG                                             
               ,T1.FEJLNR                                               
               ,T1.FELT760                                              
               ,T1.FLEJL                                                
               ,T1.BEJDVÆR                                              
               ,T1.CEJERL                                               
               ,T1.CFORSKEL                                             
               ,T1.BBER2FAM_AKT                                         
               ,T1.BBERGRL_AKT                                          
               ,T1.BEJBOL1_AKT                                          
               ,T1.BEJBOL2_AKT                                          
               ,T1.BEJDVÆR_AKT                                          
               ,T1.CBENYT_AKT                                           
               ,T1.CBERGRL_AKT                                          
               ,T1.CEJBOLTYP1_AKT                                       
               ,T1.CEJBOLTYP2_AKT                                       
               ,T1.CEJDBELIG                                            
               ,T1.CEJDTYPE_AKT                                         
               ,T1.CEJERL_GL                                            
               ,T1.CVURDOPR                                             
               ,T1.FLEJL_AKT                                            
               ,T1.CEJERL_AKT                                           
               ,T1.COMBYG                                               
               ,T1.CLANDEKODE                                           
               ,T1.CDLANDEKODE                                          
               ,T1.VEJK_EJD                                             
               ,T1.HUSNR_EJD                                            
               ,T1.ETAGE_EJD                                            
               ,T1.SDØR_EJD                                             
               ,T1.VEJK_ENHED                                           
               ,T1.HUSNR_ENHED                                          
               ,T1.ETAGE_ENHED                                          
               ,T1.SDØR_ENHED                                           
               ,T1.ENHEDBELIG                                           
               ,T1.BFENR                                                
               ,T1.VUREJENDOMID                                         
               ,T1.DVURDÅR                                              
               ,T1.VURMARK_AKT                                          
               ,T1.VURMARK                                              
               ,T1.JUR_KATEGO_AKT                                       
               ,T1.JUR_KATEGO                                           
               ,T1.JUR_UKATEGO_AKT                                      
               ,T1.JUR_UKATEGO                                          
               ,T1.VURDATO_AKT                                          
               ,T1.VURDATO                                              
               ,T1.FORSIGT_EVS_AKT                                      
               ,T1.FORSIGT_EVS                                          
               ,T1.BESKAT_EVS_AKT                                       
               ,T1.BESKAT_EVS                                           
                                                                        
         FROM   BE20000T T1                                             
                                                                        
         WHERE  T1.DINDKAAR = 2024  /*RUL*/                             
                                                                        
         ORDER BY T1.DINDKAAR, T1.EKOMNR, T1.EEJDNR, T1.EENHEDLBNR      
         FOR READ ONLY;                                                 
                                                                        
         /* Udgår? - Felter oprettet i BE20000T                         
         EXEC SQL                                                       
         DECLARE EJD_FEL_CUR CURSOR FOR                                 
                                                                        
         SELECT T1.INDHOLD_C,                                           
                T1.INDHOLD_D,                                           
                T1.FELTKODE                                             
                                                                        
         FROM   BE21000T T1                                             
                                                                        
         WHERE  T1.DINDKAAR   = 2024   *RUL*                            
          AND   T1.EKOMNR     = :EVS_EJD.EKOMNR                         
          AND   T1.EEJDNR     = :EVS_EJD.EEJDNR                         
          AND   T1.EENHEDLBNR = :EVS_EJD.EENHEDLBNR                     
                                                                        
         FOR READ ONLY;                                                 
         */                                                             
                                                                        
 END DECLARE_CURSOR;                                                    
 /*********************************************************************/
 /* OPEN CURSOR TIL LÆS AF TABEL BE20000T                      RUTINE */
 /*********************************************************************/
 OPEN_EJENDOMSOPL: PROC;                                                
                                                                        
         EXEC SQL OPEN EJENDOMS_CUR;                                    
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'OPEN EJENDOMS_CURSOR';                       
 /*RUL*/      FEJLTEKST  = 'BE24500 ** 253 ' !! FEJLTEKST;              
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END OPEN_EJENDOMSOPL;                                                  
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF EJENDOMSTABEL BE20000T                    */
 /*********************************************************************/
 FETCH_EJENDOMSOPL: PROC;                                               
                                                                        
         EXEC SQL FETCH EJENDOMS_CUR                                    
                                                                        
         INTO :EVS_EJD.DINDKAAR                                         
             ,:EVS_EJD.EKOMNR                                           
             ,:EVS_EJD.EEJDNR                                           
             ,:EVS_EJD.EENHEDLBNR                                       
             ,:EVS_EJD.DFRAGLD                                          
             ,:EVS_EJD.CBENYT                                           
             ,:EVS_EJD.CBERGRL                                          
             ,:EVS_EJD.CEJBOLTYP1                                       
             ,:EVS_EJD.CEJBOLTYP2                                       
             ,:EVS_EJD.CEJDTYPE                                         
             ,:EVS_EJD.CEJV                                             
             ,:EVS_EJD.EJDBELIG                                         
             ,:EVS_EJD.FEJLNR                                           
             ,:EVS_EJD.FELT760                                          
             ,:EVS_EJD.FLEJL                                            
             ,:EVS_EJD.BEJDVÆR:INDK_EJEND.BEJDVÆR_I                     
             ,:EVS_EJD.CEJERL                                           
             ,:EVS_EJD.CFORSKEL                                         
             ,:EVS_EJD.BBER2FAM_AKT:INDK_EJEND.BBER2FAM_AKT_I           
             ,:EVS_EJD.BBERGRL_AKT:INDK_EJEND.BBERGRL_AKT_I             
             ,:EVS_EJD.BEJBOL1_AKT:INDK_EJEND.BEJBOL1_AKT_I             
             ,:EVS_EJD.BEJBOL2_AKT:INDK_EJEND.BEJBOL2_AKT_I             
             ,:EVS_EJD.BEJDVÆR_AKT:INDK_EJEND.BEJDVÆR_AKT_I             
             ,:EVS_EJD.CBENYT_AKT                                       
             ,:EVS_EJD.CBERGRL_AKT                                      
             ,:EVS_EJD.CEJBOLTYP1_AKT                                   
             ,:EVS_EJD.CEJBOLTYP2_AKT                                   
             ,:EVS_EJD.CEJDBELIG                                        
             ,:EVS_EJD.CEJDTYPE_AKT                                     
             ,:EVS_EJD.CEJERL_GL                                        
             ,:EVS_EJD.CVURDOPR                                         
             ,:EVS_EJD.FLEJL_AKT:INDK_EJEND.FLEJL_AKT_I                 
             ,:EVS_EJD.CEJERL_AKT                                       
             ,:EVS_EJD.COMBYG                                           
             ,:EVS_EJD.CLANDEKODE                                       
             ,:EVS_EJD.CDLANDEKODE                                      
             ,:EVS_EJD.VEJK_EJD                                         
             ,:EVS_EJD.HUSNR_EJD                                        
             ,:EVS_EJD.ETAGE_EJD                                        
             ,:EVS_EJD.SDØR_EJD                                         
             ,:EVS_EJD.VEJK_ENHED                                       
             ,:EVS_EJD.HUSNR_ENHED                                      
             ,:EVS_EJD.ETAGE_ENHED                                      
             ,:EVS_EJD.SDØR_ENHED                                       
             ,:EVS_EJD.ENHEDBELIG                                       
             ,:EVS_EJD.BFENR                                            
             ,:EVS_EJD.VUREJENDOMID                                     
             ,:EVS_EJD.DVURDÅR                                          
             ,:EVS_EJD.VURMARK_AKT                                      
             ,:EVS_EJD.VURMARK                                          
             ,:EVS_EJD.JUR_KATEGO_AKT                                   
             ,:EVS_EJD.JUR_KATEGO                                       
             ,:EVS_EJD.JUR_UKATEGO_AKT                                  
             ,:EVS_EJD.JUR_UKATEGO                                      
             ,:EVS_EJD.VURDATO_AKT                                      
             ,:EVS_EJD.VURDATO                                          
             ,:EVS_EJD.FORSIGT_EVS_AKT                                  
             ,:EVS_EJD.FORSIGT_EVS                                      
             ,:EVS_EJD.BESKAT_EVS_AKT                                   
             ,:EVS_EJD.BESKAT_EVS;                                      
                                                                        
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
           WHEN (0) DO;                                                 
              ANTLÆS_EJD = ANTLÆS_EJD + 1;                              
              END;                                                      
           WHEN (100);                                                  
           OTHERWISE                                                    
             DO;                                                        
   /*SLUT15*/  FEJLTEKST  =  'BE24500 ** 262  FETCH EJENDOMS_CURSOR';   
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
         FETCH_SQLKODE = SQLCA.SQLCODE;  /* GEMMES TIL SENERE BRUG */   
                                                                        
 END FETCH_EJENDOMSOPL;                                                 
 /*********************************************************************/
 /* SELECT EJENDOMSOPLYSN.                                            */
 /*********************************************************************/
 EJENDOMSOPL: PROC;                                                     
                                                                        
      /* EXEC SQL OPEN EJD_FEL_CUR;                                     
         CALL KONTROL('268',' OPEN EJD_FEL_CUR');                       
                                                                        
         EXEC SQL                                                       
                                                                        
           FETCH EJD_FEL_CUR                                            
                                                                        
           INTO :EVS_EJD_FELT.INDHOLD_C,                                
                :EVS_EJD_FELT.INDHOLD_D,                                
                :EVS_EJD_FELT.FELTKODE;                                 
                                                                        
         IF (SQLCA.SQLCODE ^= 0 & SQLCA.SQLCODE ^= 100)                 
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'EJD_FEL_CUR';                                
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
         DO WHILE (SQLCA.SQLCODE = 0);                                  
                                                                        
           CALL FLYT_EJD_FEL;                                           
                                                                        
           EXEC SQL                                                     
                                                                        
             FETCH EJD_FEL_CUR                                          
                                                                        
             INTO :EVS_EJD_FELT.INDHOLD_C,                              
                  :EVS_EJD_FELT.INDHOLD_D,                              
                  :EVS_EJD_FELT.FELTKODE;                               
                                                                        
           IF (SQLCA.SQLCODE ^= 0 & SQLCA.SQLCODE ^= 100)               
           THEN                                                         
             DO;                                                        
               FEJLTEKST = 'EJD_FEL_CUR';                               
               CALL SQL_FEJL;                                           
             END;                                                       
         END;                                                           
                                                                        
         EXEC SQL CLOSE EJD_FEL_CUR;                                    
         CALL KONTROL('270',' CLOSE EJD_FEL_CUR');                      
      */                                                                
                                                                        
 END EJENDOMSOPL;                                                       
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF TABEL BE20000T                     RUTINE */
 /*********************************************************************/
 CLOSE_EJENDOMSOPL: PROC;                                               
                                                                        
         EXEC SQL CLOSE EJENDOMS_CUR;                                   
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'CLOSE EJENDOMS_CURSOR';                      
  /*RUL */    FEJLTEKST  = 'BE24500 ** 256 ' !! FEJLTEKST;              
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END CLOSE_EJENDOMSOPL;                                                 
 /***********************************************************/          
 KONTROL:PROC(TAL,TEKST);                                               
 DCL TAL   CHAR (3);                                                    
 DCL TEKST CHAR (80) VARYING;                                           
         SELECT (SQLCA.SQLCODE);                                        
           WHEN (0);                                                    
           OTHER                                                        
             DO;                                                        
  /*RUL*/      FEJLTEKST  = 'BE24500 ** '!!TAL!! TEKST;                 
               CALL SQL_FEJL;                                           
             END;                                                       
         END; /* SELECT*/                                               
 END KONTROL;                                                           
