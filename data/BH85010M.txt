 /*********************************************************************/
 /*                         B H 8 5 0 1 0 M                           */
 /*                                                                   */
 /* BEREGNING AF SAMMENLIGNINGSGRUNDLAG VEDR. AKTUELT SLUTÅR          */
 /* FOR EVENTUELT AT KUNNE GIVE STIGNINGSBEGRÆNSNING MELLEM           */
 /* MELLEM EJENDOMSVÆRDISKATTEN (EVS) FRA SLUTÅR TIL FORSKUDSÅR.      */
 /*                                                                   */
 /* MACROEN BENYTTES I OPRETTELSEN AF EVS (PROGRAM BH85010).          */
 /* MACROEN BRUGES UMIDDELBART  FØR  KALD AF BR08610 (BATCH)          */
 /*                                                                   */
 /* INDEN KALD SKAL KODEN CBRUGER I BH85010N SÆTTES LIG 'H' FOR       */
 /* KALDT FRA BH85010 (D.V.S. EVS-HOVEDOPRETTELSE TIL FORSKUD)        */
 /*                                                                   */
 /* HVIS RETURNKOD FRA DENNE MACRO ER LIG 0 SAMT HVIS DEN EFTER-      */
 /* FØLGENDE BEREGNING AF EVS FOR FORSKUDSÅRET GÅR GODT.              */
 /*                                                                   */
 /* NB.: HVIS RETURNKOD ER FORSKELLIG FRA 0 EFTER KALD AF MACROEN     */
 /*      SKAL DER GØRES ET ELLER ANDET AF DET KALDENDE PROGRAM.       */
 /*                                                                   */
 /*      FØLGENDE RETURKODER KAN FOREKOMME:                           */
 /*      0 = ALT OK                                                   */
 /*      1 = BÅDE CPTYPSLUT OG CPTYPFOR SKAL VÆRE OPSAT UNDER         */
 /*          TIL-FELTER VED KALD AF MAKROEN.                          */
 /*      2 = EJENDOMSTYPE (CEJDTYPE) FORKERT/MANGLER                  */
 /*                                                                   */
 /* ÅRSRULLET    AF GERD HOLM-PEDERSEN          JUN    2009 RUL       */
 /* SAMT #0403: ÆNDRET REGLER FOR OPRINDELSESKODE                     */
 /*                                                                   */
 /* ÅRSRULLET    AF GERD HOLM-PEDERSEN          JUN    2010 RUL       */
 /*                                                                   */
 /* ÅRSRULLET    AF GERD HOLM-PEDERSEN          MAJ    2011 RUL       */
 /* ÅRSRULLET    AF ESBEN BRODERSEN             JUNI   2012 RUL       */
 /* ÅRSRULLET    AF ESBEN BRODERSEN   'GLEMT'   SEP    2013 RUL       */
 /* ÅRSRULLET    AF JØRGEN SAUGMANN             JUN    2014 RUL       */
 /* ÅRSRULLET    AF JØRGEN SAUGMANN             JUN    2015 RUL       */
 /* SLUT15          ESBEN BRODERSEN             MAR    2016 #01       */
 /*                 DATOER FRA BH65300M                               */
 /* ÅRSRULLET    AF ESBEN BRODERSEN             JUN    2017 RUL       */
 /* ÅRSRULLET    AF ESBEN BRODERSEN             MAJ    2018 RUL       */
 /* ÅRSRULLET    AF ESBEN BRODERSEN             APR    2019 RUL       */
 /* OPSÆTNING AF HJCNEDSL2 ER JUSTERET PGA FORSKUD 2020 KRAV TIL      */
 /* 2FAMILIE HUSE KS28-03 C1.7                                        */
 /* Ændring af promiller L194                   JUN    2020           */
 /* ÅRSRULLET    AF ESBEN BRODERSEN             JULI   2020 RUL       */
 /* Ændring af promiller L194                                         */
 /* skal ikke ske for 2020 D426                 AUG    2020           */
 /* Slut 2021  Steen Pedersen/SEP               Maj    2021           */
 /*            BH65300M rettet til BH55300M                           */
 /* SLUT 2021  Per Brunk                        Maj    2021           */
 /* Ændring af promiller L194/D882                                    */
 /*   PBR: Defect 1359 beregning 4 promille ved cnedsl2 = 5           */
 /*        BBERGRL i stedet for BBER2FAM                              */
 /*********************************************************************/
 OPSÆT_TIL_STIGNINGSBEGRÆNSNING:                                        
 PROC(IND_AR);                                                          
                                                                        
 DCL     IND_AR         CHAR (3000) VAR;                                
 DCL     1 IND          BASED(ADDR(IND_AR)),                            
           2 LÆNGDE     BIN FIXED (15),                                 
           %INCLUDE BH85010N;;    /* EVS'S UDGAVE AF BR08680N*/  /*RUL*/
                                                                        
 DCL     HJCGLANV       CHAR      (6);                                  
                                                                        
 DCL     1 HJ_CGLANV    BASED(ADDR(HJCGLANV)),                          
           2 POS1       CHAR      (1),                                  
           2 POS2       CHAR      (1),                                  
           2 POS3       CHAR      (1),                                  
           2 POS4       CHAR      (1),                                  
           2 POS5       CHAR      (1),                                  
           2 POS6       CHAR      (1);                                  
                                                                        
 DCL     HJVÆRDI1       FIXED     (13,3);                               
 DCL     HJVÆRDI        FIXED     (11,0);                               
                                                                        
 DCL     1 HJ,                                                          
           3 CPENSNEDGL  CHAR  (1),   /* PENSIONISTNEDSLAGSKODE SLUTÅR*/
           3 FRADATO     FIXED (9),   /* INDFLYTNING-/OVERTAGELSESDATO*/
           3 BGRPROM1    FIXED (11),  /* BERGRUNDLAG FOR 10 PROM EVS  */
           3 BGRPROM2    FIXED (11),  /* BERGRUNDLAG FOR 30 PROM EVS  */
           3 BPROM1      FIXED (11,2),/* BELØB FOR 10 PROMILLE EVS    */
           3 BPROM2      FIXED (11,2);/* BELØB FOR 30 PROMILLE EVS    */
                                                                        
 DCL     MULTIPLY       BUILTIN;                                        
                                                                        
         IND.RETURNKOD = 0;                                             
         IND.FRA = '';                                                  
         IND.FRA = IND.TIL, BY NAME;                                    
                                                                        
         HJ = '';                                                       
         HJCGLANV = '000000';                                           
                                                                        
         IF IND.FRA.CGLANV > '000000'                                   
         THEN                                                           
            HJCGLANV = IND.FRA.CGLANV;                                  
                                                                        
         IF IND.TIL.DINDFLYT > 0 &                                      
            IND.TIL.DINDFLYT > IND.TIL.DOVTG                            
         THEN                                                           
            DO;                                                         
               IF IND.TIL.DINDFLYT = BH55300M.ÅR1231  /*#01*/           
               THEN                                                     
                  HJ.FRADATO = BH55300M.FORSKÅR0101;  /*#01*/           
               ELSE                                                     
                  HJ.FRADATO = IND.TIL.DINDFLYT;                        
            END;                                                        
         ELSE                                                           
            HJ.FRADATO = IND.TIL.DOVTG;                                 
                                                                        
         IF IND.TIL.DATO0107 > 0 &                                      
            IND.TIL.DINDFLYT <= IND.TIL.DOVTG &                         
            IND.TIL.DATO0107 < HJ.FRADATO                               
         THEN                                                           
            HJ.FRADATO = IND.TIL.DATO0107;                              
                                                                        
         IF IND.FRA.BPENSNEDGL_SW = -1                                  
          ! (IND.FRA.BPENSNEDGL_SW = 0 &                                
             IND.FRA.COPR_BPENSNEDGL = 'F')                             
         THEN                                                           
            CALL BEREGN_BPENSNEDGL;                                     
                                                                        
         /* DAN KODE FOR 4 PROMILLE NEDSLAG (TIDL. STDFRADRAG.) */      
         /* ER NØDVENDIG AT OPSÆTTE HVER GANG DA DEN STYRES AF  */      
         /* DATA SOM KAN ÆNDRES VIA INDBERETNING.               */      
                                                                        
         IF IND.FRA.CNEDSL1 >= '10' &                                   
            IND.FRA.CNEDSL1 <  '30'                                     
         THEN                                                           
            DO;                                                         
               SELECT;                                                  
                 WHEN (IND.FRA.CFRED = '1')                             
                    IND.FRA.HJCNEDSL2 = '3';                            
                 WHEN (IND.FRA.CEJDTYPE = '4')                          
                   DO;                                                  
                     IF IND.TIL.CEJBEVS = '0' !                         
                        IND.TIL.CEJBEVS = '4'                           
                     THEN                                               
                       DO;                                              
                          IF IND.TIL.CEJBEVS_ANDEN_ENHED = 'C'          
                          THEN                                          
                            IND.FRA.HJCNEDSL2        = '4';             
                          ELSE                                          
                            IND.FRA.HJCNEDSL2        = '5';             
                       END;                                             
                     IF  IND.TIL.CEJBEVS = 'B' !                        
                         IND.TIL.CEJBEVS = '7'                          
                     THEN                                               
                       IND.FRA.HJCNEDSL2      = '0';                    
                   END;                                                 
                 WHEN (IND.FRA.CEJDTYPE = '5')                          
                    IND.FRA.HJCNEDSL2 = '4';                            
                 WHEN (IND.FRA.CEJDTYPE = '7' !                         
                       IND.FRA.CEJDTYPE = '8')                          
                    IND.FRA.HJCNEDSL2 = '2';                            
                 OTHERWISE                                              
                    IND.FRA.HJCNEDSL2 = '1';                            
               END; /* SELECT */                                        
            END;                                                        
                                                                        
         /* HOVEDSTYRING */                                             
                                                                        
         SELECT;                                                        
                                                                        
           WHEN ((IND.FRA.COPR_BNYMAN = 'K' &                           
                 IND.FRA.COPR_BNYMAN = 'L') &    /* #0403 */            
                 IND.FRA.BNYMAN_SW = 0)                                 
             DO;                                                        
                /* MANUEL EVS (FELT 812) INDBERETTET TIL FORSKUD 2019 */
                IND.FRA.BEVSGL = 0;                                     
                IND.FRA.BEVSGL_SW = -1;                                 
                IND.FRA.COPR_BEVSGL = ' ';                              
                IND.FRA.BPENSNEDGL = 0;                                 
                IND.FRA.BPENSNEDGL_SW = -1;                             
                IND.FRA.COPR_BPENSNEDGL = ' ';                          
                IND.FRA.CGLANV = '000000';                              
                HJCGLANV = '000000';                                    
             END;                                                       
                                                                        
           WHEN (IND.CBRUGER = 'F' &                                    
                (IND.FRA.COPR_BEVSGL = 'K' !                            
                 IND.FRA.COPR_BEVSGL = 'L'))     /* #0403 */            
             DO;                                                        
                /* KALD EFTER HOVEDOPRETTELSE TIL FORSKUD 2011   */     
                /*  O G  761 (BEVSGL) INDBERETTES/ÆNDRES/SLETTES */     
                HJCGLANV = '000000';                                    
             END;                                                       
                                                                        
           WHEN (IND.TIL.CPTYPSLUT < '1' !                              
                 IND.TIL.CPTYPFOR  < '1')                               
             DO;                                                        
                IND.RETURNKOD = 1;                                      
                HJCGLANV = '000000';                                    
             END;                                                       
                                                                        
           WHEN (IND.CBRUGER = 'H'    !                                 
                (IND.CBRUGER = 'F' &                                    
                 (IND.FRA.BEVSGL_SW = -1 !                              
                  (IND.FRA.COPR_BEVSGL = 'F' &                          
                   IND.FRA.BEVSGL_SW = 0))))                            
             DO;                                                        
                                                                        
                /* KALD VED HOVEDOPRETTELSE TIL FORSKUD 2020 */         
                /*  E L L E R                                */         
                /* KALD EFTER UDEN AT BEVSGL ER OPSAT        */         
                /* ELLER INDBERETTET                         */         
                IF HJ.FRADATO < BH55300M.FORSKÅR0101   /*#01*/          
                THEN                                                    
                   DO;                                                  
                      CALL BEREGN_2020_KOMPONENTER;    /* RUL */        
                      IF IND.RETURNKOD = 0                              
                      THEN                                              
                         DO;                                            
                           CALL OPSÆT_BGLSUM1;                          
                           CALL BEREGN_STIGNING;                        
                         END;                                           
                      IF IND.RETURNKOD > 0                              
                      THEN                                              
                         DO;                                            
                            IND.FRA.BEVSGL = 0;                         
                            IND.FRA.BEVSGL_SW = -1;                     
                            IND.FRA.COPR_BEVSGL = ' ';                  
                            IND.FRA.BPENSNEDGL = 0;                     
                            IND.FRA.BPENSNEDGL_SW = -1;                 
                            IND.FRA.COPR_BPENSNEDGL = ' ';              
                            IND.FRA.CGLANV = '000000';                  
                            HJCGLANV = '000000';                        
                         END;                                           
                   END;                                                 
                ELSE                                                    
                   DO;                                                  
                      IND.FRA.BEVSGL = 0;                               
                      IND.FRA.BEVSGL_SW = -1;                           
                      IND.FRA.COPR_BEVSGL = ' ';                        
                      IND.FRA.CGLANV = '000000';                        
                      HJCGLANV = '000000';                              
                   END;                                                 
             END;                                                       
                                                                        
                                                                        
           /* Kan ikke forekomme */                                     
           WHEN (IND.CBRUGER = 'F' &                                    
                 IND.FRA.BEVSGL_SW = 0 &                                
                 IND.FRA.BPENSNEDGL_SW = 0)                             
             DO;                                                        
                /* KALD EFTER HOVEDOPRETTELSE TIL FORSKUD 2010 ? */     
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         IND.FRA.CGLANV = HJCGLANV;                                     
                                                                        
 /*********************************************************************/
 /*      OPSÆT BGLSUM1                                                */
 /*********************************************************************/
 OPSÆT_BGLSUM1:                                                         
 PROC;                                                                  
                                                                        
         IND.FRA.BGLSUM1 = IND.FRA.BGLEVS10;                            
         POS1 = '1';                                                    
                                                                        
         IF (IND.FRA.CNEDSL1 >= '10' &                                  
             IND.FRA.CNEDSL1 <  '30') &                                 
             IND.FRA.BGLEVS2 > 0                                        
         THEN                                                           
            DO;                                                         
               IND.FRA.BGLSUM1 = IND.FRA.BGLSUM1 -                      
                                 IND.FRA.BGLEVS2;                       
                                                                        
               POS2 = '1';                                              
            END;                                                        
                                                                        
         IF (IND.FRA.HJCNEDSL2 = '1' !                                  
             IND.FRA.HJCNEDSL2 = '4' !                                  
             IND.FRA.HJCNEDSL2 = '5') &                                 
             IND.FRA.BGLEVS4 > 0                                        
         THEN                                                           
            DO;                                                         
               IND.FRA.BGLSUM1 = IND.FRA.BGLSUM1 -                      
                                 IND.FRA.BGLEVS4;                       
               POS3 = '1';                                              
            END;                                                        
                                                                        
         IF IND.FRA.BGLSUM1 < 0 &                                       
            IND.FRA.BGLEVS4 > 0                                         
         THEN                                                           
            DO;                                                         
               IND.FRA.BGLEVS4 = IND.FRA.BGLEVS4 +                      
                                 IND.FRA.BGLSUM1;                       
               IND.FRA.BGLSUM1 = 0;                                     
            END;                                                        
                                                                        
         IND.FRA.BGLSUM2 = IND.FRA.BGLSUM1;                             
                                                                        
         IF IND.TIL.CPTYPSLUT > '2' &                                   
            IND.FRA.BGLSUM1 > 0                                         
         THEN                                                           
            DO;                                                         
              IF IND.FRA.BGLEVSP > 0                                    
               & IND.FRA.BGLEVSP > IND.FRA.BGLSUM2                      
              THEN                                                      
                 IND.FRA.BGLEVSP = IND.FRA.BGLSUM2;                     
                                                                        
               IF IND.FRA.BGLEVSP > 0                                   
               THEN                                                     
                  DO;                                                   
                     IND.FRA.BGLSUM1 = IND.FRA.BGLSUM1 -                
                                       IND.FRA.BGLEVSP;                 
                     POS4 = '1';                                        
                  END;                                                  
            END;                                                        
                                                                        
         IND.FRA.BGLSUM3 = IND.FRA.BGLSUM1;                             
                                                                        
         IF IND.FRA.BFASTSTIGBGR_SW = 0                                 
          & IND.FRA.BFASTSTIGBGR > 0                                    
          & IND.FRA.BGLSUM1 > 0                                         
         THEN                                                           
            DO;                                                         
               IF IND.FRA.BGLSUM1 >=                                    
                  IND.FRA.BFASTSTIGBGR                                  
               THEN                                                     
                  DO;                                                   
                     IND.FRA.BGLSUM1 = IND.FRA.BGLSUM1 -                
                                       IND.FRA.BFASTSTIGBGR;            
                     POS5 = '1';                                        
                  END;                                                  
               ELSE                                                     
                  DO;                                                   
                     IND.FRA.BGLSUM1 = IND.FRA.BGLSUM1 -                
                                       IND.FRA.BGLSUM3;                 
                     POS5 = '2';                                        
                  END;                                                  
            END;                                                        
                                                                        
 END OPSÆT_BGLSUM1;                                                     
                                                                        
 /*********************************************************************/
 /*      BEREGN BEVSGL OG BPENSNEDGL                                  */
 /*      D.V.S. HVIS BELØBENE IKKE ER OPSAT TIDLIGERE OG/ELLER        */
 /*      INDBERETTET AF KOMMUNEN.                                     */
 /*********************************************************************/
 BEREGN_2020_KOMPONENTER:                                      /* RUL */
 PROC;                                                                  
                                                                        
         SELECT;                                                        
           WHEN (IND.TIL.CEJDTYPE = '1' !                               
                 IND.TIL.CEJDTYPE = '3' !                               
                 IND.TIL.CEJDTYPE = '4' !                               
                 IND.TIL.CEJDTYPE = '5' !                               
                 IND.TIL.CEJDTYPE = '7' !                               
                 IND.TIL.CEJDTYPE = '8' !                               
                 IND.TIL.CEJDTYPE = '9');                               
           OTHERWISE                                                    
              IND.RETURNKOD = 2;                                        
         END;                                                           
                                                                        
         IF IND.TIL.BBERGRL > 0 &                                       
            IND.RETURNKOD = 0                                           
         THEN                                                           
            DO;                                                         
               IF IND.TIL.BBERGRL > 3040000                             
               THEN                                                     
                  DO;                                                   
                     HJ.BGRPROM1 = 3040000;                             
                     HJ.BGRPROM2 = IND.TIL.BBERGRL - 3040000;           
                  END;                                                  
               ELSE                                                     
                  HJ.BGRPROM1 = IND.TIL.BBERGRL;                        
                                                                        
               /* BEREGN EJENDOMSVÆRDISKAT 10 PROMILLE */               
               HJ.BPROM1 = MULTIPLY(HJ.BGRPROM1,0.0092,11,2);  /*D882*/ 
                                                                        
               /* BEREGN EJENDOMSVÆRDISKAT 30 PROMILLE */               
               IF HJ.BGRPROM2 > 0                                       
               THEN                                                     
                  HJ.BPROM2 = MULTIPLY(HJ.BGRPROM2,0.030,11,2);         
                                                                        
               IND.FRA.BGLEVS10 = HJ.BPROM1 + HJ.BPROM2;                
                                                                        
               /* BEREGN 2 PROMILLE NEDSLAG */                          
               /* EJENDOM EJET 1/7-98       */                          
               HJVÆRDI1 =                                               
               (MULTIPLY(IND.TIL.BBERGRL,0.0018,11,3)) + 0.005;/*D882*/ 
               IND.FRA.BGLEVS2 = HJVÆRDI1;                              
            END;                                                        
                                                                        
         /* BEREGN 4 PROMILLE NEDSLAG */                                
         /* FOR EJENDOM EJET 1/7-98   */                                
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (IND.FRA.HJCNEDSL2 = '1' &                              
                 IND.TIL.BBERGRL > 0 &                                  
                 IND.RETURNKOD = 0)                                     
              DO;                                                       
                 /* BEREGN 4 PROMILLE NEDSLAG - 1-FAM-HUS */            
                 HJVÆRDI1 =                                             
                 (MULTIPLY(IND.TIL.BBERGRL,0.0037,11,3)) + 0.005;       
                                                               /*D882*/ 
                 /* NEDSLAGET KAN MAX. VÆRE 1200,00 KR. */              
                 IF HJVÆRDI1 < 1200.000                                 
                 THEN                                                   
                    IND.FRA.BGLEVS4 = HJVÆRDI1;                         
                 ELSE                                                   
                    IND.FRA.BGLEVS4 = 1200.00;                          
              END;                                                      
                                                                        
           WHEN (IND.FRA.HJCNEDSL2 = '4' &                              
                 IND.TIL.BBER2FAM > 0 &                                 
                 IND.RETURNKOD = 0)                                     
              DO;                                                       
                 /* BEREGN 4 PROMILLE NEDSLAG - 2-FAM-HUS */            
                 /* MED KUN EEN EJERBOLIGVÆRDI            */            
                 HJVÆRDI1 =                                             
                 (MULTIPLY(IND.TIL.BBER2FAM,0.0037,11,3)) + 0.005;      
                                                               /*D882*/ 
                 /* NEDSLAGET KAN MAX. VÆRE 2400,00 KR. */              
                 IF HJVÆRDI1 < 2400.000                                 
                 THEN                                                   
                    IND.FRA.BGLEVS4 = HJVÆRDI1;                         
                 ELSE                                                   
                    IND.FRA.BGLEVS4 = 2400.00;                          
              END;                                                      
                                                                        
           WHEN (IND.FRA.HJCNEDSL2 = '5' &                              
                 IND.TIL.BBERGRL > 0 &                                  
                 IND.RETURNKOD = 0)                                     
              DO;                                                       
                 /* BEREGN 4 PROMILLE NEDSLAG - 2-FAM-HUS */            
                 /* MED TO EJERBOLIGVÆRDIER               */            
                 HJVÆRDI1 =                                             
                 (MULTIPLY(IND.TIL.BBERGRL,0.0037,11,3)) + 0.005;       
                                                               /*D882*/ 
                 /* NEDSLAGET KAN MAX. VÆRE 1200,00 KR. */              
                 IF HJVÆRDI1 < 1200.000                                 
                 THEN                                                   
                    IND.FRA.BGLEVS4 = HJVÆRDI1;                         
                 ELSE                                                   
                    IND.FRA.BGLEVS4 = 1200.00;                          
              END;                                                      
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END BEREGN_2020_KOMPONENTER;                                  /* RUL */
 /*********************************************************************/
 /*      BEREGN STIGNINGSBEGRÆNSNING SAMT BGLEVS                      */
 /*********************************************************************/
 BEREGN_STIGNING:                                                       
 PROC;                                                                  
                                                                        
         /* HVORDAN SKAL 2019 ? UDGANGSPUNKT REGULERES */               
         /* D.V.S. BEREGN BGLSTITIL                  */                 
                                                                        
         IF IND.TIL.CGLSLUTEVS > '0'                                    
         THEN                                                           
            DO;                                                         
              IF IND.TIL.CPTYPSLUT < '3'                                
               & IND.TIL.CPTYPGL   > '2'                                
              THEN                                                      
                 DO;                                                    
                   IND.FRA.BGLSLUTSTI =                                 
                       IND.TIL.BGLSLUTEVS + IND.TIL.BGLPENSNED;         
                 END;                                                   
              ELSE                                                      
              IF IND.TIL.CPTYPSLUT > '2'                                
               & IND.TIL.CPTYPGL   < '3'                                
              THEN                                                      
                 DO;                                                    
                   IF IND.TIL.BGLPENSNED > IND.TIL.BGLSLUTEVS           
                   THEN                                                 
                      IND.TIL.BGLPENSNED = IND.TIL.BGLSLUTEVS;          
                                                                        
                   IND.FRA.BGLSLUTSTI =                                 
                       IND.TIL.BGLSLUTEVS - IND.TIL.BGLPENSNED;         
                 END;                                                   
              ELSE                                                      
                 IND.FRA.BGLSLUTSTI = IND.TIL.BGLSLUTEVS;               
                                                                        
              IF IND.TIL.CPTYPSLUT = '1'                                
              THEN                                                      
                 CALL BEREGN_MAX_STIGNING_ALM;                          
              ELSE                                                      
                 CALL BEREGN_MAX_STIGNING_ØVR;                          
            END;                                                        
                                                                        
         ELSE                                                           
            IND.FRA.BGLSTITIL = IND.FRA.BGLSUM1;                        
                                                                        
         IF IND.FRA.BGLSTITIL < 0                                       
         THEN                                                           
            IND.FRA.BGLSTITIL = 0;                                      
                                                                        
         IF IND.FRA.BGLSTITIL < IND.FRA.BGLSUM1                         
         THEN                                                           
            DO;                                                         
              IND.FRA.BGLSTIBGR = IND.FRA.BGLSUM1 - IND.FRA.BGLSTITIL;  
            END;                                                        
         ELSE                                                           
            DO;                                                         
              IND.FRA.BGLSTIBGR = 0;                                    
              POS6 = '0';                                               
            END;                                                        
                                                                        
         IND.FRA.BEVSGL = IND.FRA.BGLSUM1 - IND.FRA.BGLSTIBGR;          
         IND.FRA.BEVSGL_SW = 0;                                         
         IND.FRA.COPR_BEVSGL = 'F';                                     
                                                                        
 END BEREGN_STIGNING;                                                   
 /*********************************************************************/
 /*      BEREGN HVOR MEGET EJENDOMSVÆRDISKATTEN MÅ STIGE TIL FOR      */
 /*      ALMINDELIGE PERSONER                                         */
 /*********************************************************************/
 BEREGN_MAX_STIGNING_ALM:                                               
 PROC;                                                                  
                                                                        
         IF IND.FRA.BGLSLUTSTI <= 12000.00                              
         THEN                                                           
            DO;                                                         
              POS6 = '4';                                               
              IND.FRA.BGLSTITIL = IND.FRA.BGLSLUTSTI + 2400.00;         
            END;                                                        
         ELSE                                                           
            DO;                                                         
              POS6 = '3';                                               
              IND.FRA.BGLSTITIL = IND.FRA.BGLSLUTSTI +                  
                        (MULTIPLY(IND.FRA.BGLSLUTSTI,0.2,11,2));        
            END;                                                        
                                                                        
 END BEREGN_MAX_STIGNING_ALM;                                           
                                                                        
 /*********************************************************************/
 /*      BEREGN HVOR MEGET EJENDOMSVÆRDISKATTEN MÅ STIGE TIL FOR      */
 /*      PERSONER MED STATUS SOM PENSIONISTER, FØRTIDSPENSIONISTER    */
 /*      OG/ELLER EFTERLØNSMODTAGERE                                  */
 /*********************************************************************/
 BEREGN_MAX_STIGNING_ØVR:                                               
 PROC;                                                                  
                                                                        
         IF IND.FRA.BGLSLUTSTI <= 7000.00                               
         THEN                                                           
            DO;                                                         
              POS6 = '1';                                               
              IND.FRA.BGLSTITIL = IND.FRA.BGLSLUTSTI + 500.00;          
            END;                                                        
         ELSE                                                           
            DO;                                                         
              POS6 = '2';                                               
              IND.FRA.BGLSTITIL = IND.FRA.BGLSLUTSTI +                  
                     (MULTIPLY(IND.FRA.BGLSLUTSTI,0.2,11,2) - 900);     
            END;                                                        
                                                                        
 END BEREGN_MAX_STIGNING_ØVR;                                           
 /*********************************************************************/
 /* OPSÆT 'GENEREL' KODE FOR 4 PROMILLE NEDSLAG - 67 ÅRIGE M.V.       */
 /* OG BEREGN BPENSNEDGL (4 PROMILLE NEDSLAG - 67 ÅRIGE M.V.)         */
 /* OBS: GÆLDENDE FOR SLUTÅRET                                        */
 /*********************************************************************/
 BEREGN_BPENSNEDGL:                                                     
 PROC;                                                                  
                                                                        
         HJ.CPENSNEDGL = ' ';                                           
                                                                        
         IF IND.TIL.CEJDTYPE = '3' !                                    
            IND.TIL.CEJDTYPE = '8'                                      
         THEN                                                           
            HJ.CPENSNEDGL = '2'; /* SOMMERHUS */                        
         ELSE                                                           
            HJ.CPENSNEDGL = '1'; /* HELÅRSBOLIGER */                    
                                                                        
         IF IND.TIL.BBERGRL > 0                                         
         THEN                                                           
            DO;                                                         
               /* BEREGN BEREGNINGSGRUNDLAG FOR SLUTÅR  */              
               HJVÆRDI1 =                                               
               (MULTIPLY(IND.TIL.BBERGRL,0.0037,11,3)) + 0.005;/*D882*/ 
               IF HJ.CPENSNEDGL = '1'                                   
               THEN                                                     
                  DO;                                                   
                     /* OPSÆT BGLEVSP FOR EN HELÅRSBOLIG */             
                     /* NEDSLAGET KAN MAX. VÆRE 6000,00 KR. */          
                     IF HJVÆRDI1 < 6000.000                             
                     THEN                                               
                        IND.FRA.BGLEVSP = HJVÆRDI1;                     
                     ELSE                                               
                        IND.FRA.BGLEVSP = 6000.00;                      
                  END;                                                  
               ELSE                                                     
                  IF HJ.CPENSNEDGL = '2'                                
                  THEN                                                  
                     DO;                                                
                        /* OPSÆT BGLEVSP FOR EN FRITIDSBOLIG */         
                        /* NEDSLAGET KAN MAX. VÆRE 2000,00 KR. */       
                        IF HJVÆRDI1 < 2000.000                          
                        THEN                                            
                           IND.FRA.BGLEVSP = HJVÆRDI1;                  
                        ELSE                                            
                           IND.FRA.BGLEVSP = 2000.00;                   
                     END;                                               
                                                                        
               IND.FRA.BPENSNEDGL = IND.FRA.BGLEVSP;                    
               IND.FRA.BPENSNEDGL_SW = 0;                               
               IND.FRA.COPR_BPENSNEDGL = 'F';                           
            END;                                                        
                                                                        
 END BEREGN_BPENSNEDGL;                                                 
 /*********************************************************************/
 END OPSÆT_TIL_STIGNINGSBEGRÆNSNING;                                    
