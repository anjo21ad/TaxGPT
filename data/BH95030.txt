  PROCESS OPT(TIME);                                                    
 BH95030: /* OPSÆT TIL OG BEREGN AF EVS FORSKUD 2015 VIA PL/1 */        
 PROCEDURE (BH945_AR) REORDER;                                          
 /*********************************************************************/
                                                                        
 DCL COPYRIGHT CHAR (30) STATIC INIT ('COPYRIGHT KOMMUNEDATA I/S 2003');
                                                                        
 /*********************************************************************/
 /*            PROGRAMMERET AF AAGE RASMUSSEN, PUS T&S JUNI 2000      */
 /*            ÅRSTILRETTET AF AAGE RASMUSSEN, LSU T&S JUNI 2001      */
 /*            ÅRSTILRETTET AF AAGE RASMUSSEN, LSU T&S AUG  2002      */
 /*            ÅRSTILRETTET AF AAGE RASMUSSEN, LSU T&S AUG  2003      */
 /*            ÅRSTILRETTET AF BO SCHMIDT    , LSU T&S AUG  2004      */
 /* #FORSKUD06 ÅRSILRETTET AF SUSANNE VILLUMSEN  PKF  AUG  2005       */
 /*            BR586 ÆNDRES TIL BH950_AR  ->                          */
 /*            NAVNET SKAL IKKE ÅRSRULLES MERE                        */
 /* #FORSKUD07 ÅRSILRETTET AF BO SCHMIDT         PKF  JUL  2006       */
 /* #FORSKUD08 ÅRSILRETTET AF BO SCHMIDT         PKF  JUL  2007       */
 /* #FORSKUD09 ÅRSILRETTET AF BO SCHMIDT         PKF  JUL  2007       */
 /* #FORSKUD10 ÅRSILRETTET AF GERD HOLM-PEDERSEN PKF  APR  2009       */
 /* #FORSKUD11 ÅRSILRETTET AF GERD HOLM-PEDERSEN PKF  JUN  2010       */
 /* #FORSKUD12 ÅRSILRETTET AF GERD HOLM-PEDERSEN PKF  MAJ  2011       */
 /* #FORSKUD13 ÅRSILRETTET AF ESBEN BRODERSEN    PR   JUNI 2012       */
 /* #FORSKUD14 ÅRSILRETTET AF ESBEN BRODERSEN    PR   JUNI 2013       */
 /* #FORSKUD15 ÅRSILRETTET AF JØRGEN SAUGMANN    PR   JUNI 2014       */
 /* #FORSKUD16 ÅRSILRETTET AF JØRGEN SAUGMANN    PR   JUNI 2015       */
 /*                           ESBEN BRODERSEN         MARTS 2016      */
 /*                           UDVIDET BRUG AF BH65300M  #01           */
 /* FORSKUD17 KOMPILERET      ESBEN BRODERSEN  JUNI 2016              */
 /*********************************************************************/
         DEFAULT RANGE (*) STATIC;                                      
 /*********************************************************************/
 /*      DECLARE AF INPUT                                             */
 /*********************************************************************/
                                                                        
 DCL     BH945_AR        CHAR      (6000) VAR;                          
                                                                        
 DCL     1 BH945         BASED     (ADDR(BH945_AR)),                    
           3 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH90100N;;                                          
                                                                        
 /*********************************************************************/
 /*      DECLARE AF DIVERSE PARAMETRE TIL KALD AF PL/1-BEREGN         */
 /*********************************************************************/
                                                                        
 DCL     1 BH950_AR,                                                    
           %INCLUDE BH95007N; /* HJÆLPESTRUK FOR BR48610N */            
                                                                        
 /*********************************************************************/
 /*      DECLARE AF DIVERSE                                           */
 /*********************************************************************/
                                                                        
 DCL     1 BH65300M,                                                    
           %INCLUDE BH65300M;                                           
 DCL     BH95007         ENTRY;            /* PL/1-BEREGNING FOR 2014 */
 DCL     ADDR            BUILTIN;                                       
                                                                        
         ON CONVERSION                                                  
            BEGIN;                                                      
              PUT SKIP LIST ('CPR-NR = ',BH945.SORT_CPR);               
              PUT SKIP LIST ('KOM-NR = ',BH945.SORT_KOMNR);             
              PUT SKIP LIST ('EJD-NR = ',BH945.SORT_EJDNR);             
              PUT SKIP LIST ('CPR-NR = ',BH945.SORT_CPR);               
              PUT SKIP LIST ('KOM-NR = ',BH945.SORT_KOMNR);             
              PUT SKIP LIST ('EJD-NR = ',BH945.SORT_EJDNR);             
              CALL PLIDUMP ('SNHOB');                                   
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      P R O C E S S                                                */
 /*********************************************************************/
                                                                        
         IF (BH945.TIL_EVS.DAFSTAA = 0 !                                
             BH945.TIL_EVS.DAFSTAA > BH65300M.ÅR1231) &  /*#01*/        
             BH945.TIL_EVS.CEJBEVS = '0'                                
         THEN                                                           
            DO;                                                         
                                /*FORSKUD09 BR976 ÆNDRES TIL BH950_AR*/ 
               BH950_AR = '';                                           
               BH950_AR.DINDKAAR = FORSKÅR;                             
               BH950_AR.STARTDATO = BH945.TIL_EVS.DOVTG;                
               BH950_AR.SLUTDATO = BH945.TIL_EVS.DAFSTAA;               
                                                                        
               BH950_AR = BH945.TIL_EVS, BY NAME;                       
               BH950_AR = BH945.EJERSKAB, BY NAME;                      
               BH950_AR = BH945.EJENDOM, BY NAME;                       
               BH950_AR.GPCTEJER = BH945.TIL_EVS.GPCTEJER * 100;        
               BH950_AR.GPCTUDLE = BH945.TIL_EVS.GPCTUDLE * 100;        
               BH950_AR.GPCTERHV = BH945.TIL_EVS.GPCTERHV * 100;        
               BH950_AR = BH945.FRA_EVS_SLUT, BY NAME;                  
               BH950_AR = BH945.TIL_EVS_FOR, BY NAME;                   
                                                                        
               IF BH945.EJERSKAB.CEJDTYPE > '0'                         
               THEN                                                     
                  BH950_AR.CEJDTYPE = BH945.EJERSKAB.CEJDTYPE;          
               ELSE                                                     
                  BH950_AR.CEJDTYPE = BH945.EJENDOM.CEJDTYPE;           
                                                                        
               CALL BH95007(BH950_AR);                                  
                                                                        
               BH945.FRA_EVS_FOR = BH950_AR, BY NAME;                   
               BH945.FEJLNR = BH950_AR.RETURKODE;                       
            END;                                                        
                                                                        
 END BH95030;                                                           
