 PROCESS OPT(TIME);                                                     
 BH31800:   /* OPDEL ESR-UDTRÆK I EJENDOMME MED 2 EJERE OG ØVR. EJD. */ 
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /********************************************************************/ 
  DCL COPYRIGHT   CHAR (30) STATIC    INIT ('COPYRIGHT KMD A/S 2013');  
 /********************************************************************* 
 *                                                                    * 
 * FORMÅL : OPDELING AF ESR-UDTRÆK I EJENDOMME SOM HAR 2 EJERE OG     * 
 *          ØVRIGE EJERE FOR SENERE AT KONTROLLERE OG EVT. OPSÆTTE    * 
 *          OG/ELLER NULSTILLE EJERANDELS-PROCENTEN PÅ DATASÆTTET     * 
 *          MED 2-EJERE.                                              * 
 *                                                                    * 
 *          DESUDEN OVERLÆSES UDTRÆKSINDIVIDER SOM IKKE ER RELEVANTE  * 
 *          I DEN VIDERE BEHANDLING AF ESR-UDTRÆKKET.                 * 
 *                                                                    * 
 * INPUT  : C.N570X0D  UDTRÆK FRA ESR (X=1 HVIS SLUT,X=4 HVIS FORSKUD)* 
 *                                                                    * 
 * OUTPUT : B.H31810D  ESR UDTRÆK  K U N  EJENDOMME MED 2 EJERE.      * 
 *          B.H31800D  ESR UDTRÆK MED ØVRIGE EJENDOMME.               * 
 *          BH31801Y   KØRSELSKONTROLLISTE                            * 
 *                                                                    * 
 * PROGRAMMØR: AAGE RASMUSSEN   LSU T&S EVS            NOV 2001       * 
 ********************************************************************** 
 * RETTET:     OLUF MØRK        LSU T&S EVS            JUN 2002       * 
 *             ÅRSTILRETNING.                                         * 
 * RETTET:     BO SCHMIDT       LSU T&S EVS            JUN 2003       * 
 *             ÅRSTILRETNING.                                         * 
 * RETTET:     BO SCHMIDT       LSU T&S EVS            JUN 2004       * 
 *             ÅRSTILRETNING TIL FORSKUD 2005                         * 
 * RETTET:     AAGE RASMUSSEN   LSU T&S EVS            NOV 2004       * 
 *             ÅRSTILRETNING TIL SLUT 2004                            * 
 * FORSKUD06   SUSANNE KROGH VILLUMSEN                 26/05-2005     * 
 *             ÅRSTILRETNING TIL FORSKUD 2006                         * 
 *             VURDOPL0 ÆNDRET TIL VURDOPLNY                          * 
 *             VURDOPL1 ÆNDRET TIL VURDOPLGL                          * 
 *             VURDOPL2 ÆNDRET TIL VURDOPL02                          * 
 *             VURDOPL3 ÆNDRET TIL VURDOPL01                          * 
 *             VURDOPL0.OMBER02 ÆNDRET TIL VURDOPLNY.OMBER01          * 
 *             VURDOPL1.OMBER02 ÆNDRET TIL VURDOPLGL.OMBER01          * 
 *  NB!   FELTÆNDRINGERNE ER IKKE MÆRKET I PROGRAMMET PGA AT MAN DA   * 
 *        VILLE KOMME TIL AT MÆRKE NÆSTEN ALLE LINIER I PROGRAMMET    * 
 * FORSKUD07   BO SCHMIDT                              MAJ 2006       * 
 *             ÅRSTILRETNING TIL FORSKUD 2007                         * 
 * FORSKUD08   BO SCHMIDT                              MAJ 2007       * 
 *             ÅRSTILRETNING TIL FORSKUD 2008                         * 
 * FORSKUD09   BO SCHMIDT                              JUNI 2008      * 
 *             ÅRSTILRETNING TIL FORSKUD 2009                         * 
 * FORSKUD10   GERD HOLM-PEDERSEN                      APRIL 2009     * 
 *             ÅRSTILRETNING TIL FORSKUD 2010                         * 
 *             NYT FELT CEJFOER0107                                   * 
 * FORSKUD11   GERD HOLM-PEDERSEN                      JUNI  2010     * 
 *             ÅRSTILRETNING TIL FORSKUD 2011                         * 
 *             SAMT CEJEV FJERNET. VI FÅR NU KUN EJENDOMME MED        * 
 *             VURDERING                                              * 
 * FORSKUD12   GERD HOLM-PEDERSEN                      JUNI  2011     * 
 *             ÅRSTILRETNING TIL FORSKUD 2012                         * 
 * FORSKUD13   GERD HOLM-PEDERSEN                      MAJ   2012     * 
 *             ÅRSTILRETNING TIL FORSKUD 2012                         * 
 * SLUT12      NYT FELT CEANV I STRUKTUR BH31800N, LKA, OKTOBER 2012  * 
 *             KRAV 18-01 - BENYTTELSESKODE 25                        * 
 *                                                                    * 
 * FORSKUD14   LARS HARRITSHØJ                        MAJ 2013        * 
 *             ÅRSTILRETNING TIL FORSKUD 2014  SØG PÅ RUL             * 
 *             CEANV SÆTTES LIG = '000' FOR FORSKUDS KØRSEL #01       * 
 *             DA KRAV 18-01 KUN SKAL GÆLDE FOR SLUT KØRSEL           * 
 *                                                                    * 
 * FORSKUD15   JØRGEN SAUGMANN                        JUN 2014        * 
 *             ÅRSTILRETNING TIL FORSKUD 2014  SØG PÅ RUL             * 
 * SLUT14     JØRGEN SAUGMANN                        OKT 2014         * 
 *             ÅRSTILRETNING TIL SLUT 2014  SØG PÅ RUL                * 
 * FORSKUD16   JENS HOLGER KJÆR                            08.06.2015 * 
 *             ÅRSRULNING TIL FORSKUD 16. SØG PÅ RUL                  * 
 * SLUT15      ESBEN BRODERSEN FEJLRETTELSE AF RULNING                * 
 *             INDFØRT DATO MACRO BH65300M  #01                       * 
 * FORSKUD17   ESBEN BRODERSEN                             12.06.2016 * 
 *             ÅRSRULNING TIL FORSKUD 2017                            * 
 *             KS32-01 FORSKUD 2017 FJERNET NULSTILLING AF            * 
 *             CEANV FOR FORSKUD                                      * 
 * FORSKUD18   ESBEN BRODERSEN                             05.06.2017 * 
 *             KUN KOMPILERET TIL FORSKUD 2018                        * 
 * FORSKUD19   ESBEN BRODERSEN                             25.05.2018 * 
 *             KRAV 26-01 (DEFECT 25 FORSKUD 2018) Nulstilling af     * 
 *             afståelse  dato DAFSTÅ når ikke valid                  * 
 *             SAMT OPRYDNING I UDKOMMENTERET KODE                    * 
 *                                                                    * 
 * SLUT18      ESBEN BRODERSEN                             12.09.2018 * 
 *             Input er udviddet med enhedsløbnr til 2 familie        * 
 *             boliger, samt teknisk fejlnummer og enheds adresse     * 
 *             Ny stuktur BH31800N - > BH33700N                       * 
 *             CN570 omdøbt til BH339                                 * 
 *             Parameter til styring om det er Forskud/slut kørsel i  * 
 *             tidligere var det styret af dags dato                  * 
 *             Max grænse for DAFSTAA er parameterstyret              * 
 *                                                                    * 
 * Rettelse #02: Edward Laryea, EDL                     22-03-2019    * 
 *               Nyt felt STRAKS_EVS i BH33700N                       * 
 * FORSKUD21   PER BRUNK PBR                               23.03.2020 * 
 *             KUN KOMPILERET TIL FORSKUD 2021                        * 
 *             Nye felter i BH33700N VURMARK og VUR2001    14.05.2020 * 
 *SLUT2020     Per Brunk PBR                               10.11.2020 * 
 *             Defect 611 (D611) CEBENYT 10,11,12,14,20 og 79         * 
 * SLUT 2021   Z6SEP                                       Marts 2021 * 
 *             BH65300M rettet til BH55300M                           * 
 *             Fil BH318I er fjernet                                  * 
 *             Brug af BH318_PARM er erstattet af BH55300M            * 
 *             Z6ONE                                       Juli 2021  * 
 *             D864 Udgået ejendom CBENYT = 16                        * 
 *********************************************************************/ 
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL     BH339I  FILE RECORD INPUT;     /* ESR UDTRÆK */                
 DCL     BH3181O FILE RECORD OUTPUT;    /* 2-EJERE */                   
 DCL     BH3180O FILE RECORD OUTPUT;    /* ØVRIGE  */                   
 DCL     SYSPRINT FILE OUTPUT;                                          
 /********************************************************************* 
 *       DECLARE AF ESR UDTRÆK INPUT                                  * 
 *********************************************************************/ 
 DCL     BH339_AR        CHAR      (2000) VAR;                          
 DCL     1 BH339         BASED     (ADDR(BH339_AR)),                    
           4 LÆNGDE BIN FIXED (15),                                     
           %INCLUDE BH33700N;                                           
                                                                        
 DCL     1 BH55300M,                                                    
           %INCLUDE BH55300M;              /* #01 */                    
                                                                        
 /********************************************************************* 
 *               DECLARE AF DIV. TÆLLEVÆRKER                          * 
 *********************************************************************/ 
 DCL     1 TV,                        /* TÆLLEVÆRKER TIL TOTALLISTEN */ 
           2 LÆS_BH339    FIXED DEC (7),                                
           2 LÆS_OPTÆL    FIXED DEC (7),                                
           2 CPRNR_NUL    FIXED DEC (7),                                
           2 SLETTET      FIXED DEC (7),                                
 /*        2 SLET_BK16    FIXED DEC (7),  */                            
           2 SALG_FØR     FIXED DEC (7),                                
           2 KØB_EFTER    FIXED DEC (7),                                
           2 OVERSPR_BK   FIXED DEC (7),                                
           2 OVERSPR_B14  FIXED DEC (7),                                
           2 OVERSPR_B20  FIXED DEC (7),                                
           2 OVERSPR_B78  FIXED DEC (7),                                
           2 OVERSPR_B79  FIXED DEC (7),                                
           2 FLYTEJBAKT   FIXED DEC (7),                                
           2 FLYTEJB07    FIXED DEC (7),                                
           2 FLYTEJB072N  FIXED DEC (7),                                
           2 FLYTEJB072Ø  FIXED DEC (7),                                
           2 FLYTEJB071N  FIXED DEC (7),                                
           2 FLYTEJB071Ø  FIXED DEC (7),                                
           2 FLYTEJB02    FIXED DEC (7),                                
           2 FLYTEJB01    FIXED DEC (7),                                
           2 SKR_2EJ      FIXED DEC (7),                                
           2 SKR_ØVR      FIXED DEC (7),                                
           2 NULSTIL_SALG FIXED DEC (7);                                
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     EOF_BH339       BIT       (1);                                 
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
 DCL     FØRSTE_NULSTIL  BIT       (1);                                 
                                                                        
                                                                        
 DCL     UDDATO          CHAR      (10);                                
                                                                        
 DCL     DATO1           CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
                                                                        
 DCL     HJ_DATOEN       PIC  '(8)9';                                   
 DCL     1 HJ_DATO       BASED(ADDR(HJ_DATOEN)),                        
           2 AAR         PIC  '9999',                                   
           2 MD          PIC  '99',                                     
           2 DG          PIC  '99';                                     
                                                                        
 DCL     WS_PROGRAMNAVN         CHAR(8)  INIT ('BH31800');              
                                                                        
 DCL     MAX_DAFSTAA            FIXED     (09);                         
 /*********************************************************************/
 /*      DECLARE AF ABEND-RUTINE                                        
 /*********************************************************************/
 DCL     ABENDKODE     FIXED       (2) INIT(5);                         
 DCL     1 ABENDMEDD,                                                   
          2 ABENDMODUL CHAR      (7) INIT ('BH84300'),                  
          2 ABENDFILL1 CHAR      (1) INIT (' '),                        
          2 ABENDMEDNR CHAR      (2) INIT ('**'),                       
          2 ABENDFILL2 CHAR      (1) INIT (' '),                        
          2 ABENDTXT   CHAR      (45);                                  
                                                                        
 DCL     ABENDRTKODE   FIXED     (1) INIT (2);                          
 /********************************************************************* 
 *       DECLARE AF ENTRY OG BUILTIN                                  * 
 *********************************************************************/ 
 DCL     MOD             BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS61900         ENTRY;                                         
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
         EXTERNAL INIT ('NOTEST(ALL,,;)');                              
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH31800L'),                                        
           2 F1          CHAR      (21)      INIT      (' '),           
           2 TEKST2      CHAR      (52)      INIT      (                
           'OPDEL ESR-UDTRÆK I 2-EJERE OG ØVRIGE  '),                   
           2 F2          CHAR      (21)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'Z.ZZZ.ZZ9',                         
           2 F2          CHAR      (63)      INIT      ((63)' ');       
         % INCLUDE ZZ20301M;                                            
                                                                        
                                                                        
 DCL     1 OVERLINNUSTIL,                                               
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (132);                               
                                                                        
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
         EOF_BH339 = NEJ;                                               
         ON ERROR                                                       
            BEGIN;                                                      
                ON ERROR SYSTEM;                                        
                PUT SKIP LIST ('PROGRAMFEJL');                          
                CALL PLIDUMP  ('SNHOB','PROGRAM BH31800L');             
            END;                                                        
                                                                        
         OPEN FILE (BH339I)  TITLE ('BH33900I');                        
         OPEN FILE (BH3180O) TITLE ('BH31800O');                        
         OPEN FILE (BH3181O) TITLE ('BH31810O');                        
         ON ENDFILE (BH339I)                                            
         BEGIN;                                                         
            EOF_BH339 = JA;                                             
         END;                                                           
         CALL ZZ20390 ('*OPEN','BH31801Y');                             
         CALL ZZ20390 ('*OPEN','BH31802Y'); /*Fravalgte forskud 2019*/  
                                                                        
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         OVERLIN1.DATO  = UDDATO;                                       
         SIDELIN.CCA    = ZZIK1;                                        
         OVERLIN1.CCA   = ZZWS2;                                        
         OVERLIN2.CCA   = ZZWS3;                                        
         FØRSTE_NULSTIL = JA;                                           
         TV = '';                                                       
                                                                        
         SELECT (BH55300M.AFVIKLINGS_ID);                               
            WHEN ('OPRET_EVS_SLUT')                                     
              DO;                                                       
                 PUT SKIP LIST ('Dette er en EVS SLUT kørsel');         
              END;                                                      
            WHEN ('SUPPL_EVS_SLUT')                                     
              DO;                                                       
                 PUT SKIP LIST ('Dette er en EVS SUPPL kørsel');        
              END;                                                      
            WHEN ('OPRET_EVS_FORSK')                                    
              DO;                                                       
                 PUT SKIP LIST ('Dette er en EVS FORSKUD kørsel');      
              END;                                                      
            OTHERWISE                                                   
              DO;                                                       
                 ABENDTXT = '101 Parameter skal være S,F,U';            
                 CALL PROGRAM_FEJL;                                     
              END;                                                      
         END;                                                           
                                                                        
         SELECT (BH55300M.AFVIKLINGS_ID);                               
            WHEN ('OPRET_EVS_FORSK')                                    
               DO;                                                      
                  MAX_DAFSTAA = BH55300M.FORSKÅR1231 + 10000;           
               END;                                                     
            WHEN ('OPRET_EVS_SLUT')                                     
               DO;                                                      
                  MAX_DAFSTAA = BH55300M.FORSKÅR1231;                   
               END;                                                     
            WHEN ('SUPPL_EVS_SLUT')                                     
               DO;                                                      
                  MAX_DAFSTAA = BH55300M.FORSKÅR1231;                   
               END;                                                     
            OTHERWISE                                                   
               DO;                                                      
                  ABENDTXT = '101 PARAMETERFEJL';                       
                  CALL PROGRAM_FEJL;                                    
               END;                                                     
         END; /* select */                                              
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
                                                                        
                                                                        
         CALL LÆS_BH339;                                                
                                                                        
         DO WHILE (EOF_BH339 = NEJ);                                    
            IF BH339.DCPRCIR < 9999999999                               
            THEN                                                        
               CALL BEHANDL;                                            
            ELSE                                                        
               TV.LÆS_OPTÆL = TV.LÆS_OPTÆL + 1;                         
            CALL LÆS_BH339;                                             
         END;                                                           
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /********************************************************************* 
 *       LÆS ESR UDTRÆK                                               * 
 *********************************************************************/ 
 LÆS_BH339:                                                             
 PROC;                                                                  
                                                                        
         READ FILE (BH339I) INTO (BH339_AR);                            
                                                                        
         IF EOF_BH339 = NEJ                                             
         THEN                                                           
            TV.LÆS_BH339 = TV.LÆS_BH339 + 1;                            
                                                                        
 END LÆS_BH339;                                                         
 /********************************************************************* 
 *       BEHANDL EJERE                                                * 
 *********************************************************************/ 
 BEHANDL:                                                               
 PROC;                                                                  
                                                                        
         IF BH339.DCPRCIR = 0                                           
         THEN                                                           
            DO;                                                         
               TV.CPRNR_NUL = TV.CPRNR_NUL + 1;                         
               RETURN;                                                  
            END;                                                        
                                                                        
         IF BH339.DAFGDAT > 0 &                                         
            BH339.DAFSTÅ = 0                                            
         THEN                                                           
            DO;                                                         
               // D864 fjernet da vi behandler kode 16 anderledes       
               // IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '16'              
               // THEN                                                  
               //    TV.SLET_BK16 = TV.SLET_BK16 + 1;                   
               // ELSE                                                  
                                                                        
               TV.SLETTET = TV.SLETTET + 1;                             
               RETURN;                                                  
            END;                                                        
                                                                        
         /*AF HENSYN TIL BAGUD FORSKUDT REGNSKABSÅR*/                   
         IF BH339.DAFSTÅ > 0 &                                          
            BH339.DAFSTÅ < BH55300M.GLÅR0301  /*#01*/                   
         THEN                                                           
            DO;                                                         
               TV.SALG_FØR = TV.SALG_FØR + 1;                           
               RETURN;                                                  
            END;                                                        
                                                                        
                                                                        
         /*AF HENSYN TIL FREMAD FORSKUDT REGNSKABSÅR*/                  
         IF BH339.DOVTG > BH55300M.FORSKÅR0131                          
         THEN                                                           
            DO;                                                         
               TV.KØB_EFTER = TV.KØB_EFTER + 1;                         
               RETURN;                                                  
            END;                                                        
                                                                        
                                                                        
         /*ESR har lavet en fejlrettelse hvor de har ganget */          
         /*nedestående felter med 100                       */          
         /*rettelse lagt ind til EVS slut 2018              */          
                                                                        
         BH339.BFSKAT    =  BH339.BFSKAT/100;                           
         BH339.BYDAF     =  BH339.BYDAF/100;                            
         BH339.BDAF      =  BH339.BDAF/100;                             
         BH339.BFKOMSKAT =  BH339.BFKOMSKAT/100;                        
         BH339.BFKOMSKST =  BH339.BFKOMSKST/100;                        
                                                                        
         HJ_DATOEN = BH339.DOVTG;                                       
                                                                        
         IF HJ_DATOEN = 0                                               
         THEN;                                                          
         ELSE                                                           
         IF HJ_DATO.MD < 01                                             
          ! HJ_DATO.MD > 12                                             
         THEN                                                           
            DO;                                                         
              HJ_DATO.MD = 01;                                          
              HJ_DATO.DG = 01;                                          
            END;                                                        
         ELSE                                                           
         IF HJ_DATO.DG < 01                                             
         THEN                                                           
            HJ_DATO.DG = 01;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 31                                             
          & (HJ_DATO.MD = 01 !                                          
             HJ_DATO.MD = 03 !                                          
             HJ_DATO.MD = 05 !                                          
             HJ_DATO.MD = 07 !                                          
             HJ_DATO.MD = 08 !                                          
             HJ_DATO.MD = 10 !                                          
             HJ_DATO.MD = 12)                                           
         THEN                                                           
            HJ_DATO.DG = 31;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 30                                             
          & (HJ_DATO.MD = 04 !                                          
             HJ_DATO.MD = 06 !                                          
             HJ_DATO.MD = 09 !                                          
             HJ_DATO.MD = 11)                                           
         THEN                                                           
            HJ_DATO.DG = 30;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 29                                             
          & HJ_DATO.MD = 02                                             
          & MOD(HJ_DATO.AAR,4) = 0                                      
         THEN                                                           
            HJ_DATO.DG = 29;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 28                                             
          & HJ_DATO.MD = 02                                             
          & MOD(HJ_DATO.AAR,4) > 0                                      
         THEN                                                           
            HJ_DATO.DG = 28;                                            
                                                                        
         BH339.DOVTG = HJ_DATOEN;                                       
                                                                        
         /* Ny regl til Forskud 2019/slut 2018 */                       
         /* der skal nulstilles afståelses datoer som ligger efter */   
         /* efter 20201231 for Forskud EVS oprettelsen og          */   
         /* efter 20191231 for Slut EVS oprettelsen                */   
         IF BH339.DAFSTÅ > MAX_DAFSTAA                                  
         THEN                                                           
           DO;                                                          
             TV.NULSTIL_SALG = TV.NULSTIL_SALG + 1;                     
             CALL NULSTILISTE;                                          
             BH339.DAFSTÅ = 0;                                          
           END;                                                         
                                                                        
         HJ_DATOEN = BH339.DAFSTÅ;                                      
                                                                        
         IF HJ_DATOEN = 0                                               
         THEN;                                                          
         ELSE                                                           
         IF HJ_DATO.MD < 01                                             
          ! HJ_DATO.MD > 12                                             
         THEN                                                           
            DO;                                                         
              HJ_DATO.MD = 12;                                          
              HJ_DATO.DG = 31;                                          
            END;                                                        
         ELSE                                                           
         IF HJ_DATO.DG < 01                                             
         THEN                                                           
            HJ_DATO.DG = 01;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 31                                             
          & (HJ_DATO.MD = 01 !                                          
             HJ_DATO.MD = 03 !                                          
             HJ_DATO.MD = 05 !                                          
             HJ_DATO.MD = 07 !                                          
             HJ_DATO.MD = 08 !                                          
             HJ_DATO.MD = 10 !                                          
             HJ_DATO.MD = 12)                                           
         THEN                                                           
            HJ_DATO.DG = 31;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 30                                             
          & (HJ_DATO.MD = 04 !                                          
             HJ_DATO.MD = 06 !                                          
             HJ_DATO.MD = 09 !                                          
             HJ_DATO.MD = 11)                                           
         THEN                                                           
            HJ_DATO.DG = 30;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 29                                             
          & HJ_DATO.MD = 02                                             
          & MOD(HJ_DATO.AAR,4) = 0                                      
         THEN                                                           
            HJ_DATO.DG = 29;                                            
         ELSE                                                           
         IF HJ_DATO.DG > 28                                             
          & HJ_DATO.MD = 02                                             
          & MOD(HJ_DATO.AAR,4) > 0                                      
         THEN                                                           
            HJ_DATO.DG = 28;                                            
                                                                        
         BH339.DAFSTÅ = HJ_DATOEN;                                      
                                                                        
         /* HER KOPIERES EVT. BENYTTELSESKODE 70 ELLER 71 */            
         /* OPSAT UNDER VURDOPLGL.ÅRSVURD.CBENYT  T I L    */           
         /*             VURDOPLNY.ÅRSVURD.CBENYT           */           
         /* A.H.T. FORSKUD DA VURDOPLNY-OPLYSNINGERNE      */           
         /* A L T I D  VIL VÆRE TOMME VED UDTRÆK DERTIL!  */            
                                                                        
                                                                        
         /* Taget ud i forbindelse med variabelt vurderings år ##       
         IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '  '                       
          & (BH339.VURDOPLGL.ÅRSVURD.CBENYT = '70'                      
           ! BH339.VURDOPLGL.ÅRSVURD.CBENYT = '71')                     
         THEN                                                           
            DO;                                                         
              BH339.VURDOPLNY.DVURDÅR = BH55300M.INDKÅR1;  /*#01*/      
         /*   BH339.VURDOPLNY.ÅRSVURD.CBENYT =                          
                           BH339.VURDOPLGL.ÅRSVURD.CBENYT;              
              BH339.VURDOPLGL.ÅRSVURD.CBENYT = '  ';                    
            END;*/                                                      
                                                                        
                                                                        
         /* HER OPSÆTTES MANGLENDE AKTUELLE VURDERINGSOPLYSNINGER  */   
         /* VEDRØRENDE ÅRSVURDERING PR. 1/10-2018, DA              */   
         /* DEN EJ ER KENDT TIL FORSKUD 2019.                      */   
         /* STYRING AF FORSKUDS KØRSEL OMLAGT TIL PARAMETER        */   
         /* & (DATO2.MD > '05' & DATO2.MD < '11')                  */   
                                                                        
         IF BH339.VURDOPLNY.DVURDÅR = '    '                            
          & BH339.VURDOPLNY.ÅRSVURD.CBENYT = '  '                       
          & BH55300M.AFVIKLINGS_ID = 'OPRET_EVS_FORSK'                  
         THEN                                                           
            DO;                                                         
              BH339.VURDOPLNY.DVURDÅR = BH55300M.INDKÅR1;  /*#01*/      
              BH339.VURDOPLNY.OMBER01(1).KONSEKVENS = 'J';              
              BH339.VURDOPLNY.OMBER01(2).KONSEKVENS = 'J';              
            END;                                                        
                                                                        
                                                                        
         /* Kode ændret i forbindelse variabel vurderingsår ##EBD */    
         /* Frasortering af ejendomme som ikke er  */                   
         /* evs-relevant pga aktuelvurdering      */                    
         IF BH55300M.AFVIKLINGS_ID = 'OPRET_EVS_FORSK'                  
         THEN                                                           
           DO;                                                          
             IF BH339.VURDOPLGL.ÅRSVURD.CBENYT = '00' !                 
                BH339.VURDOPLGL.ÅRSVURD.CBENYT = '55' !                 
                BH339.VURDOPLGL.ÅRSVURD.CBENYT = '56' !                 
                BH339.VURDOPLGL.ÅRSVURD.CBENYT = '57'                   
             THEN                                                       
               DO;                                                      
                 TV.OVERSPR_BK = TV.OVERSPR_BK + 1;                     
                 RETURN;                                                
               END;                                                     
           END;                                                         
         ELSE /* OPRET_EVS_SLUT */                                      
           DO;                                                          
             IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '00' !                 
                BH339.VURDOPLNY.ÅRSVURD.CBENYT = '55' !                 
                BH339.VURDOPLNY.ÅRSVURD.CBENYT = '56' !                 
                BH339.VURDOPLNY.ÅRSVURD.CBENYT = '57'                   
             THEN                                                       
               DO;                                                      
                 TV.OVERSPR_BK = TV.OVERSPR_BK + 1;                     
                 RETURN;                                                
               END;                                                     
           END;                                                         
                                                                        
                                                                        
         IF (BH339.VURDOPLNY.OMBER01(1).KONSEKVENS = 'J' !              
             BH339.VURDOPLNY.OMBER01(1).KONSEKVENS = 'N' !              
             BH339.VURDOPLNY.OMBER01(2).KONSEKVENS = 'J' !              
             BH339.VURDOPLNY.OMBER01(2).KONSEKVENS = 'N') &             
             BH339.VURDOPLNY.CUOP ^= '6'                                
         THEN                                                           
            DO;                                                         
               /* DER ER OMBEREGNINGER TIL AKTUEL VURDERING, */         
               /* D.V.S. AT VURDERINGSOPLYSNINGERNE FRA DEN  */         
               /* NÆRMESTE FOREGÅENDE VURDERING              */         
               /* SKAL BENYTTES SOM AKTUEL VURDERING D.V.S.  */         
               /* TIL OPSÆTNING AF FEJLNR, CEJBEVS SAMT BE-  */         
               /* REGNINGSGRUNDLAG M.V..                     */         
                IF BH339.VURDOPLGL.ÅRSVURD.CBENYT = '00' !              
                 /*  BH339.VURDOPLGL.ÅRSVURD.CBENYT = '10' !  D611      
                   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '11' !              
                   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '12' !              
                   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '14' !              
                   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '20' ! */           
                   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '55' !              
                   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '56' !              
                   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '57'                
                 /*  BH339.VURDOPLGL.ÅRSVURD.CBENYT = '79' */           
                THEN                                                    
                  DO;                                                   
                     /* DETTE ER EJENDOMME SOM IKKE   */                
                     /* ER EVS-RELEVANTE P.G.A AKTUEL */                
                     /* VURDERING                     *//* D661 */      
                     /*IF BH339.VURDOPLGL.ÅRSVURD.CBENYT = '14'         
                     THEN                                               
                        TV.OVERSPR_B14 = TV.OVERSPR_B14 + 1;            
                     ELSE                                               
                     IF BH339.VURDOPLGL.ÅRSVURD.CBENYT = '20'           
                     THEN                                               
                        TV.OVERSPR_B20 = TV.OVERSPR_B20 + 1;            
                     ELSE                                               
                     IF BH339.VURDOPLGL.ÅRSVURD.CBENYT = '79'           
                     THEN                                               
                        TV.OVERSPR_B79 = TV.OVERSPR_B79 + 1;            
                     ELSE */                                            
                        TV.OVERSPR_BK = TV.OVERSPR_BK + 1;              
                     RETURN;                                            
                  END;                                                  
            END;                                                        
         ELSE                                                           
            DO;                                                         
               IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '00' !               
               /*   BH339.VURDOPLNY.ÅRSVURD.CBENYT = '10' ! D611        
                  BH339.VURDOPLNY.ÅRSVURD.CBENYT = '11' !               
                  BH339.VURDOPLNY.ÅRSVURD.CBENYT = '12' !               
                  BH339.VURDOPLNY.ÅRSVURD.CBENYT = '14' !               
                  BH339.VURDOPLNY.ÅRSVURD.CBENYT = '20' ! */            
                  BH339.VURDOPLNY.ÅRSVURD.CBENYT = '55' !               
                  BH339.VURDOPLNY.ÅRSVURD.CBENYT = '56' !               
                  BH339.VURDOPLNY.ÅRSVURD.CBENYT = '57'                 
               /*   BH339.VURDOPLNY.ÅRSVURD.CBENYT = '79' */            
               THEN                                                     
                  DO;                                                   
                     /* DETTE ER EJENDOMME SOM IKKE */                  
                     /* ER EVS-RELEVANTE P.G.A AKTUEL */                
                     /* VURDERING                     *//* D661 */      
                   /*  IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '14'         
                     THEN                                               
                        TV.OVERSPR_B14 = TV.OVERSPR_B14 + 1;            
                     ELSE                                               
                     IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '20'           
                     THEN                                               
                        TV.OVERSPR_B20 = TV.OVERSPR_B20 + 1;            
                     ELSE                                               
                     IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '79'           
                     THEN                                               
                        TV.OVERSPR_B79 = TV.OVERSPR_B79 + 1;            
                     ELSE */                                            
                        TV.OVERSPR_BK = TV.OVERSPR_BK + 1;              
                     RETURN;                                            
                  END;                                                  
            END;                                                        
                                                                        
         IF BH339.VURDOPLNY.ÅRSVURD.CBENYT = '78' !                     
           (BH339.VURDOPLNY.ÅRSVURD.CBENYT > '00' &                     
            BH339.VURDOPLNY.ÅRSVURD.CBENYT ^= '78' &                    
            BH339.VURDOPLNY.ÅRSVURD.BEJDVÆR = 0  &                      
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '78')                      
         THEN                                                           
            DO;                                                         
               /* DETTE ER EJENDOMME SOM IKKE */                        
               /* ER EVS-RELEVANTE JVF. T&S   */                        
               /* KRAVSPEC. EVS 2003 18-04-05 */                        
               TV.OVERSPR_B78 = TV.OVERSPR_B78 + 1;                     
               RETURN;                                                  
            END;                                                        
                                                                        
         IF BH339.VURDOPLGL.ÅRSVURD.CBENYT = '00' !                     
         /*   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '10' ! D611              
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '11' !                     
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '12' !                     
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '14' !                     
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '20' ! */                  
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '55' !                     
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '56' !                     
            BH339.VURDOPLGL.ÅRSVURD.CBENYT = '57'                       
         /*   BH339.VURDOPLGL.ÅRSVURD.CBENYT = '79' */                  
         THEN                                                           
            BH339.VURDOPLGL = '';                                       
                                                                        
         IF BH339.VURDOPL02.ÅRSVURD.CBENYT = '00' !                     
         /*   BH339.VURDOPL02.ÅRSVURD.CBENYT = '10' ! D611              
            BH339.VURDOPL02.ÅRSVURD.CBENYT = '11' !                     
            BH339.VURDOPL02.ÅRSVURD.CBENYT = '12' !                     
            BH339.VURDOPL02.ÅRSVURD.CBENYT = '14' !                     
            BH339.VURDOPL02.ÅRSVURD.CBENYT = '20' ! */                  
            BH339.VURDOPL02.ÅRSVURD.CBENYT = '55' !                     
            BH339.VURDOPL02.ÅRSVURD.CBENYT = '56' !                     
            BH339.VURDOPL02.ÅRSVURD.CBENYT = '57'                       
         /*   BH339.VURDOPL02.ÅRSVURD.CBENYT = '79' */                  
         THEN                                                           
            BH339.VURDOPL02 = '';                                       
                                                                        
         IF (BH339.VURDOPL01.CBENYT = '00' !                            
         /*    BH339.VURDOPL01.CBENYT = '10' ! D611                     
             BH339.VURDOPL01.CBENYT = '11' !                            
             BH339.VURDOPL01.CBENYT = '12' !                            
             BH339.VURDOPL01.CBENYT = '14' !                            
             BH339.VURDOPL01.CBENYT = '20' ! */                         
             BH339.VURDOPL01.CBENYT = '55' !                            
             BH339.VURDOPL01.CBENYT = '56' !                            
             BH339.VURDOPL01.CBENYT = '57'                              
          /*   BH339.VURDOPL01.CBENYT = '79'*/)                         
          ! (BH339.VURDOPL01.BEJDVÆR = 0  &                             
             BH339.VURDOPL01.CBENYT ^= '78')                            
         THEN                                                           
            BH339.VURDOPL01 = '';                                       
                                                                        
         IF BH339.CPENS = '0'                                           
         THEN                                                           
            BH339.CPENS = ' ';                                          
                                                                        
         IF BH339.CFRED = '0'                                           
         THEN                                                           
            BH339.CFRED = ' ';                                          
                                                                        
         CALL VURDOPLNY;                               /*FORSKUD06*/    
                                                                        
         CALL VURDOPLGL;                               /*FORSKUD06*/    
                                                                        
         CALL VURDOPL02;                               /*FORSKUD06*/    
                                                                        
         CALL VURDOPL01;                               /*FORSKUD06*/    
                                                                        
         CALL SKATSTOP;                                /*FORSKUD06*/    
                                                                        
         /*2Familiehuse skal ikke have 2 ejer behandling */             
         /*Da da ejer procent allerede er bestemt        */             
         IF BH339.FEJER = 2      &                                      
            BH339.EENHEDLBNR = 0    /* KS0223 */                        
         THEN                                                           
            DO;                                                         
               WRITE FILE (BH3181O) FROM (BH339_AR);                    
               TV.SKR_2EJ = TV.SKR_2EJ + 1;                             
            END;                                                        
         ELSE                                                           
            DO;                                                         
               WRITE FILE (BH3180O) FROM (BH339_AR);                    
               TV.SKR_ØVR = TV.SKR_ØVR + 1;                             
            END;                                                        
                                                                        
 END BEHANDL;                                                           
 /********************************************************************* 
 *                       NULSTILLEDE DATOER UDSKRIVES.                * 
 *********************************************************************/ 
 NULSTILISTE:PROC;                                                      
                                                                        
 DCL HJDCPRCIR PIC  '(10)9';                                            
 DCL HJEKOMNR  PIC  '(03)9';                                            
 DCL HJEEJDNR  PIC  '(06)9';                                            
 DCL HJDATO    PIC  '(08)9';                                            
                                                                        
         IF FØRSTE_NULSTIL                                              
         THEN                                                           
           DO;                                                          
              SIDELIN = '';                                             
              SIDELIN.CCA    = ZZIK1;                                   
              FØRSTE_NULSTIL = NEJ;                                     
              SIDELIN.FILLER = 'BH31802Y LISTE OVER NULSTILLEDE DATOER';
              CALL ZZ20300(SIDELIN,'02');                               
              SIDELIN = '';                                             
              SIDELIN.CCA = ZZWS1;                                      
              CALL ZZ20300(SIDELIN,'02'); /*BLANK LINIE*/               
           END;                                                         
                                                                        
         SIDELIN = '';                                                  
         SIDELIN.CCA = ZZWS1;                                           
                                                                        
         HJDCPRCIR = BH339.DCPRCIR;                                     
         HJEKOMNR  = BH339.EKOMNR;                                      
         HJEEJDNR  = BH339.EEJDNR;                                      
         HJDATO    = BH339.DAFSTÅ;                                      
                                                                        
         SIDELIN.FILLER = HJDCPRCIR !! ' ' !! HJEKOMNR !! '-' !!        
                          HJEEJDNR  !! ' DATO = ' !! HJDATO;            
                                                                        
         CALL ZZ20300(SIDELIN,'02');                                    
                                                                        
 END NULSTILISTE;                                                       
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
         PROC;                                                          
                                                                        
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.LÆS_OPTÆL;                                  
         DETLIN1.TEKST = 'LÆSTE OPTÆLLINGSINDIVIDER PÅ       C.N570X0D';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆS_BH339;                                  
         DETLIN1.TEKST = 'LÆSTE ØVRIGE INDIVIDER PÅ          C.N570X0D';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.CPRNR_NUL;                                  
         DETLIN1.TEKST = '      HERAF OVERLÆST PERSONNUMMER LIG 0     ';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
      /* DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SLET_BK16;                                  
         DETLIN1.TEKST = '      HERAF OVERLÆST EJER SLETTET MED BK16  ';
         CALL ZZ20300 (DETLIN1,'01'); */                                
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SLETTET;                                    
         DETLIN1.TEKST = '      HERAF OVERLÆST EJER SLETTET I ESR     ';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SALG_FØR;                                   
                                                                        
         DETLIN1.TEKST = '      HERAF OVERLÆST SALG FØR ' !!            
                         BH55300M.GLSLUTÅR1 !! '-03-01  ';              
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.NULSTIL_SALG;                               
         DETLIN1.TEKST = '      HERAF NULSTILLET DATO SALG EFTER ' !!   
                          BH55300M.INDKÅR2 !! '-01-31  ';               
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.KØB_EFTER;                                  
         DETLIN1.TEKST = '      HERAF OVERLÆST KØB EFTER ' !!           
                          BH55300M.INDKÅR2 !! '-01-31  ';               
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.OVERSPR_B14;                                
         DETLIN1.TEKST = '      HERAF OVERLÆST EJER MED BK14  ';        
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.OVERSPR_B20;                                
         DETLIN1.TEKST = '      HERAF OVERLÆST EJER MED BK20  ';        
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.OVERSPR_B78;                                
         DETLIN1.TEKST = '      HERAF OVERLÆST EJER MED BK78  ';        
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.OVERSPR_B79;                                
         DETLIN1.TEKST = '      HERAF OVERLÆST EJER MED BK79  ';        
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.OVERSPR_BK;                                 
         DETLIN1.TEKST = '      HERAF UØNSKEDE BENYTTELSESKODER ';      
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.SKR_2EJ;                                    
         DETLIN1.TEKST = 'SKREVNE INDIVIDER KUN 2-EJERE      B.H31810D';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.SKR_ØVR;                                    
         DETLIN1.TEKST = 'SKREVNE INDIVIDER ØVRIGE           B.H31800D';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FLYTEJBAKT;                                 
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - ÅRSVURD ' !!         
                         BH55300M.INDKÅR1;                              
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FLYTEJB07;                                  
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - ÅRSVURD ' !!         
                          BH55300M.GLSLUTÅR1;                           
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FLYTEJB072Ø;                                
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - OMBER02 ØVR ';       
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FLYTEJB072N;                                
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - OMBER02 NY  ';       
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FLYTEJB071Ø;                                
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - OMBER01 ØVR ';       
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FLYTEJB071N;                                
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - OMBER01 NY  ';       
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FLYTEJB02;                                  
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - ÅRSVURD 2002';       
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FLYTEJB01;                                  
         DETLIN1.TEKST = 'FLYT EJEBOL(2) TIL (1) - ÅRSVURD 2001';       
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
 END TOTALLISTE;                                                        
 /**************************************************************/       
 /*   FORSKUD06  VURDOPL2 -> VURDOPL02                         */       
 VURDOPL02: PROC;                                                       
                                                                        
         IF BH339.VURDOPL02.ÅRSVURD.EJEBOL(1).EJBOLTYP < '1' &          
            BH339.VURDOPL02.ÅRSVURD.EJEBOL(2).EJBOLTYP > '0'            
         THEN                                                           
            DO;                                                         
               BH339.VURDOPL02.ÅRSVURD.EJEBOL(1) =                      
               BH339.VURDOPL02.ÅRSVURD.EJEBOL(2), BY NAME;              
               BH339.VURDOPL02.ÅRSVURD.EJEBOL(2) = '';                  
               TV.FLYTEJB02 = TV.FLYTEJB02 + 1;                         
            END;                                                        
                                                                        
 END  VURDOPL02;                                                        
 /**************************************************************/       
 VURDOPL01: PROC;                                                       
                                                                        
         IF BH339.VURDOPL01.EJEBOL(1).EJBOLTYP < '1' & /*FORSKUD06*/    
            BH339.VURDOPL01.EJEBOL(2).EJBOLTYP > '0'   /*FORSKUD06*/    
         THEN                                                           
            DO;                                                         
               BH339.VURDOPL01.EJEBOL(1) =             /*FORSKUD06*/    
               BH339.VURDOPL01.EJEBOL(2), BY NAME;     /*FORSKUD06*/    
               BH339.VURDOPL01.EJEBOL(2) = '';         /*FORSKUD06*/    
               TV.FLYTEJB01 = TV.FLYTEJB01 + 1;        /*FORSKUD06*/    
            END;                                                        
                                                                        
 END  VURDOPL01;                                                        
 /**************************************************************/       
 SKATSTOP: PROC;                                      /*FORSKUD06*/     
                                                                        
         IF BH339.SKATSTOP.OMBER01(1).EJEBOL(1).EJBOLTYP < '1' &        
            BH339.SKATSTOP.OMBER01(1).EJEBOL(2).EJBOLTYP > '0'          
         THEN                                                           
            DO;                                                         
               BH339.SKATSTOP.OMBER01(1).EJEBOL(1) =                    
               BH339.SKATSTOP.OMBER01(1).EJEBOL(2), BY NAME;            
               BH339.SKATSTOP.OMBER01(1).EJEBOL(2) = '';                
               TV.FLYTEJB071Ø = TV.FLYTEJB071Ø + 1;                     
            END;                                                        
                                                                        
         IF BH339.SKATSTOP.OMBER01(2).EJEBOL(1).EJBOLTYP < '1' &        
            BH339.SKATSTOP.OMBER01(2).EJEBOL(2).EJBOLTYP > '0'          
         THEN                                                           
            DO;                                                         
               BH339.SKATSTOP.OMBER01(2).EJEBOL(1) =                    
               BH339.SKATSTOP.OMBER01(2).EJEBOL(2), BY NAME;            
               BH339.SKATSTOP.OMBER01(2).EJEBOL(2) = '';                
               TV.FLYTEJB071N = TV.FLYTEJB071N + 1;                     
            END;                                                        
                                                                        
         IF BH339.SKATSTOP.OMBER02(1).EJEBOL(1).EJBOLTYP < '1' &        
            BH339.SKATSTOP.OMBER02(1).EJEBOL(2).EJBOLTYP > '0'          
         THEN                                                           
            DO;                                                         
               BH339.SKATSTOP.OMBER02(1).EJEBOL(1) =                    
               BH339.SKATSTOP.OMBER02(1).EJEBOL(2), BY NAME;            
               BH339.SKATSTOP.OMBER02(1).EJEBOL(2) = '';                
               TV.FLYTEJB072Ø = TV.FLYTEJB072Ø + 1;                     
            END;                                                        
                                                                        
         IF BH339.SKATSTOP.OMBER02(2).EJEBOL(1).EJBOLTYP < '1' &        
            BH339.SKATSTOP.OMBER02(2).EJEBOL(2).EJBOLTYP > '0'          
         THEN                                                           
            DO;                                                         
               BH339.SKATSTOP.OMBER02(2).EJEBOL(1) =                    
               BH339.SKATSTOP.OMBER02(2).EJEBOL(2), BY NAME;            
               BH339.SKATSTOP.OMBER02(2).EJEBOL(2) = '';                
               TV.FLYTEJB072N = TV.FLYTEJB072N + 1;                     
            END;                                                        
 END  SKATSTOP;                                                         
 /**************************************************************/       
 VURDOPLGL: PROC;                                                       
                            /*FORSKUD06   VURDOPL1 -> VURDOPLGL*/       
         IF BH339.VURDOPLGL.ÅRSVURD.CEJERL = '0'                        
         THEN                                                           
            BH339.VURDOPLGL.ÅRSVURD.CEJERL = ' ';                       
                                                                        
         IF BH339.VURDOPLGL.ÅRSVURD.CUOP = '0'                          
         THEN                                                           
            BH339.VURDOPLGL.ÅRSVURD.CUOP = ' ';                         
                                                                        
         IF BH339.VURDOPLGL.ÅRSVURD.EJEBOL(1).EJBOLTYP < '1' &          
            BH339.VURDOPLGL.ÅRSVURD.EJEBOL(2).EJBOLTYP > '0'            
         THEN                                                           
            DO;                                                         
               BH339.VURDOPLGL.ÅRSVURD.EJEBOL(1) =                      
               BH339.VURDOPLGL.ÅRSVURD.EJEBOL(2), BY NAME;              
               BH339.VURDOPLGL.ÅRSVURD.EJEBOL(2) = '';                  
               TV.FLYTEJB07 = TV.FLYTEJB07 + 1;                         
            END;                                                        
                                                                        
 END  VURDOPLGL;                                                        
 /************************************************************/         
 VURDOPLNY: PROC;                                                       
               /*FORSKUD06   VURDOPL0 -> VURDOPLNY  */                  
         IF BH339.VURDOPLNY.ÅRSVURD.CFORSKEL = '0'                      
         THEN                                                           
            BH339.VURDOPLNY.ÅRSVURD.CFORSKEL = ' ';                     
                                                                        
         IF BH339.VURDOPLNY.ÅRSVURD.CEJERL = '0'                        
         THEN                                                           
            BH339.VURDOPLNY.ÅRSVURD.CEJERL = ' ';                       
                                                                        
         IF BH339.VURDOPLNY.ÅRSVURD.CUOP = '0'                          
         THEN                                                           
            BH339.VURDOPLNY.ÅRSVURD.CUOP = ' ';                         
                                                                        
         IF BH339.VURDOPLNY.ÅRSVURD.EJEBOL(1).EJBOLTYP < '1' &          
            BH339.VURDOPLNY.ÅRSVURD.EJEBOL(2).EJBOLTYP > '0'            
         THEN                                                           
            DO;                                                         
               BH339.VURDOPLNY.ÅRSVURD.EJEBOL(1) =                      
               BH339.VURDOPLNY.ÅRSVURD.EJEBOL(2), BY NAME;              
               BH339.VURDOPLNY.ÅRSVURD.EJEBOL(2) = '';                  
               TV.FLYTEJBAKT = TV.FLYTEJBAKT + 1;                       
            END;                                                        
                                                                        
 END  VURDOPLNY;                                                        
 /*********************************************************************/
 /*      CLOSE AF FILER OG SPOOL                                      */
 /*********************************************************************/
 AFSLUT:                                                                
         PROC;                                                          
                                                                        
         CALL TOTALLISTE;                                               
                                                                        
         CLOSE FILE (BH339I),                                           
               FILE (BH3180O),                                          
               FILE (BH3181O);                                          
                                                                        
         CALL ZZ20300((133)' ','99');                                   
                                                                        
 END AFSLUT;                                                            
 /*********************************************************************/
 /* HER UDSKRIVES ØVRIGE FEJL                                  RUTINE */
 /*********************************************************************/
 PROGRAM_FEJL: PROC;                                                    
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED PROGRAMFEJL');                 
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END PROGRAM_FEJL;                                                      
 /*********************************************************************/
 END  BH31800;                                                          
