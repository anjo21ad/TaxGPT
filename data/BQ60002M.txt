 /********************************************************************/ 
 /*                                                                  */ 
 /* NAVN     : BQ60002M BEHANDLING AF UNIKKE TS-KØER                 */ 
 /*                                                                  */ 
 /* FUNKTION : TILDEL_EN_TSKØ   : ADMINISTRERER FEJLHÅNDTERERING     */ 
 /*                               VEDR. TS-KØ TILDELING              */ 
 /*            TILDEL_TSKØ_NAVN : TILDELER ET UNIKT NAVN TIL EN TS-KØ*/ 
 /*            GENFIND_TSKØ_NAVN: GENFINDER NAVNET PÅ EN TS-KØ       */ 
 /*            FRIGIV_TSKØ_NAVN : FRIGIVER NAVNET PÅ EN TILDELT TS-KØ*/ 
 /*            SLET_TSKØ        :   SLETTER TS-KØ                    */ 
 /*                                                                  */ 
 /* PARAMETER:                                                       */ 
 /*                                                                  */ 
 /* KALD     : TS_NAVN =                                             */ 
 /*          : TILDEL_TSKØ_NAVN(EIBTRMID !! 'ZSRØR','ZSRØR',PTR);    */ 
 /*          : TS_NAVN = TILDEL_TSKØ_NAVN(EIBTRMID !! 'ZSRØR');      */ 
 /*          : TS_NAVN = GENFIND_TSKØ_NAVN(EIBTRMID !! 'ZSRØR');     */ 
 /*          : TS_NAVN = GENFIND_TSKØ_NAVN(EIBTRMID !! 'ZSRØR');     */ 
 /*          : FRIGIV_TSKØ_NAVN(EIBTRMID !! 'LINE');                 */ 
 /*          : SLET_TSKØ_NAVN(EIBTRMID !! 'LINE');                   */ 
 /* EFT.KALD :                                                       */ 
 /*                                                                  */ 
 /* OPRETTET : 19.01.2001 AF Z6TMD.                                  */ 
 /*                                                                  */ 
 /********************************************************************/ 
         DCL   CICSRETUR                PIC'ZZZ9';                      
                                                                        
 /**********************************************************************
 **     TILDELING AF TS-KØNAVN.                                       **
 **********************************************************************/
 TILDEL_TSKØ_NAVN:   PROC (TSNAVN)                                      
                     RETURNS (CHAR (08));                               
                                                                        
      DCL  TSNAVN               CHAR (14);                              
      ZS62002                = '';                                      
      ZS62002.FUNKTION       = '1';                                     
      ZS62002.IDENTIFIKATION = TSNAVN;                                  
      CALL TSKØNAVNRUTINE;                                              
                                                                        
      IF ZS62002.RC = 0 THEN                                            
         RETURN(ZS62002.TSQNAVN);                                       
      ELSE                                                              
         RETURN(' ');                                                   
 END TILDEL_TSKØ_NAVN;                                                  
                                                                        
 /**********************************************************************
 **     GENFIND TS-KØNAVN.                                            **
 **********************************************************************/
 GENFIND_TSKØ_NAVN:   PROC (TSNAVN)                                     
                      RETURNS (CHAR (08));                              
                                                                        
      DCL  TSNAVN               CHAR (14);                              
      ZS62002                = '';                                      
      ZS62002.FUNKTION       = '2';                                     
      ZS62002.IDENTIFIKATION = TSNAVN;                                  
      CALL TSKØNAVNRUTINE;                                              
                                                                        
      IF ZS62002.RC = 0 THEN                                            
         RETURN(ZS62002.TSQNAVN);                                       
      ELSE                                                              
         RETURN(' ');                                                   
                                                                        
                                                                        
 END GENFIND_TSKØ_NAVN;                                                 
 /**********************************************************************
 **     FRIGIV DET RESERVEREDE TSKØ NAVN.                             **
 **********************************************************************/
 FRIGIV_TSKØ_NAVN: PROC(TSNAVN);                                        
                                                                        
   DCL  TSNAVN               CHAR (14);                                 
   ZS62002                = '';                                         
   ZS62002.FUNKTION       = '3';                                        
   ZS62002.IDENTIFIKATION = TSNAVN;                                     
   CALL TSKØNAVNRUTINE;                                                 
                                                                        
 END FRIGIV_TSKØ_NAVN;                                                  
 /**********************************************************************
 **    SLETNING AF TSKØER.                                            **
 **********************************************************************/
 SLET_TSKØ_EVS:  PROC(TS_KØNAVN);                                       
                                                                        
   DCL TS_KØNAVN             CHAR(8);                                   
                                                                        
   EXEC CICS DELETEQ TS QUEUE(TS_KØNAVN)                                
                        NOHANDLE;                                       
 END SLET_TSKØ_EVS;                                                     
 /**********************************************************************
 **     KALD RUTINE TIL FREMSKAFFELSE AF UNIQUE TSKØNAVN.             **
 **********************************************************************/
 TSKØNAVNRUTINE:   PROC;                                                
                                                                        
   EXEC CICS LINK PROGRAM('ZS62002')                                    
                  COMAREA(ZS62002)                                      
                  RESP(CICSRC);                                         
                                                                        
 END TSKØNAVNRUTINE;                                                    
                                                                        
 /**********************************************************************
 *    LÆS FUNDNE OPLYSNINGER FRA TSKØ.                               *  
 **********************************************************************/
 LÆS_TSKØ_OVERSIGT_EVS:  PROC(TSKØNAVN,ITEMNO,EOF_SW);                  
         DCL   TSKØNAVN                CHAR(8);                         
         DCL   ITEMNO                  BIN FIXED(15,0);                 
         DCL   EOF_SW                  BIT(01);                         
                                                                        
         EXEC CICS READQ TS QUEUE(TSKØNAVN)                             
                            ITEM(ITEMNO)                                
                            INTO(TS_DATA)                               
                            RESP(CICSRC);                               
                                                                        
         CICSRETUR = CICSRC;                                            
         TESTPRT('...VED LÆS_TSKØ_OVERSIGT_EVS CICSRC:',CICSRETUR);     
                                                                        
         SELECT (CICSRC);                                               
            WHEN (DFHRESP(NORMAL)) DO;                                  
               EOF_SW = NEJ;                                            
            END;                                                        
            WHEN (DFHRESP(QIDERR)) DO;                                  
               EOF_SW = JA;                                             
            END;                                                        
            WHEN (DFHRESP(ITEMERR)) DO;                                 
               EOF_SW = JA;                                             
            END;                                                        
            OTHERWISE DO;                                               
               EOF_SW = JA;                                             
            END;                                                        
         END;                                                           
 END LÆS_TSKØ_OVERSIGT_EVS;                                             
                                                                        
 /**********************************************************************
 *    LÆS FUNDNE OPLYSNINGER FRA TSKØ.                               *  
 **********************************************************************/
 LÆS_TSKØ_GRUND_EVS:  PROC(TSKØNAVN,ITEMNO,EOF_SW);                     
 DCL  TSKØNAVN             CHAR(8);                                     
 DCL  ITEMNO               BIN FIXED(15,0);                             
 DCL  EOF_SW               BIT(01);                                     
                                                                        
   EXEC CICS READQ TS QUEUE(TSKØNAVN)                                   
                      ITEM(ITEMNO)                                      
                      INTO(TS_KOLON_DATA)                               
                      RESP(CICSRC);                                     
  SELECT (CICSRC);                                                      
     WHEN (DFHRESP(NORMAL))                                             
       EOF_SW = NEJ;                                                    
     WHEN (DFHRESP(QIDERR)) /* KØEN FINDES IKKE */                      
       EOF_SW = JA;                                                     
     WHEN (DFHRESP(ITEMERR))                                            
       EOF_SW = JA;                                                     
     OTHER                                                              
       EOF_SW = JA;                                                     
   END;                                                                 
                                                                        
 END LÆS_TSKØ_GRUND_EVS;                                                
                                                                        
 /**********************************************************************
 *    LÆS FUNDNE OPLYSNINGER FRA UDSKRIFT TSKØ                       *  
 **********************************************************************/
 LÆS_TSKØ_UDSKRIFT_EVS:  PROC(TSKØNAVN,ITEMNO,EOF_SW);                  
 DCL  TSKØNAVN             CHAR(8);                                     
 DCL  ITEMNO               BIN FIXED(15,0);                             
 DCL  EOF_SW               BIT(01);                                     
                                                                        
   EXEC CICS READQ TS QUEUE(TSKØNAVN)                                   
                      ITEM(ITEMNO)                                      
                      INTO(TS_UDSKRIFT_DATA)                            
                      RESP(CICSRC);                                     
  SELECT (CICSRC);                                                      
     WHEN (DFHRESP(NORMAL))                                             
       EOF_SW = NEJ;                                                    
     WHEN (DFHRESP(QIDERR)) /* KØEN FINDES IKKE */                      
       EOF_SW = JA;                                                     
     WHEN (DFHRESP(ITEMERR))                                            
       EOF_SW = JA;                                                     
     OTHER                                                              
       EOF_SW = JA;                                                     
   END;                                                                 
                                                                        
 END LÆS_TSKØ_UDSKRIFT_EVS;                                             
                                                                        
 /**********************************************************************
 *    LÆS FUNDNE OPLYSNINGER FRA UDSKRIFT TSKØ                       *  
 **********************************************************************/
 LÆS_TSKØ_BEREGN_EVS:  PROC(TSKØNAVN,ITEMNO,EOF_SW);                    
 DCL  TSKØNAVN             CHAR(8);                                     
 DCL  ITEMNO               BIN FIXED(15,0);                             
 DCL  EOF_SW               BIT(01);                                     
                                                                        
   EXEC CICS READQ TS QUEUE(TSKØNAVN)                                   
                      ITEM(ITEMNO)                                      
                      INTO(TS_BEREGN_DATA)                              
                      RESP(CICSRC);                                     
   SELECT (CICSRC);                                                     
     WHEN (DFHRESP(NORMAL)) DO;                                         
       EOF_SW = NEJ;                                                    
     END;                                                               
     WHEN (DFHRESP(QIDERR)) DO;                                         
       EOF_SW = JA;                                                     
     END;                                                               
     WHEN (DFHRESP(ITEMERR)) DO;                                        
       EOF_SW = JA;                                                     
     END;                                                               
     OTHERWISE DO;                                                      
       EOF_SW = JA;                                                     
     END;                                                               
   END;                                                                 
 END LÆS_TSKØ_BEREGN_EVS;                                               
                                                                        
 /**********************************************************************
 *    LÆS FUNDNE OPLYSNINGER FRA BEREGNINGENS HISTORISKE GRUND OPLYS. * 
 **********************************************************************/
 LÆS_TSKØ_OPLYS_GRND_EVS:  PROC(TSKØNAVN,ITEMNO,EOF_SW);                
 DCL  TSKØNAVN             CHAR(8);                                     
 DCL  ITEMNO               BIN FIXED(15,0);                             
 DCL  EOF_SW               BIT(01);                                     
                                                                        
   EXEC CICS READQ TS QUEUE(TSKØNAVN)                                   
                      ITEM(ITEMNO)                                      
                      INTO(TS_OPLYS_GRND_DATA)                          
                      RESP(CICSRC);                                     
  SELECT (CICSRC);                                                      
     WHEN (DFHRESP(NORMAL)) DO;                                         
       EOF_SW = NEJ;                                                    
     END;                                                               
     WHEN (DFHRESP(QIDERR)) DO;                                         
       EOF_SW = JA;                                                     
     END;                                                               
     WHEN (DFHRESP(ITEMERR)) DO;                                        
       EOF_SW = JA;                                                     
     END;                                                               
     OTHERWISE DO;                                                      
       EOF_SW = JA;                                                     
     END;                                                               
   END;                                                                 
 END LÆS_TSKØ_OPLYS_GRND_EVS;                                           
                                                                        
 /**********************************************************************
 *    LÆS FUNDNE OPLYSNINGER FRA TSKØ.                               *  
 **********************************************************************/
 LÆS_TSKØ_FEJL_EVS:  PROC(TSKØNAVN,ITEMNO,EOF_SW);                      
 DCL  TSKØNAVN             CHAR(8);                                     
 DCL  ITEMNO               BIN FIXED(15,0);                             
 DCL  EOF_SW               BIT(01);                                     
                                                                        
   EXEC CICS READQ TS QUEUE(TSKØNAVN)                                   
                      ITEM(ITEMNO)                                      
                      INTO(TS_FEJL_DATA)                                
                      RESP(CICSRC);                                     
  SELECT (CICSRC);                                                      
     WHEN (DFHRESP(NORMAL))                                             
       EOF_SW = NEJ;                                                    
     WHEN (DFHRESP(QIDERR)) /* KØEN FINDES IKKE */                      
       EOF_SW = JA;                                                     
     WHEN (DFHRESP(ITEMERR))                                            
       EOF_SW = JA;                                                     
     OTHER                                                              
       EOF_SW = JA;                                                     
   END;                                                                 
                                                                        
 END LÆS_TSKØ_FEJL_EVS;                                                 
 /**********************************************************************
 *    SKRIV FUNDNE OPLYSNINGER PÅ TSKØ.                              *  
 **********************************************************************/
 SKRIV_TSKØ_EVS:  PROC(TSKØNAVN);                                       
 DCL  TSKØNAVN             CHAR(8);                                     
                                                                        
   EXEC CICS WRITEQ TS QUEUE(TSKØNAVN)                                  
                       FROM(TS_DATA)                                    
                       RESP(CICSRC);                                    
                                                                        
 END SKRIV_TSKØ_EVS;                                                    
 /**********************************************************************
 *    SKRIV FUNDNE OPLYSNINGER PÅ TSKØ.                              *  
 **********************************************************************/
 SKRIV_TSKØ_FEJL_EVS:  PROC(TSKØNAVN);                                  
 DCL  TSKØNAVN             CHAR(8);                                     
                                                                        
   EXEC CICS WRITEQ TS QUEUE(TSKØNAVN)                                  
                       FROM(TS_FEJL_DATA)                               
                       RESP(CICSRC);                                    
                                                                        
 END SKRIV_TSKØ_FEJL_EVS;                                               
