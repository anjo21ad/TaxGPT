 BE24800:    /* Omplacering indkomstår (individ 135)                  */
 PROC OPTIONS (MAIN) REORDER;                                           
 /*********************************************************************/
 /* FUNKTION:                                                         */
 /* LÆSE OMPLACERING (SKIFT AF PESONNUMER) PÅ BE90200T FRA DXC        */
 /* I FORBINDELSE MED ÅRSOPGØRELSEN                                   */
 /* OPDATER SLUT TABELLER BE30000T og BE40000T                        */
 /* SÅ EJERFORHOLD FLYTTES TIL NYT CPRNUMMER                          */
 /* PROGRAMMET SKAL GØRE DET SAMME SOM DETTE CICS PROGRAM             */
 /* GØR I EVS SLUT (2018)                                             */
 /* Det kaldes via BE99800  - >  BE99900                              */
 /* BE18070 - omplacering                                             */
 /*                                                                   */
 /*  EXTERNE REF.    ZS30101   ABENDRUTINE                            */
 /*                  ZS61900   LOGNING AF KST-DATO PÅ LOAD            */
 /*                                                                   */
 /* OPRETTET AF ESBEN BRODERSEN EBD MARTS 2020                        */
 /* rettet af   Per Brunk september 2020                              */
 /*             vedr. OMPLARTKOD=S skal ikke behandles                */
 /*                                                                   */
 /*      RETTET AF   : ONE                               10/05-2021   */
 /*      VEDRØRENDE  : ÅRSTILRETNING 2020                             */
 /*      RETTET AF   : ONE                               nov-2021     */
 /*      VEDRØRENDE  : ÅRSTILRETNING 2021                             */
 /*      RETTET AF   : ONE                               nov-2022     */
 /*      VEDRØRENDE  : ÅRSTILRETNING 2022                             */
 /*      RETTET AF   : JJJ                               Sep-2023     */
 /*      VEDRØRENDE  : ÅRSTILRETNING 2024                             */
 /*      RETTET AF   : HNK                               Sep-2023     */
 /*      VEDRØRENDE  : ÅRSTILRETNING 2024 NY EVS         Nov-2023     */
 /*********************************************************************/
 /*      DECLARES AF FILES                                            */
 /*********************************************************************/
  DCL SYSPRINT EXTERNAL FILE PRINT;                                     
 /*********************************************************************/
 /*      DECLARES AF BUILTIN-FUNKTIONER                               */
 /*********************************************************************/
   DCL (ADDR,                                                           
        CSTG,                                                           
        NULL,                                                           
        STG,                                                            
        INDEX,                                                          
        SUBSTR,                                                         
        LBOUND,                                                         
        HBOUND,                                                         
        VERIFY,                                                         
        DIVIDE,                                                         
        LENGTH,                                                         
        MOD,                                                            
        PLIRETC,                                                        
        PLIDUMP,                                                        
        LOW,                                                            
        TIMESTAMP)           BUILTIN;                                   
                                                                        
 /*********************************************************************/
 /*      DB2 TABELSTRUKTURER                                          */
 /*********************************************************************/
   EXEC SQL INCLUDE SQLCA;                                              
   EXEC SQL INCLUDE BE90000T; /*Driftsstyringstabel                   */
   EXEC SQL INCLUDE BE90200T; /*Indlæsningstabel                      */
   EXEC SQL INCLUDE BE30000T; /* EVS SLUT EJERSKABSTABEL              */
   EXEC SQL INCLUDE BE40000T; /* EVS SLUT RESULTATTABEL               */
                                                                        
 DCL 1 BE300_SW,     /* Indikatorvariable til BE30000T */               
       %INCLUDE BE30005M;                                               
                                                                        
 DCL 1 BE400_SW,     /* Indikatorvariable til BE40000T */               
       %INCLUDE BE40005M;                                               
                                                                        
 /*********************************************************************/
 /*      DECLARES                                                     */
 /*********************************************************************/
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS67000         ENTRY;                                         
 /*********************************************************************/
 /*      ENTRY-DECLARE DATORUTINE & FORMAT DDMMÅRHU                   */
 /*********************************************************************/
 %INCLUDE ZS38000N;                                                     
 %INCLUDE ZS38002N;                                                     
 DCL     HELP_DATOC           CHAR      (8),                            
         HELP_DATOP           PIC       '(8)9'  DEF HELP_DATOC,         
         1 HELP_DTX           DEF       HELP_DATOC,                     
          2 ÅRX               PIC       '9999',                         
          2 MDX               PIC       '99',                           
          2 DGX               PIC       '99';                           
 DCL     DATO                      PIC       '(8)9',                    
         1 DATO_DEF                DEF       DATO,                      
          2 DG1                    PIC       '99',                      
          2 MD1                    PIC       '99',                      
          2 ÅR1                    PIC       '9999';                    
 DCL     TID             CHAR      (9);                                 
 DCL     1 TID1          BASED(ADDR(TID)),                              
           2 TIM          CHAR      (2),                                
           2 MIN          CHAR      (2),                                
           2 SEK          CHAR      (2);                                
                                                                        
 /********************************************************************/ 
 /* Input - PARM -                                                   */ 
 /********************************************************************/ 
 DCL PARM              FILE RECORD INPUT;                               
 DCL 1 PARM_REC,                                                        
       3 PARM_FUNKTION  CHAR(08),                                       
       3 PARM_FILLER    CHAR(72);                                       
                                                                        
 /*********************************************************************/
 /*      DIVERSE DECLARES                                             */
 /*********************************************************************/
   DCL I       BIN FIXED(15);                                           
                                                                        
   DCL FEJL              BIT(1) INIT('1'B);                             
   DCL OK                BIT(1) INIT('0'B);                             
   DCL JA                BIT(1) INIT('1'B);                             
   DCL NEJ               BIT(1) INIT('0'B);                             
   DCL TRUE              BIT(1) INIT('1'B);                             
   DCL FALSE             BIT(1) INIT('0'B);                             
   DCL TFLAG             BIT(1) INIT('0'B);                             
   DCL OMPLACER_FUNDET   BIT(1) INIT('0'B);                             
   DCL GL_PERSON_FUNDET  BIT(1) INIT('0'B);                             
                                                                        
   DCL HJ_PIC_999  PIC '999' ;                                          
   DCL HJ_PIC_9999 PIC '9999' ;                                         
                                                                        
   DCL TAL          CHAR (10)   INIT ('0123456789');                    
                                                                        
   DCL WK_KOERDTO   CHAR (10);                                          
   DCL RETURTEKST   CHAR (45) INIT(' ');                                
   DCL TIDSSTAMP    CHAR (26);                                          
                                                                        
   DCL ANTAL_FETCH_OMPLA BIN FIXED(31) INIT(0);                         
   DCL ANTAL_OPD_PERSON  BIN FIXED(31) INIT(0);                         
   DCL ANTAL_OPD_RESULT  BIN FIXED(31) INIT(0);                         
                                                                        
   DCL MAX_TIMESTAMP   CHAR(26) INIT ('9999-12-31-23.59.59.999999');    
                                                                        
   DCL ANT_COMM          BIN FIXED(31) INIT(0);                         
                                                                        
   DCL PROGRAM_1     CHAR (08) INIT ('BE24600L');             /*ÅR-RET*/
   DCL PROGRAM_2     CHAR (08) INIT ('BE24800L');             /*ÅR-RET*/
                                                                        
   DCL HJ_PNR       PIC '(10)9'      INIT(0);                           
   DCL WK_INDKAAR   BIN FIXED (15)   INIT(2024);   /*ÅR-RET*//*¤SLUT19*/
   DCL WK_KOERNR    BIN FIXED (15)   INIT(0);                           
                                                                        
 /**********************************************************************
 * ØVRIGE DECLARES                                                     *
 **********************************************************************/
                                                                        
 DCL  PROGRAM                 CHAR      (08);                           
 DCL  SØGDINDKAAR             BIN FIXED (15);                           
 DCL  SØGKOERNR               BIN FIXED (15);                           
 DCL  SØGPNR                  DEC FIXED (11);                           
 DCL  SØGKOMNR                BIN FIXED (15);                           
 DCL  SØGEJDNR                BIN FIXED (31);                           
 DCL  SØGEENHEDLBNR           BIN FIXED (15);                           
 DCL  SØGLBNR                 BIN FIXED (15);                           
 DCL  GLPNR                   DEC FIXED (11);                           
 DCL  NYTPNR                  DEC FIXED (11);                           
 DCL  GLPNR_CHAR              CHAR (10);                                
 DCL  NYTPNR_CHAR             CHAR (10);                                
 DCL  RETURKODE               BIN FIXED (15);                           
                                                                        
 /*********************************************************************/
 /****** PRINTLINIER TIL INTERN FEJL- OG KONTROLLISTE                 */
 /*********************************************************************/
   % INCLUDE ZZ20301M;                  /* STANDARD KONTROLKARAKTERER */
                                                                        
   DCL     1   LINIE,                                                   
             3  CCHAR      CHAR      (1),                               
             3  TEXT       CHAR      (132);                             
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
 /*********************************************************************/
 /*      HOUSEKEEPING                                                 */
 /*********************************************************************/
            ON ERROR                                                    
            BEGIN;                                                      
                ON ERROR SYSTEM;                                        
                PUT SKIP LIST ('PROGRAMFEJL');                          
                CALL PLIDUMP  ('SBKO','MODUL BE24800');       /*ÅR-RET*/
            END;                                                        
                                                                        
         CALL ZS61900;/* SKRIV SSI-DATO */                              
         ZS380PARM.RETURKODE  = 0;                                      
         FUNKTION   = 'DAGSDATO';                                       
         VALIDERING = 'N';                                              
         CALL ZS38000(ZS380PARM.FUNKTION,                               
                      ZS380PARM.VALIDERING,                             
                      ZS380PARM.PARM,                                   
                      ZS380PARM.RETURKODE);                             
                                                                        
         HELP_DATOC   = ZS380PARM3.DATO1;                               
         DATO_DEF.DG1 = HELP_DTX.DGX;                                   
         DATO_DEF.MD1 = HELP_DTX.MDX;                                   
         DATO_DEF.ÅR1 = HELP_DTX.ÅRX;                                   
                                                                        
         CALL ZZ20390 ('*OPEN','BE24889Y'); /* KONTROLLISTE *//*ÅR-RET*/
                                                                        
         PARM_REC = '';                                                 
         PARM_FUNKTION = '*';                                           
                                                                        
         ON UNDEFINEDFILE(PARM) BEGIN;                                  
           GO TO HOUSEKEEPING_SLUT;                                     
         END;                                                           
                                                                        
         OPEN FILE(PARM) TITLE('PARM');                                 
                                                                        
         ON ENDFILE(PARM) BEGIN;                                        
           GO TO HOUSEKEEPING_SLUT;                                     
         END;                                                           
                                                                        
        READ FILE(PARM) INTO(PARM_REC);                                 
                                                                        
        TIDSSTAMP = TIMESTAMP;                                          
                                                                        
        /* Hvad skal styre start på læs af BE90200T */                  
 /*------------------------------------------------------------------*/ 
 /* HOUSEKEEPING_SLUT                                                */ 
 /*------------------------------------------------------------------*/ 
 HOUSEKEEPING_SLUT:                                                     
                                                                        
 /*********************************************************************/
 /*      HOVEDSTYRING                                                 */
 /*********************************************************************/
         CALL FIND_KØRSELSNR;                                           
         IF WK_KOERNR > 0                                               
         THEN DO;                                                       
            Call Declare_Cur_BE902;                                     
                                                                        
            EXEC SQL Open Cur_BE902;                                    
            IF SQLCA.SQLCODE ^= 0                                       
            THEN DO;                                                    
               RETURTEKST = 'SQLFEJL: OPEN Cur_BE902';                  
               CALL SQL_FEJL;                                           
               END;                                                     
                                                                        
            Call Fetch_Cur_BE902;                                       
                                                                        
            Do While (OMPLACER_FUNDET);                                 
               Call FINDES_GL_CPRNR_PERSON;                             
               Call FINDES_NYT_CPRNR_PERSON;                            
               IF GL_PERSON_FUNDET                                      
               Then                                                     
                  CALL BEHANDLING;                                      
               Call Fetch_Cur_BE902;                                    
               End;                                                     
                                                                        
            EXEC SQL Close Cur_BE902;                                   
            IF SQLCA.SQLCODE ^= 0                                       
            THEN DO;                                                    
               RETURTEKST = 'SQLFEJL: CLOSE Cur_BE902';                 
               CALL SQL_FEJL;                                           
               END;                                                     
                                                                        
            CALL OPDATER_OVERFØR_STATUS;                                
            CALL SKRIV_TOTALER;                                         
            End;                                                        
        CALL AFSLUT;                                                    
                                                                        
 /*********************************************************************/
 /*    Omplaceringsprogrammet finder det mindste kørselsnr.           */
 /*    (for indkomståret) i kørselstabellen,                          */
 /*     hvor Omplacering ikke er udført.                              */
 /*                                                                   */
 /*********************************************************************/
 FIND_KØRSELSNR: PROC;                                                  
                                                                        
     DCLBE90000T = '';                                                  
                                                                        
     EXEC SQL SELECT KOERNR                                             
         INTO :DCLBE90000T.KOERNR                                       
         FROM BE90000T                                                  
         WHERE INDKAAR         = :WK_INDKAAR                            
           AND INDIVIDNR       = 135                                    
           AND INDLÆS_NAVN     = :PROGRAM_1                             
           AND OVERFØR_NAVN    = :PROGRAM_2                             
           AND OVERFØR_STATUS  = 0                                      
           AND INDLÆS_STATUS   = 1                                      
         ORDER BY KOERNR                                                
     FETCH FIRST ROW ONLY;                                              
                                                                        
     SELECT (SQLCODE);                                                  
       WHEN (0)                                                         
         DO;                                                            
           PUT SKIP LIST('NYE Omplaceringer FUNDET');                   
           PUT SKIP LIST('Indkomstår    :',WK_INDKAAR);                 
           PUT SKIP LIST('KØRSELSNUMMER :',DCLBE90000T.KOERNR);         
           WK_KOERNR = DCLBE90000T.KOERNR;                              
         END;                                                           
       WHEN (100)                                                       
         DO;                                                            
           PUT SKIP LIST('INGEN NYE Omplaceringer FUNDET');             
           WK_KOERNR = 0;                                               
         END;                                                           
       OTHER                                                            
         DO;                                                            
           ABENDTXT='SELECT I FIND_KØRSELSNR SQLCODE: '                 
                     !! SQLCODE;                                        
           CALL sql_fejl;                                               
         END;                                                           
     END;                                                               
                                                                        
 END FIND_KØRSELSNR;                                                    
 /*********************************************************************/
 /*      BEHANDLING                                                   */
 /*********************************************************************/
 BEHANDLING: PROC;                                                      
                                                                        
         SØGDINDKAAR = WK_INDKAAR;                                      
         GLPNR       = DCLBE90200T.PNR;                                 
         GLPNR_CHAR  = FIX11_TIL_CHAR10(GLPNR);                         
         SØGPNR      = GLPNR;                                           
         NYTPNR      = CHAR10_TIL_FIX11(DCLBE90200T.NYTPNR);            
         NYTPNR_CHAR = DCLBE90200T.NYTPNR;                              
         SØGPNR      = NYTPNR;                                          
                                                                        
         CALL DECLARE_EJD_CUR;                                          
                                                                        
         EXEC SQL OPEN EJD_CUR;                                         
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
           DO;                                                          
             RETURTEKST = 'SQLFEJL: OPEN EJD_CUR';                      
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
         CALL FETCH_EJD_CUR;                                            
                                                                        
         DO WHILE(SQLCODE = 0);                                         
            CALL LÆS_NYT_PNR_PERSON;                                    
                                                                        
            IF SQLCA.SQLCODE = 100                                      
            THEN                                                        
               DO;                                                      
                 CALL OPDAT_GL_PNR_PERSON;                              
                 CALL KOPIER_ESK_TABEL;                                 
                 ANTAL_OPD_PERSON = ANTAL_OPD_PERSON + 1;               
                 ANT_COMM = ANT_COMM + 1;                               
                                                                        
                 CALL LÆS_GL_PNR_RESULTAT;                              
                                                                        
                 IF SQLCA.SQLCODE = 0                                   
                 THEN                                                   
                    DO;                                                 
                      CALL OPDAT_GL_PNR_RESULTAT;                       
                      CALL KOPIER_RES_TABEL;                            
                      ANTAL_OPD_RESULT = ANTAL_OPD_RESULT + 1;          
                    END;                                                
               END;                                                     
                                                                        
            CALL FETCH_EJD_CUR;                                         
         END;                                                           
                                                                        
         EXEC SQL CLOSE EJD_CUR;                                        
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
           DO;                                                          
             RETURTEKST = 'SQLFEJL: CLOSE EJD_CUR';                     
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
         /* HUSK COMMIT*/                                               
         IF ANT_COMM > 4999                                             
         THEN                                                           
           DO;                                                          
             EXEC SQL COMMIT;                                           
             PUT SKIP LIST ('Commit efter ' !! ANTAL_OPD_PERSON !!      
                    ' opdateringer på sluttabeller');                   
              ANT_COMM = 0;                                             
           END;                                                         
                                                                        
 END BEHANDLING;                                                        
 /**********************************************************************
 * UNDERSØG OM GAMMELT CPRNR FINDES PÅ PERSONTABEL                     *
 **********************************************************************/
 FINDES_GL_CPRNR_PERSON: PROC;                                          
                                                                        
         SØGDINDKAAR = WK_INDKAAR;                                      
         GLPNR       = DCLBE90200T.PNR;                                 
         SØGPNR      = GLPNR;                                           
         GLPNR_CHAR  = FIX11_TIL_CHAR10(GLPNR);                         
         GL_PERSON_FUNDET = JA;                                         
                                                                        
         CALL UNDERSØG_PNR_FINDES_PERSON;                               
                                                                        
         IF RETURKODE > 0                                               
         THEN                                                           
           DO;                                                          
             PUT SKIP LIST ('Gl pnr: '!!GLPNR_CHAR!!                    
                           ' findes ikke.');                            
             GL_PERSON_FUNDET = NEJ;                                    
           END;                                                         
                                                                        
 END FINDES_GL_CPRNR_PERSON;                                            
 /**********************************************************************
 * UNDERSØG OM NYT CPRNR FINDES PÅ PERSONTABEL                         *
 **********************************************************************/
 FINDES_NYT_CPRNR_PERSON: PROC;                                         
                                                                        
         SØGDINDKAAR = WK_INDKAAR;                                      
                                                                        
         NYTPNR      = CHAR10_TIL_FIX11(DCLBE90200T.NYTPNR);            
         SØGPNR      = NYTPNR;                                          
                                                                        
         CALL UNDERSØG_PNR_FINDES_PERSON;                               
                                                                        
         IF RETURKODE = 0                                               
         THEN                                                           
            PUT SKIP LIST ('Nyt pnr: '!!DCLBE90200T.NYTPNR!!            
                           ' findes allerede.');                        
                                                                        
 END FINDES_NYT_CPRNR_PERSON;                                           
                                                                        
 /********************************************************************/ 
 /* DECLARE CURSOR BE902000T                                         */ 
 /********************************************************************/ 
 DECLARE_Cur_BE902: PROC;                                               
                                                                        
         EXEC SQL                                                       
              DECLARE Cur_BE902 CURSOR FOR                              
              SELECT DUMMY_ID                                           
                    ,INDKAAR                                            
                    ,KOERNR                                             
                    ,KOERDTO                                            
                    ,PNR                                                
                    ,REGISTMP                                           
                    ,NYTPNR                                             
                    ,OMPLSTATUSKOD                                      
                    ,OMPLDTO                                            
                    ,OMPLARTKOD                                         
                    ,INSERT_TS                                          
                    ,INSERT_AF                                          
                                                                        
              FROM   BE90200T                                           
                                                                        
              WHERE INDKAAR    = :WK_INDKAAR                            
                And KOERNR     = :WK_KOERNR                             
                And OMPLARTKOD = 'O'                                    
                and NYTPNR     <> ''                                    
                                                                        
              FOR FETCH ONLY                                            
         ;                                                              
                                                                        
 END DECLARE_Cur_BE902;                                                 
 /********************************************************************/ 
 /* FETCH CURSOR BE90200T                                            */ 
 /********************************************************************/ 
 FETCH_Cur_BE902: PROC;                                                 
                                                                        
         OMPLACER_FUNDET = NEJ;                                         
                                                                        
         EXEC SQL                                                       
              FETCH Cur_BE902                                           
              INTO  :DCLBE90200T.DUMMY_ID                               
                   ,:DCLBE90200T.INDKAAR                                
                   ,:DCLBE90200T.KOERNR                                 
                   ,:DCLBE90200T.KOERDTO                                
                   ,:DCLBE90200T.PNR                                    
                   ,:DCLBE90200T.REGISTMP                               
                   ,:DCLBE90200T.NYTPNR                                 
                   ,:DCLBE90200T.OMPLSTATUSKOD                          
                   ,:DCLBE90200T.OMPLDTO                                
                   ,:DCLBE90200T.OMPLARTKOD                             
                   ,:DCLBE90200T.INSERT_TS                              
                   ,:DCLBE90200T.INSERT_AF                              
         ;                                                              
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
           WHEN (0)                                                     
             DO;                                                        
               ANTAL_FETCH_OMPLA = ANTAL_FETCH_OMPLA + 1;               
               OMPLACER_FUNDET = JA;                                    
           /*    PUT SKIP LIST('BE902: '!!DCLBE90200T.PNR!!' fundet')§*/
             END;                                                       
           WHEN (100)                                                   
             DO;                                                        
               OMPLACER_FUNDET = NEJ;                                   
           /* PUT SKIP LIST('BE902: '!!DCLBE90200T.PNR!!' ej fundet')§*/
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
               ABENDTXT = '101 FETCH Cur_BE902';                        
             CALL SQL_FEJL;                                             
           END;                                                         
         END; /* SELECT*/                                               
                                                                        
 END FETCH_Cur_BE902;                                                   
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED SQLCODE: ' !! SQLCA.SQLCODE);  
         PUT SKIP LIST ('*****************************************');   
                                                                        
         CALL ZS67000(SQLCA);                                           
         ABENDMODUL   = 'BE24800';                            /*ÅR-RET*/
         ABENDTXT = RETURTEKST;                                         
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /*    Omplaceringsprogrammet finder det mindste kørselsnr.           */
 /*    (for indkomståret) i kørselstabellen,                          */
 /*     hvor Omplacering ikke er udført.                              */
 /*                                                                   */
 /*********************************************************************/
 OPDATER_OVERFØR_STATUS: PROC;                                          
                                                                        
     EXEC SQL UPDATE BE90000T                                           
        SET OVERFØR_OPDATER_TS = CURRENT TIMESTAMP                      
           ,OVERFØR_STATUS     = 1                                      
        WHERE INDKAAR    = :WK_INDKAAR                                  
        AND   INDIVIDNR  = 135                                          
        AND   KOERNR     = :WK_KOERNR;                                  
                                                                        
     SELECT (SQLCA.SQLCODE);                                            
       WHEN (0)                                                         
           DO;                                                          
           END;                                                         
       OTHERWISE                                                        
           DO;                                                          
              ABENDTXT = '307 OPDATER_OVERFØR_STATUS BE90000T '         
                          !! SQLCODE;                                   
              CALL SQL_FEJL;                                            
           END;                                                         
     END; /* SELECT*/                                                   
                                                                        
 END OPDATER_OVERFØR_STATUS;                                            
 /*********************************************************************/
 /*      SKRIV TOTALER                                                */
 /*********************************************************************/
 SKRIV_TOTALER: PROC;                                                   
                                                                        
         LINIE = '';                                                    
         CCHAR = ZZWS1;                                                 
         CALL ZZ20300(LINIE,'89');                                      
                                                                        
         LINIE.TEXT = 'Omplaceringer';                                  
         CALL ZZ20300(LINIE,'89');                                      
         LINIE.TEXT = 'Indkomstår: '!!WK_INDKAAR!!                      
                      ' Kørselsnr.: '!!WK_KOERNR;                       
         CALL ZZ20300(LINIE,'89');                                      
         LINIE.TEXT = '';                                               
         CALL ZZ20300(LINIE,'89');                                      
         LINIE.TEXT = 'ANTAL_FETCH_OMPLA ' !! ANTAL_FETCH_OMPLA;        
         CALL ZZ20300(LINIE,'89');                                      
         LINIE.TEXT = 'ANTAL_OPD_PERSON  ' !! ANTAL_OPD_PERSON;         
         CALL ZZ20300(LINIE,'89');                                      
         LINIE.TEXT = 'ANTAL_OPD_RESULT  ' !! ANTAL_OPD_RESULT;         
         CALL ZZ20300(LINIE,'89');                                      
                                                                        
 END SKRIV_TOTALER;                                                     
 /*********************************************************************/
 /*      AFSLUT                                                       */
 /*********************************************************************/
 AFSLUT: PROC;                                                          
                                                                        
    /* Med her for at optællinger skal passe */                         
    IF ANT_COMM > 0                                                     
    THEN                                                                
      DO;                                                               
        EXEC SQL COMMIT;                                                
        PUT SKIP LIST ('Commit efter ' !! ANTAL_OPD_PERSON !!           
               ' opdateringer på sluttabeller');                        
         ANT_COMM = 0;                                                  
      END;                                                              
                                                                        
    CLOSE FILE (PARM);                                                  
    CALL ZZ20300(' ','99');      /* LUK ALLE PRINTDATASÆT */            
                                                                        
 END AFSLUT;                                                            
 /*********************************************************************/
 /**********************************************************************
 * DIVERSE INCLUDES                                                    *
 **********************************************************************/
                                                                        
         %INCLUDE BE24870M;          /* CPRNR OMPLACERINGER *//*ÅR-RET*/
         %INCLUDE BE00001M;                    /* CHAR4_TIL_BIN15     */
                                               /* CHAR10_TIL_FIX11    */
 %INCLUDE BE24404M;               /* ABENDMODUL    */  /*#01*//*ÅR-RET*/
                                                                        
 END BE24800;                                                    /*#01*/
