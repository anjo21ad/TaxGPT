 /*********************************************************************/
 /* BS36012M OPRETTET SOM KOPI AF BS36000M                            */
 /* OPRETTE TIL EVS OPRETTELSE FORSKUD 2019 LAGT UNDER BFSK Z6EBD     */
 /* DA DE ANDRE MODULER MED AS75100 LIGGER HER                        */
 /*                                                                   */
 /* KAN FINDE ALDEREN PÅ EN PERSON UDFRA EN DATO OG PERSONNUMER       */
 /*      - FIND_ALDER(PRDATO,DCPRN)                                   */
 /*        PARAMETER  DCPRN ER  FIXED(11)                             */
 /*                   PRDATO ER FIXED(9)                              */
 /*        RETURNERER ALDEREN PÅ FIXED(3) FORMAT.                     */
 /*                                                                   */
 /*********************************************************************/
 DCL     AS75100      ENTRY;                                            
 dcl 1 AS75100N,                                                        
       %include AS75100N;                                               
                                                                        
        IF 1 = 2                                                        
        THEN                                                            
          FETCH AS75100;                                                
 /*********************************************************************/
 /* FIND ALDEREN VED DATO FOR PERSONNUMER VED HJÆLP AF STANDARDRUTINE */
 /*********************************************************************/
 FIND_ALDER:  PROC(PRDATO,DCPRN) RETURNS(FIXED(3));                     
                                                                        
                                                                        
 DCL     HJALDER_STOR    FIXED(11);                                     
                                                                        
 DCL     FGAMMEL      FIXED(3);                                         
 DCL     HJDCPRN      FIXED(11);                                        
 DCL     PRDATO       FIXED(9);                                         
 DCL     DCPRN        FIXED(11);                                        
 DCL     DCPRNP       PIC'9999999999';                                  
 DCL     DCPRNC       CHAR(10) BASED(ADDR(DCPRNP));                     
 DCL     1 HJDCPRNP  BASED(ADDR(DCPRNP)),                               
           2 DD     PIC'99',                                            
           2 MM     PIC'99',                                            
           2 ÅR     PIC'99',                                            
           2 LBN    PIC'9999';                                          
                                                                        
         DCPRNP = DCPRN;                                                
         IF DCPRNP > 4020000000                                         
         THEN                                                           
            DCPRNP = DCPRNP - 4020000000;                               
                                                                        
         AS75100_IN.CPRNR = DCPRNC;                                     
         CALL AS75100(ADDR(AS75100N));                                  
         IF AS75100_OUT.RC > 1                                          
         THEN                                                           
           DO;                                                          
             RETURN (0);                                                
           END;                                                         
         ELSE                                                           
           DO;                                                          
             HJALDER_STOR = (PRDATO - FULL_PNR_DATE)/10000;             
             IF HJALDER_STOR <= 200   &                                 
                HJALDER_STOR >= -99                                     
             THEN                                                       
               DO;                                                      
                 IF HJALDER_STOR < 0                                    
                 THEN                                                   
                   DO;                                                  
                     FGAMMEL = 0;                                       
                   END;                                                 
                 ELSE                                                   
                   DO;                                                  
                     FGAMMEL = (PRDATO - FULL_PNR_DATE)/10000;          
                   END;                                                 
               END;                                                     
             ELSE                                                       
               DO;                                                      
                 PUT SKIP LIST('FORKERT ALDER FOR');                    
                 PUT SKIP LIST('PRDATO =',PRDATO);                      
                 PUT SKIP LIST('DCPRNP =',DCPRNP);                      
                 PUT SKIP LIST('DCPRN  =',DCPRN);                       
                 PUT SKIP LIST('PRDATO =',PRDATO);                      
                 PUT SKIP LIST('FULL_PNR_DATE =',FULL_PNR_DATE);        
                 PUT SKIP LIST('HJALDER_STOR =',HJALDER_STOR);          
                 FGAMMEL = 0;                                           
               END;                                                     
           END;                                                         
                                                                        
         RETURN(FGAMMEL);                                               
                                                                        
 END FIND_ALDER;                                                        
