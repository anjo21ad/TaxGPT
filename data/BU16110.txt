 PROCESS OPT(TIME);                                                     
 BU16110: PROC (KOM_AREAL,BU_AREAL) REORDER;                            
 /**********************************************************************
 * PROJEKT:     EVS SLUT 2015.                                         *
 * PROGRAMNAVN: BU16110. (BATCHUDGAVE AF CICSPROGRAM BU16010).         *
 * PROGRAMTYPE: BATCH.                                                 *
 * FUNKTION : LÆS/SKRIV DATA I BH97100                                 *
 * PGMFORLØB:   1. VALIDER NØGLEFELTER.                                *
 *              2. INITIER STRUKTURER.                                 *
 *              3. TILGÅ EJENDOMS-/PERSONTABELLEN.                     *
 *              4. RETURNER SVAR.                                      *
 * INDDATA:     UDFYLDTE NØGLEFELTER FRA HOVEDSTYRINGSMODUL BU16000.   *
 *              BEREGNINGSANMODNING INPUT FRA CSC.                     *
 * RETURDATA:   SQLCODE    - SQL RETUR KODE.                           *
 *              RETURKODE  - 0:OK 1:TOM RÆKKE -1: SQLFEJL.             *
 *              RETURTEKST - UDDYBENDE TEKST TIL RETURKODE.            *
 * TABELLER:    BQ20000T   - EVS EJENDOMSTABEL                         *
 *              BQ21000T   - EVS EJENDOMS-FELTTABEL                    *
 *              BQ30000T   - EVS EJERSKABSTABEL                        *
 *              BQ31000T   - EVS EJERSKABS-FELTTABEL                   *
 *              BQ40000T   - EVS RESULTATTABEL                         *
 *              BQ41000T   - EVS RESULTAT-FELTTABEL                    *
 *              BQ50000T   - EVS FELTKODETABEL                         *
 * KONSTRUKTØR: OLUF MØRK             OMO, LSU/T&S BRØNDBY 23.11.2000. *
 ***********************************************************************
 * ÆNDRINGSLOG: BO SCHMIDT            BOB, LSU/PKF BALLERUP 04.10.2006.*
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: INGRID FISCHER        IFI, PKF ÅRHUS        15.11.2007.*
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: BO SCHMIDT            BOB, PKF BALLERUP     15.11.2008.*
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: BO SCHMIDT            BOB, PKF BALLERUP     15.10.2009.*
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: GERD HOLM-PEDERSEN    GEH, PKF BALLERUP     20.10.2010.*
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: GERD HOLM-PEDERSEN    GEH, PKF BALLERUP     02.10.2011.*
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: GERD HOLM-PEDERSEN    GEH, PR  BALLERUP     27.03.2012.*
 *              KALD TIL ZS67000 FLTTET HERTIL FRA BH97100             *
 ***********************************************************************
 * ÆNDRINGSLOG: LARS KAAE HARRITSHØJ  LKA, PR  BALLERUP     SEP 2012   *
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: JØRGEN SAUGMANN       QQS, PR  BALLERUP     OKT 2013   *
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * ÆNDRINGSLOG: Esben Brodersen       QEB, PR  BALLERUP     OKT 2014   *
 *              ÅRSRULLET                                              *
 ***********************************************************************
 * EVS SLUT-15.  Årsrullet. Kopi af BQ14110.           JNK  Okt. 2015  *
 ***********************************************************************
 * ÆNDRINGSLOG: Esben Brodersen       QEB, PR  BALLERUP     JUN 2016   *
 *              ÅRSRULLET Kopi af BQ15110  BQ15 -> BQ16                *
 **********************************************************************/
                                                                        
                                                                        
 DEFAULT RANGE (*) STATIC; /* LAGERTYPE AHT. KALD AF EKSTERNE MODULER */
                                                                        
 DCL     COPYRIGHT       CHAR (30) INIT ('(C) KMD A/S 2003');           
                                                                        
 /**********************************************************************
 * DECLARE AF STRUKTUR                                                 *
 **********************************************************************/
                                                                        
 DCL     1 KOM_AREAL,                                                   
         %INCLUDE BU16010N;                                             
                                                                        
 DCL     1 BU_AREAL,                                                    
         %INCLUDE BU16011N;;                                            
                                                                        
 DCL     1 EVS_EJD,                     /* EVS EJENDOMSTABEL          */
         %INCLUDE BU20000N;;                                            
 DCL     1 EVS_EJD_FELT,                /* EVS EJENDOMS FELTTABEL     */
         %INCLUDE BU21000N;;                                            
 DCL     1 EVS_ESK,                     /* EVS EJERSKABSTABELEN       */
         %INCLUDE BU30000N;;                                            
 DCL     1 EVS_ESK_FELT,                /* EVS EJERSKABSFELTTABELEN   */
         %INCLUDE BU31000N;;                                            
 DCL     1 EVS_RES,                     /* EVS EJERSKABSTABELEN       */
         %INCLUDE BU40000N;;                                            
 DCL     1 EVS_RES_FELT,                /* EVS EJERSKABSFELTTABELEN   */
         %INCLUDE BU41000N;;                                            
                                                                        
 DCL     1 EJENDOMTAB,                                                  
         %INCLUDE BU16100N;;                                            
 DCL     1 PERSONTAB,                                                   
         %INCLUDE BU16200N;;                                            
 DCL     1 RESULTATTAB,                                                 
         %INCLUDE BU16300N;;                                            
                                                                        
 DCL     1 INDK_EJEND,                  /* INDIKATOR EJENDOMS OPLYSN. */
         %INCLUDE BU16005N;;                                            
 DCL     1 INDK_EJERSK,                 /* INDIKATOR EJENDOMS OPLYSN. */
         %INCLUDE BU16006N;;                                            
 DCL     1 INDK_EVS_RES,                /* INDIKATOR RESULTAT OPLYSN. */
         %INCLUDE BU16017N;;                                            
                                                                        
 /*********************************************************************/
 /* DECLARE AF BUILTIN                                                */
 /*********************************************************************/
                                                                        
 DCL     (ADDR, NULL, MULTIPLY, PLIDUMP) BUILTIN;                       
 DCL     PUTSKIP            BIT(1)       INIT('0'B);                    
                                                                        
 /**********************************************************************
 * DECLARE AF DB2                                                      *
 **********************************************************************/
                                                                        
 DCL     ZS67000         ENTRY;                       /* DB2 FEJL     */
         EXEC SQL INCLUDE SQLCA;        /* SQL KOMMUNIKATIONSAREAL    */
         EXEC SQL INCLUDE BQ20000T;     /* EVS EJENDOMTABEL           */
         EXEC SQL INCLUDE BQ21000T;     /* EVS EJENDOMFELTTABEL       */
         EXEC SQL INCLUDE BQ30000T;     /* EVS EJERSKABSTABEL         */
         EXEC SQL INCLUDE BQ31000T;     /* EVS EJERSKABSTFELTTABEL    */
         EXEC SQL INCLUDE BQ40000T;     /* EVS RESULTATTABEL          */
         EXEC SQL INCLUDE BQ41000T;     /* EVS RESULTATFELTTABEL      */
         EXEC SQL INCLUDE BQ50000T;     /* EVS FELTKODETABEL          */
                                                                        
 /**********************************************************************
 * DECLARE AF DIVERSE HJÆLPEFELTER                                     *
 **********************************************************************/
                                                                        
 DCL     RETURTEKST_EJD  CHAR (35) VAR  INIT(' ');                      
 DCL     RETURTEKST_PER  CHAR (35) VAR  INIT(' ');                      
                                                                        
 /*********************************************************************/
 /* ON - CONDITIONS                                                   */
 /*********************************************************************/
                                                                        
         ON ERROR                                                       
            CALL PLIDUMP ('SHOB','BU16110');                            
                                                                        
 /**********************************************************************
 * PROCES                                                              *
 **********************************************************************/
                                                                        
         KOM_AREAL.RETURKODE = 0;                                       
         KOM_AREAL.SQLKODE   = 0;                                       
                                                                        
         SELECT (KOM_AREAL.KOMM.FUNKTION);                              
                                                                        
          WHEN (1) /* SELECT PERSON & EJENDOM */                        
             DO;                                                        
               CALL LÆS_TABELLER;                                       
               BU_AREAL.EJENDOM   = EJENDOMTAB, BY NAME;                
               BU_AREAL.PERSON    = PERSONTAB, BY NAME;                 
               BU_AREAL.INDK_EJD  = INDK_EJEND, BY NAME;                
               BU_AREAL.INDK_PERS = INDK_EJERSK, BY NAME;               
             END;                                                       
                                                                        
          WHEN (2) /* INSERT PERSON & EJENDOM */                        
             DO;                                                        
               EJENDOMTAB  = BU_AREAL.EJENDOM, BY NAME;                 
               PERSONTAB   = BU_AREAL.PERSON, BY NAME;                  
               INDK_EJEND  = BU_AREAL.INDK_EJD, BY NAME;                
               INDK_EJERSK = BU_AREAL.INDK_PERS, BY NAME;               
                                                                        
               IF KOMM.TYPE = 3                                         
               THEN                                                     
                  CALL SLET_EJD_FEL;                                    
                                                                        
               CALL SKRIV_TABELLER;                                     
             END;                                                       
                                                                        
          WHEN (3)  /*  OPTÆL ANTAL EJENDOMME FOR EN BESTEMT PERSON  */ 
            CALL OPTÆL_ANTAL_EJENDOMME;                                 
                                                                        
          WHEN (4)  /*        BRUGES IKKE I BATCH DATAMODULET        */ 
             DO;                                                        
              KOM_AREAL.RETURKODE  = -1;                                
              RETURTEKST = 'FUNKTIONSVALG SKAL VÆRE 1 - 3';             
             END;                                                       
                                                                        
          WHEN (5)  /*          BRUGES IKKE I BATCH DATAMODULET      */ 
             DO;                                                        
              KOM_AREAL.RETURKODE  = -1;                                
              RETURTEKST = 'FUNKTIONSVALG SKAL VÆRE 1 - 3';             
             END;                                                       
                                                                        
          OTHERWISE                                                     
            DO;                                                         
              KOM_AREAL.RETURKODE  = -1;                                
              RETURTEKST = 'FUNKTIONSVALG SKAL VÆRE 1 - 3';             
            END;                                                        
                                                                        
         END; /* END-SELECT */                                          
                                                                        
 /**********************************************************************
 * HER UDSKRIVES SQL FEJL VED HJÆLP AF STANDARD RUTINE                 *
 **********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         KOM_AREAL.RETURKODE = -1;                                      
         KOM_AREAL.SQLKODE   = SQLCA.SQLCODE;                           
                                                                        
         CALL ZS67000 (SQLCA);                                          
                                                                        
 DCL     P_SQLKODE        PIC       '-----9';                           
         P_SQLKODE = KOM_AREAL.SQLKODE;                                 
                                                                        
    PUT SKIP LIST ('BU16110 - SQL_FEJL CPR: ', SØG.DCPRN);              
    PUT SKIP LIST ('RETURTEKST_PER: ',RETURTEKST_PER);                  
    PUT SKIP LIST ('BU16110 - SQL:  ',P_SQLKODE);                       
                                                                        
 END SQL_FEJL;                                                          
 /**********************************************************************
 * DIVERSE MAKROER                                                     *
 **********************************************************************/
                                                                        
         %INCLUDE BU16010M;              /* BEHANDL FUNKTIONERNE 1-5  */
         %INCLUDE BU16014M;              /* FLYT_EJD_FEL              */
         %INCLUDE BU16015M;              /* SLET_EJD_FEL              */
         %INCLUDE BU16020M;              /* FLYT_ESK_FEL              */
         %INCLUDE BU16017M;              /* FLYT_EJD_FEL_TIL          */
         %INCLUDE BU16018M;              /* FLYT_ESK_FEL_TIL          */
                                                                        
 END BU16110;                                                           
