 /**********************************************************************
 * PROJEKT:     EVS SLUT ZSRØR.                                        *
 * PROGRAMNAVN: BQ60001M.                                              *
 * PROGRAMTYPE: MAKRO.                                                 *
 * FUNKTION:    FREMSKAFELSE AF DATA FRA BQ00250 TIL ZS-RØR            *
 * TABELLER:                                                           *
 *                                                                     *
 * PROGRAMMØR:  TOMMY DESTING         TMD, LSU/ARB BRØNDBY 18.01.2001. *
 * ÆNDRINGSLOG: ALBERT RAMOS          ABR, LSU/T&S BRØNDBY 20.03.2001. *
 * ÆNDRINGSLOG: XXXXXX XXXXXX         XXX, LSU/T&S BRØNDBY 00.00.2001. *
 **********************************************************************/
 /*********************************************************************/
 /*                                                                   */
 /*                                                                   */
 /*********************************************************************/
 DCL     VERIFY          BUILTIN;                                       
 DCL     TAL               CHAR      (10) INIT ('0123456789');          
 DCL     PARMPTR           POINTER;                                     
 DCL    HJ_CFUNK         CHAR  (16);                                    
 DCL    HJ_CFUNK_ELM(16) CHAR  (1)  BASED (ADDR(HJ_CFUNK));             
 DCL    HJ_ESLKNR        PIC'999';                                      
                                                                        
 DCL    BRUG_OVERSIGT    BIT   (1)  INIT ('0'B);                        
 DCL    VIS_OVERSIGT     BIT   (1)  INIT ('0'B);                        
 DCL    VIS_LOG          BIT   (1)  INIT ('0'B);                        
 DCL    FREMTVING_ADG    BIT   (1)  INIT ('0'B);                        
 DCL    FREMTVING_INGEN_ADG BIT (1) INIT ('0'B);                        
 DCL    VIS_FEJL_LOG     BIT   (1)  INIT ('0'B);                        
 DCL    VIS_GRUND        BIT   (1)  INIT ('0'B);                        
 DCL    VIS_BEREGN       BIT   (1)  INIT ('0'B);                        
                                                                        
 DCL 1 FEJLDATA,                                                        
       2 CRETUR                   CHAR(5),                              
       2 MEDD_TEKST               CHAR(80);                             
                                                                        
 DCL 1 TS_KØER,                                                         
        3 TS_OVERSIGT,                   /* Erklæringer af ts-und.kø*/  
          5 IDENT      CHAR      (14),   /* Ident på ts kø          */  
          5 KØNAVN     CHAR      (08),   /* Navn på ts kø           */  
          5 ANT_ITEMS  FIXED BIN (15),   /* Antal items på ts kø    */  
          5 AKT_START  FIXED BIN (15),   /* Første item på side n   */  
        3 TS_GRUND,                     /* Erklæringer af ts-und.kø*/   
          5 IDENT      CHAR      (14),   /* Ident på ts kø          */  
          5 KØNAVN     CHAR      (08),   /* Navn på ts kø           */  
          5 ANT_ITEMS  FIXED BIN (15),   /* Antal items på ts kø    */  
          5 AKT_START  FIXED BIN (15),   /* Første item på side n   */  
        3 TS_UDSKRIFT,                  /* Erklæringer af ts-und.kø*/   
          5 IDENT      CHAR      (14),   /* Ident på ts kø          */  
          5 KØNAVN     CHAR      (08),   /* Navn på ts kø           */  
          5 ANT_ITEMS  FIXED BIN (15),   /* Antal items på ts kø    */  
          5 AKT_START  FIXED BIN (15),   /* Første item på side n   */  
        3 TS_BEREGN,                    /* Erklæringer af ts-und.kø*/   
          5 IDENT      CHAR      (14),   /* Ident på ts kø          */  
          5 KØNAVN     CHAR      (08),   /* Navn på ts kø           */  
          5 ANT_ITEMS  FIXED BIN (15),   /* Antal items på ts kø    */  
          5 AKT_START  FIXED BIN (15),   /* Første item på side n   */  
        3 TS_OPLYS_GRND,                /* Erklæringer af ts-und.kø*/   
          5 IDENT      CHAR      (14),   /* Ident på ts kø          */  
          5 KØNAVN     CHAR      (08),   /* Navn på ts kø           */  
          5 ANT_ITEMS  FIXED BIN (15),   /* Antal items på ts kø    */  
          5 AKT_START  FIXED BIN (15),   /* Første item på side n   */  
        3 TS_FEJL,                       /* Erklæringer af ts-und.kø*/  
          5 IDENT      CHAR      (14),   /* Ident på ts kø          */  
          5 KØNAVN     CHAR      (08),   /* Navn på ts kø           */  
          5 ANT_ITEMS  FIXED BIN (15),   /* Antal items på ts kø    */  
          5 AKT_START  FIXED BIN (15);   /* Første item på side n   */  
                                                                        
 /*%INCLUDE    ZM70013M;                    TILDEL_TS_KØ             */ 
 /*                                                                     
 %INCLUDE    ZM70001N;    /* generelle declares til cicsprogrammer    / 
 */                                                                     
                                                                        
  DCL 1 ZM,                                                             
        2  SYSID           CHAR      (04),                              
        2  CENTRAL         CHAR      (02),                              
        2  CICS_TYPE       CHAR      (01),                              
        2  DUMMY           CHAR (01);                                   
                                                                        
 %INCLUDE    BQ00250M;                    /* PROCESMODULS AREALER     */
                                                                        
 /*OVERSIGT */                                                          
 DCL     TS_DATA_PTR     POINTER;                                       
 DCL     1 TS_DATA,                                                     
           % INCLUDE BQ00251N;                                          
                                                                        
 /*GRUNDOPLYSNINGER */                                                  
 DCL     TS_KOLON_DATA_PTR     POINTER;                                 
 DCL     1 TS_KOLON_DATA,                                               
           % INCLUDE BQ00252N;                                          
                                                                        
 /* BEREGNINGSUDSKRIFT Nøgler */                                        
 DCL     TS_UDSKRIFT_DATA_PTR        POINTER;                           
 DCL     1 TS_UDSKRIFT_DATA,                                            
           %INCLUDE BQ00253N;                                           
                                                                        
 /* BEREGNINGSOPLYSNINGER */                                            
 DCL     TS_BEREGN_DATA_PTR     POINTER;                                
 DCL     1 TS_BEREGN_DATA,                                              
           %INCLUDE BQ00254N;                                           
                                                                        
 /* BEREGNINGSGRUNDLAG    */                                            
 DCL     TS_OPLYS_GRND_DATA_PTR     POINTER;                            
 DCL     1 TS_OPLYS_GRND_DATA,                                          
           %INCLUDE BQ00252N;                                           
                                                                        
 /* FEJLOPLYSNINGER */                                                  
 DCL     TS_FEJL_DATA_PTR     POINTER;                                  
 DCL     1 TS_FEJL_DATA,                                                
           5 INDIVIDTYPE     BIN FIXED (15),                            
           5 LINIETYPE       BIN FIXED (15),                            
           5 FEJLOPLYSNINGER CHAR (200);                                
                                                                        
 DCL     JA                BIT       (1)   INIT ('1'B);                 
 DCL     NEJ               BIT       (1)   INIT ('0'B);                 
                                                                        
         TS_DATA_PTR          = ADDR(TS_DATA);                          
         TS_KOLON_DATA_PTR    = ADDR(TS_KOLON_DATA);                    
         TS_UDSKRIFT_DATA_PTR = ADDR(TS_UDSKRIFT_DATA);                 
         TS_BEREGN_DATA_PTR   = ADDR(TS_BEREGN_DATA);                   
         TS_OPLYS_GRND_DATA_PTR = ADDR(TS_OPLYS_GRND_DATA);             
         TS_FEJL_DATA_PTR     = ADDR(TS_FEJL_DATA);                     
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_INITIERING                                                **
 **********************************************************************/
 EVS_INITIERING: PROC;                                                  
                                                                        
    CALL EVS_TILDEL_TSKØ_IDENTER;                                       
    CALL EVS_GENFIND_TSKØER;                                            
    CALL EVS_SLET_TSKØER;                                               
    CALL EVS_FRIGIV_TSKØER;                                             
    CALL EVS_OPRET_TSKØER;                                              
 END EVS_INITIERING;                                                    
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_STYRING                                                   **
 **********************************************************************/
 EVS_STYRING: PROC;                                                     
     /*  DCL DCPRN      PIC  '(10)9';                                   
         DCL DINDKAAR   PIC  '9999';                                    
         DCL EKOMNR     PIC  '9999';                                    
         DCL EEJDNR     PIC  '(10)9';                                   
         DCL ELBNR      PIC  '999';                                     
         DCL EGENNR     PIC  '(3)9';  */                                
         DCL J          FIXED BIN(15);                                  
         DCL EOF_SW_UDSKRIFT   BIT(01) INIT('0'B);                      
                                                                        
   /* CALL EVS_DAN_TEST_DATA;*/                                         
                                                                        
   FEJLDATA.CRETUR       = '00000';                                     
   FEJLDATA.MEDD_TEKST   = 'ALT OK';                                    
                                                                        
   CALL EVS_INITIERING;                                                 
                                                                        
   IF FEJLDATA.CRETUR ^= '00000' THEN                                   
   DO;                                                                  
       CALL EVS_SKAF_FEJL_DATA;                                         
       RETURN;                                                          
   END;                                                                 
                                                                        
   CALL EVS_VALIDER_INPUT;                                              
                                                                        
   IF FEJLDATA.CRETUR ^= '00000' THEN                                   
   DO;                                                                  
       CALL EVS_SKAF_FEJL_DATA;                                         
       RETURN;                                                          
   END;                                                                 
                                                                        
   CALL SKAF_BRUGEROPLYSNINGER;                        /* Individ 800 */
   CALL SKAF_ADRESSEOPLYSNINGER;                       /* Individ 801 */
                                                                        
   /**************************************************************      
   /* HVIS OVERSIGTEN IKKE SKAL BENYTTES TIL AT FREMSKAFFE DATA  *      
   /* HENTES DETAIL-DATA DIREKTE UDEN OM OVERSIGTEN              *      
   /*************************************************************/      
   IF BRUG_OVERSIGT = NEJ THEN                                          
   DO;                                                                  
      CALL KALD_PROCESMODUL_GRUND(INPUT.DCPRN,INPUT.DINDKAAR,           
           INPUT.EKOMNR,INPUT.EEJDNR,INPUT.ELBNR,INPUT.EGENNR);         
      CALL EVS_GRUND_DATA(INPUT.DCPRN,INPUT.DINDKAAR,                   
           INPUT.EKOMNR,INPUT.EEJDNR,INPUT.ELBNR,INPUT.EGENNR);         
      CALL EVS_SKAF_FEJL_DATA;                                          
      RETURN;                                                           
   END;                                                                 
                                                                        
   /**************************************************************      
   /* HVIS OVERSIGTEN SKAL BENYTTES TIL AT FREMSKAFFE DATA       *      
   /* HENTES HENTES DATA FRA OVERSIGTEN.                         *      
   /* OG HVIS DETAIL-DATA ØNSKES SKAFFES DISSE V.H.A. DATA       *      
   /* FRA OVERSIGTEN.                                            *      
   /*************************************************************/      
   CALL KALD_PROCESMODUL_OVERSIGT;                                      
                                                                        
   testprt('...ved evs_styring -');                                     
                                                                        
   IF                                                                   
   PROCESMODUL.CRETUR = 'OK'                                            
   THEN DO;                                                             
      TS_OVERSIGT.AKT_START = 1;                                        
                                                                        
      DO WHILE(FLERE_ELEMENTER);                                        
                                                                        
         OUTPUTELEM = '';                                               
         CALL EVS_SKAF_OVERSIGT_DATA;                                   
                                                                        
         testprt('eejdnr:',ts_data.eejdnr,                              
                 '- elbnr:',ts_data.elbnr,                              
                 '- TS_OVERSIGT.AKT_START:', TS_OVERSIGT.AKT_START);    
                                                                        
         IF FLERE_ELEMENTER = JA  THEN                                  
         DO;                                                            
            IF VIS_OVERSIGT = JA THEN                                   
               CALL BEH_ZSRØR_TSKØ; /*SKRIV TIL ZS-RØR-KØ */            
                                                                        
            IF                                                          
            VIS_GRUND = JA    &                                         
            VIS_BEREGN = NEJ  &                                         
            TS_DATA.INDIVIDTYPE = 100                                   
            THEN DO;                                                    
             /*DCPRN    = TS_DATA.DCPRN;                                
               DINDKAAR = TS_DATA.DINDKAAR;                             
               EKOMNR   = TS_DATA.EKOMNR;                               
               EEJDNR   = TS_DATA.EEJDNR;                               
               ELBNR    = TS_DATA.ELBNR;                                
               EGENNR   = TS_DATA.EGENNR; */                            
            /* IF TS_OVERSIGT.AKT_START < 5 THEN                        
               DO; */                                                   
               CALL KALD_PROCESMODUL_GRUND(TS_DATA.DCPRN,               
                                           TS_DATA.DINDKAAR,            
                                           TS_DATA.EKOMNR,              
                                           TS_DATA.EEJDNR,              
                                           TS_DATA.ELBNR,               
                                           TS_DATA.EGENNR);             
                                                                        
               CALL EVS_GRUND_DATA(TS_DATA.DCPRN,                       
                                   TS_DATA.DINDKAAR,                    
                                   TS_DATA.EKOMNR,                      
                                   TS_DATA.EEJDNR,                      
                                   TS_DATA.ELBNR,                       
                                   TS_DATA.EGENNR);                     
            /* END; */                                                  
            END;                                                        
                                                                        
            IF                                                          
            VIS_BEREGN       = JA  &                                    
           /* Nogle gang er der een for mange elementer i TS-KØ'en.  */ 
           /* Så skal der returneres med IKKE flere_elementer og EOF */ 
            (TS_DATA.DCPRN    > 0   !                                   
             TS_DATA.DINDKAAR > 0   !                                   
             TS_DATA.EEJDNR   > 0   !                                   
             TS_DATA.ELBNR    > 0)                                      
            THEN DO;                                                    
               TS_UDSKRIFT.AKT_START = 1;                               
               TS_UDSKRIFT.ANT_ITEMS = 0;                               
                                                                        
               HJ_ESLKNR = HENT_ESLKNR(TS_DATA.DCPRN,                   
                                       TS_DATA.DINDKAAR);               
                                                                        
              /* Hent Opgørelsesnøgler(UDSKRIFT) og læg i TSKØ */       
               CALL KALD_PROCESMODUL_UDSKRIFT(TS_DATA.DCPRN,            
                                              TS_DATA.DINDKAAR,         
                                              TS_DATA.EKOMNR,           
                                              HJ_ESLKNR,                
                                              TS_DATA.EEJDNR,           
                                              TS_DATA.ELBNR);           
                                                                        
                /* Positionere til den sidste opg.nøgle (UDSKRIFT) */   
                /* Den sidste er den mest aktuel.                  */   
                /* DO I = TS_KØER.TS_UDSKRIFT.ANT_ITEMS TO 1 BY -1    */
                /* WHILE (TS_KØER.TS_UDSKRIFT.ANT_ITEMS > 0);         */
               DO I = 1 TO TS_KØER.TS_UDSKRIFT.ANT_ITEMS                
               WHILE (TS_KØER.TS_UDSKRIFT.ANT_ITEMS > 0   &             
                      PROCESMODUL.CRETUR            = 'OK');            
                                                                        
                  TS_BEREGN.AKT_START = 1;                              
                  EOF_SW_UDSKRIFT     = NEJ;                            
                                                                        
                 /* Læs opg.nøgle fra TSKØ samt UDSKRDTO */             
                  CALL LÆS_TSKØ_UDSKRIFT_EVS(TS_UDSKRIFT.KØNAVN,        
                                             I, EOF_SW_UDSKRIFT);       
                                                                        
                  testprt('Før KALD_PROCESMODUL_OPGØRELSE',             
                          '- itemnr:',i,'- hj_eslknr:',hj_eslknr,       
                          '- ts_udskrift_data.egennr:',                 
                             ts_udskrift_data.egennr);                  
                                                                        
                  IF                                                    
                  ^EOF_SW_UDSKRIFT                                      
                  THEN DO;                                              
                     CALL KALD_PROCESMODUL_OPGØRELSE(I,                 
                                            TS_DATA.DCPRN,              
                                            TS_DATA.DINDKAAR,           
                                            TS_DATA.EKOMNR,             
                                            HJ_ESLKNR,                  
                                            TS_DATA.EEJDNR,             
                                            TS_DATA.ELBNR,              
                                            TS_UDSKRIFT_DATA.EGENNR,    
                                            TS_UDSKRIFT_DATA.CONLINE);  
                                                                        
                     IF                                                 
                     VIS_GRUND           = JA  &                        
                     TS_DATA.INDIVIDTYPE = 100                          
                     THEN DO;                                           
                        CALL KALD_PROCESMODUL_OPLYS_GRND(I,             
                                            TS_DATA.DCPRN,              
                                            TS_DATA.DINDKAAR,           
                                            TS_DATA.EKOMNR,             
                                            HJ_ESLKNR,                  
                                            TS_DATA.EEJDNR,             
                                            TS_DATA.ELBNR,              
                                            TS_UDSKRIFT_DATA.EGENNR,    
                                            TS_UDSKRIFT_DATA.CONLINE);  
                     END;                                               
                                                                        
                     IF                                                 
                     PROCESMODUL.CRETUR = 'OK'                          
                     THEN DO;                                           
                        testprt('TS_KØER.TS_UDSKRIFT.ANT_ITEMS:',       
                                 TS_KØER.TS_UDSKRIFT.ANT_ITEMS,         
                                '- TS_UDSKRIFT_DATA.EGENNR:',           
                                 TS_UDSKRIFT_DATA.EGENNR);              
                                                                        
                        FLERE_ELEMENTER_OPLYS_GRND = JA;                
                                                                        
                        DO J = 1 TO TS_KØER.TS_OPLYS_GRND.ANT_ITEMS     
                        WHILE(FLERE_ELEMENTER_OPLYS_GRND);              
                                                                        
                           OUTPUTELEM = '';                             
                           CALL EVS_SKAF_OPLYS_GRND_DATA(J,             
                                         TS_DATA.DCPRN,                 
                                         TS_DATA.DINDKAAR,              
                                         TS_DATA.EKOMNR,                
                                         TS_DATA.EEJDNR,                
                                         TS_DATA.ELBNR,                 
                                         TS_DATA.EGENNR,                
                                         TS_UDSKRIFT_DATA.UDSKRDTO);    
                                                                        
                           IF                                           
                           FLERE_ELEMENTER_OPLYS_GRND                   
                           THEN DO;                                     
                              CALL BEH_ZSRØR_TSKØ;                      
                           END;                                         
                        END;                                            
                                                                        
                        FLERE_ELEMENTER_BEREGN = JA;                    
                                                                        
                        DO J = 1 TO TS_KØER.TS_BEREGN.ANT_ITEMS         
                        WHILE(FLERE_ELEMENTER_BEREGN);                  
                                                                        
                           OUTPUTELEM = '';                             
                           CALL EVS_SKAF_BEREGN_DATA(J,                 
                                         TS_DATA.DCPRN,                 
                                         TS_DATA.DINDKAAR,              
                                         TS_DATA.EKOMNR,                
                                         TS_DATA.EEJDNR,                
                                         TS_DATA.ELBNR,                 
                                         TS_DATA.EGENNR,                
                                         TS_UDSKRIFT_DATA.UDSKRDTO);    
                                                                        
                           IF                                           
                           FLERE_ELEMENTER_BEREGN = JA                  
                           THEN DO;                                     
                              CALL BEH_ZSRØR_TSKØ;                      
                           END;                                         
                        END;                                            
                                                                        
                        TS_KØER.TS_BEREGN.ANT_ITEMS = 0;                
                        CALL RESET_BEREGN_TSKØ;                         
                                                                        
                        TS_KØER.TS_OPLYS_GRND.ANT_ITEMS = 0;            
                        CALL RESET_OPLYS_GRND_TSKØ;                     
                     END;                                               
                  END;                                                  
               END;                                                     
                                                                        
              /* Skaf/Hent grundlag'et hvis opgørelsen er ikke  */      
              /*           beregnet endnu.                      */      
               IF                                                       
               (TS_KØER.TS_UDSKRIFT.ANT_ITEMS <= 0       &              
                VIS_GRUND                      = JA      &              
                PROCESMODUL.CRETUR             = 'EJFU'  &              
                TS_DATA.INDIVIDTYPE            = 100)                   
               THEN DO;                                                 
                  testprt('procesmodul.cretur:',procesmodul.cretur);    
                  CALL KALD_PROCESMODUL_GRUND(TS_DATA.DCPRN,            
                                              TS_DATA.DINDKAAR,         
                                              TS_DATA.EKOMNR,           
                                              TS_DATA.EEJDNR,           
                                              TS_DATA.ELBNR,            
                                              TS_DATA.EGENNR);          
                  CALL EVS_GRUND_DATA(TS_DATA.DCPRN,                    
                                      TS_DATA.DINDKAAR,                 
                                      TS_DATA.EKOMNR,                   
                                      TS_DATA.EEJDNR,                   
                                      TS_DATA.ELBNR,                    
                                      TS_DATA.EGENNR);                  
               END;                                                     
                                                                        
               TS_KØER.TS_UDSKRIFT.ANT_ITEMS = 0;                       
               CALL RESET_UDSKRIFT_TSKØ;                                
            END;                                                        
         END;                                                           
      END;                                                              
   END;                                                                 
                                                                        
   CALL EVS_SKAF_FEJL_DATA;                                             
 END EVS_STYRING;                                                       
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_GRUND_DATA                                               ** 
 **********************************************************************/
 EVS_GRUND_DATA: PROC(DCPRN,DINDKAAR,EKOMNR,EEJDNR,ELBNR,EGENNR);       
                                                                        
      DCL DCPRN         PIC  '(10)9';                                   
      DCL DINDKAAR      PIC  '9999';                                    
      DCL EKOMNR        PIC  '9999';                                    
      DCL EEJDNR        PIC  '(10)9';                                   
      DCL ELBNR         PIC  '999';                                     
      DCL EGENNR        PIC  '(3)9';                                    
                                                                        
     TS_GRUND.AKT_START = 1;                                            
                                                                        
     FLERE_ELEMENTER_GRUND = JA;                                        
     DO WHILE(FLERE_ELEMENTER_GRUND);                                   
        OUTPUTELEM = '';                                                
        CALL EVS_SKAF_GRUND_DATA(DCPRN,DINDKAAR,EKOMNR,EEJDNR,          
                                 ELBNR,EGENNR);                         
        IF FLERE_ELEMENTER_GRUND = JA THEN                              
           CALL BEH_ZSRØR_TSKØ;                                         
        ELSE                                                            
        DO;                                                             
           CALL SLET_TSKØ_EVS(TS_KØER.TS_GRUND.KØNAVN);                 
           /*                                                           
           CALL FRIGIV_TSKØ_NAVN(TS_KØER.TS_GRUND.IDENT);               
           TS_KØER.TS_GRUND.KØNAVN =                                    
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_GRUND.IDENT);             
           */                                                           
        END;                                                            
     END;                                                               
 END EVS_GRUND_DATA;                                                    
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_SKAF_FEJL_DATA                                            **
 *********************************************************************/ 
 EVS_SKAF_FEJL_DATA: PROC;                                              
                                                                        
       IF VIS_FEJL_LOG = JA  ! VIS_LOG = JA THEN                        
       DO;                                                              
          TS_FEJL.AKT_START = 1;                                        
          DO WHILE(FLERE_ELEMENTER_FEJL);                               
             OUTPUTELEM = '';                                           
             CALL EVS_LÆS_FEJL_TSKØ;                                    
             IF FLERE_ELEMENTER_FEJL = JA THEN                          
                CALL BEH_ZSRØR_TSKØ; /* SKRIV TIL ZS-RØR-KØ */          
          END;                                                          
       END;                                                             
                                                                        
 END EVS_SKAF_FEJL_DATA;                                                
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_VALIDER_INPUT                                             **
 **********************************************************************/
 EVS_VALIDER_INPUT: PROC;                                               
    DCL FEJLOPLYSNINGER CHAR     (200);                                 
                                                                        
    HJ_CFUNK =  INPUT.CFUNK;                                            
                                                                        
    IF  HJ_CFUNK_ELM(1) = 1 THEN                                        
        VIS_LOG  = JA;                                                  
    ELSE                                                                
        VIS_LOG  = NEJ;                                                 
                                                                        
    IF  HJ_CFUNK_ELM(2) = 1 THEN                                        
        FREMTVING_ADG = JA;                                             
    ELSE                                                                
        FREMTVING_ADG = NEJ;                                            
                                                                        
    /*************************************************************      
       2001-09-03 Z6TMD FLAGET FREMTVING_ADG SÆTTES NU ALTID TIL JA     
       P.G.A. PARAMETEREN SVARENDE TIL HJ_CFUNK_ELM(2)                  
       NU ER FJERNET FRA VB-PROGRAMMET                                  
     ************************************************************/      
    FREMTVING_ADG = JA;                                                 
                                                                        
    IF SIKKERHED_OK('B217') THEN                                        
    ;                                                                   
    ELSE                                                                
    DO;                                                                 
       FEJLDATA.CRETUR    = '00001';                                    
       FEJLDATA.MEDD_TEKST = 'BRUGER HAR IKKE ADGANG TIL B217';         
       RETURN;                                                          
    END;                                                                
                                                                        
                                                                        
    IF VERIFY(INPUT.CFUNK,TAL)    = 0  &                                
       VERIFY(INPUT.DCPRN,TAL)    = 0  &                                
       VERIFY(INPUT.DINDKAAR,TAL) = 0 THEN                              
    DO;                                                                 
       IF  VERIFY(INPUT.EKOMNR,TAL) = 0 &                               
           VERIFY(INPUT.EEJDNR,TAL) = 0 &                               
           VERIFY(INPUT.ELBNR,TAL) = 0  &                               
           VERIFY(INPUT.EGENNR,TAL) =  0    THEN                        
       DO;                                                              
           IF VIS_LOG = JA THEN                                         
              CALL LOG_DATA_SKRIV(990,1,'BRUG IKKE OVERSIGT');          
           BRUG_OVERSIGT = NEJ;                                         
       END;                                                             
       ELSE                                                             
       DO;                                                              
           IF VIS_LOG = JA THEN                                         
              CALL LOG_DATA_SKRIV(990,1,'BRUG OVERSIGT');               
           BRUG_OVERSIGT = JA;                                          
       END;                                                             
    END;                                                                
    ELSE                                                                
    DO;                                                                 
        FEJLDATA.CRETUR       = '00100';                                
        FEJLDATA.MEDD_TEKST   = 'FEJL I INPUT';                         
        VIS_FEJL_LOG = JA;                                              
        FEJLOPLYSNINGER       =  'FEJL I INPUT' !! ' ' !! 'CFUNK ' !!   
        INPUT.CFUNK !! ' DCPRN ' !! INPUT.DCPRN !! ' ' !!               
        ' DINDKAAR '  !! INPUT.DINDKAAR;                                
        CALL LOG_DATA_SKRIV(999,1, FEJLOPLYSNINGER);                    
                                                                        
        RETURN;                                                         
                                                                        
    END;                                                                
                                                                        
    IF  HJ_CFUNK_ELM(16) = 1 THEN                                       
        VIS_OVERSIGT = JA;                                              
    ELSE                                                                
        VIS_OVERSIGT = NEJ;                                             
                                                                        
    IF  HJ_CFUNK_ELM(15) = 1 THEN                                       
        VIS_GRUND = JA;                                                 
    ELSE                                                                
        VIS_GRUND = NEJ;                                                
                                                                        
    IF  HJ_CFUNK_ELM(14) = 1 THEN                                       
        VIS_BEREGN = JA;                                                
    ELSE                                                                
        VIS_BEREGN = NEJ;                                               
                                                                        
 END EVS_VALIDER_INPUT;                                                 
 /**********************************************************************
 *      BQ60001M                                                       *
 **     LOG_DATA                                                      **
 **********************************************************************/
 LOG_DATA: PROC(INDIVIDTYPE,LINIETYPE,LOGTXT,CFUNK,DCPRN,DINDKAAR,      
                EKOMNR,ESLKNR,EEJDNR,ELBNR,EGENNR,TSKØNAVN);            
 /* LOG_DATA: PROC(INDIVIDTYPE,LINIETYPE,LOGTXT,CFUNK,DCPRN,DINDKAAR,   
                EKOMNR,EEJDNR,ELBNR,EGENNR,TSKØNAVN); */                
    DCL INDIVIDTYPE     BIN FIXED (15);                                 
    DCL LINIETYPE       BIN FIXED (15);                                 
    DCL LOGTXT          CHAR(30);                                       
    DCL CFUNK           CHAR(16);                                       
    DCL DCPRN           PIC  '(10)9';                                   
    DCL DINDKAAR        PIC  '9999';                                    
    DCL EKOMNR          PIC  '9999';                                    
    DCL ESLKNR          PIC  '999';     /***/                           
    DCL EEJDNR          PIC  '(10)9';                                   
    DCL ELBNR           PIC  '999';                                     
    DCL EGENNR          PIC  '(3)9';                                    
    DCL TSKØNAVN        CHAR  (8);                                      
                                                                        
    DCL FEJLOPLYSNINGER CHAR     (200);                                 
                                                                        
     /* BEGYND Z6TMD TEST AF FEJLOPLYSNINGER */                         
    FEJLOPLYSNINGER = ' LOGTXT   ' !! LOGTXT      !!                    
                      ' CFUNK    ' !! CFUNK       !!                    
                      ' DCPRN    ' !! DCPRN       !!                    
                      ' DINDKAAR ' !! DINDKAAR    !!                    
                      ' EKOMNR   ' !! EKOMNR      !!                    
                      ' ESLKNR   ' !! ESLKNR      !!                    
                      ' EEJDNR   ' !! EEJDNR      !!                    
                      ' ELBNR    ' !! ELBNR       !!                    
                      ' EGENNR   ' !! EGENNR      !!                    
                      ' TSKØNAVN ' !! TSKØNAVN;                         
     CALL LOG_DATA_SKRIV(INDIVIDTYPE,LINIETYPE,FEJLOPLYSNINGER);        
                                                                        
  END LOG_DATA;                                                         
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     LOG_DATA_SKRIV                                                **
 **********************************************************************/
 LOG_DATA_SKRIV: PROC(INDIVIDTYPE,LINIETYPE,FEJLOPLYSNINGER);           
    DCL INDIVIDTYPE     BIN FIXED (15);                                 
    DCL LINIETYPE       BIN FIXED (15);                                 
    DCL FEJLOPLYSNINGER CHAR     (200);                                 
                                                                        
     TS_FEJL_DATA.INDIVIDTYPE = INDIVIDTYPE;                            
     TS_FEJL_DATA.LINIETYPE   = LINIETYPE;                              
     TS_FEJL_DATA.FEJLOPLYSNINGER = FEJLOPLYSNINGER;                    
                                                                        
     CALL SKRIV_TSKØ_FEJL_EVS(TS_KØER.TS_FEJL.KØNAVN);                  
                                                                        
 END LOG_DATA_SKRIV;                                                    
 /**********************************************************************
 *      BQ60001M                                                       *
 **     BEH_ZSRØR_TSKØ                                                **
 **********************************************************************/
 BEH_ZSRØR_TSKØ: PROC;                                                  
         CALL SKRIV_TSKØ;                                               
 END BEH_ZSRØR_TSKØ;                                                    
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_AFSLUTNINING                                              **
 **********************************************************************/
 EVS_AFSLUTNING: PROC;                                                  
    CALL EVS_SLET_TSKØER;                                               
    CALL EVS_FRIGIV_TSKØER;                                             
 END EVS_AFSLUTNING;                                                    
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_TILDEL_TSKØ_IDENTER                                       **
 **********************************************************************/
 EVS_TILDEL_TSKØ_IDENTER: PROC;                                         
                                                                        
   TS_KØER.TS_OVERSIGT.IDENT   = EIBTRNID !! 'EVSOVER';                 
   TS_KØER.TS_GRUND.IDENT      = EIBTRNID !! 'EVSGRUN';                 
   TS_KØER.TS_UDSKRIFT.IDENT   = EIBTRNID !! 'EVSUDSK';                 
   TS_KØER.TS_BEREGN.IDENT     = EIBTRNID !! 'EVSBRGN';                 
   TS_KØER.TS_OPLYS_GRND.IDENT = EIBTRNID !! 'EVSOPGR';                 
   TS_KØER.TS_FEJL.IDENT       = EIBTRNID !! 'EVSFEJL';                 
 END EVS_TILDEL_TSKØ_IDENTER;                                           
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_GENFIND_TSKØER                                            **
 **********************************************************************/
 EVS_GENFIND_TSKØER: PROC;                                              
   TS_KØER.TS_OVERSIGT.KØNAVN =                                         
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_OVERSIGT.IDENT);        
                                                                        
   TS_KØER.TS_GRUND.KØNAVN =                                            
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_GRUND.IDENT);           
                                                                        
   TS_KØER.TS_UDSKRIFT.KØNAVN =                                         
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_UDSKRIFT.IDENT);        
                                                                        
   TS_KØER.TS_BEREGN.KØNAVN =                                           
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_BEREGN.IDENT);          
                                                                        
   TS_KØER.TS_OPLYS_GRND.KØNAVN =                                       
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_OPLYS_GRND.IDENT);      
                                                                        
   TS_KØER.TS_FEJL.KØNAVN =                                             
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_FEJL.IDENT);            
 END EVS_GENFIND_TSKØER;                                                
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_SLET_TSKØER                                               **
 **********************************************************************/
 EVS_SLET_TSKØER: PROC;                                                 
   CALL SLET_TSKØ_EVS(TS_KØER.TS_OVERSIGT.KØNAVN);                      
   CALL SLET_TSKØ_EVS(TS_KØER.TS_GRUND.KØNAVN);                         
   CALL SLET_TSKØ_EVS(TS_KØER.TS_UDSKRIFT.KØNAVN);                      
   CALL SLET_TSKØ_EVS(TS_KØER.TS_BEREGN.KØNAVN);                        
   CALL SLET_TSKØ_EVS(TS_KØER.TS_OPLYS_GRND.KØNAVN);                    
   CALL SLET_TSKØ_EVS(TS_KØER.TS_FEJL.KØNAVN);                          
 END EVS_SLET_TSKØER;                                                   
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_FRIGIV_TSKØER                                             **
 **********************************************************************/
 EVS_FRIGIV_TSKØER: PROC;                                               
   CALL FRIGIV_TSKØ_NAVN(TS_KØER.TS_OVERSIGT.IDENT);                    
   CALL FRIGIV_TSKØ_NAVN(TS_KØER.TS_GRUND.IDENT);                       
   CALL FRIGIV_TSKØ_NAVN(TS_KØER.TS_UDSKRIFT.IDENT);                    
   CALL FRIGIV_TSKØ_NAVN(TS_KØER.TS_BEREGN.IDENT);                      
   CALL FRIGIV_TSKØ_NAVN(TS_KØER.TS_OPLYS_GRND.IDENT);                  
   CALL FRIGIV_TSKØ_NAVN(TS_KØER.TS_FEJL.IDENT);                        
 END EVS_FRIGIV_TSKØER;                                                 
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     RESET_UDSKRIFT_TSKØ                                           **
 **********************************************************************/
 RESET_UDSKRIFT_TSKØ: PROC;                                             
   TS_KØER.TS_UDSKRIFT.KØNAVN =                                         
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_UDSKRIFT.IDENT);        
   CALL SLET_TSKØ_EVS(TS_KØER.TS_UDSKRIFT.KØNAVN);                      
   TS_KØER.TS_BEREGN.KØNAVN =                                           
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_UDSKRIFT.IDENT);          
 END RESET_UDSKRIFT_TSKØ;                                               
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     RESET_BEREGN_TSKØ                                             **
 **********************************************************************/
 RESET_BEREGN_TSKØ: PROC;                                               
   TS_KØER.TS_BEREGN.KØNAVN =                                           
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_BEREGN.IDENT);          
   CALL SLET_TSKØ_EVS(TS_KØER.TS_BEREGN.KØNAVN);                        
   TS_KØER.TS_BEREGN.KØNAVN =                                           
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_BEREGN.IDENT);            
 END RESET_BEREGN_TSKØ;                                                 
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     RESET_OPLYS_GRND_TSKØ                                         **
 **********************************************************************/
 RESET_OPLYS_GRND_TSKØ: PROC;                                           
   TS_KØER.TS_OPLYS_GRND.KØNAVN =                                       
                   GENFIND_TSKØ_NAVN(TS_KØER.TS_OPLYS_GRND.IDENT);      
   CALL SLET_TSKØ_EVS(TS_KØER.TS_OPLYS_GRND.KØNAVN);                    
   TS_KØER.TS_OPLYS_GRND.KØNAVN =                                       
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_OPLYS_GRND.IDENT);        
 END RESET_OPLYS_GRND_TSKØ;                                             
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_OPRET_TSKØER                                              **
 **********************************************************************/
 EVS_OPRET_TSKØER: PROC;                                                
                                                                        
   DCL HJ_FEJLOPLYSNINGER CHAR(200);                                    
                                                                        
   /*OVERSIGT */                                                        
                                                                        
   TS_KØER.TS_OVERSIGT.KØNAVN =                                         
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_OVERSIGT.IDENT);          
                                                                        
   IF TS_KØER.TS_OVERSIGT.KØNAVN = ' ' THEN                             
   DO;                                                                  
      VIS_FEJL_LOG = JA;                                                
                                                                        
      HJ_FEJLOPLYSNINGER =                                              
                'FEJL I TS-KØ : ' !!   TS_KØER.TS_OVERSIGT.IDENT;       
                                                                        
      CALL LOG_DATA_SKRIV(999,1,HJ_FEJLOPLYSNINGER);                    
                                                                        
      FEJLDATA.CRETUR       = '00110';                                  
      FEJLDATA.MEDD_TEKST =                                             
      'FEJL VED TILDELING AF TS-KØ ' !! TS_KØER.TS_OVERSIGT.IDENT;      
   END;                                                                 
   ELSE                                                                 
   DO;                                                                  
      TS_KØER.TS_OVERSIGT.ANT_ITEMS = 0;                                
      TS_KØER.TS_OVERSIGT.AKT_START = 0;                                
   END;                                                                 
                                                                        
   /*GRUNDOPLYSNINGER */                                                
                                                                        
   TS_KØER.TS_GRUND.KØNAVN =                                            
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_GRUND.IDENT);             
                                                                        
   IF TS_KØER.TS_GRUND.KØNAVN = ' ' THEN                                
   DO;                                                                  
      VIS_FEJL_LOG = JA;                                                
                                                                        
      HJ_FEJLOPLYSNINGER =                                              
             'FEJL I TS-KØ : ' !!  TS_KØER.TS_GRUND.IDENT;              
                                                                        
      CALL LOG_DATA_SKRIV(999,1,HJ_FEJLOPLYSNINGER);                    
                                                                        
      FEJLDATA.CRETUR       = '00120';                                  
      FEJLDATA.MEDD_TEKST =                                             
      'FEJL VED TILDELING AF TS-KØ ' !! TS_KØER.TS_GRUND.IDENT;         
   END;                                                                 
   ELSE                                                                 
   /* FEJLBEHANDLING */                                                 
   DO;                                                                  
      TS_KØER.TS_GRUND.ANT_ITEMS = 0;                                   
      TS_KØER.TS_GRUND.AKT_START = 0;                                   
   END;                                                                 
                                                                        
   /*Udskrift         */                                                
   TS_KØER.TS_UDSKRIFT.KØNAVN =                                         
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_UDSKRIFT.IDENT);          
                                                                        
   IF                                                                   
   TS_KØER.TS_UDSKRIFT.KØNAVN = ' '                                     
   THEN DO;                                                             
      VIS_FEJL_LOG = JA;                                                
                                                                        
      HJ_FEJLOPLYSNINGER =                                              
            'FEJL I TS-KØ : ' !!  TS_KØER.TS_UDSKRIFT.IDENT;            
                                                                        
      CALL LOG_DATA_SKRIV(999,1,HJ_FEJLOPLYSNINGER);                    
                                                                        
      FEJLDATA.CRETUR       = '00135';                                  
      FEJLDATA.MEDD_TEKST =                                             
      'FEJL VED TILDELING AF TS-KØ ' !! TS_KØER.TS_UDSKRIFT.IDENT;      
   END;                                                                 
   ELSE DO;                                                             
      TS_KØER.TS_UDSKRIFT.ANT_ITEMS = 0;                                
      TS_KØER.TS_UDSKRIFT.AKT_START = 0;                                
   END;                                                                 
                                                                        
   /*BEREGN           */                                                
   TS_KØER.TS_BEREGN.KØNAVN =                                           
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_BEREGN.IDENT);            
                                                                        
   IF                                                                   
   TS_KØER.TS_BEREGN.KØNAVN = ' '                                       
   THEN DO;                                                             
      VIS_FEJL_LOG = JA;                                                
                                                                        
      HJ_FEJLOPLYSNINGER =                                              
            'FEJL I TS-KØ : ' !!  TS_KØER.TS_BEREGN.IDENT;              
                                                                        
      CALL LOG_DATA_SKRIV(999,1,HJ_FEJLOPLYSNINGER);                    
                                                                        
      FEJLDATA.CRETUR       = '00130';                                  
      FEJLDATA.MEDD_TEKST =                                             
      'FEJL VED TILDELING AF TS-KØ ' !! TS_KØER.TS_BEREGN.IDENT;        
   END;                                                                 
   ELSE DO;                                                             
      TS_KØER.TS_BEREGN.ANT_ITEMS = 0;                                  
      TS_KØER.TS_BEREGN.AKT_START = 0;                                  
   END;                                                                 
                                                                        
   /*Beregningsgrundlag */                                              
   TS_KØER.TS_OPLYS_GRND.KØNAVN =                                       
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_OPLYS_GRND.IDENT);        
                                                                        
   IF                                                                   
   TS_KØER.TS_OPLYS_GRND.KØNAVN = ' '                                   
   THEN DO;                                                             
      VIS_FEJL_LOG = JA;                                                
                                                                        
      HJ_FEJLOPLYSNINGER = 'FEJL I TS-KØ : ' !!                         
                           TS_KØER.TS_OPLYS_GRND.IDENT;                 
                                                                        
      CALL LOG_DATA_SKRIV(999,1,HJ_FEJLOPLYSNINGER);                    
                                                                        
      FEJLDATA.CRETUR     = '00137';                                    
      FEJLDATA.MEDD_TEKST = 'FEJL VED TILDELING AF TS-KØ ' !!           
                            TS_KØER.TS_OPLYS_GRND.IDENT;                
   END;                                                                 
   ELSE DO;                                                             
      TS_KØER.TS_OPLYS_GRND.ANT_ITEMS = 0;                              
      TS_KØER.TS_OPLYS_GRND.AKT_START = 0;                              
   END;                                                                 
                                                                        
   /*FEJL             */                                                
                                                                        
   TS_KØER.TS_FEJL.KØNAVN =                                             
                  TILDEL_TSKØ_NAVN(TS_KØER.TS_FEJL.IDENT);              
                                                                        
   IF TS_KØER.TS_FEJL.KØNAVN = ' ' THEN                                 
   DO;                                                                  
      VIS_FEJL_LOG = JA;                                                
                                                                        
      HJ_FEJLOPLYSNINGER = 'FEJL I TS-KØ : ' !!                         
                    TS_KØER.TS_FEJL.IDENT;                              
                                                                        
     CALL LOG_DATA_SKRIV(999,1,HJ_FEJLOPLYSNINGER);                     
                                                                        
      FEJLDATA.CRETUR       = '00140';                                  
      FEJLDATA.MEDD_TEKST =                                             
      'FEJL VED TILDELING AF TS-KØ ' !! TS_KØER.TS_FEJL.IDENT;          
   END;                                                                 
   ELSE                                                                 
   /* FEJLBEHANDLING */                                                 
   DO;                                                                  
      TS_KØER.TS_FEJL.ANT_ITEMS = 0;                                    
      TS_KØER.TS_FEJL.AKT_START = 0;                                    
   END;                                                                 
 END EVS_OPRET_TSKØER;                                                  
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_SKAF_HEADER_DATA                                          **
 **********************************************************************/
 EVS_SKAF_HEADER_DATA: PROC;                                            
                                                                        
      /*EXEC CICS ASKTIME;*/                                            
                                                                        
      DCL PIC_DCPRN PIC '(10)9';                                        
      DCL PIC_DINDKAAR PIC '9999';                                      
      OUTPUT.CRETUR       = FEJLDATA.CRETUR;                            
      OUTPUT.MEDD_TEKST   = FEJLDATA.MEDD_TEKST;                        
      TS_DATA.DCPRN       = PROCESMODUL.DCPRN;                          
      TS_DATA.DINDKAAR    = PROCESMODUL.INDKÅR;                         
                                                                        
      PIC_DCPRN           = TS_DATA.DCPRN;                              
      OUTPUT.DCPRN        = PIC_DCPRN;                                  
                                                                        
      PIC_DINDKAAR = TS_DATA.DINDKAAR;                                  
      OUTPUT.DINDKAAR     = PIC_DINDKAAR;                               
                                                                        
 END EVS_SKAF_HEADER_DATA;                                              
                                                                        
 /**********************************************************************
 **     DAN TEST_DATA                                                 **
 **********************************************************************/
 /*                                                                     
 EVS_DAN_TEST_DATA: PROC;                                               
                                                                        
      TS_DATA.INDIVIDTYPE          =  100;                              
      TS_DATA.LINIETYPE            =  1;                                
      TS_DATA.EKOMNR               =  163;                              
      TS_DATA.EEJDNR               =  1630000012;                       
      TS_DATA.ELBNR                =  001;                              
      TS_DATA.EGENNR               =  002;                              
      TS_DATA.EJDBELIG             =  'HERLEV HOVEDGADE 999    ';       
      TS_DATA.CEJDTYPE             =  '1';                              
                                                                        
      TS_DATA.ÆNDR.FUNDET          =  'J';                              
      TS_DATA.ÆNDR.BNETTO          =  0;                                
      TS_DATA.ÆNDR.BNETTO_I        =  -1;  / 0 ELLER -1/                
      TS_DATA.ÆNDR.BEJERAN         =  1800000;                          
      TS_DATA.ÆNDR.BEJERAN_I       =  0;                                
      TS_DATA.ÆNDR.BEVSMAN         =  0;                                
      TS_DATA.ÆNDR.BEVSMAN_I       =  -1;                               
      TS_DATA.ÆNDR.CSUPPL        =  '1';                                
      TS_DATA.ÆNDR.DFRAGLD       =  '01/02-2001';                       
                                                                        
      CALL SKRIV_TSKØ_EVS(TS_KØER.TS_OVERSIGT.KØNAVN);                  
                                                                        
      TS_DATA.INDIVIDTYPE          =  100;                              
      TS_DATA.LINIETYPE            =  1;                                
      TS_DATA.EKOMNR               =  999;                              
      TS_DATA.EEJDNR               =  1630000012;                       
      TS_DATA.ELBNR                =  001;                              
      TS_DATA.EGENNR               =  002;                              
      TS_DATA.EJDBELIG             =  'TESTKOMMUNEGADE 84      ';       
      TS_DATA.CEJDTYPE             =  '1';                              
                                                                        
      TS_DATA.ÆNDR.FUNDET          =  'J';                              
      TS_DATA.ÆNDR.BNETTO          =  0;                                
      TS_DATA.ÆNDR.BNETTO_I        =  -1;  / 0 ELLER -1/                
      TS_DATA.ÆNDR.BEJERAN         =  1700000;                          
      TS_DATA.ÆNDR.BEJERAN_I       =  0;                                
      TS_DATA.ÆNDR.BEVSMAN         =  0;                                
      TS_DATA.ÆNDR.BEVSMAN_I       =  -1;                               
      TS_DATA.ÆNDR.CSUPPL        =  '1';                                
      TS_DATA.ÆNDR.DFRAGLD       =  '01/02-2001';                       
                                                                        
      CALL SKRIV_TSKØ_EVS(TS_KØER.TS_OVERSIGT.KØNAVN);                  
                                                                        
 END EVS_DAN_TEST_DATA;                                                 
 */                                                                     
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_DAN_TEST_GRUND_DATA                                     **  
 **********************************************************************/
                                                                        
 EVS_DAN_TEST_GRUND_DATA: PROC;                                         
                                                                        
      DCL DCPRN         PIC  '(10)9';                                   
      DCL DINDKAAR      PIC  '9999';                                    
      DCL EKOMNR        PIC  '9999';                                    
      DCL EEJDNR        PIC  '(10)9';                                   
      DCL ELBNR         PIC  '999';                                     
      DCL EGENNR        PIC  '(3)9';                                    
                                                                        
      DCPRN         =    2512484916;                                    
      DINDKAAR      =    2000;                                          
      EKOMNR        =    0420;                                          
      EEJDNR        =    0000000316;                                    
      ELBNR         =    001;                                           
      EGENNR        =    001;                                           
                                                                        
                                                                        
      CALL KALD_PROCESMODUL_GRUND(DCPRN,DINDKAAR,                       
                                  EKOMNR,EEJDNR,ELBNR,EGENNR);          
                                                                        
                                                                        
          FLERE_ELEMENTER_GRUND = JA;                                   
          DO WHILE(FLERE_ELEMENTER_GRUND);                              
             OUTPUTELEM = '';                                           
             CALL EVS_SKAF_GRUND_DATA(DCPRN,DINDKAAR,EKOMNR,EEJDNR,     
                                      ELBNR,EGENNR);                    
             IF FLERE_ELEMENTER_GRUND = JA THEN                         
                CALL BEH_ZSRØR_TSKØ;                                    
          END;                                                          
                                                                        
                                                                        
 END EVS_DAN_TEST_GRUND_DATA;                                           
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_SKAF_OVERSIGT_DATA                                        **
 **********************************************************************/
 EVS_SKAF_OVERSIGT_DATA: PROC;                                          
      DCL  EOF_SW               BIT(01) INIT ('0'B);                    
      DCL  ITEMNO               BIN FIXED(15,0);                        
      DCL PIC_DHENVNR   PIC '(10)9';                                    
      DCL PIC_EKOMNR    PIC '9999';                                     
      DCL PIC_EEJDNR    PIC '(10)9';                                    
      DCL PIC_ELBNR     PIC '999';                                      
      DCL PIC_EGENNR    PIC '999';                                      
                                                                        
      testprt('...ved evs_skaf_oversigt_data - TS_OVERSIGT.AKT_START:', 
                                               TS_OVERSIGT.AKT_START);  
      ITEMNO = TS_OVERSIGT.AKT_START;                                   
      CALL LÆS_TSKØ_OVERSIGT_EVS(TS_KØER.TS_OVERSIGT.KØNAVN,            
                              ITEMNO,EOF_SW);                           
                                                                        
        testprt('TS_DATA.DCPRN:', TS_DATA.DCPRN,                        
                '.DINDKAAR:',     TS_DATA.DINDKAAR,                     
                '.EEJDNR:',       TS_DATA.EEJDNR,                       
                '- ELBNR:',       TS_DATA.ELBNR);                       
                                                                        
      IF EOF_SW = JA THEN                                               
          FLERE_ELEMENTER = NEJ;                                        
      ELSE                                                              
      DO;                                                               
          FLERE_ELEMENTER = JA;                                         
          OUTPUTELEM.INDIVIDTYPE  = TS_DATA.INDIVIDTYPE;                
          OUTPUTELEM.LINIETYPE    = TS_DATA.LINIETYPE;                  
                                                                        
          PIC_DHENVNR            = TS_DATA.DHENVNR;                     
          OUTPUTELEM.FILLER1     = PIC_DHENVNR;                         
                                                                        
          PIC_EKOMNR              = TS_DATA.EKOMNR;                     
          OUTPUTELEM.EKOMNR       = PIC_EKOMNR;                         
                                                                        
          PIC_EEJDNR               = TS_DATA.EEJDNR;                    
          OUTPUTELEM.EEJDNR        = PIC_EEJDNR;                        
                                                                        
          PIC_ELBNR                = TS_DATA.ELBNR;                     
          OUTPUTELEM.ELBNR         = PIC_ELBNR;                         
                                                                        
          PIC_EGENNR               = TS_DATA.EGENNR;                    
          OUTPUTELEM.EGENNR        = PIC_EGENNR;                        
                                                                        
          IF TS_DATA.INDIVIDTYPE   =  110 THEN                          
             OUTPUTELEM.EJDBELIG   = 'Total for alle ejendomme';        
          ELSE                                                          
             OUTPUTELEM.EJDBELIG   = TS_DATA.EJDBELIG;                  
                                                                        
          OUTPUTELEM.CEJDTYPE      = TS_DATA.CEJDTYPE;                  
                                                                        
          OUTPUTELEM.AEN_FUNDET    = ' ';                               
          OUTPUTELEM.AEN_BNETTO    = TS_DATA.BNETTO;                    
          OUTPUTELEM.AEN_BNETTO_I  = TS_DATA.BNETTO_I;                  
          OUTPUTELEM.AEN_BEJERAN   = TS_DATA.BEJERAN;                   
          OUTPUTELEM.AEN_BEJERAN_I = TS_DATA.BEJERAN_I;                 
          OUTPUTELEM.AEN_BEVSMAN   = TS_DATA.BEVSMAN;                   
          OUTPUTELEM.AEN_BEVSMAN_I = TS_DATA.BEVSMAN_I;                 
          OUTPUTELEM.AEN_CSUPPL    = TS_DATA.CSUPPL;                    
          OUTPUTELEM.AEN_UDSKRDTO  = TS_DATA.UDSKRDTO;                  
          OUTPUTELEM.AEN_DFRAGLD   = TS_DATA.DFRAGLD;                   
          TS_OVERSIGT.AKT_START = TS_OVERSIGT.AKT_START +1;             
      END;                                                              
 END EVS_SKAF_OVERSIGT_DATA;                                            
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_SKAF_GRUND_DATA                                          ** 
 **********************************************************************/
 EVS_SKAF_GRUND_DATA: PROC(DCPRN,DINDKAAR,EKOMNR,EEJDNR,                
                           ELBNR,EGENNR);                               
      DCL  EOF_SW               BIT(01) INIT ('0'B);                    
      DCL  ITEMNO               BIN FIXED(15,0);                        
                                                                        
      DCL DCPRN         PIC  '(10)9';                                   
      DCL DINDKAAR      PIC  '9999';                                    
      DCL EKOMNR        PIC  '9999';                                    
      DCL EEJDNR        PIC  '(10)9';                                   
      DCL ELBNR         PIC  '999';                                     
      DCL EGENNR        PIC  '(3)9';                                    
                                                                        
      DCL PIC_EKOMNR    PIC '9999';                                     
      DCL PIC_EEJDNR    PIC '(10)9';                                    
      DCL PIC_ELBNR     PIC '999';                                      
      DCL PIC_EGENNR    PIC '999';                                      
                                                                        
      ITEMNO = TS_GRUND.AKT_START;                                      
      CALL LÆS_TSKØ_GRUND_EVS(TS_KØER.TS_GRUND.KØNAVN,                  
                              ITEMNO,EOF_SW);                           
                                                                        
      IF EOF_SW = JA THEN                                               
          FLERE_ELEMENTER_GRUND = NEJ;                                  
      ELSE                                                              
      DO;                                                               
          FLERE_ELEMENTER_GRUND = JA;                                   
                                                                        
          PIC_EKOMNR              = EKOMNR;                             
          OUTPUTELEM.EKOMNR       = PIC_EKOMNR;                         
                                                                        
          PIC_EEJDNR               = EEJDNR;                            
          OUTPUTELEM.EEJDNR        = PIC_EEJDNR;                        
                                                                        
          PIC_ELBNR                = ELBNR;                             
          OUTPUTELEM.ELBNR         = PIC_ELBNR;                         
                                                                        
          PIC_EGENNR               = EGENNR;                            
          OUTPUTELEM.EGENNR        = PIC_EGENNR;                        
                                                                        
          OUTPUTELEM.INDIVIDTYPE  = TS_KOLON_DATA.INDIVIDTYPE;          
          OUTPUTELEM.LINIETYPE    = TS_KOLON_DATA.LINIETYPE;            
          OUTPUTELEM.FELTNR       = TS_KOLON_DATA.FELTNR;               
          OUTPUTELEM.FELTTEKST    = TS_KOLON_DATA.FELTTEKST;            
          OUTPUTELEM.KOLONNE1     = TS_KOLON_DATA.KOLONNE1;             
          OUTPUTELEM.KOLONNE2     = TS_KOLON_DATA.KOLONNE2;             
                                                                        
          TS_GRUND.AKT_START      = TS_GRUND.AKT_START +1;              
      END;                                                              
                                                                        
 END EVS_SKAF_GRUND_DATA;                                               
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_SKAF_BEREGN_DATA                                          **
 **********************************************************************/
 EVS_SKAF_BEREGN_DATA: PROC (ITEMNO, DCPRN, DINDKAAR, EKOMNR,           
                             EEJDNR, ELBNR, EGENNR,   UDSKRDTO);        
         DCL   EOF_SW       BIT(01) INIT ('0'B);                        
         DCL   ITEMNO       BIN FIXED(15,0);                            
         DCL   DCPRN        PIC  '(10)9';                               
         DCL   DINDKAAR     PIC  '9999';                                
         DCL   EKOMNR       PIC  '9999';                                
         DCL   EEJDNR       PIC  '(10)9';                               
         DCL   ELBNR        PIC  '999';                                 
         DCL   EGENNR       PIC  '(3)9';                                
         DCL   UDSKRDTO     CHAR(10);                                   
                                                                        
         testprt('...ved EVS_SKAF_BEREGN_DATA - ITEMNO:',ITEMNO,        
                        '- TS_BEREGN.AKT_START:',TS_BEREGN.AKT_START);  
                                                                        
         TS_BEREGN_DATA = '';                                           
       /*ITEMNO = TS_BEREGN.AKT_START; */                               
         CALL LÆS_TSKØ_BEREGN_EVS(TS_KØER.TS_BEREGN.KØNAVN,             
                                  ITEMNO,EOF_SW);                       
                                                                        
         IF EOF_SW = JA THEN                                            
             FLERE_ELEMENTER_BEREGN = NEJ;                              
         ELSE                                                           
         DO;                                                            
             FLERE_ELEMENTER_BEREGN  = JA;                              
                                                                        
             OUTPUTELEM.EKOMNR = EKOMNR;                                
             OUTPUTELEM.EEJDNR = EEJDNR;                                
             OUTPUTELEM.ELBNR  = ELBNR;                                 
             OUTPUTELEM.EGENNR = EGENNR;                                
                                                                        
             OUTPUTELEM.INDIVIDTYPE  = TS_BEREGN_DATA.INDIVIDTYPE;      
             OUTPUTELEM.LINIETYPE    = TS_BEREGN_DATA.LINIETYPE;        
             OUTPUTELEM.AEN_UDSKRDTO = UDSKRDTO;                        
             OUTPUTELEM.TEKST_LGD    = TS_BEREGN_DATA.TEKST_LGD;        
             OUTPUTELEM.TEKST        = TS_BEREGN_DATA.TEKST;            
             OUTPUTELEM.BELOEB       = TS_BEREGN_DATA.BELØB;            
             TS_BEREGN.AKT_START     = TS_BEREGN.AKT_START + 1;         
         END;                                                           
 END EVS_SKAF_BEREGN_DATA;                                              
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_SKAF_OPLYS_GRND_DATA                                      **
 **********************************************************************/
 EVS_SKAF_OPLYS_GRND_DATA: PROC (ITEMNO, DCPRN, DINDKAAR, EKOMNR,       
                                 EEJDNR, ELBNR, EGENNR,   UDSKRDTO);    
         DCL   EOF_SW       BIT(01) INIT ('0'B);                        
         DCL   ITEMNO       BIN FIXED(15,0);                            
         DCL   DCPRN        PIC  '(10)9';                               
         DCL   DINDKAAR     PIC  '9999';                                
         DCL   EKOMNR       PIC  '9999';                                
         DCL   EEJDNR       PIC  '(10)9';                               
         DCL   ELBNR        PIC  '999';                                 
         DCL   EGENNR       PIC  '(3)9';                                
         DCL   UDSKRDTO     CHAR(10);                                   
                                                                        
         testprt('...ved EVS_SKAF_OPLYS_GRND_DATA - ITEMNO:',ITEMNO,    
                  '- TS_OPLYS_GRND.AKT_START:',TS_OPLYS_GRND.AKT_START);
                                                                        
         TS_OPLYS_GRND_DATA = '';                                       
                                                                        
       /*ITEMNO = TS_OPLYS_GRND.AKT_START; */                           
         CALL LÆS_TSKØ_OPLYS_GRND_EVS(TS_KØER.TS_OPLYS_GRND.KØNAVN,     
                                      ITEMNO,EOF_SW);                   
                                                                        
         IF EOF_SW = JA THEN                                            
             FLERE_ELEMENTER_OPLYS_GRND = NEJ;                          
         ELSE                                                           
         DO;                                                            
             FLERE_ELEMENTER_OPLYS_GRND = JA;                           
                                                                        
             OUTPUTELEM.EKOMNR = EKOMNR;                                
             OUTPUTELEM.EEJDNR = EEJDNR;                                
             OUTPUTELEM.ELBNR  = ELBNR;                                 
             OUTPUTELEM.EGENNR = EGENNR;                                
                                                                        
             OUTPUTELEM.AEN_UDSKRDTO = UDSKRDTO;                        
             OUTPUTELEM.INDIVIDTYPE  = TS_OPLYS_GRND_DATA.INDIVIDTYPE;  
             OUTPUTELEM.LINIETYPE    = TS_OPLYS_GRND_DATA.LINIETYPE;    
             OUTPUTELEM.FELTNR       = TS_OPLYS_GRND_DATA.FELTNR;       
             OUTPUTELEM.FELTTEKST    = TS_OPLYS_GRND_DATA.FELTTEKST;    
             OUTPUTELEM.KOLONNE1     = TS_OPLYS_GRND_DATA.KOLONNE1;     
             OUTPUTELEM.KOLONNE2     = TS_OPLYS_GRND_DATA.KOLONNE2;     
                                                                        
             TS_OPLYS_GRND.AKT_START = TS_OPLYS_GRND.AKT_START + 1;     
         END;                                                           
 END EVS_SKAF_OPLYS_GRND_DATA;                                          
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **     EVS_LÆS_FEJL_TSKØ                                           **  
 **********************************************************************/
 EVS_LÆS_FEJL_TSKØ: PROC;                                               
      DCL  EOF_SW               BIT(01) INIT ('0'B);                    
      DCL  ITEMNO               BIN FIXED(15,0);                        
                                                                        
      ITEMNO = TS_FEJL.AKT_START;                                       
      CALL LÆS_TSKØ_FEJL_EVS(TS_KØER.TS_FEJL.KØNAVN,                    
                        ITEMNO,EOF_SW);                                 
                                                                        
      IF EOF_SW = JA THEN                                               
          FLERE_ELEMENTER_FEJL = NEJ;                                   
      ELSE                                                              
      DO;                                                               
          FLERE_ELEMENTER_FEJL = JA;                                    
                                                                        
          OUTPUTELEM.INDIVIDTYPE     = TS_FEJL_DATA.INDIVIDTYPE;        
          OUTPUTELEM.LINIETYPE       = TS_FEJL_DATA.LINIETYPE;          
          OUTPUTELEM.FEJLOPLYSNINGER = TS_FEJL_DATA.FEJLOPLYSNINGER;    
                                                                        
          TS_FEJL.AKT_START         = TS_FEJL.AKT_START + 1;            
      END;                                                              
                                                                        
 END EVS_LÆS_FEJL_TSKØ;                                                 
                                                                        
 /**********************************************************************
 *      BQ60001M                                                       *
 **      KALD PROCESMODUL MED FUNKTION LÆS EVS-OVERSIGT               **
 **********************************************************************/
 KALD_PROCESMODUL_OVERSIGT: PROC;                                       
         /*TST PUT SKIP LIST ('KALD_PROCESSMODUL') TSL*/                
                                                                        
      /* EXEC CICS ASKTIME; */                                          
         PROCESMODUL.CFUNK = 'OVERSIGT';                                
         PROCESMODUL.DCPRN  = INPUT.DCPRN;                              
         PROCESMODUL.INDKÅR = INPUT.DINDKAAR;                           
         PROCESMODUL.EKOMNR = 0;                                        
         PROCESMODUL.EEJDNR = 0;                                        
         PROCESMODUL.ELBNR  = 0;                                        
         PROCESMODUL.EGENNR = 0;                                        
                                                                        
         PROCESMODUL.TS.KØNAVN = TS_KØER.TS_OVERSIGT.KØNAVN;            
         IF VIS_LOG = JA THEN                                           
         DO;                                                            
            CALL LOG_DATA(998,1,' ', PROCESMODUL.CFUNK,                 
                       PROCESMODUL.DCPRN,PROCESMODUL.INDKÅR,0,0,0,0,0,  
                       TS_KØER.TS_OVERSIGT.KØNAVN);                     
         END;                                                           
                                                                        
         EXEC CICS LINK                                                 
                   PROGRAM ('BQ00250')                                  
                   COMMAREA (PROCESMODUL)                               
         ;                                                              
                                                                        
         SELECT(PROCESMODUL.CRETUR);                                    
           WHEN('OK')                                                   
              DO;                                                       
                TS_KØER.TS_OVERSIGT.ANT_ITEMS =                         
                                    PROCESMODUL.TS.ANT_ITEMS;           
                testprt('Oversigt.ant_items:',PROCESMODUL.TS.ANT_ITEMS);
              END;                                                      
           WHEN('EJFU')                                                 
              DO;                                                       
                FEJLDATA.CRETUR       = '00150';                        
                FEJLDATA.MEDD_TEKST = 'Der findes ingen oplysninger ' !!
                             'på forespurgte person';                   
              END;                                                      
           OTHERWISE                                                    
              DO;                                                       
                FEJLDATA.CRETUR       = '00160';                        
                FEJLDATA.MEDD_TEKST =                                   
                               'Alvorlig fejl ved læsning af '!!        
                             'EVS''s  register, prøv senere';           
              END;                                                      
         END;                                                           
 END KALD_PROCESMODUL_OVERSIGT;                                         
                                                                        
 /********************************************************************* 
 *      BQ60001M                                                       *
 *      KALD PROCESSMODUL MED FUNKTION LÆS AFSNIT                      *
 *                                                                     *
 **********************************************************************/
 KALD_PROCESMODUL_GRUND: PROC(DCPRN,DINDKAAR,EKOMNR,                    
                              EEJDNR,ELBNR,EGENNR);                     
                                                                        
         DCL DCPRN      PIC  '(10)9';                                   
         DCL DINDKAAR   PIC  '9999';                                    
         DCL EKOMNR     PIC  '9999';                                    
         DCL EEJDNR     PIC  '(10)9';                                   
         DCL ELBNR      PIC  '999';                                     
         DCL EGENNR     PIC  '(3)9';                                    
                                                                        
         PROCESMODUL = '';                                              
                                                                        
                                                                        
         PROCESMODUL.CFUNK  = 'GRUND';                                  
         PROCESMODUL.DCPRN  = DCPRN;                                    
         PROCESMODUL.INDKÅR = DINDKAAR;                                 
         PROCESMODUL.EKOMNR = EKOMNR;                                   
         PROCESMODUL.EEJDNR = EEJDNR;                                   
         PROCESMODUL.ELBNR  = ELBNR;                                    
         PROCESMODUL.EGENNR = EGENNR;                                   
                                                                        
         /*TESTDATA                                                     
         PROCESMODUL.CFUNK  = 'GRUND';                                  
         PROCESMODUL.DCPRN  = 2512484916;                               
         PROCESMODUL.INDKÅR = 2000;                                     
         PROCESMODUL.EKOMNR = 0420;                                     
         PROCESMODUL.EEJDNR = 0000000316;                               
         PROCESMODUL.ELBNR  = 001;                                      
         PROCESMODUL.EGENNR = 001;                                      
         */                                                             
                                                                        
         IF VIS_LOG = JA THEN                                           
         DO;                                                            
            CALL LOG_DATA(998,2,' ', 'GRUND',                           
                PROCESMODUL.DCPRN,PROCESMODUL.INDKÅR,PROCESMODUL.EKOMNR,
                0,                                                      
                PROCESMODUL.EEJDNR,PROCESMODUL.ELBNR,PROCESMODUL.EGENNR,
                 TS_KØER.TS_GRUND.KØNAVN);                              
         END;                                                           
                                                                        
         PROCESMODUL.TS.KØNAVN = TS_KØER.TS_GRUND.KØNAVN;               
                                                                        
         EXEC CICS LINK                                                 
                   PROGRAM ('BQ00250')                                  
                   COMMAREA (PROCESMODUL)                               
         ;                                                              
                                                                        
         SELECT(PROCESMODUL.CRETUR);                                    
           WHEN('OK')                                                   
              DO;                                                       
                TS_KØER.TS_GRUND.ANT_ITEMS =                            
                                    PROCESMODUL.TS.ANT_ITEMS;           
                                                                        
                testprt('grund.ant_items:',procesmodul.ts.ant_items);   
                                                                        
                CALL BEH_DEBITERING(EIBTRNID,'KS1');                    
                IF VIS_LOG = JA THEN                                    
                   CALL LOG_DATA_SKRIV(980,1,'DEBITERING ' !!           
                                       EIBTRNID !!' KS1');              
              END;                                                      
           WHEN('EJFU')                                                 
              DO;                                                       
                FEJLDATA.CRETUR       = '00170';                        
                FEJLDATA.MEDD_TEKST = 'Der findes ingen oplysninger ' !!
                             'på forespurgte person';                   
              END;                                                      
           OTHERWISE                                                    
              DO;                                                       
                FEJLDATA.CRETUR       = '00180';                        
                FEJLDATA.MEDD_TEKST =                                   
                               'Alvorlig fejl ved læsning af '   !!     
                             'EVS''s  register, prøv senere ';          
                                                                        
              END;                                                      
         END;                                                           
                                                                        
 END KALD_PROCESMODUL_GRUND;                                            
                                                                        
 /********************************************************************* 
 *      BQ60001M                                                       *
 *      HENT PROCESSMODUL MED FUNKTION UDSKRIFT                        *
 *      For at hente listen af nøgler til beregningsudskrifter         *
 **********************************************************************/
 KALD_PROCESMODUL_UDSKRIFT: PROC(DCPRN, DINDKAAR, EKOMNR,               
                                ESLKNR, EEJDNR,   ELBNR);               
                                                                        
         DCL DCPRN      PIC  '(10)9';                                   
         DCL DINDKAAR   PIC  '9999';                                    
         DCL EKOMNR     PIC  '9999';                                    
         DCL ESLKNR     PIC  '999';                                     
         DCL EEJDNR     PIC  '(10)9';                                   
         DCL ELBNR      PIC  '999';                                     
         DCL EGENNR     PIC  '(3)9';                                    
                                                                        
         PROCESMODUL        = '';                                       
         PROCESMODUL.CFUNK  = 'UDSKRIFTER';                             
         PROCESMODUL.DCPRN  = DCPRN;                                    
         PROCESMODUL.INDKÅR = DINDKAAR;                                 
         PROCESMODUL.ESLKNR = ESLKNR;                                   
         PROCESMODUL.EKOMNR = EKOMNR;                                   
         PROCESMODUL.EEJDNR = EEJDNR;                                   
         PROCESMODUL.ELBNR  = ELBNR;                                    
                                                                        
         testprt('...ved KALD_PROCESMODUL_udskrift - EEJDNR:',EEJDNR,   
                                                '- ELBNR:',ELBNR);      
                                                                        
         IF                                                             
         VIS_LOG = JA THEN                                              
         DO;                                                            
            CALL LOG_DATA(998, 2, ' ', 'UDSKRIFTER',                    
                          PROCESMODUL.DCPRN,  PROCESMODUL.INDKÅR,       
                          PROCESMODUL.EKOMNR, PROCESMODUL.ESLKNR,       
                          PROCESMODUL.EEJDNR,                           
                          PROCESMODUL.ELBNR,  0,                        
                          TS_KØER.TS_UDSKRIFT.KØNAVN);                  
         END;                                                           
                                                                        
         PROCESMODUL.TS.KØNAVN = TS_KØER.TS_UDSKRIFT.KØNAVN;            
                                                                        
         EXEC CICS LINK                                                 
                   PROGRAM ('BQ00250')                                  
                   COMMAREA (PROCESMODUL)                               
         ;                                                              
                                                                        
         TS_KØER.TS_UDSKRIFT.ANT_ITEMS = PROCESMODUL.TS.ANT_ITEMS;      
                                                                        
         testprt('cretur:',PROCESMODUL.CRETUR,                          
                 '- TS_UDSKRIFT.ANT_ITEMS:',PROCESMODUL.TS.ANT_ITEMS);  
                                                                        
         SELECT(PROCESMODUL.CRETUR);                                    
            WHEN('OK') DO;                                              
            END;                                                        
            WHEN('EJFU') DO;                                            
            /* FEJLDATA.CRETUR       = '00170';                         
               FEJLDATA.MEDD_TEKST = 'Der findes ingen opgørelse ' !!   
                                     'på forespurgte person';           
            */                                                          
            END;                                                        
            OTHERWISE DO;                                               
               FEJLDATA.CRETUR       = '00180';                         
               FEJLDATA.MEDD_TEKST = 'Alvorlig fejl ved læsning af ' !! 
                                     'EVS''s  register, prøv senere ';  
            END;                                                        
         END;                                                           
 END KALD_PROCESMODUL_UDSKRIFT;                                         
                                                                        
 /********************************************************************* 
 *      BQ60001M                                                       *
 *      HENT PROCESSMODUL MED FUNKTION BEREGN  (BEREGNING & HISTORIK)  *
 **********************************************************************/
 KALD_PROCESMODUL_OPGØRELSE: PROC(ITEMNR, DCPRN, DINDKAAR, EKOMNR,      
                                  ESLKNR, EEJDNR, ELBNR, EGENNR,        
                                  CONLINE);                             
                                                                        
         DCL EOF_SW     BIT(01) INIT ('0'B);                            
         DCL ITEMNR     BIN FIXED(15,0);                                
         DCL DCPRN      PIC  '(10)9';                                   
         DCL DINDKAAR   PIC  '9999';                                    
         DCL EKOMNR     PIC  '9999';                                    
         DCL ESLKNR     PIC  '999';                                     
         DCL EEJDNR     PIC  '(10)9';                                   
         DCL ELBNR      PIC  '999';                                     
         DCL EGENNR     PIC  '999';                                     
         DCL CONLINE    CHAR (1);                                       
                                                                        
         testprt('...ved KALD_PROCESMODUL_opgørelse - ITEMNR:',ITEMNR,  
                 '- EGENNR:',TS_UDSKRIFT_DATA.EGENNR);                  
                                                                        
         PROCESMODUL          = '';                                     
         PROCESMODUL.CFUNK    = 'BEREGN';                               
         PROCESMODUL.DCPRN    = DCPRN;                                  
         PROCESMODUL.INDKÅR   = DINDKAAR;                               
         PROCESMODUL.ESLKNR   = ESLKNR;                                 
         PROCESMODUL.EKOMNR   = EKOMNR;                                 
         PROCESMODUL.EEJDNR   = EEJDNR;                                 
         PROCESMODUL.ELBNR    = ELBNR;                                  
         PROCESMODUL.EGENNR   = EGENNR;                                 
         PROCESMODUL.CONLINE  = CONLINE;                                
         PROCESMODUL.CPENSRED = 'X';                                    
         PROCESMODUL.CSUMEVS  = ' ';                                    
         PROCESMODUL.BSUMEVS  = 0;                                      
                                                                        
         IF                                                             
         VIS_LOG = JA THEN                                              
         DO;                                                            
            CALL LOG_DATA(998, 2, ' ', 'BEREGN',                        
                          PROCESMODUL.DCPRN,  PROCESMODUL.INDKÅR,       
                          PROCESMODUL.EKOMNR, PROCESMODUL.ESLKNR,       
                          PROCESMODUL.EEJDNR,                           
                          PROCESMODUL.ELBNR,  PROCESMODUL.EGENNR,       
                          TS_KØER.TS_BEREGN.KØNAVN);                    
         END;                                                           
                                                                        
         PROCESMODUL.TS.KØNAVN = TS_KØER.TS_BEREGN.KØNAVN;              
                                                                        
         EXEC CICS LINK                                                 
                   PROGRAM ('BQ00250')                                  
                   COMMAREA (PROCESMODUL)                               
         ;                                                              
                                                                        
         SELECT(PROCESMODUL.CRETUR);                                    
            WHEN('OK','EJB2','EJFU') DO;                                
               TS_KØER.TS_BEREGN.ANT_ITEMS =                            
                  PROCESMODUL.TS.ANT_ITEMS;                             
               testprt('beregn.ant_items:',                             
                        procesmodul.ts.ant_items);                      
                                                                        
                CALL BEH_DEBITERING(EIBTRNID,'KS2');                    
                IF VIS_LOG = JA THEN                                    
                   CALL LOG_DATA_SKRIV(980,1,'DEBITERING ' !!           
                                       EIBTRNID !!' KS2');              
                                                                        
               IF                                                       
               PROCESMODUL.CRETUR = 'EJB2'                              
               THEN DO;                                                 
                  FEJLDATA.CRETUR       = '00175';                      
                  FEJLDATA.MEDD_TEKST = PROCESMODUL.RETURTEKST;         
               END;                                                     
            END;                                                        
         /* WHEN('EJFU')DO;                                             
               FEJLDATA.CRETUR       = '00150';                         
               FEJLDATA.MEDD_TEKST = 'Der findes ingen oplysninger ' !! 
                                     'på forespurgte person';           
            END; */                                                     
            WHEN('EJB1') DO;                                            
               FEJLDATA.CRETUR       = '00170';                         
               FEJLDATA.MEDD_TEKST = 'Der findes ingen ' !!             
                    'beregningsopgørelse på forespurgte person';        
            END;                                                        
            OTHERWISE DO;                                               
               FEJLDATA.CRETUR       = '00180';                         
               FEJLDATA.MEDD_TEKST =                                    
                                'Alvorlig fejl ved læsning af '   !!    
                                'EVS''s  register, prøv senere. ' !!    
                                '- CRETUR: ' !! PROCESMODUL.CRETUR;     
            END;                                                        
         END;                                                           
 END KALD_PROCESMODUL_OPGØRELSE;                                        
                                                                        
 /********************************************************************* 
 *      BQ60001M                                                       *
 *      HENT PROCESSMODUL MED FUNKTION OPLYS-BERG (BEREGNINGSGRUNDLAG) *
 **********************************************************************/
 KALD_PROCESMODUL_OPLYS_GRND: PROC(ITEMNR, DCPRN, DINDKAAR, EKOMNR,     
                                   ESLKNR, EEJDNR, ELBNR, EGENNR,       
                                   CONLINE);                            
                                                                        
         DCL EOF_SW     BIT(01) INIT ('0'B);                            
         DCL ITEMNR     BIN FIXED(15,0);                                
         DCL DCPRN      PIC  '(10)9';                                   
         DCL DINDKAAR   PIC  '9999';                                    
         DCL EKOMNR     PIC  '9999';                                    
         DCL ESLKNR     PIC  '999';                                     
         DCL EEJDNR     PIC  '(10)9';                                   
         DCL ELBNR      PIC  '999';                                     
         DCL EGENNR     PIC  '999';                                     
         DCL CONLINE    CHAR (1);                                       
                                                                        
         testprt('...ved kald_procesmodul_oplys_grnd - itemnr:',itemnr, 
                 '- egennr:',ts_udskrift_data.egennr);                  
                                                                        
         PROCESMODUL          = '';                                     
         PROCESMODUL.CFUNK    = 'OPLYS-BERG';                           
         PROCESMODUL.DCPRN    = DCPRN;                                  
         PROCESMODUL.INDKÅR   = DINDKAAR;                               
         PROCESMODUL.ESLKNR   = ESLKNR;                                 
         PROCESMODUL.EKOMNR   = EKOMNR;                                 
         PROCESMODUL.EEJDNR   = EEJDNR;                                 
         PROCESMODUL.ELBNR    = ELBNR;                                  
         PROCESMODUL.EGENNR   = EGENNR;                                 
         PROCESMODUL.CONLINE  = CONLINE;                                
         PROCESMODUL.CPENSRED = 'X';                                    
         PROCESMODUL.CSUMEVS  = ' ';                                    
         PROCESMODUL.BSUMEVS  = 0;                                      
                                                                        
         IF                                                             
         VIS_LOG = JA THEN                                              
         DO;                                                            
            CALL LOG_DATA(998, 2, ' ', 'OPLYS-BERG',                    
                          PROCESMODUL.DCPRN,  PROCESMODUL.INDKÅR,       
                          PROCESMODUL.EKOMNR, PROCESMODUL.ESLKNR,       
                          PROCESMODUL.EEJDNR,                           
                          PROCESMODUL.ELBNR,  PROCESMODUL.EGENNR,       
                          TS_KØER.TS_OPLYS_GRND.KØNAVN);                
         END;                                                           
                                                                        
         PROCESMODUL.TS.KØNAVN = TS_KØER.TS_OPLYS_GRND.KØNAVN;          
                                                                        
         EXEC CICS LINK                                                 
                   PROGRAM ('BQ00250')                                  
                   COMMAREA (PROCESMODUL)                               
         ;                                                              
                                                                        
         SELECT(PROCESMODUL.CRETUR);                                    
            WHEN('OK','EJFU') DO;                                       
               TS_KØER.TS_OPLYS_GRND.ANT_ITEMS =                        
                  PROCESMODUL.TS.ANT_ITEMS;                             
               testprt('oplys_grnd.ant_items:',                         
                        procesmodul.ts.ant_items);                      
            END;                                                        
        /*  WHEN('EJFU')DO;                                             
               FEJLDATA.CRETUR       = '00150';                         
               FEJLDATA.MEDD_TEKST = 'Der findes ingen oplysninger ' !! 
                                     'på forespurgte person';           
            END; */                                                     
            OTHERWISE DO;                                               
               FEJLDATA.CRETUR       = '00180';                         
               FEJLDATA.MEDD_TEKST =                                    
                                'Alvorlig fejl ved læsning af '   !!    
                                'EVS''s  register, prøv senere. ' !!    
                                '- CRETUR: ' !! PROCESMODUL.CRETUR;     
            END;                                                        
         END;                                                           
 END KALD_PROCESMODUL_OPLYS_GRND;                                       
                                                                        
 /*********************************************************************/
 /*      BQ60001M:                                                    */
 /*      SIKKERHED_OK - Undersøg om den aktuel bruger har adgang til  */
 /*                     CICS transaktionen i parameteret TRANSKODE.   */
 /*                     Hvis brugeren har adgang returner '1'b ellers */
 /*                     returner '0'b.                                */
 /*********************************************************************/
 SIKKERHED_OK: PROC(TRANSKODE) RETURNS(BIT(01));                        
         DCL   GEMPTR        PTR;                                       
         DCL   TRANSKODE     CHAR(04);                                  
         DCL   RETURBIT      BIT(1) INIT('0'B);                         
         %INCLUDE ZS34602M;                                             
                                                                        
         CALL ZM_HENT_SYSID;  /* Sæt CICS_TYPE - T=TEST, P=PROD, osv. */
                                                                        
         IF VIS_LOG = JA THEN                                           
         DO;                                                            
           CALL LOG_DATA_SKRIV(991,1,'ZM.CICS_TYPE = ' !! ZM.CICS_TYPE);
           CALL LOG_DATA_SKRIV(991,2,'FREMTVING_ADG = ' !!              
                               FREMTVING_ADG);                          
         END;                                                           
                                                                        
         IF                                                             
         ZM.CICS_TYPE = 'T'  &      /* Test CICS                      */
         FREMTVING_ADG = JA  /* FREMTVING ADGANG TEST CICS*/            
       /*FREMTVING_INGEN_ADG = JA*//* FREMTVING INGEN ADGANG TEST CICS*/
         THEN DO;                                                       
            IF VIS_LOG = JA THEN                                        
              CALL LOG_DATA_SKRIV(991,3,'FREMTVING ADGANG');            
                                                                        
    /*      RETURN('0'B); */                                            
            RETURN('1'B);                                               
         END;                                                           
                                                                        
         GEMPTR = PARMPTR;                                              
         ZS346PARM.TRANSID    = TRANSKODE;                              
         PARMPTR              = ADDR(ZS346PARM);                        
                                                                        
         EXEC CICS LINK                                                 
                   PROGRAM ('ZS34602')                                  
                   COMMAREA(ZS346PARM)                                  
                   LENGTH(STG(ZS346PARM));                              
         /*                                                             
         testprt('ZS346PARM.TRANSID...:',ZS346PARM.TRANSID,             
                 '.BRUGERNAVN:',ZS346PARM.BRUGERNAVN,                   
                 '.RC........:',ZS346PARM.RC);                          
         */                                                             
                                                                        
         IF                          /* Bruger har ikke transkode i   */
         ZS346PARM.RC = '1'          /* transsæt, men tjek om det er  */
         THEN DO;                    /* en transkode uden sikkerhed ? */
            IF                                                          
            ZS346PARM.SIKKODE = '01' /* Transkode uden sikkerhed */     
            THEN DO;                                                    
               RETURBIT = '1'B;                                         
            END;                                                        
         END;                                                           
         ELSE DO;                                                       
            IF                                                          
            ZS346PARM.RC = '0'                                          
            THEN DO;                                                    
               RETURBIT = '1'B;                                         
            END;                                                        
         END;                                                           
                                                                        
         PARMPTR = GEMPTR;                                              
                                                                        
         RETURN (RETURBIT);                                             
 END SIKKERHED_OK;                                                      
 /*********************************************************************/
 /*  BQ60001M:    BEH_DEBITERING  RUTINE                              */
 /*                                                                   */
 /*    F.EKS.:    CALL BEH_DEBITERING ('B2Q6','KS2')                  */
 /*********************************************************************/
 BEH_DEBITERING: PROC(TRANSIDENT,ENHEDSKODE);                           
         DCL   GEMPTR                  POINTER;                         
         DCL   TRANSIDENT              CHAR (04);                       
         DCL   ENHEDSKODE              CHAR (03);                       
                                                                        
         %INCLUDE ZS36902N;;                       /* DCL AF ZS36902N */
  /*-----------------------------------------------------------------*/ 
                                                                        
         GEMPTR  = PARMPTR;   /* Gem PARMPTR */                         
                                                                        
         PARMPTR           = ADDR(ZS36902N);                            
         ZS36902N.FUNKID   = '3';     /* Læg entry på CMF */            
         ZS36902N.TRANSID  = TRANSIDENT;                                
         ZS36902N.ENHEDKDE = ENHEDSKODE;                                
         EXEC CICS LINK PROGRAM ('ZS36902')                             
                        COMMAREA(ZS36902N);                             
                                                                        
         PARMPTR = GEMPTR;    /* Genetabler PARMPTR */                  
                                                                        
         IF                                                             
         ZS36902N.RETKODE ^= '0'                                        
         THEN DO;                                                       
            CALL LOG_ABEND('ABEND','ZS36902',                           
                           'ABEND - response=' !! ZS36902N.RETKODE);    
         END;                                                           
                                                                        
 END BEH_DEBITERING;                                                    
 /*********************************************************************/
 /* BQ60001M:                                                         */
 /* SKAF_ADRESSEOPLYSNINGER                                           */
 /*********************************************************************/
 SKAF_ADRESSEOPLYSNINGER: PROC;                                         
    DCL   HJ_ANT_LIN     PIC'99';                                       
                                                                        
    testprt('...ved skaf_adresseoplysninger');                          
                                                                        
    /*  ZM_HENT_NAVN_PNR_OK     ZM70021M             */                 
    OUTPUTELEM = '';                                                    
                                                                        
    IF ZM_HENT_NAVN_PNR_OK ('000', INPUT.DCPRN, 'C', 'O')               
    THEN                                                                
    DO;                                                                 
       testprt('zm70021M.fant_lin:',zm70021m.fant_lin);                 
                                                                        
       IF                                                               
       ZM70021M.FANT_LIN = ''   !                                       
       ZM70021M.FANT_LIN = ' '                                          
       THEN DO;                                                         
          HJ_ANT_LIN = 0;                                               
                                                                        
          OUTPUTELEM.INDIVIDTYPE  = 801;                                
          OUTPUTELEM.LINIETYPE    = 1;                                  
          OUTPUTELEM.TEKST        = '';                                 
          CALL BEH_ZSRØR_TSKØ;                                          
       END;                                                             
       ELSE DO;                                                         
          HJ_ANT_LIN = ZM70021M.FANT_LIN;                               
                                                                        
          DO H = 1 TO HJ_ANT_LIN;                                       
             OUTPUTELEM.INDIVIDTYPE  = 801;                             
             OUTPUTELEM.LINIETYPE    = 1;                               
             OUTPUTELEM.TEKST   = ZM70021M.FADR.ALIN(H);                
             testprt('H:',H,'af zm70021M.fant_lin:',zm70021m.fant_lin); 
             CALL BEH_ZSRØR_TSKØ;                                       
          END;                                                          
       END;                                                             
    END;                                                                
    ELSE DO;                                                            
       OUTPUTELEM.INDIVIDTYPE  = 801;                                   
       OUTPUTELEM.LINIETYPE    = 1;                                     
       OUTPUTELEM.TEKST        = '';                                    
       OUTPUTELEM.FEJLOPLYSNINGER = 'RETURKODE: ' !!                    
                                    ZM70021M.RETURKODE !!               
                                    '- RETURTEXT: '!!                   
                                    ZM70021M.RETURTEXT;                 
       CALL BEH_ZSRØR_TSKØ;                                             
    END;                                                                
 END SKAF_ADRESSEOPLYSNINGER;                                           
                                                                        
 /*********************************************************************/
 /* BQ60001M:                                                         */
 /* Brugeroplysninger (user-id, navn samt adm. enhed)                 */
 /*********************************************************************/
 SKAF_BRUGEROPLYSNINGER: PROC;                                          
                                                                        
    testprt('...ved skaf_brugeroplysninger');                           
                                                                        
    OUTPUTELEM = '';                                                    
    ZS367PARM.SUBFUNK = 8;                                              
    ZS367PARM.APPL    = 'GENNEM';                                       
                                                                        
    EXEC CICS LINK                                                      
              PROGRAM ('ZS36702')              /*                     */
              COMMAREA(ZS367PARM)                                       
              LENGTH(STG(ZS367PARM));                                   
                                                                        
    OUTPUTELEM.INDIVIDTYPE        = 800;                                
    OUTPUTELEM.LINIETYPE          = 1;                                  
    OUTPUTELEM.FILLER1     = ZS367PARM.USERID;                          
    OUTPUTELEM.FILLER2     = ZS367PARM.NAVN;                            
    OUTPUTELEM.FILLER3     = ZS367PARM.ADMTXT;                          
                                                                        
    CALL BEH_ZSRØR_TSKØ;                                                
                                                                        
 END SKAF_BRUGEROPLYSNINGER;                                            
 /*********************************************************************/
 /*   Log oplysninger eller ABEND på en pæn måde                      */
 /*********************************************************************/
 LOG_ABEND: PROC(FUNK,MODUL,TEKST);                                     
         DCL   FUNK          CHAR(08) VAR;                              
         DCL   MODUL         CHAR(08);                                  
         DCL   TEKST         CHAR(70) VAR;                              
                                                                        
         SELECT(FUNK);                                                  
            WHEN('LOG') DO;                                             
               ZS378FUNK   = '01';    /* RETUR TIL APPL UDEN DUMP */    
            END;                                                        
            WHEN('ABEND') DO;                                           
               ZS378FUNK   = '04';    /* RETUR TIL APPL UDEN DUMP */    
            END;                                                        
            OTHERWISE DO;                                               
            END;                                                        
         END;                                                           
                                                                        
         ZS378TYPE   = 'CICS';                                          
         ZS378MODUL  = MODUL;                                           
                                                                        
         ZS378TEKST  = TEKST;                                           
                                                                        
         %INCLUDE ZS37802M;    /* FEJLHANDLING LOG-ABEND RUTINE MAKRO */
 END LOG_ABEND;                                                         
                                                                        
 /**********************************************************************
 * Link til snitflademodul ZM710002 Funktion 10                        *
 * Find KOMMUNENUMMER for CPRNR, INDKOMSTÅR,                           *
 *      KOMMUNETYPE SLUTLIGNINGSKOMMUNE                                *
 **********************************************************************/
 HENT_ESLKNR: PROC(DCPRN, INDKÅR) RETURNS(PIC '999');                   
                                                                        
         DCL 1 ZM71002N,                                                
               %INCLUDE ZM71002N;                                       
         DCL   DCPRN          PIC  '(10)9';                             
         DCL   INDKÅR         PIC  '9999';                              
         DCL   PIC_ESLKNR     PIC'999';                                 
                                                                        
         ZM71002N                = '';                                  
         ZM71002N.FUNKTION       = 10;                                  
         ZM71002N.CPRNR          = DCPRN;                               
         ZM71002N.INDKOMSTÅR     = INDKÅR;                              
         ZM71002N.KOMMUNETYPE_ID = 6;       /* SLUTLIGNINGSKOMMUNE */   
                                                                        
         EXEC CICS LINK PROGRAM  ('ZM71002')                            
                        COMMAREA (ZM71002N);                            
                                                                        
         testprt('zm71002n.knr:',zm71002n.knr);                         
         IF                                                             
         ZM71002N.PERSON_OK = 'J'                                       
         THEN DO;                                                       
           PIC_ESLKNR = ZM71002N.KNR;                                   
         END;                                                           
         ELSE DO;                                                       
           PIC_ESLKNR = 000;                                            
         END;                                                           
                                                                        
         RETURN(ZM71002N.KNR);                                          
 END HENT_ESLKNR;                                                       
                                                                        
 /**********************************************************************
 *    PROGRAM MAKROER                                                  *
 **********************************************************************/
 %INCLUDE    ZM70015M;                    /* ZM_HENT_SYSID            */
 %INCLUDE    ZM70021M;                    /* ZM_HENT_NAVN_PNR_OK      */
 %INCLUDE    ZS36702M;                    /* Brugeroplysninger        */
