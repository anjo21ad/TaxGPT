 /*********************************************************************/
 /*      DANNE DATA TIL SLUT HOS DXC                                  */
 /*   SLUT08    BO SCHMIDT                                19/11-2008  */
 /*             TILRETTET SLUT 2008                                   */
 /*********************************************************************/
 /*   SLUT09    GERD HOLM-PEDERSEN                        09/10-2009  */
 /*             TILRETTET SLUT 2009 SAMT                              */
 /*             KRAV 18-02-01: OPSÆTNING AF BEREGNINGSGRL. FOR UDL. EJ*/
 /*             HVOR FELT 614 (BBERGRL_015ANV) NU SKAL ANVENDES BÅDE  */
 /*             TIL DANSKE OG UDENLANDSKE EJENDOMME                   */
 /*             KRAV 18-03-03: NEDTAGNING AF FELT 158=7               */
 /*                            FUDL100 OPSÆTTES HVIS 158 ER NEDTAGET  */
 /*********************************************************************/
 /*   SLUT10    GERD HOLM-PEDERSEN                        05/10-2010  */
 /*             TILRETTET SLUT 2010                                   */
 /*********************************************************************/
 /*   SLUT11    GERD HOLM-PEDERSEN                        18/10-2011  */
 /*             TILRETTET SLUT 2011 SAMT                              */
 /*             KRAV 18-05:    OPSÆTNING AF BEREGNINGSGRL. FOR UDL. EJ*/
 /*             HVOR FELT 615,616,,21,622 OG 626 OVERFØRES SOM 614    */
 /*             FELT 616 OG 626 SKAL IKKE OVERFØRES.                  */
 /*             ER DERFOR SLETTEDE.                                   */
 /*   SLUT12    LARS KAAE HARRITSHØJ                      SEP. 2012   */
 /*             TILRETTET SLUT 2012                                   */
 /*   SLUT13    JØRGEN SAUGMANN                           OKT. 2013   */
 /*             TILRETTET SLUT 2013                                   */
 /*   SLUT14    Esben BRodersen                           NOV. 2014   */
 /*             TILRETTET SLUT 2014                                   */
 /*   SLUT15    JNK : TILRETTET til SLUT-15               NOV. 2015   */
 /*   SLUT15    ESBEN BRODERSEN                                       */
 /*             ÅRSTAL TAGES FRA BH65300M #01                         */
 /*   SLUT16    ESBEN BRODERSEN                           JUN  2016   */
 /*             RETTELSE TIL DEFECT 158 FRA SLUT 2015                 */
 /*   SLUT16    ÆNDRING I HÅNDTERING AF  SPECIELLE        OKT 2016    */
 /*             LANDBRUGSOPLYSNINGER CEJDTYPE = '9' QEB  #01          */
 /*             NYE FELTER: BLANDVÆR_015ANV, BLANDVÆR_02ANV,          */
 /*                         BLANDVÆR_AKT                              */
 /*             UDGÅEDE FELTER: BPROM2, BPROM1, BSTIBEGR, BNEDSL1,    */
 /*             BPENSNED, BNEDSL2, BGRPROM2, CSTIBLB, BGRPROM1        */
 /*   DB2OMLÆG  Lene Maj Jensen  QLE                      MAR  2017   */
 /*             Beregningsbånd omlagt til DB2                         */
 /*   SLUT17    ESBEN BRODERSEN                           OKT 2017    */
 /*             UDGÅEDE FELTER: CSCREGISTMP, BGLSUM1, CNULSTIL        */
 /*   SLUT18    ESBEN BRODERSEN                           OKT 2017    */
 /*             Udgåede felter: CSKPLOMF, BOBEHAKOD, CBENYT, CELØNCOR */
 /*                             EKOMNR_EJDNR_GL, CSKPLOMFGL           */
 /*             Nye felter:     EENHEDLBNR, VURDOPRIDKOD, EJDBLIGEKMNR*/
 /*                             VEJKOD, HUSNR, HUSBOSTAADR, ETAGENR,  */
 /*                             SIDEDOERNR                            */
 /*   SLUT 2021 Steen Pedersen SEP                        MAR 2021    */
 /*             BH65300M rettet til BH55300M                          */
 /*                                                                   */
 /*   SLUT 2021 Finn Andersen FIA                         JUN 2021    */
 /*             BH96110N erstattes af BH86121N                        */
 /*             Der er tilføjet 22 nye felter til den nye include     */
 /*             BH96110N, som der laves en ny af hvert år fremover.   */
 /*             2. og 3. sidste karakterer angiver årstal.            */
 /*         ONE BFENR er udgået 2021-10-21                            */
 /*                                                                   */
 /*  SLUT  2021 Edward Laryea                       8.Nov 2021        */
 /*             Defect 981                                            */
 /* #SLUT2021  Edward Laryea                        12.  Nov 2021     */
 /*            Defect 1093/1094                                       */
 /*  Slut2021  Per Brunk Defect 1093/1094           16.  Nov 2021     */
 /*            fjernet betingelse for ændring fra ' ' -> 'N'          */
 /*             Per Brunk PBR                             MAR 2022    */
 /*             D1190 - Forsigt-evs = blank -> J/N udfra vurmark      */
 /*  Slut2021  Jan Jensen                           21.  Sep 2022     */
 /*             Output til SLUT udvides med HEADER+TRAILER            */
 /*  Slut 24   May Britt Simonsen  (MBS)            April 2024        */
 /*            VURMARK sættes til og testes på 299 i stedet for 99    */
 /*            Gælder for 2024 og frem                                */
 /*  Slut 24   Jan Jensen  (JJJ)                    Juni  2024        */
 /*            BH55600M erstatter BH55300M                            */
 /*  SLUT24    Per Jensen, PEN     BF17 ÆA65           02.07.2024     */
 /*            Justering så 'Ukendt VURMARK kode' - 299 bliver sat op */
 /*            uden hensyntagen til tidligere værdi - blev tidligere  */
 /*            kun sat hvis VURMARK var = 0                           */
 /*  SLUT24    Jan Erik Jensen (XJY) ÆA73              25.10.2024     */
 /*            #1892264 Konvertering af udenlandske ejendomsnumre:    */
 /*            Rettet så beskatningsgrundlag (felterne BBERGRL_AKT    */
 /*            og BBER2FAM_AKT) også sendes videre for udenlandske    */
 /*            ejendomme.                                             */
 /*                                                                   */
 /* SLUT 24    Jan Erik Jensen (XJY) ÆA73              05.11.2024     */
 /*            #1892264 Konvertering af udenlandske ejendomsnumre:    */
 /*            Rettet så udenlandsk betalt skat (felt BUDLSKC)        */
 /*            sendes videre som nul i stedet for "null" for          */
 /*            udenlandske ejendomme.                                 */
 /*********************************************************************/
 DAN_DATA_TIL_SLUT: PROC;                                               
                                                                        
   DCL PIC15 PIC '(14)z9';                                              
   DCL CHAR15 CHAR(15);                                                 
   DCL PIC11 PIC '(10)z9';                                              
   DCL CHAR11 CHAR(11);                                                 
   DCL PIC9 PIC '(8)z9';                                                
   DCL CHAR10 CHAR(10);                                                 
   /*DEFECT 981 */                                                      
   DCL HJ_VURD_015ANV_VURMARK  DEC (3,0);                               
   DCL HJ_VURD_02ANV_VURMARK   DEC (3,0);                               
   DCL HJ_VURD_A_VURMARK_AKT   DEC (3,0);                               
   /*DEFECT 1093-1094 */                                                
   dcl HJ_VURD_015ANY_FORSIGT_EVS  CHAR(1);                             
   dcl HJ_VURD_02ANY_FORSIGT_EVS   CHAR(1);                             
   dcl hj_VURD_A_FORSIGT_EVS       CHAR(1);                             
   dcl hj_VURD_015ANY_BESKAT_EVS   CHAR(1);                             
   dcl hj_VURD_02ANY_BESKAT_EVS    CHAR(1);                             
   dcl hj_VURD_A_BESKAT_EVS        CHAR(1);                             
                                                                        
   BH861_DATA            =  '';                                         
   BH861_DATA.INDVNR     = 809;                                         
   BH861_DATA.INDVLGD    = 569;                                         
   BH861_DATA.FELTLGD    = 569;                                         
   BH861_DATA.HEADER     = 'EVSGRUND';                                  
   BH861_DATA.DINDKAAR   = BH55600M.INDKÅR1;                  /*#01*/   
   BH861_DATA.DCPRN      = DCLBQ78000T.DCPRN;                           
   BH861_DATA.EKOMNR     = DCLBQ78000T.EKOMNR;                          
   BH861_DATA.EEJDNR     = DCLBQ78000T.EEJDNR;                          
   BH861_DATA.EENHEDLBNR = DCLBQ78000T.EENHEDLBNR;                      
   BH861_DATA.ELBNR      = DCLBQ78000T.UDSKRLBNR;                       
                                                                        
   BH861_DATA.EJDBLIGEKMNR  = DCLBQ78000T.EKOMNR;                       
                                                                        
   /* FIA - VURDOPRIKOD udgår i forhold til 2020 */                     
   /*                                                                   
   IF DCLBQ75000T.EJER_DCPRCIR > 0  !                                   
      DCLBQ75000T.ÆGTE_DCPRCIR > 0                                      
   THEN                                                                 
     BH861_DATA.VURDOPRIKOD  = 'ESR';                                   
   ELSE                                                                 
     BH861_DATA.VURDOPRIKOD  = 'EVS';                                   
   */                                                                   
                                                                        
   BH861_DATA.CSLET        = '';                                        
   BH861_DATA.CLANDEKODE   = DCLBQ78000T.EJENDOM_CLANDEKODE;            
   BH861_DATA.CEJBEVS      = DCLBQ78000T.TILEVS_CEJBEVS;                
   BH861_DATA.MANPENSSTI_I = -1;                                        
   BH861_DATA.MANPENSSTI   = 0;                                         
   IF BH861_DATA.EKOMNR = 999                                           
   THEN                                                                 
     DO;                                                                
       BH861_DATA.BBERGRL_015ANV_I  = DCLBQ78000T.EJERSKAB_UDL_614_SW;  
       BH861_DATA.BBERGRL_015ANV    = DCLBQ78000T.EJERSKAB_UDL_614;     
       BH861_DATA.BBERGRL_02ANV_I   = DCLBQ78000T.EJERSKAB_UDL_615_SW;  
       BH861_DATA.BBERGRL_02ANV     = DCLBQ78000T.EJERSKAB_UDL_615;     
       BH861_DATA.BBERGRL_AKT_I     = DCLBQ78000T.EJERSKAB_UDL_616_SW;  
       BH861_DATA.BBERGRL_AKT       = DCLBQ78000T.EJERSKAB_UDL_616;     
                                                                        
       BH861_DATA.BBER2FAM_015ANV_I = DCLBQ78000T.EJERSKAB_UDL_621_SW;  
       BH861_DATA.BBER2FAM_015ANV   = DCLBQ78000T.EJERSKAB_UDL_621;     
       BH861_DATA.BBER2FAM_02ANV_I  = DCLBQ78000T.EJERSKAB_UDL_622_SW;  
       BH861_DATA.BBER2FAM_02ANV    = DCLBQ78000T.EJERSKAB_UDL_622;     
       BH861_DATA.BBER2FAM_AKT_I    = DCLBQ78000T.EJERSKAB_UDL_626_SW;  
       BH861_DATA.BBER2FAM_AKT      = DCLBQ78000T.EJERSKAB_UDL_626;     
     END;                                                               
   ELSE                                                                 
     DO;                                                                
       BH861_DATA.BBERGRL_015ANV_I = DCLBQ78000T.VURD_015ANV_BBERGRL_SW;
       BH861_DATA.BBERGRL_015ANV   = DCLBQ78000T.VURD_015ANV_BBERGRL;   
       BH861_DATA.BBERGRL_02ANV_I  = DCLBQ78000T.VURD_02ANV_BBERGRL_SW; 
       BH861_DATA.BBERGRL_02ANV    = DCLBQ78000T.VURD_02ANV_BBERGRL;    
       BH861_DATA.BBERGRL_AKT_I    = DCLBQ78000T.VURD_A_BBERGRL_A_SW;   
       BH861_DATA.BBERGRL_AKT      = DCLBQ78000T.VURD_A_BBERGRL_AKT;    
                                                                        
       BH861_DATA.BBER2FAM_015ANV_I =                                   
                             DCLBQ78000T.VURD_015ANV_BBER2FAM_SW;       
       BH861_DATA.BBER2FAM_015ANV   =                                   
                             DCLBQ78000T.VURD_015ANV_BBER2FAM;          
       BH861_DATA.BBER2FAM_02ANV_I  =                                   
                             DCLBQ78000T.VURD_02ANV_BBER2FAM_SW;        
       BH861_DATA.BBER2FAM_02ANV    = DCLBQ78000T.VURD_02ANV_BBER2FAM;  
       BH861_DATA.BBER2FAM_AKT_I    = DCLBQ78000T.VURD_A_BBER2FAM_A_SW; 
       BH861_DATA.BBER2FAM_AKT      = DCLBQ78000T.VURD_A_BBER2FAM_AKT;  
     END;                                                               
                                                                        
   IF DCLBQ78000T.EENHEDLBNR = 0                                        
   THEN                                                                 
     DO;                                                                
       BH861_DATA.EJDBELIG     = DCLBQ78000T.EJENDOM_EJDBELIG;          
       BH861_DATA.VEJKOD       = DCLBQ78000T.EJENDOM_VEJK_EJD;          
       BH861_DATA.HUSNR        =                                        
             SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_EJD,1,3);                 
       BH861_DATA.HUSBOSTAADR  =                                        
             SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_EJD,4,1);                 
       BH861_DATA.ETAGENR      = DCLBQ78000T.EJENDOM_ETAGE_EJD;         
       BH861_DATA.SIDEDOERNR   = DCLBQ78000T.EJENDOM_SDØR_EJD;          
     END;                                                               
   ELSE                                                                 
     DO                                                                 
       BH861_DATA.EJDBELIG     = DCLBQ78000T.EJENDOM_ENHEDBELIG;        
       BH861_DATA.VEJKOD       = DCLBQ78000T.EJENDOM_VEJK_ENHED;        
       BH861_DATA.HUSNR        =                                        
             SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_ENHED,1,3);               
       BH861_DATA.HUSBOSTAADR  =                                        
             SUBSTR(DCLBQ78000T.EJENDOM_HUSNR_ENHED,4,1);               
       BH861_DATA.ETAGENR      = DCLBQ78000T.EJENDOM_ETAGE_ENHED;       
       BH861_DATA.SIDEDOERNR   = DCLBQ78000T.EJENDOM_SDØR_ENHED;        
     END;                                                               
                                                                        
   /* FIA - 1 Nyt felt   2021-06-29 *//* PBR - nu med 2021.10.25 */     
   BH861_DATA.CRTEKORNS = DCLBQ78000T.EJERSKAB_CRTEKORNS;               
                                                                        
   /* Rettelse til defect 154 fra slut 2015 QEB */                      
   IF DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT > '0'                           
   THEN                                                                 
     BH861_DATA.CEJDTYPE = DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT;           
   ELSE                                                                 
     BH861_DATA.CEJDTYPE = DCLBQ78000T.EJENDOM_CEJDTYPE;                
                                                                        
                                                                        
   IF DCLBQ78000T.EENHEDLBNR = 0     &                                  
      DCLBQ78000T.EKOMNR     ^= 999  &                                  
     (BH861_DATA.CEJDTYPE = '4' !                                       
      BH861_DATA.CEJDTYPE = '5')                                        
   THEN                                                                 
     DO;                                                                
       PUT SKIP LIST('2FAMILIHUSE UDEN EENHEDLBNR');                    
       PUT SKIP LIST('DCLBQ78000T.DCPRN     ',DCLBQ78000T.DCPRN );      
       PUT SKIP LIST('DCLBQ78000T.EKOMNR    ',DCLBQ78000T.EKOMNR);      
       PUT SKIP LIST('DCLBQ78000T.EEJDNR    ',DCLBQ78000T.EEJDNR);      
       PUT SKIP LIST('DCLBQ78000T.UDSKRLBNR ',DCLBQ78000T.UDSKRLBNR);   
       PUT SKIP LIST('BH861_DATA.CEJDTYPE   ',BH861_DATA.CEJDTYPE);     
       TV.EJ_EENHEDLBNR = TV.EJ_EENHEDLBNR + 1;                         
     END;                                                               
                                                                        
                                                                        
   BH861_DATA.CÆGTOPR  = '';  //DCLBQ78000T.TILEVS_CÆGTOPR;             
   IF DCLBQ78000T.TILEVS_DOVTG > 0                                      
   THEN                                                                 
      BH861_DATA.DOVTG =FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DOVTG);   
   ELSE                                                                 
      BH861_DATA.DOVTG = (10)' ';                                       
   IF DCLBQ78000T.TILEVS_DAFSTAA > DCLBQ76000T.DRGNÅRTIL                
   THEN                                                                 
      BH861_DATA.DAFSTAA = '';                                          
   ELSE                                                                 
      IF DCLBQ78000T.TILEVS_DAFSTAA > 0                                 
      THEN                                                              
         BH861_DATA.DAFSTAA =                                           
         FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DAFSTAA);                
      ELSE                                                              
         BH861_DATA.DAFSTAA = (10)' ';                                  
   BH861_DATA.GPCTEJER_I = DCLBQ78000T.TILEVS_GPCTEJER_SW;              
   IF DCLBQ78000T.TILEVS_GPCTEJER_SW = 0                                
   THEN                                                                 
      BH861_DATA.GPCTEJER = DCLBQ78000T.TILEVS_GPCTEJER;                
   BH861_DATA.FDAGUDLE  = 0;                                            
   BH861_DATA.GPCTUDLE  = 0;                                            
                                                                        
   BH861_DATA.FUDL100 = DCLBQ78000T.TILEVS_FUDL100;                     
                                                                        
   BH861_DATA.GPCTERHV  = 0;                                            
   BH861_DATA.FDAGERHV  = 0;                                            
   BH861_DATA.FERHVFLER = DCLBQ78000T.TILEVS_FERHVFLER;                 
   BH861_DATA.CENKE     = DCLBQ78000T.TILEVS_CENKE;                     
   BH861_DATA.CPTYPSLUT = DCLBQ78000T.TILEVS_CPTYPSLUT;                 
   BH861_DATA.CPTYPGL   = DCLBQ78000T.TILEVS_CPTYPGL;                   
   BH861_DATA.FELT759   = DCLBQ78000T.TILEVS_FELT759;                   
   BH861_DATA.FELT760   = DCLBQ78000T.TILEVS_CFRED;                     
   BH861_DATA.BEVSGL_I  = DCLBQ78000T.TILEVS_BEVSGL_SW;                 
   BH861_DATA.BEVSGL    = DCLBQ78000T.TILEVS_BEVSGL;                    
   BH861_DATA.BPENSNEDGL_I = DCLBQ78000T.TILEVS_BPENSNEDGL_SW;          
   BH861_DATA.BPENSNEDGL = DCLBQ78000T.TILEVS_BPENSNEDGL;               
                                                                        
   IF DCLBQ78000T.TILEVS_DINDFLYT > 0                                   
   THEN                                                                 
      BH861_DATA.DINDFLYT =                                             
      FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DINDFLYT);                  
                                                                        
   IF DCLBQ78000T.TILEVS_DFRAFLYT > 0                                   
   THEN                                                                 
      BH861_DATA.DFRAFLYT =                                             
      FIX09_TIL_DB2_DATO(DCLBQ78000T.TILEVS_DFRAFLYT);                  
                                                                        
   BH861_DATA.FUBEBOELIG = 0;                                           
   BH861_DATA.BFASTSTIGBGR_I = DCLBQ78000T.TILEVS_BFASTSTIGBGR_SW;      
   BH861_DATA.BFASTSTIGBGR   = DCLBQ78000T.TILEVS_BFASTSTIGBGR;         
   BH861_DATA.CINDFLYT       = '';                                      
   BH861_DATA.CBERGRGLOP     = DCLBQ78000T.EJERSKAB_CBERGRGLOP;         
   BH861_DATA.BMANEVSSTI_I   = -1;                                      
   BH861_DATA.BMANEVSSTI     = 0;;                                      
   BH861_DATA.BEVSMAN_I      = -1;                                      
   BH861_DATA.BEVSMAN        = 0;;                                      
   BH861_DATA.BMANNEDSL_I    = -1;                                      
   BH861_DATA.BMANNEDSL      = 0;;                                      
   BH861_DATA.CEKSEMP        = DCLBQ78000T.TILEVS_CEKSEMP;              
   BH861_DATA.MANNEDSLSTI_I  = -1;                                      
   BH861_DATA.MANNEDSLSTI    = 0;;                                      
                                                                        
   /*                                                                   
   XJY 05.11.2024 #1892264:                                             
   Sæt den udenlandsk betalte skat til 0 i                              
   stedet for NULL. Skal kun ske for SLUT 2024                          
                                                                        
   BH861_DATA.BUDLSKC_I      = -1;                                      
   BH861_DATA.BUDLSKC        = 0;;                                      
   */                                                                   
   IF WS_TIL_EVS_AAR = 2024 & BH861_DATA.EKOMNR = 999 THEN              
   DO;                                                                  
      BH861_DATA.BUDLSKC_I      = 0;                                    
      BH861_DATA.BUDLSKC        = 0;                                    
   END;                                                                 
   ELSE                                                                 
   DO;                                                                  
      BH861_DATA.BUDLSKC_I      = -1;                                   
      BH861_DATA.BUDLSKC        = 0;                                    
   END;                                                                 
                                                                        
   BH861_DATA.BEJBOL1_AKT_I  = DCLBQ78000T.VURD_A_BEJBOL1_A_SW;         
   BH861_DATA.BEJBOL1_AKT    = DCLBQ78000T.VURD_A_BEJBOL1_AKT;          
   BH861_DATA.BEJBOL2_AKT_I  = DCLBQ78000T.VURD_A_BEJBOL2_A_SW;         
   BH861_DATA.BEJBOL2_AKT    = DCLBQ78000T.VURD_A_BEJBOL2_AKT;          
   BH861_DATA.DAFSTAAFOR     = DCLBQ78000T.TILEVS_DAFSTAAFOR;           
   BH861_DATA.BEJBOL1_02ANV_I = DCLBQ78000T.VURD_02ANV_BEJBOL1_SW;      
   BH861_DATA.BEJBOL1_02ANV  = DCLBQ78000T.VURD_02ANV_BEJBOL1;          
   BH861_DATA.BEJBOL2_02ANV_I = DCLBQ78000T.VURD_02ANV_BEJBOL2_SW;      
   BH861_DATA.BEJBOL2_02ANV  = DCLBQ78000T.VURD_02ANV_BEJBOL2;          
                                                                        
   /* FIA - 1 Nyt felt   2021-06-10 */                                  
   /*ONE BFENR er udgået 2021-10-21*/                                   
   /*/*PIC15 = DCLBQ75000T.BFENR;*/                                     
   /*CHAR15 = PIC15;*/                                                  
   /*BH861_DATA.BFENR = SUBSTR(CHAR15,6);*/                             
                                                                        
   BH861_DATA.CBERGRL     = DCLBQ78000T.EJENDOM_CBERGRL;                
                                                                        
   /* FIA - 6 Nye felter 2021-06-10 */                                  
   /*Defect 1093-1094 */                                                
   hj_VURD_A_BESKAT_EVS = DCLBQ78000T.VURD_A_BESKAT_EVS;                
   hj_VURD_015ANY_BESKAT_EVS = DCLBQ78000T.VURD_015ANY_BESKAT_EVS;      
   hj_VURD_02ANY_BESKAT_EVS = DCLBQ78000T.VURD_02ANY_BESKAT_EVS;        
   hj_VURD_A_FORSIGT_EVS = DCLBQ78000T.VURD_A_FORSIGT_EVS;              
   hj_VURD_015ANY_FORSIGT_EVS = DCLBQ78000T.VURD_015ANY_FORSIGT_EVS;    
   hj_VURD_02ANY_FORSIGT_EVS =  DCLBQ78000T.VURD_02ANY_FORSIGT_EVS;     
   // if DCLBQ78000T.EKOMNR = 999 !                                     
   //   (DCLBQ78000T.EKOMNR <> 999 &                                    
   //    DCLBQ78000T.TILEVS_CDATAFRA = '1' !                            
   //    DCLBQ78000T.TILEVS_CDATAFRA = '2' !                            
   //    DCLBQ78000T.TILEVS_CDATAFRA = '4' !                            
   //    DCLBQ78000T.TILEVS_CDATAFRA = '5' !                            
   //    DCLBQ78000T.TILEVS_CDATAFRA = '6' !                            
   //    DCLBQ78000T.TILEVS_CDATAFRA = '7')                             
   // then                                                              
   //   do;                                                             
   if DCLBQ78000T.VURD_A_BESKAT_EVS= ''                                 
   then                                                                 
     hj_VURD_A_BESKAT_EVS= 'N';                                         
   if DCLBQ78000T.VURD_015ANY_BESKAT_EVS= ''                            
   then                                                                 
     hj_VURD_015ANY_BESKAT_EVS = 'N';                                   
   if DCLBQ78000T.VURD_02ANY_BESKAT_EVS = ''                            
   then                                                                 
     hj_VURD_02ANY_BESKAT_EVS = 'N';                                    
   // Start D1190                                                       
   if DCLBQ78000T.VURD_A_FORSIGT_EVS = ''                               
   then do;                                                             
     if DCLBQ78000T.VURD_A_VURMARK_AKT = 3                              
      ! DCLBQ78000T.VURD_A_VURMARK_AKT = 5                              
     then                                                               
       hj_VURD_A_FORSIGT_EVS = 'J';                                     
     else                                                               
       hj_VURD_A_FORSIGT_EVS = 'N';                                     
     end;                                                               
   // Slut D1190                                                        
   if DCLBQ78000T.VURD_015ANY_FORSIGT_EVS = ''                          
   then                                                                 
     hj_VURD_015ANY_FORSIGT_EVS = 'N';                                  
   if DCLBQ78000T.VURD_02ANY_FORSIGT_EVS = ''                           
   then                                                                 
     hj_VURD_02ANY_FORSIGT_EVS = 'N';                                   
  //      end;                                                          
    BH861_DATA.VURD_A_BESKAT_EVS      =                                 
         TJEK(hj_VURD_A_BESKAT_EVS);                                    
    BH861_DATA.VURD_015ANY_BESKAT_EVS =                                 
         TJEK(hj_VURD_015ANY_BESKAT_EVS);                               
    BH861_DATA.VURD_02ANY_BESKAT_EVS  =                                 
         TJEK(hj_VURD_02ANY_BESKAT_EVS );                               
    BH861_DATA.VURD_A_FORSIGT_EVS      =                                
         TJEK(hj_VURD_A_FORSIGT_EVS);                                   
    BH861_DATA.VURD_015ANY_FORSIGT_EVS =                                
         TJEK(hj_VURD_015ANY_FORSIGT_EVS);                              
    BH861_DATA.VURD_02ANY_FORSIGT_EVS  =                                
         TJEK(hj_VURD_02ANY_FORSIGT_EVS);                               
                                                                        
                                                                        
    BH861_DATA.GPCTEJERFOR = DCLBQ78000T.TILEVS_GPCTEJERFOR;            
    BH861_DATA.CERHV       = DCLBQ78000T.TILEVS_CERHV;                  
    /* FIA - CVURDOPR udgår i forhold til 2020 */                       
    /*BH861_DATA.CVURDOPR    = DCLBQ78000T.TILEVS_A_V_CVURDOPR;*/       
    BH861_DATA.COMBYG      = DCLBQ78000T.EJENDOM_COMBYG;                
    BH861_DATA.CBENYT      = DCLBQ78000T.EJENDOM_CBENYT;                
                                                                        
    /* 3 Nye felter slut 2016 til overførsel af landbrugs opl #01*/     
    IF BH861_DATA.CEJDTYPE = '9' &                                      
       BH861_DATA.EKOMNR ^= 999                                         
    THEN                                                                
      DO;                                                               
        BH861_DATA.BLANDVÆR_015ANV_I =                                  
                        DCLBQ78000T.VURD_015ANV_BEJDVÆR_SW;             
        BH861_DATA.BLANDVÆR_015ANV   = DCLBQ78000T.VURD_015ANV_BEJDVÆR; 
        BH861_DATA.BLANDVÆR_02ANV_I =                                   
                        DCLBQ78000T.VURD_02ANV_BEJDVÆR_SW;              
        BH861_DATA.BLANDVÆR_02ANV  = DCLBQ78000T.VURD_02ANV_BEJDVÆR;    
        BH861_DATA.BLANDVÆR_AKT_I    = DCLBQ78000T.VURD_A_BEJDVÆR_A_SW; 
        BH861_DATA.BLANDVÆR_AKT      = DCLBQ78000T.VURD_A_BEJDVÆR_AKT;  
      END;                                                              
    ELSE                                                                
      DO;                                                               
        BH861_DATA.BLANDVÆR_015ANV_I = -1;                              
        BH861_DATA.BLANDVÆR_015ANV   = 0;                               
        BH861_DATA.BLANDVÆR_02ANV_I  = -1;                              
        BH861_DATA.BLANDVÆR_02ANV    = 0;                               
        BH861_DATA.BLANDVÆR_AKT_I    = -1;                              
        BH861_DATA.BLANDVÆR_AKT      = 0;                               
      END;                                                              
                                                                        
                                                                        
    BH861_DATA.BBERGRL_I  = DCLBQ78000T.EJERSKAB_BBERGRL_SW;            
    BH861_DATA.BBERGRL    = DCLBQ78000T.EJERSKAB_BBERGRL;               
    BH861_DATA.CBERGROP   = DCLBQ78000T.EJERSKAB_CBERGROP;              
    BH861_DATA.BFORSKAT_I = DCLBQ78000T.TILEVS_BFORSKAT_SW;             
    BH861_DATA.BFORSKAT   = DCLBQ78000T.TILEVS_BFORSKAT;                
    BH861_DATA.CFORSKAT   = DCLBQ78000T.TILEVS_CFORSKAT;                
    BH861_DATA.CUDLMAN    = DCLBQ78000T.TILEVS_CUDLMAN;                 
    BH861_DATA.BBER2FAM_I = DCLBQ78000T.EJERSKAB_BBER2FAM_SW;           
    BH861_DATA.BBER2FAM   = DCLBQ78000T.EJERSKAB_BBER2FAM;              
    IF DCLBQ78000T.FEJLNR > 0                                           
    THEN                                                                
       DO;                                                              
          HJ_FEJLNR = DCLBQ78000T.FEJLNR;                               
          BH861_DATA.FEJLNR = HJ_FEJLNR;                                
       END;                                                             
    ELSE                                                                
       BH861_DATA.FEJLNR = ' ';                                         
                                                                        
                                                                        
                                                                        
    BH861_DATA.BEJBOL1_015ANV_I =                                       
                  DCLBQ78000T.VURD_015ANV_BEJBOL1_SW;                   
    BH861_DATA.BEJBOL1_015ANV   =                                       
                  DCLBQ78000T.VURD_015ANV_BEJBOL1;                      
    BH861_DATA.BEJBOL2_015ANV_I =                                       
                  DCLBQ78000T.VURD_015ANV_BEJBOL2_SW;                   
    BH861_DATA.BEJBOL2_015ANV   =                                       
                  DCLBQ78000T.VURD_015ANV_BEJBOL2;                      
                                                                        
    /* 6 Nye felter 2021-06-10 */                                       
    BH861_DATA.VURD_A_JUR_KATEGO       =                                
         DCLBQ78000T.VURD_A_JUR_KATEGO;                                 
    BH861_DATA.VURD_015ANY_JUR_KATEGO  =                                
         DCLBQ78000T.VURD_015ANY_JUR_KATEGO;                            
    BH861_DATA.VURD_02ANY_JUR_KATEGO   =                                
         DCLBQ78000T.VURD_02ANY_JUR_KATEGO;                             
    BH861_DATA.VURD_A_JUR_UKATEGO      =                                
         DCLBQ78000T.VURD_A_JUR_UKATEGO;                                
    BH861_DATA.VURD_015ANY_JUR_UKATEGO =                                
         DCLBQ78000T.VURD_015ANY_JUR_UKATEGO;                           
    BH861_DATA.VURD_02ANY_JUR_UKATEGO  =                                
         DCLBQ78000T.VURD_02ANY_JUR_UKATEGO;                            
                                                                        
                                                                        
    BH861_DATA.DFRAGLD    = DATO2.ÅR !! '-' !! DATO2.MD !! '-' !!       
                       DATO2.DG !! '-01.01.01.000001';                  
    BH861_DATA.CNEDSL1  = DCLBQ78000T.TILEVS_CNEDSL1;                   
    BH861_DATA.FLEJL    = DCLBQ78000T.VURD_A_FLEJL_AKT;                 
    BH861_DATA.DOVTGFOR = DCLBQ78000T.TILEVS_DOVTGFOR;                  
    BH861_DATA.CDATAFRA = DCLBQ78000T.TILEVS_CDATAFRA;                  
    BH861_DATA.CUDLHEL  = DCLBQ78000T.TILEVS_CUDLHEL;                   
    BH861_DATA.CUDLDEL  = DCLBQ78000T.TILEVS_CUDLDEL;                   
                                                                        
    /* FIA - 8 Nye felter 2021-06-10 - START */                         
    PIC11 = DCLBQ78000T.EJENDOM_VUREJENDOMID;                           
    CHAR11 = PIC11;                                                     
    BH861_DATA.VUREJENDOMID = SUBSTR(CHAR11,2);                         
                                                                        
    BH861_DATA.DVURDÅR = DCLBQ78000T.VURD_A_DVURDÅR;                    
                                                                        
    /* Defect 981 08.11.2021  herfra*/                                  
    HJ_VURD_A_VURMARK_AKT  = DCLBQ78000T.VURD_A_VURMARK_AKT;            
    HJ_VURD_015ANV_VURMARK = DCLBQ78000T.VURD_015ANV_VURMARK;           
    HJ_VURD_02ANV_VURMARK = DCLBQ78000T.VURD_02ANV_VURMARK;             
    IF DCLBQ78000T.EKOMNR = 999                                         
    THEN                                                                
       DO;                                                              
  //       IF DCLBQ78000T.VURD_015ANV_VURMARK = 0 &                     
  //          DCLBQ78000T.VURD_02ANV_VURMARK  = 0 &                     
  //          DCLBQ78000T.VURD_A_VURMARK_AKT  = 0                       
  //       THEN                                                         
  //          DO;                                                       
               IF BH55600M.INDKÅR1 < 2024 /* FØR 2024 */                
               THEN                                                     
                  DO;                                                   
                     HJ_VURD_015ANV_VURMARK = 99;                       
                     HJ_VURD_02ANV_VURMARK  = 99;                       
                     HJ_VURD_A_VURMARK_AKT  = 99;                       
                  END;                                                  
               ELSE                                                     
                  DO; /* 2024 OG FREM */                                
                     /* MBS VURMARK sættes til 299 i stedet for 99 */   
                     HJ_VURD_015ANV_VURMARK = 299;                      
                     HJ_VURD_02ANV_VURMARK  = 299;                      
                     HJ_VURD_A_VURMARK_AKT  = 299;                      
                  END;                                                  
                                                                        
                                                                        
  //         END;                                                       
       END;                                                             
     ELSE                                                               
       DO;                                                              
         IF (DCLBQ78000T.TILEVS_CDATAFRA = '1' !                        
             DCLBQ78000T.TILEVS_CDATAFRA = '2' !                        
             DCLBQ78000T.TILEVS_CDATAFRA = '4' !                        
             DCLBQ78000T.TILEVS_CDATAFRA = '5' !                        
             DCLBQ78000T.TILEVS_CDATAFRA = '6' !                        
             DCLBQ78000T.TILEVS_CDATAFRA = '7')                         
  //           DCLBQ78000T.VURD_015ANV_VURMARK = 0 &                    
  //           DCLBQ78000T.VURD_02ANV_VURMARK  = 0 &                    
  //           DCLBQ78000T.VURD_A_VURMARK_AKT  = 0                      
         THEN                                                           
           DO;                                                          
              IF BH55600M.INDKÅR1 < 2024 /* FØR 2024 */                 
              THEN DO;                                                  
                 HJ_VURD_015ANV_VURMARK = 99;                           
                 HJ_VURD_02ANV_VURMARK  = 99;                           
                 HJ_VURD_A_VURMARK_AKT  = 99;                           
              END;                                                      
              ELSE DO  /* 2024 OG FREM */                               
                 /* MBS VURMARK sættes til 299 i stedet for 99 */       
                 HJ_VURD_015ANV_VURMARK = 299;                          
                 HJ_VURD_02ANV_VURMARK  = 299;                          
                 HJ_VURD_A_VURMARK_AKT  = 299;                          
              END;                                                      
                                                                        
           END;                                                         
         IF DCLBQ78000T.VURD_015ANV_BBERGRL_SW = -1                     
  //          & DCLBQ78000T.VURD_015ANV_VURMARK > 0                     
  //          & DCLBQ78000T.VURD_015ANV_VURMARK  <> 99                  
            & BH55600M.INDKÅR1 < 2024 /* FØR 2024 */                    
         THEN                                                           
           DO;                                                          
              HJ_VURD_015ANV_VURMARK = 99;                              
           END;                                                         
         IF DCLBQ78000T.VURD_015ANV_BBERGRL_SW = -1                     
  //        & DCLBQ78000T.VURD_015ANV_VURMARK > 0                       
  //        & DCLBQ78000T.VURD_015ANV_VURMARK  <> 299                   
          & BH55600M.INDKÅR1 > 2023 /* 2024 OG FREM */                  
            /* MBS VURMARK sættes til 299 i stedet for 99 */            
         THEN                                                           
           DO;                                                          
           /* MBS VURMARK sættes til 299 i stedet for 99 */             
              HJ_VURD_015ANV_VURMARK = 299;                             
           END;                                                         
         IF DCLBQ78000T.VURD_02ANV_BBERGRL_SW = -1                      
  //          & DCLBQ78000T.VURD_02ANV_VURMARK > 0                      
  //          & DCLBQ78000T.VURD_02ANV_VURMARK  <> 99                   
            & BH55600M.INDKÅR1 < 2024 /* FØR 2024 */                    
         THEN                                                           
           DO;                                                          
              HJ_VURD_02ANV_VURMARK = 99;                               
           END;                                                         
         IF DCLBQ78000T.VURD_02ANV_BBERGRL_SW = -1                      
  //        & DCLBQ78000T.VURD_02ANV_VURMARK > 0                        
            /* MBS VURMARK sættes til 299 i stedet for 99 */            
  //        & DCLBQ78000T.VURD_02ANV_VURMARK  <> 299                    
          & BH55600M.INDKÅR1 > 2023 /* 2024 OG FREM */                  
         THEN                                                           
           DO;                                                          
              HJ_VURD_02ANV_VURMARK = 299;                              
           END;                                                         
         IF DCLBQ78000T.VURD_A_BBERGRL_A_SW   = -1                      
  //          & DCLBQ78000T.VURD_A_VURMARK_AKT > 0                      
  //          & DCLBQ78000T.VURD_A_VURMARK_AKT  <> 99                   
            & BH55600M.INDKÅR1 < 2024 /* FØR 2024 */                    
         THEN                                                           
           DO;                                                          
              HJ_VURD_A_VURMARK_AKT= 99;                                
           END;                                                         
         IF DCLBQ78000T.VURD_A_BBERGRL_A_SW   = -1                      
  //          & DCLBQ78000T.VURD_A_VURMARK_AKT > 0                      
  //          & DCLBQ78000T.VURD_A_VURMARK_AKT  <> 299                  
            /* MBS VURMARK sættes til 299 i stedet for 99 */            
            & BH55600M.INDKÅR1 > 2023 /* 2024 OG FREM */                
         THEN                                                           
           DO;                                                          
              HJ_VURD_A_VURMARK_AKT= 299;                               
           END;                                                         
       END;                                                             
                                                                        
    BH861_DATA.VURD_A_VURMARK_AKT  = HJ_VURD_A_VURMARK_AKT;             
    BH861_DATA.VURD_015ANV_VURMARK = HJ_VURD_015ANV_VURMARK;            
    BH861_DATA.VURD_02ANV_VURMARK  = HJ_VURD_02ANV_VURMARK;             
     /* Defect 981 08.11.2021  hertil*/                                 
                                                                        
    IF DCLBQ78000T.VURD_A_VURDATO = 0 THEN                              
                                                                        
      BH861_DATA.VURD_A_VURDATO = '';                                   
    ELSE                                                                
      DO;                                                               
        PIC9 = DCLBQ78000T.VURD_A_VURDATO;                              
                                                                        
        CHAR10 = RIGHT(PIC9,10);                                        
        BH861_DATA.VURD_A_VURDATO =                                     
                REPATTERN(CHAR10,'YYYY-MM-DD','YYYYMMDD', 1950);        
      END;                                                              
                                                                        
    IF DCLBQ78000T.VURD_015ANY_VURDATO = 0 THEN                         
      BH861_DATA.VURD_015ANY_VURDATO = '';                              
    ELSE                                                                
      DO;                                                               
        PIC9 = DCLBQ78000T.VURD_015ANY_VURDATO;                         
        CHAR10 = RIGHT(PIC9,10);                                        
        BH861_DATA.VURD_015ANY_VURDATO =                                
                REPATTERN(CHAR10,'YYYY-MM-DD','YYYYMMDD', 1950);        
      END;                                                              
                                                                        
    IF DCLBQ78000T.VURD_02ANY_VURDATO = 0 THEN                          
      BH861_DATA.VURD_02ANY_VURDATO = '';                               
    ELSE                                                                
      DO;                                                               
        PIC9 = DCLBQ78000T.VURD_02ANY_VURDATO;                          
        CHAR10 = RIGHT(PIC9,10);                                        
        BH861_DATA.VURD_02ANY_VURDATO =                                 
                REPATTERN(CHAR10,'YYYY-MM-DD','YYYYMMDD', 1950);        
      END;                                                              
                                                                        
     /* FIA - 8 Nye felter 2021-06-10 - SLUT */                         
                                                                        
                                                                        
    BH861_DATA.BEJDVPUSKTP_I = -1;                                      
    BH861_DATA.BEJDVPUSKTP   = 0;                                       
    BH861_DATA.BEJDVÆPUSKP_I = -1;                                      
    BH861_DATA.BEJDVÆPUSKP   = 0;                                       
                                                                        
    TV.SKREVET = TV.SKREVET + 1;                                        
                                                                        
    WRITE FILE (BH861O) FROM (BH861_DATA);                              
                                                                        
 END DAN_DATA_TIL_SLUT;                                                 
                                                                        
 /*********************************************************************/
 /* Udfyld truktur til header og skriv denne                          */
 /*********************************************************************/
 DAN_BH861_HEAD: PROC;                                                  
                                                                        
   DCLBE72100T = '';                                                    
   DCLBE72100T.TIL_EVS_AAR   = WS_TIL_EVS_AAR;                          
   DCLBE72100T.AFVIKLINGS_ID = WS_FORSKUD_SLUT_TXT;                     
   DCLBE72100T.DATA_ID       = BH55600M.DATA_ID;                        
                                                                        
   EXEC SQL                                                             
      SELECT KOERNR                                                     
           , KOERDTO                                                    
        INTO :DCLBE72100T.KOERNR,                                       
             :DCLBE72100T.KOERDTO                                       
        FROM BE72100T                                                   
       WHERE TIL_EVS_AAR   = :DCLBE72100T.TIL_EVS_AAR                   
         AND AFVIKLINGS_ID = :DCLBE72100T.AFVIKLINGS_ID                 
         AND DATA_ID       = :DCLBE72100T.DATA_ID                       
       ;                                                                
                                                                        
   SELECT (SQLCA.SQLCODE);                                              
     WHEN (0) ;                                                         
      OTHER                                                             
       DO;                                                              
         ABENDTXT = '101 Fejl select på BQ72100T (KOER felter)';        
         CALL SQL_FEJL;                                                 
       END;                                                             
   END;                                                                 
                                                                        
   BH861_HEAD = '';                                                     
   BH861_HEAD.INDVNR  = 0001;                                           
   BH861_HEAD.INDKAAR = WS_TIL_EVS_AAR;                                 
   BH861_HEAD.KOERNR  = DCLBE72100T.KOERNR;                             
   BH861_HEAD.KOERDTO = DCLBE72100T.KOERDTO;                            
                                                                        
   WRITE FILE (BH861O) FROM (BH861_HEAD);                               
                                                                        
 END DAN_BH861_HEAD;                                                    
 /*********************************************************************/
 /* Udfyld truktur til trailer og skriv denne                         */
 /*********************************************************************/
 DAN_BH861_TRAIL: PROC;                                                 
                                                                        
    BH861_TRAIL = '';                                                   
    BH861_TRAIL.INDVNR = 0999;                                          
    BH861_TRAIL.PNR    = HJ_CHAR_10;                                    
    BH861_TRAIL.FINDV  = TV.SKREVET;                                    
                                                                        
    WRITE FILE (BH861O) FROM (BH861_TRAIL);                             
                                                                        
 END DAN_BH861_TRAIL;                                                   
 /*********************************************************************/
 /* Test om input felt er J eller N(eller noget andet)                */
 /* Hvis felt er = J så returneres '1', eller returneres 1  blank.    */
 /*********************************************************************/
 TJEK: PROC(FELT) RETURNS(CHAR(1));                                     
                                                                        
   DCL FELT CHAR(1);                                                    
                                                                        
   IF FELT = 'J' THEN                                                   
     RETURN('1');                                                       
   ELSE                                                                 
     RETURN(' ');                                                       
                                                                        
 END TJEK;                                                              
                                                                        
                                                                        
