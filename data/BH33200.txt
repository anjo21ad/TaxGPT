 BH33200: PROCEDURE OPTIONS (MAIN);                                     
 /**********************************************************************
 * PROJEKT:     EVS SLUT 2001 TEST SYSTEM                              *
 * PROGRAMNAVN: BH33200.                                               *
 * PROGRAMTYPE: BATCH.                                                 *
 * FUNKTION:    PROGRAMMET UDTRÆKKER ALLE AKTIVE OG VALIDE EJENDOMME   *
 *              FRA EVS SLUT 2000.                                     *
 * PGMFORLØB:   1. ÅBEN ESR UDTRÆKSFIL.                                *
 *              2. DECLARE PERSONEJENDOMSOPL.                          *
 *              3. OPEN PERSONEJENDOMSOPL.                             *
 *              4. LÆS/FETCH RÆKKE PÅ PERSONTABEL.                     *
 *              5. BEHANDL DATA TIL RECORDSTRUKTUR.                    *
 *              6. CHECK/SKRIV RÆKKE PÅ EVS FIL.                       *
 *              7. GENTAG PUNKT 4 TIL 7 INTIL IKKE FLERE RÆKKER        *
 *              8. LUK PERSONEJENDOMSOPL.                              *
 *              9. LUK ESR UDTRÆKSFIL.                                 *
 *             10. SKRIV KONTROLLISTE.                                 *
 * INDDATA:     BQ00600T - KOPI AF EVS EJENDOMSTABEL.                  *
 *              BQ00700T - KOPI AF EVS PERSONTABEL.                    *
 * UDDATA:      BH33200O - BH33200N UDTRÆK FRA EVS SLUT 2000.          *
 *              BH33201Y - KONTROLLISTE.                               *
 * KONSTRUKTØR: PROGRAMMET ER TILRETTET TIL EVS 2001                   *
 *              ESBEN BRODERSEN       ESB,     T&S BRØNDBY 28.11.2001. *
 * ÆNDRINGSLOG:                                                        *
 **********************************************************************/
                                                                        
 DEFAULT RANGE (*) STATIC; /* LAGERTYPE AHT. KALD AF EKSTERNE MODULER */
                                                                        
 DCL     COPYRIGHT      CHAR (30) INIT ('(C) KMD A/S 2001');            
                                                                        
 /*********************************************************************/
 /* DECLARE AF DB2                                                    */
 /*********************************************************************/
                                                                        
         EXEC SQL INCLUDE BQ00600T;           /* EVS EJENDOMSTABELLEN */
         EXEC SQL INCLUDE BQ00700T;           /* EVS PERSONTABELLEN   */
         EXEC SQL INCLUDE SQLCA;           /* SQL KOMMUNIKATIONSAREAL */
                                                                        
 /**********************************************************************
 * DECLARE AF ABEND RUTINE                                             *
 **********************************************************************/
                                                                        
 DCL     ZS30101        ENTRY;                                          
 DCL     ZS67000        ENTRY;                                          
 DCL     ZS61900        ENTRY;                        /* KST/SSI INFO */
                                                                        
 /*********************************************************************/
 /* DECLARE AF DIVERSE                                                */
 /*********************************************************************/
                                                                        
 DCL     HJ_DCPRN       CHAR (10);                                      
 DCL     HJ_DCPRN_PIC   PIC  '(10)9' BASED(ADDR(HJ_DCPRN));             
 DCL     HJ_EKOMNR      CHAR (03);                                      
 DCL     HJ_EEJDNR      CHAR (06);                                      
 DCL     EKOMEEJD_NR    CHAR (09);                                      
 DCL     OK             CHAR (01)        INIT('J');                     
 DCL     FEJLTEKST      CHAR (20)        INIT(' ');                     
 DCL     ABENDMEDD      CHAR (56)        INIT(' ');                     
                                                                        
 DCL     DT             CHAR (6);                                       
 DCL     1 DAT          BASED(ADDR(DT)),                                
         2 ÅR           PIC   '99',                                     
         2 MD           PIC   '99',                                     
         2 DAG          PIC   '99';                                     
                                                                        
 /*********************************************************************/
 /* DECLARE DATASÆT                                                   */
 /*********************************************************************/
                                                                        
 DCL     SYSPRINT FILE STREAM PRINT;                                    
 DCL     BH3320O FILE OUTPUT RECORD;                   /* ESR UDTRÆK  */
 /*********************************************************************/
 /* DECLARE STRUKTURER                                                */
 /*********************************************************************/
                                                                        
 DCL     1 UDTRÆK_ESR,                                                  
         %INCLUDE CN57000N;;                                            
                                                                        
 DCL     1 INDK_PERS,                                                   
         %INCLUDE BQ00006N;;                                            
                                                                        
 /*********************************************************************/
 /* DECLARE AF BUILTIN                                                */
 /*********************************************************************/
                                                                        
 /* DCL     PLIXOPT   CHAR  (04) VAR STATIC EXT INIT ('STAE');          
            IKKE UNDERSTØTTET AF KOMPILER ?                           */
 DCL     (ADDR,DATE,VERIFY,NULL,MOD,SUBSTR,PLIDUMP) BUILTIN;            
                                                                        
 /*********************************************************************/
 /* DECLARE AF TÆLLERE                                                */
 /*********************************************************************/
                                                                        
 DCL   ANTLÆS_PERSON     BIN FIXED (31) INIT(0);/* LÆSTE PERSONTABEL  */
 DCL   ANTSKRIV_PERSON   BIN FIXED (31) INIT(0);/* SKREVET UDTRÆKSFIL */
 DCL   ANTSKRIV_ØVR      BIN FIXED (31) INIT(0);/* SKREVET EXCL UDLAND*/
 DCL   ANTSKRIV_ØVR_CÆG  BIN FIXED (31) INIT(0);/* SKREVET EXCL UDLAND*/
                                                /* OG CÆGTOPR ^= ' '  */
 DCL   ANTSKRIV_UDL      BIN FIXED (31) INIT(0);/* SKREVET KUN  UDLAND*/
 DCL   ANTEJDNR_EJ_OK    BIN FIXED (31) INIT(0);/* IKKE MODULUS 11 OK */
 DCL   ANTCEJBEVS_9      BIN FIXED (31) INIT(0);/* CEJBEVS=9(SLETTET) */
 DCL   ANTCSLET_1        BIN FIXED (31) INIT(0);/* CSLET=1  (SLETTET) */
 DCL   ANTEJDNR_UDL_EJ   BIN FIXED (31) INIT(0);/* FORKERT EJENDOMSNR */
                                                /* HOS CSC FOR UDLAND */
 DCL   ANTEJDNR_EEJDNR_0 BIN FIXED (31) INIT(0);/* FORKERT EJENDOMSNR */
                                                /* HOS CSC            */
 /*********************************************************************/
 /* PRINTLINIER TIL SPOOL                                             */
 /*********************************************************************/
                                                                        
 DCL     LINIE           CHAR (133);                                    
 DCL     1 LIN           BASED(ADDR(LINIE)),                            
           2 CC          CHAR (1),                                      
           2 FIL1        CHAR (21),                                     
           2 TEKST       CHAR (56),                                     
           2 ANT         PIC  '---------9',                             
           2 FIL2        CHAR (45);                                     
         %INCLUDE ZZ20301M;                                             
                                                                        
 /*********************************************************************/
 /* ON - CONDITIONS                                                   */
 /*********************************************************************/
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
                ON ERROR SYSTEM;                                        
                PUT SKIP LIST ('PROGRAMFEJL');                          
                CALL PLIDUMP  ('SBHO','MODUL BH33200');                 
            END;                                                        
                                                                        
 /*********************************************************************/
 /* HOUSEKEEPING                                                      */
 /*********************************************************************/
         UDTRÆK_ESR            = '';                                    
         TESTPERSON            = '';                                    
         TESTEJENDOM           = '';                                    
         DT = DATE;                                                     
                                                                        
         OPEN FILE (BH3320O) TITLE ('BH33200O');                        
                                                                        
         CALL ZZ20390('*OPEN','BH33201Y');       /* ÅBEN KONTROLLISTE */
                                                                        
         LINIE = ZZWS3 !! ' KONTROL- & AFSTEMNINGSTOTAL FOR'            
                       !! ' ESR-UDTRÆK 2000    ' !! 'DATO: '            
                       !!   DAT.DAG !! '.' !! DAT.MD !! '.' !! DAT.ÅR;  
                                                                        
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LINIE = ZZWS3 !! ' PROGRAMID: BH33200 ';                       
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LINIE = ZZWS2;                                                 
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         CALL ZS61900;                              /* KST/SSI INFO   */
                                                                        
 /*********************************************************************/
 /* PROCES                                                            */
 /*********************************************************************/
         PUT SKIP LIST('PROGRAMMET BH33200 STARTER');                   
         CALL DECLARE_PERSONEJENDOMSOPL;                                
         CALL OPEN_PERSONEJENDOMSOPL;                                   
         CALL FETCH_PERSONEJENDOMSOPL;                                  
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               DO WHILE (SQLCA.SQLCODE = 0);                            
                 CALL BEHANDL;                                          
                 UDTRÆK_ESR            = '';                            
                 TESTPERSON            = '';                            
                 TESTEJENDOM           = '';                            
                 CALL FETCH_PERSONEJENDOMSOPL;                          
               END;                                                     
             END;                                                       
                                                                        
           WHEN (100)                                                   
               PUT SKIP LIST ('INGEN RÆKKER LÆST');                     
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST  = 'FETCH PERSON_CURSOR ';                     
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT */                                              
         CALL AFSLUT;                                                   
                                                                        
 /*********************************************************************/
 /* OPEN CURSOR TIL LÆS AF PERSONTABEL BQ00200T                RUTINE */
 /*********************************************************************/
 OPEN_PERSONEJENDOMSOPL: PROC;                                          
                                                                        
         EXEC SQL OPEN PERSON_CURSOR;                                   
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'OPEN PERSON_CURSOR';                         
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END OPEN_PERSONEJENDOMSOPL;                                            
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF PERSONTABEL BQ00200T               RUTINE */
 /*********************************************************************/
 CLOSE_PERSONEJENDOMSOPL: PROC;                                         
                                                                        
         EXEC SQL CLOSE PERSON_CURSOR;                                  
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'CLOSE PERSON_CURSOR';                        
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END CLOSE_PERSONEJENDOMSOPL;                                           
 /*********************************************************************/
 /* BEHANDL                                                    RUTINE */
 /*********************************************************************/
 BEHANDL: PROC;                                                         
           CALL UDFYLD_STRUKTUR;                                        
           CALL CHECK_SKRIV;                                            
 END BEHANDL;                                                           
 UDFYLD_STRUKTUR:  PROC;                                                
         UDTRÆK_ESR.DCPRCIR    = TESTPERSON.DCPRN;                      
         UDTRÆK_ESR.EKOMNR     = TESTPERSON.EKOMNR;                     
         UDTRÆK_ESR.EEJDNR     = TESTPERSON.EEJDNR;                     
         IF TESTPERSON.DOVTG ^= ' ' & TESTPERSON.GPCTEJER < 100         
           THEN                                                         
           UDTRÆK_ESR.CITYP = 7;                                        
         ELSE                                                           
           IF TESTPERSON.DOVTG ^= ' ' & TESTPERSON.GPCTEJER = 100       
             THEN                                                       
             UDTRÆK_ESR.CITYP = 5;                                      
           ELSE                                                         
             UDTRÆK_ESR.CITYP = 1;                                      
         UDTRÆK_ESR.ANAVN   = ' ';                                      
         UDTRÆK_ESR.ACONA   = ' ';                                      
         UDTRÆK_ESR.AUADR   = ' ';                                      
         UDTRÆK_ESR.APADR   = ' ';                                      
         UDTRÆK_ESR.ABELMAT = ' ';                                      
         UDTRÆK_ESR.DOVTG   = DB2_DATO_TIL_FIX09(TESTPERSON.DOVTG);     
         UDTRÆK_ESR.DAFSTÅ  = DB2_DATO_TIL_FIX09(TESTPERSON.DAFSTAA);   
         UDTRÆK_ESR.DAFGDAT = DB2_DATO_TIL_FIX09(TESTPERSON.DAFSTAA);   
         UDTRÆK_ESR.DSLUTS  = DB2_DATO_TIL_FIX09(TESTPERSON.DAFSTAA);   
         UDTRÆK_ESR.DSKØDE  = DB2_DATO_TIL_FIX09(TESTPERSON.DAFSTAA);   
         UDTRÆK_ESR.CEJFORH = 10;                                       
     /*  UDTRÆK_ESR.CLEJE   = TESTPERSON.CLEJE;   */                    
         UDTRÆK_ESR.CPENS   = ' ';                                      
         UDTRÆK_ESR.GANE    = TESTPERSON.GPCTEJER;                      
         IF TESTPERSON.GPCTEJER < 100 THEN                              
           UDTRÆK_ESR.FEJER   = 2;                                      
         ELSE                                                           
           UDTRÆK_ESR.FEJER   = 1;                                      
         UDTRÆK_ESR.CHEJD      = ' ';                                   
         UDTRÆK_ESR.CTILOM     = ' ';                                   
         UDTRÆK_ESR.DVURDÅR    = 2001;                                  
         UDTRÆK_ESR.CBENYT     = TESTEJENDOM.CBENYT;                    
         UDTRÆK_ESR.FLEJL      = TESTEJENDOM.FLEJL;                     
         UDTRÆK_ESR.BEJDVÆP4A  = TESTPERSON.BBERGRL;                    
         UDTRÆK_ESR.BEJDVÆP4B  = TESTPERSON.BBERGRL;                    
         UDTRÆK_ESR.BEJDVÆR    = TESTPERSON.BBERGRL;                    
         UDTRÆK_ESR.BGRUNDV    = TESTPERSON.BBERGRL;                    
         SELECT(TESTEJENDOM.CEJBOLTYP1);                                
           WHEN ('1')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(1).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).EJBOLTYP = TESTEJENDOM.CEJBOLTYP1;  
               UDTRÆK_ESR.EJEBOL(1).BEJEBOL  = TESTEJENDOM.BEJBOL1;     
               UDTRÆK_ESR.ANT_FOR_1 = UDTRÆK_ESR.ANT_FOR_1 + 1;         
             END;                                                       
           WHEN ('2')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(1).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).EJBOLTYP = TESTEJENDOM.CEJBOLTYP1;  
               UDTRÆK_ESR.EJEBOL(1).BEJEBOL  = TESTEJENDOM.BEJBOL1;     
               ANT_FOR_2 = ANT_FOR_2 + 1;                               
             END;                                                       
           WHEN ('4')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(1).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).EJBOLTYP = TESTEJENDOM.CEJBOLTYP1;  
               UDTRÆK_ESR.EJEBOL(1).BEJEBOL  = TESTEJENDOM.BEJBOL1;     
               ANT_FOR_4 = ANT_FOR_4 + 1;                               
             END;                                                       
           WHEN ('5')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(1).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).EJBOLTYP = TESTEJENDOM.CEJBOLTYP1;  
               UDTRÆK_ESR.EJEBOL(1).BEJEBOL  = TESTEJENDOM.BEJBOL1;     
               ANT_FOR_5 = ANT_FOR_5 + 1;                               
             END;                                                       
           WHEN ('6')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(1).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).EJBOLTYP = TESTEJENDOM.CEJBOLTYP1;  
               UDTRÆK_ESR.EJEBOL(1).BEJEBOL  = TESTEJENDOM.BEJBOL1;     
               ANT_FOR_6 = ANT_FOR_6 + 1;                               
             END;                                                       
           WHEN ('8')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(1).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).EJBOLTYP = TESTEJENDOM.CEJBOLTYP1;  
               UDTRÆK_ESR.EJEBOL(1).BEJEBOL  = TESTEJENDOM.BEJBOL1;     
               ANT_FOR_8 = ANT_FOR_8 + 1;                               
             END;                                                       
           WHEN ('9')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(1).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(1).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(1).EJBOLTYP = TESTEJENDOM.CEJBOLTYP1;  
               UDTRÆK_ESR.EJEBOL(1).BEJEBOL  = TESTEJENDOM.BEJBOL1;     
               ANT_FOR_9 = ANT_FOR_9 + 1;                               
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
               /* EVT SKAL DER LAVES EN TÆLLER HER */                   
             END;                                                       
           END;            /* SELECT TESTEJENDOM.CEJBOLTYP1  */         
         SELECT(TESTEJENDOM.CEJBOLTYP2);                                
           WHEN ('1')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(2).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).EJBOLTYP = TESTEJENDOM.CEJBOLTYP2;  
               UDTRÆK_ESR.EJEBOL(2).BEJEBOL  = TESTEJENDOM.BEJBOL2;     
               ANT_FOR_1 = ANT_FOR_1 + 1;                               
             END;                                                       
           WHEN ('2')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(2).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).EJBOLTYP = TESTEJENDOM.CEJBOLTYP2;  
               UDTRÆK_ESR.EJEBOL(2).BEJEBOL  = TESTEJENDOM.BEJBOL2;     
               ANT_FOR_2 = ANT_FOR_2 + 1;                               
             END;                                                       
           WHEN ('4')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(2).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).EJBOLTYP = TESTEJENDOM.CEJBOLTYP2;  
               UDTRÆK_ESR.EJEBOL(2).BEJEBOL  = TESTEJENDOM.BEJBOL2;     
               ANT_FOR_4 = ANT_FOR_4 + 1;                               
             END;                                                       
           WHEN ('5')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(2).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).EJBOLTYP = TESTEJENDOM.CEJBOLTYP2;  
               UDTRÆK_ESR.EJEBOL(2).BEJEBOL  = TESTEJENDOM.BEJBOL2;     
               ANT_FOR_5 = ANT_FOR_5 + 1;                               
             END;                                                       
           WHEN ('6')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(2).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).EJBOLTYP = TESTEJENDOM.CEJBOLTYP2;  
               UDTRÆK_ESR.EJEBOL(2).BEJEBOL  = TESTEJENDOM.BEJBOL2;     
               ANT_FOR_6 = ANT_FOR_6 + 1;                               
             END;                                                       
           WHEN ('8')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(2).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).EJBOLTYP = TESTEJENDOM.CEJBOLTYP2;  
               UDTRÆK_ESR.EJEBOL(2).BEJEBOL  = TESTEJENDOM.BEJBOL2;     
               ANT_FOR_8 = ANT_FOR_8 + 1;                               
             END;                                                       
           WHEN ('9')                                                   
             DO;                                                        
               UDTRÆK_ESR.EJEBOL(2).VEJK_EJEB     = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).HUSNR_EJEB    = 0;   /* ' '; */     
               UDTRÆK_ESR.EJEBOL(2).BOGST_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).ETAGE_EJEB    = ' ';                
               UDTRÆK_ESR.EJEBOL(2).EJBOLTYP = TESTEJENDOM.CEJBOLTYP2;  
               UDTRÆK_ESR.EJEBOL(2).BEJEBOL  = TESTEJENDOM.BEJBOL2;     
               ANT_FOR_9 = ANT_FOR_9 + 1;                               
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
              ;            /* EVT SKAL DER LAVES EN TÆLLER HER */       
             END;                                                       
           END;            /* SELECT TESTEJENDOM.CEJBOLTYP2  */         
         UDTRÆK_ESR.BSKOV                = TESTPERSON.BBERGRL;          
         IF TESTEJENDOM.CEJDTYPE = '7' ! TESTEJENDOM.CEJDTYPE = '8'     
           THEN                                                         
           DO;                                                          
             UDTRÆK_ESR.CEJERL    = '2';                                
             UDTRÆK_ESR.CEJERL_GL = '2';                                
           END;                                                         
         ELSE                                                           
           DO;                                                          
             UDTRÆK_ESR.CEJERL    = ' ';                                
             UDTRÆK_ESR.CEJERL_GL = ' ';                                
           END;                                                         
      /* UDTRÆK_ESR.GL_CBENYT             = TESTEJENDOM.CBENYT;         
         UDTRÆK_ESR.GL_FLEJL              = TESTEJENDOM.FLEJL; */       
         UDTRÆK_ESR.GL_BEJDV                = 0;                        
         UDTRÆK_ESR.GL_BEJEB                = 0;                        
         UDTRÆK_ESR.GL_BSTUE                = 0;                        
         UDTRÆK_ESR.GL_BSTUGR               = 0;                        
         UDTRÆK_ESR.GBOANDPCT            = 0;                           
         UDTRÆK_ESR.BFSKAT               = 0;                           
         UDTRÆK_ESR.BYDAF                = 0;                           
         UDTRÆK_ESR.BDAF                 = 0;                           
         UDTRÆK_ESR.BAFPGRVKOM           = 0;                           
         UDTRÆK_ESR.BFKOMSKST            = 0;                           
         UDTRÆK_ESR.BFAMTSKST            = 0;                           
         UDTRÆK_ESR.BAFPGRVAMT           = 0;                           
         UDTRÆK_ESR.BFAMTSKLA            = 0;                           
         UDTRÆK_ESR.EMATNR               = 0;                           
         UDTRÆK_ESR.ABGSTSK              = ' ';                         
         UDTRÆK_ESR.HEJLTX               = ' ';                         
         UDTRÆK_ESR.EMATAR               = 0;                           
         UDTRÆK_ESR.CDIFF                = 0;                           
         UDTRÆK_ESR.CFRED                = TESTPERSON.CFRED;            
         UDTRÆK_ESR.CEJSO                = ' ';                         
         UDTRÆK_ESR.CEJEV                = ' ';                         
         UDTRÆK_ESR.CEJ_100              = 1;                           
         UDTRÆK_ESR.CFORSKEL             = ' ';                         
         UDTRÆK_ESR.BBRF379              = ' ';                         
         UDTRÆK_ESR.BBRF380              = ' ';                         
         UDTRÆK_ESR.BBRANV               = ' ';                         
         UDTRÆK_ESR.BBROPFØRT            = ' ';                         
         UDTRÆK_ESR.VEJK_EJD             = 0;                           
         UDTRÆK_ESR.HUSNR_EJD            = 0;                           
         UDTRÆK_ESR.BOGST_EJD            = ' ';                         
         UDTRÆK_ESR.ETAGE_EJD            = 0;                           
         UDTRÆK_ESR.VEJK_EJER            = 0;                           
         UDTRÆK_ESR.HUSNR_EJER           = 0;                           
         UDTRÆK_ESR.BOGST_EJER           = 0;                           
         UDTRÆK_ESR.ETAGE_EJER           = 0;                           
         UDTRÆK_ESR.SDØR_EJER            = 0;                           
      /* UDTRÆK_ESR.CKOPI                = TESTPERSON.CKOPI;            
         UDTRÆK_ESR.DCPRNKOPI            = TESTPERSON.DCPRNKOPI; */     
 END UDFYLD_STRUKTUR;                                                   
                                                                        
 CHECK_SKRIV: PROC;                                                     
 /*******************************************************************/  
 /*    CHECK FOR FORKERTE EJENDOMSNUMMER                            */  
 /*******************************************************************/  
         CALL CHECK_EJDNR;                                              
                                                                        
         IF OK ^= 'J'                                                   
         THEN                                                           
            DO;                                                         
               ANTEJDNR_EJ_OK = ANTEJDNR_EJ_OK + 1;                     
               RETURN;                                                  
            END;                                                        
                                                                        
                                                                        
                                                                        
 /*********************************************************************/
 /* UDSKRIVNING                                                       */
 /*********************************************************************/
         ANTSKRIV_PERSON = ANTSKRIV_PERSON + 1;                         
         WRITE FILE (BH3320O) FROM (UDTRÆK_ESR);                        
         ANTSKRIV_ØVR = ANTSKRIV_ØVR + 1;                               
                                                                        
 END CHECK_SKRIV;                                                       
 /*********************************************************************/
 /* HER CHECKES OM EJENDOMSNUMMER ER MODULUS-11 VALIDT         RUTINE */
 /*********************************************************************/
 CHECK_EJDNR: PROC;                                                     
                                                                        
         OK = 'J';                                                      
                                                                        
         HJ_DCPRN_PIC = UDTRÆK_ESR.DCPRCIR;                             
         HJ_EKOMNR   = ZM_KONV_BF15_CH3 (UDTRÆK_ESR.EKOMNR);            
         HJ_EEJDNR   = KONV_BF31_CH06_F (UDTRÆK_ESR.EEJDNR);            
         EKOMEEJD_NR = HJ_EKOMNR !! HJ_EEJDNR;                          
                                                                        
         IF UDTRÆK_ESR.EKOMNR ^= 999                                    
         THEN                                                           
            IF EVS_MOD11_CHK(EKOMEEJD_NR) = '1'B                        
            THEN;                                                       
            ELSE                                                        
               DO;                                                      
                  OK = 'N';                                             
                  LIN.TEKST =                                           
                  ' KOMMUNENR/EJENDOMSNR EJ MODULUS-11 VALIDT';         
                  LIN.FIL1  = HJ_DCPRN !! ' ' !!                        
                              HJ_EKOMNR !! ' ' !! HJ_EEJDNR;            
                  CALL ZZ20300(LINIE,'01');                             
               END;                                                     
                                                                        
 END CHECK_EJDNR;                                                       
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         CLOSE FILE (BH3320O);                                          
         CALL CLOSE_PERSONEJENDOMSOPL;                                  
         CALL ZS67000(SQLCA);                                           
                                                                        
         ABENDMEDD = 'BH33200 ** 250 ' !! FEJLTEKST;                    
                                                                        
         CALL ZS30101 (5, ABENDMEDD, 2);                                
                                                                        
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /* LUK FILER, CURSOR OG UDSKRIV AFSTEMNINGS- OG KONTROLLISTE  RUTINE */
 /*********************************************************************/
 AFSLUT: PROC;                                                          
         PUT SKIP LIST('PROGRAMMET BH33200 SLUTTER');                   
         CLOSE FILE (BH3320O);                                          
         CALL CLOSE_PERSONEJENDOMSOPL;                                  
                                                                        
         LINIE = ZZWS2;                                                 
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL LÆSTE FRA PERSONTABEL OG EJENDOMSTABEL...'; 
         LIN.ANT   = ANTLÆS_PERSON;                                     
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL EJ SKREVET IKKE VALIDE EJENDOMSNUMRE ....'; 
         LIN.ANT   = ANTEJDNR_EJ_OK;                                    
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         LIN.TEKST = 'ANTAL SKREVNE IALT ............................'; 
         LIN.ANT   = ANTSKRIV_PERSON;                                   
         CALL ZZ20300(LINIE,'01');                                      
                                                                        
         CALL ZZ20300(' ','99');                      /* LUK KMDSPOOL */
                                                                        
 END AFSLUT;                                                            
 /*********************************************************************/
 /* HER STARTER APPLIKATIONENS EGNE INCLUDES                          */
 /*********************************************************************/
                                                                        
 %INCLUDE BH33200M;             /* DECLARE OG FETCH SQL STATEMENTS.   */
 %INCLUDE BS55111M;             /* CHECK OM KOMNR OG EJENDOMSNR ER OK */
 %INCLUDE ZM90051M;             /* KONV BIN15 TIL CHAR                */
 %INCLUDE BS34307M;             /* KONV BF31 TIL CHAR6                */
 %INCLUDE BH33201M;             /* KONV DATO FRA CHAR TIL DEC FIXED   */
 /*  %INCLUDE BH33002M; */      /* KONV CHAR(10) TIL DEC FIXED(11)    */
                                                                        
 END BH33200;                                                           
