 BQ30000: PROC OPTIONS (MAIN) REORDER;                                  
 /**********************************************************************
 ** PROJEKT:     EVS SLUT                                             **
 ** PROGRAMNAVN: BQ30000.                                             **
 ** PROGRAMTYPE: BATCH.                                               **
 ** FUNKTION:    EVS-UDTRÆK FRA SLUT 2019 TIL DANMARKS STATISTIK      **
 ** PGMFORLØB:   1. DECLARE CURSOR                                    **
 **              2. ÅBEN CURSOR                                       **
 **              3. LÆS CURSOR                                        **
 **              4. SKRIV EVT. UDTRUKNE EVS PERSONNER                 **
 **              5. LUK FILER/CURSOR                                  **
 **              6. DAN OPTÆLLINGSLISTE.                              **
 ** UDDATA:      BQ30000O - UDTRÆK TIL DANMARKS STATISTIK             **
 ** KONSTRUKTØR: EDWARD LARYEA       EDL, LSU/T&S BRØNDBY 11.12.2001. **
 **                                                                   **
 ** RETTEDE AF : EDWARD LARYEA       EDL, LSU/T&S BRØNDBY 17.01.2002. **
 ** POBNR. 36899  TILFØJET TABEL BQ00300T                             **
 ** RETTEDE AF : ESBEN BRODERSEN     ESB, LSU/T&S BALLERUP   05.2003. **
 ** TILRETTET TIL DE NYE TABELLER FOR EVS 2001                        **
 ** RETTEDE AF : GGP                    , LSU/T&S BALLERUP   11.2003. **
 ** OMLAGT TIL DE NYE TABELLER FOR EVS 2002 (BQ30000T,BQ40000T)       **
 ** RETTEDE AF : GGP                    , LSU/T&S BALLERUP   12.2004. **
 ** NYE FELTER TILFØRT                                                **
 ** RETTEDE AF : BO SCHMIDT             ,PKF/T&S BALLERUP 03.10.2005. **
 ** NYE FELTER TILFØRT                                                **
 ** RETTEDE AF : BO SCHMIDT             ,PKF/T&S BALLERUP 03.10.2006. **
 ** ÅRSTILRETTER                                                      **
 ** RETTEDE AF : BO SCHMIDT             ,PKF/T&S BALLERUP 03.10.2007. **
 ** ÅRSTILRETTER                                                      **
 ** RETTEDE AF : BO SCHMIDT             ,PKF/T&S BALLERUP 15.09.2008. **
 ** ÅRSTILRETTER                                                      **
 ** RETTEDE AF : HANS ERIK KJELDSEN     ,PKF/T&S BALLERUP 10.11.2009. **
 ** ÅRSTILRETTET                                                      **
 ** RETTET  AF : GERD HOLM-PEDERSE      ,PKF     BALLERUP 20.10.2010. **
 ** RETTET  AF : GEH  DATO ÆNDRET       ,PKF     BALLERUP 25.11.2010. **
 ** RETTET  AF : GEH  DATO ÆNDRET       ,PKF     BALLERUP 06.12.2010. **
 ** RETTET  AF : GEH  DATO ÆNDRET       ,PF      BALLERUP 11.11.2011. **
 ** RETTEDE AF : LARS KAAE HARRITSHØJ   ,PR      BALLERUP SEP 2012    **
 ** RETTEDE AF : JØREGEN SAUGMANN       ,PR      BALLERUP NOV 2013    **
 ** RETTEDE AF : MICHAEL KRISTENSEN     ,PR      BALLERUP NOV 2014    **
 ** RETTEDE AF : Claus Marcussen        ,PR      BALLERUP NOV 2015    **
 ** RETTED  AF : Lene Maj Jensen     QLE         BALLERUP NOV 2016    **
 **              Søgeindhold i årstal og resultat ændret              **
 ** RETTET  AF : Jørgen Saugmann     SQU         BALLERUP DEC 2017    **
 **              Søgeindhold i årstal og resultat ændret              **
 ** RETTET  AF : Esben Brodersen     QEB         BALLERUP JAN 2018    **
 **              Nyt kriterie for udtræk pga af ændring i individ 811 **
 **              Ny optælling af CEJBEVS                              **
 ** Rettet  af : Gitte Jensen        GJN         Ballerup 28.11.2018  **
 **              Søgeindhold i årstal og resultat ændret              **
 ** Rettet  af : Esben Brodersen     EBD        Ballerup  25.11.2019  **
 **              Søgeindhold i årstal og resultat ændret              **
 **              EENHEDLBNR er sat ind i sortering og joins           **
 **              skal ikke sendes til Danmarks statistik for 2018     **
 **              årsrullet strukturer pga af enhedsløbenummer #01     **
 ** Rettet  af : Esben Brodersen     EBD        Ballerup  19.01.2021  **
 **              Søgeindhold i årstal og resultat ændret              **
 ** Rettet  af : ONE                                   december 2021  **
 **              Søgeindhold i årstal og resultat ændret              **
 **              årsrullet strukturer pga af enhedsløbenummer #01     **
 **              Uddata skal efterfølgende i jlc sorteres efter       **
 **              kommunenummer,ejendomsnummer og enhedsløbenummer     **
 **              og periodeløbenummer                                 **
 ** Rettet  af : ONE                                   december 2022  **
 **              årsrullet strukturer pga af enhedsløbenummer #01     **
 **              Søgeindhold i årstal og resultat ændret              **
 ** Rettet  af : PBR                                   december 2023  **
 **              årsrullet strukturer pga af enhedsløbenummer #01     **
 **              Søgeindhold i årstal og resultat ændret              **
 ** Rettet  af : PBR                                   december 2024  **
 **              årsrullet strukturer pga af enhedsløbenummer #01     **
 **              Søgeindhold i årstal og resultat ændret              **
 **********************************************************************/
                                                                        
 DEFAULT RANGE (*) STATIC; /* LAGERTYPE AHT. KALD AF EKSTERNE MODULER */
                                                                        
 DCL     COPYRIGHT       CHAR  (30) INIT ('(C) KMD A/S');               
 /**********************************************************************
 * DECLARE AF STRUKTURER                                               *
 **********************************************************************/
 DCL     1 PERSONTAB,                  /* EVS PERONTABELSTRUKTUR */     
         %INCLUDE BQ23200N;;  /*#01*/                                   
                                                                        
 DCL     1 RESULTATTAB,                                                 
         %INCLUDE BQ23300N;;  /*#01*/  /* EVS RESULTATSTRUKTUR       */ 
                                                                        
 DCL     1 EVS_ESK_FELT,               /* EVS EJERSKABSFELTTABELEN   */ 
         %INCLUDE BQ31000N;;                                            
 DCL     1 EVS_RES_FELT,               /* EVS RESULTATFELTTABELEN    */ 
         %INCLUDE BQ41000N;;                                            
                                                                        
 DCL     1 INDK_EJERSK,                 /* INDIKATOR EJENDOMS OPLYSN. */
         %INCLUDE BQ23006N;;   /*#01*/                                  
 DCL     1 INDK_EVS_RES,                /* INDIKATOR RESULTAT OPLYSN. */
         %INCLUDE BQ23017N;;   /*#01*/                                  
                                                                        
 DCL     UDTRAEK_UD  CHAR(606);                                         
 DCL     1 UDTRAEK   BASED(ADDR(UDTRAEK_UD)),       /* UDTRÆK TIL DS  */
         %INCLUDE BQ30011N;                                             
                                                                        
 /**********************************************************************
 * DECLARE AF DB2 TABELLER                                             *
 **********************************************************************/
                                                                        
         EXEC SQL INCLUDE SQLCA;        /* SQL KOMMUNIKATIONSAREAL    */
         EXEC SQL INCLUDE BQ30000K;     /* EVS PERSONTABEL            */
         EXEC SQL INCLUDE BQ31000K;     /* EVS PERSONTFELTTABEL       */
         EXEC SQL INCLUDE BQ40000K;     /* EVS RESULTATTABEL          */
         EXEC SQL INCLUDE BQ41000K;     /* EVS RESULTATFELTTABEL      */
                                                                        
 /*********************************************************************/
 /* DECLARE DATASÆT OG FILER                                          */
 /*********************************************************************/
                                                                        
 DCL     BQ300O          FILE OUTPUT RECORD;                            
 /**********************************************************************
 * DECLARE AF BUILTIN                                                  *
 **********************************************************************/
                                                                        
 DCL     (ADDR, PLIDUMP, DATE, NULL,TRANSLATE,SUBSTR) BUILTIN;          
 /**********************************************************************
 * DECLARE AF DIVERSE FELTER                                           *
 **********************************************************************/
 DCL     SQLKODE         PIC '9999';                                    
 DCL     UDSKRDT         CHAR      (10);                                
 DCL     FSKAF           FIXED DEC (15);                                
 DCL     FPERS           FIXED DEC (15);                                
 DCL     FSKRIV          FIXED DEC (15);                                
 DCL     FFEJL           FIXED DEC (15);                                
 DCL     FPERSON         FIXED DEC (15);                                
 DCL     FEJERFORHOLD    FIXED DEC (15);                                
 DCL     FEJENDOMSVÆRDISKAT  FIXED (15);                                
                                                                        
 DCL     PDCPRN          PIC       '9999999999';                        
 DCL     DATO            CHAR      (6);                                 
 DCL     PDATO           PIC       '999999' BASED(ADDR(DATO));          
                                                                        
 DCL     SLUTNU          BIT;                                           
                                                                        
 DCL     HJ_CHAR1        CHAR      (01);                                
                                                                        
 /* INPUT TIL CURSOR UDTRAEK_CURSOR PÅ BQ40000T - RET DATOER HER #01 */ 
 DCL UDTRAEK_DINDKAAR    BIN FIXED(15) INIT(2023);                      
 DCL UDTRAEK_DRESULTAT   CHAR(26) INIT('2024-11-27-00.00.00.000000');   
                                                                        
                                                                        
 DCL  1 STATISTIK UNALIGNED,                                            
        5 CEJBEVS(0:12),                                                
          10 ANTAL BIN FIXED(31);                                       
                                                                        
 DCL  HJ_TX     BIN FIXED(31) INIT(0);                                  
 DCL  HJ_PICX   PIC       '9';                                          
                                                                        
 DCL     1 DT DEF DATO,                                                 
           2 AA          CHAR      (2),                                 
           2 MM          CHAR      (2),                                 
           2 DD          CHAR      (2);                                 
                                                                        
 DCL     LINIE           CHAR      (133);                               
 DCL     1 LIN           DEF LINIE,                                     
           2 CC1         CHAR           (1),                            
           2 TEKST       CHAR           (132);                          
                                                                        
         % INCLUDE ZZ20301M;                                            
 DCL     1 ABENDMEDD,                                                   
           2 ABENDMODUL CHAR      (7),                                  
           2 ABENDFILL1 CHAR      (1),                                  
           2 ABENDMEDNR CHAR      (2),                                  
           2 ABENDFILL2 CHAR      (1),                                  
           2 ABENDTXT   CHAR      (45);                                 
                                                                        
 DCL     ABENDRTKODE    FIXED     (2);                                  
 DCL     SQLCODE_CH     CHAR      (5);                                  
 DCL     SQLCODE_PIC    PIC       'SSSS9' DEF SQLCODE_CH;               
                                                                        
 DCL     GEM_SKAF_UDTRAEK_DCPRN FIXED (11);                             
 /*********************************************************************/
 /*         EXTERNAL ENTRIES                                          */
 /*********************************************************************/
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS67000        ENTRY;                                          
 DCL     MEDDEL         CHAR (56);                                      
 DCL     ABEND_STR               CHAR (56) BASED(ADDR(ABEND_STRUK));    
 DCL     1 ABEND_STRUK,                                                 
          2 MODULNAVN            CHAR (07) INIT ('BQ30000'),            
          2 HFILL1               CHAR (01) INIT (' '),                  
          2 MEDDELNR             CHAR (02) INIT ('**'),                 
          2 HFILL2               CHAR (01) INIT (' '),                  
          2 MEDDELTXT            CHAR (45) INIT ('');                   
 /**********************************************************************
 * ON CONDITIONS                                                       *
 **********************************************************************/
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
               ON ERROR SYSTEM;                                         
               CALL PLIDUMP  ('SNHOB','MODUL BQ30000');                 
            END;                                                        
                                                                        
 /**********************************************************************
 * HOUSE-KEEPING                                                       *
 **********************************************************************/
         CALL ZS61900;                           /* SSI */              
         OPEN FILE (BQ300O) TITLE ('BQ30000O');                         
         CALL ZZ20390 ('*OPEN','BQ30002Y','RECF','FBA');                
         UDTRAEK_UD = '';                                               
         /**********************************/                           
         /* OPSÆT DAGS DATO                */                           
         /**********************************/                           
         DATO = DATE;                                                   
         UDSKRDT = DT.DD !! '/' !! DT.MM !! '-' !! DT.AA;               
         FSKAF  = 0;                                                    
         FPERS  = 0;                                                    
         FSKRIV = 0;                                                    
         FFEJL  = 0;                                                    
         FPERSON = 0;                                                   
         FEJERFORHOLD = 0;                                              
         FEJENDOMSVÆRDISKAT = 0;                                        
         GEM_SKAF_UDTRAEK_DCPRN = 0;                                    
         SLUTNU = '0'B;                                                 
         STATISTIK = '';                                                
                                                                        
 /**********************************************************************
 * PROCES                                                              *
 **********************************************************************/
                                                                        
         CALL DECLARE_UDTRAEK;                                          
                                                                        
         CALL AABEN_UDTRAEK_CURSOR;                                     
                                                                        
         CALL LÆS_UDTRAEK;                                              
                                                                        
         DO WHILE (SLUTNU = '0'B);                                      
                                                                        
           IF GEM_SKAF_UDTRAEK_DCPRN ^= DCLGENBQ40000T.DCPRN            
           THEN                                                         
              FPERSON = FPERSON +1;                                     
                                                                        
           GEM_SKAF_UDTRAEK_DCPRN = DCLGENBQ40000T.DCPRN;               
                                                                        
           RESULTATTAB = '';                                            
           INDK_EVS_RES = -1;                                           
           CALL OVERFØR_DATA_RES;                                       
           CALL LÆS_RESULTATS_FELTTABEL;                                
                                                                        
           CALL DECLARE_PERSON;                                         
                                                                        
           CALL AABEN_PERSON_CURSOR;                                    
           CALL SKAF_PERSON;                                            
                                                                        
           PERSONTAB = '';                                              
           INDK_EJERSK = -1;                                            
           CALL OVERFØR_DATA_PER;                                       
           CALL LÆS_EJERSKABS_FELTTABEL;                                
                                                                        
           CALL LUK_PERSON_CURSOR;                                      
                                                                        
           CALL DAN_UDTRAEK;                                            
           CALL SKRIV_UDTRAEK;                                          
                                                                        
           FEJERFORHOLD = FEJERFORHOLD + 1;                             
                                                                        
           CALL LÆS_UDTRAEK;                                            
         END;                                                           
                                                                        
         FSKAF = FSKAF - 1;                                             
                                                                        
         CALL LUK_UDTRAEK_CURSOR;                                       
         CALL UDSKRIV_KONTROLLISTE;                                     
         CALL LUK_FILER;                                                
                                                                        
 /*********************************************************************/
 /*      DECLARE CURSOR TIL UDTRÆK                                    */
 /*********************************************************************/
 DECLARE_UDTRAEK: PROC;                                                 
                                                                        
        EXEC SQL DECLARE UDTRAEK_CURSOR CURSOR FOR                      
                                                                        
        SELECT  T1.DCPRN                                                
               ,T1.DINDKAAR                                             
               ,T1.EKOMNR                                               
               ,T1.EEJDNR                                               
               ,T1.EENHEDLBNR                                           
               ,T1.ELBNR                                                
               ,T1.EGENNR                                               
               ,T1.DFRAGLD                                              
               ,T1.DRESULTAT                                            
               ,T1.UDSKRDTO                                             
               ,T1.COMPLA                                               
               ,T1.DOMPLACPR                                            
        FROM   BQ40000T T1                                              
        LEFT JOIN BQ41000T T3                                           
          ON  T3.DCPRN      = T1.DCPRN                                  
         AND  T3.DINDKAAR   = T1.DINDKAAR                               
         AND  T3.EKOMNR     = T1.EKOMNR                                 
         AND  T3.EEJDNR     = T1.EEJDNR                                 
         AND  T3.EENHEDLBNR = T1.EENHEDLBNR                             
         AND  T3.ELBNR      = T1.ELBNR                                  
         AND  T3.EGENNR     = T1.EGENNR                                 
         AND  T3.FELTKODE   = 26                                        
        WHERE  T1.DINDKAAR  = :DCLGENBQ40000T.DINDKAAR                  
         AND   T1.COMPLA   ^= '1'                                       
         AND   T1.CKOERSEL  = 'B'                                       
         AND   T1.EGENNR    =                                           
                  (SELECT MAX(EGENNR)                                   
                    FROM BQ40000T T2                                    
                    WHERE T2.DCPRN      = T1.DCPRN                      
                    AND   T2.DINDKAAR   = T1.DINDKAAR                   
                    AND   T2.EKOMNR     = T1.EKOMNR                     
                    AND   T2.EEJDNR     = T1.EEJDNR                     
                    AND   T2.EENHEDLBNR = T1.EENHEDLBNR                 
                    AND   T2.ELBNR     = T1.ELBNR                       
                    AND   T2.CKOERSEL  = 'B'                            
                    AND   T2.DRESULTAT < :DCLGENBQ40000T.DRESULTAT)     
        AND   T3.INDHOLD_D IS NOT NULL                                  
        ORDER BY T1.DINDKAAR,T1.DCPRN,T1.EKOMNR,                        
                 T1.EEJDNR, T1.EENHEDLBNR, T1.ELBNR                     
        FOR FETCH ONLY                                                  
        ;                                                               
                                                                        
 END DECLARE_UDTRAEK;                                                   
 /*********************************************************************/
 /*      ÅBEN CURSOR TIL UDTRÆK                                       */
 /*********************************************************************/
 AABEN_UDTRAEK_CURSOR: PROC;                                            
        DCLGENBQ40000T.DINDKAAR  = UDTRAEK_DINDKAAR;                    
        DCLGENBQ40000T.DRESULTAT = UDTRAEK_DRESULTAT;                   
                                                                        
        PUT SKIP LIST('DER ER KØRT MED FØLGENDE PARAMETRE: '!!          
                      DCLGENBQ40000T.DINDKAAR!!'  '!!                   
                      DCLGENBQ40000T.DRESULTAT);                        
                                                                        
        EXEC SQL OPEN UDTRAEK_CURSOR;                                   
        IF SQLCODE ^= 0                                                 
        THEN                                                            
           DO;                                                          
             SQLCODE_PIC = SQLCODE;                                     
             ABENDTXT   =  '261 OPEN UDTRAEK_CURSOR,SQLCODE= '          
                           !! SQLCODE_CH;                               
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
 END AABEN_UDTRAEK_CURSOR;                                              
 /*********************************************************************/
 /*      LÆS UDTRÆK AF RESULTATER DER SKAL LEVERES TIL DS             */
 /*********************************************************************/
 LÆS_UDTRAEK: PROC;                                                     
                                                                        
        EXEC SQL                                                        
                                                                        
             FETCH UDTRAEK_CURSOR                                       
                                                                        
             INTO  :DCLGENBQ40000T.DCPRN,                               
                   :DCLGENBQ40000T.DINDKAAR,                            
                   :DCLGENBQ40000T.EKOMNR,                              
                   :DCLGENBQ40000T.EEJDNR,                              
                   :DCLGENBQ40000T.EENHEDLBNR,                          
                   :DCLGENBQ40000T.ELBNR,                               
                   :DCLGENBQ40000T.EGENNR,                              
                   :DCLGENBQ40000T.DFRAGLD,                             
                   :DCLGENBQ40000T.DRESULTAT,                           
                   :DCLGENBQ40000T.UDSKRDTO,                            
                   :DCLGENBQ40000T.COMPLA,                              
                   :DCLGENBQ40000T.DOMPLACPR;                           
                                                                        
        IF SQLCODE ^= 0                                                 
         & SQLCODE ^= 100                                               
        THEN                                                            
           DO;                                                          
             SQLCODE_PIC = SQLCODE;                                     
             ABENDTXT   =  '262 FETCH UDTRAEK_CURSOR,SQLCODE= '         
                           !! SQLCODE_CH;                               
             CALL SQL_FEJL;                                             
           END;                                                         
        ELSE                                                            
        IF SQLCODE = 100                                                
        THEN                                                            
           SLUTNU = '1'B;                                               
                                                                        
        FSKAF = FSKAF + 1;                                              
                                                                        
 END LÆS_UDTRAEK;                                                       
 /*********************************************************************/
 /*       LUK CURSOR TIL UDTRÆK                                       */
 /*********************************************************************/
 LUK_UDTRAEK_CURSOR: PROC;                                              
                                                                        
        EXEC SQL CLOSE UDTRAEK_CURSOR;                                  
                                                                        
        IF SQLCODE ^= 0                                                 
        THEN                                                            
           DO;                                                          
             SQLCODE_PIC = SQLCODE;                                     
             ABENDTXT   =  '263 CLOSE UDTRAEK_CURSOR,SQLCODE= '         
                           !! SQLCODE_CH;                               
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
 END LUK_UDTRAEK_CURSOR;                                                
 /*********************************************************************/
 /* LÆS RESULTATSFELTTABEL OG FLYT DATA TIL RESULTATTAB               */
 /*********************************************************************/
 LÆS_RESULTATS_FELTTABEL: PROC;                                         
                                                                        
        CALL DECLARE_RES_FEL_CUR;                                       
                                                                        
        EXEC SQL OPEN RES_FEL_CUR;                                      
                                                                        
        IF SQLCA.SQLCODE ^= 0                                           
        THEN                                                            
           DO;                                                          
             SQLCODE_PIC = SQLCODE;                                     
             ABENDTXT   =  '264 OPEN RES_FEL_CUR,SQLCODE= '             
                         !! SQLCODE_CH;                                 
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
        CALL FETCH_RES_FEL_CUR;                                         
                                                                        
        DO WHILE(SQLCODE = 0);                                          
          EVS_RES_FELT.INDHOLD_C = DCLGENBQ41000T.INDHOLD_C;            
          EVS_RES_FELT.INDHOLD_D = DCLGENBQ41000T.INDHOLD_D;            
          EVS_RES_FELT.FELTKODE  = DCLGENBQ41000T.FELTKODE;             
          CALL FLYT_RES_FEL;                                            
          CALL FETCH_RES_FEL_CUR;                                       
        END;                                                            
                                                                        
        EXEC SQL CLOSE RES_FEL_CUR;                                     
                                                                        
        IF SQLCA.SQLCODE ^= 0                                           
        THEN                                                            
           DO;                                                          
             SQLCODE_PIC = SQLCODE;                                     
             ABENDTXT   =  '265 CLOSE RES_FEL_CUR,SQLCODE= '            
                         !! SQLCODE_CH;                                 
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
 END LÆS_RESULTATS_FELTTABEL;                                           
 /*********************************************************************/
 /* DECLARE CURSOR TIL DCLGENBQ4100T                                  */
 /*********************************************************************/
 DECLARE_RES_FEL_CUR: PROC;                                             
                                                                        
        EXEC SQL                                                        
                                                                        
             DECLARE RES_FEL_CUR CURSOR FOR                             
                                                                        
             SELECT T1.DCPRN,                                           
                    T1.DINDKAAR,                                        
                    T1.EKOMNR,                                          
                    T1.EEJDNR,                                          
                    T1.EENHEDLBNR,                                      
                    T1.ELBNR,                                           
                    T1.EGENNR,                                          
                    T1.FELTKODE,                                        
                    T1.INDHOLD_C,                                       
                    T1.INDHOLD_D                                        
                                                                        
             FROM   BQ41000T T1                                         
                                                                        
             WHERE  T1.DCPRN      = :DCLGENBQ40000T.DCPRN               
             AND    T1.DINDKAAR   = :DCLGENBQ40000T.DINDKAAR            
             AND    T1.EKOMNR     = :DCLGENBQ40000T.EKOMNR              
             AND    T1.EEJDNR     = :DCLGENBQ40000T.EEJDNR              
             AND    T1.EENHEDLBNR = :DCLGENBQ40000T.EENHEDLBNR          
             AND    T1.ELBNR      = :DCLGENBQ40000T.ELBNR               
             AND    T1.EGENNR     = :DCLGENBQ40000T.EGENNR              
                                                                        
             ORDER BY T1.FELTKODE                                       
             FOR FETCH ONLY                                             
        ;                                                               
                                                                        
 END DECLARE_RES_FEL_CUR;                                               
 /*********************************************************************/
 /* FETCH CURSOR TIL DCLGENBQ41000T                                   */
 /*********************************************************************/
 FETCH_RES_FEL_CUR: PROC;                                               
                                                                        
        EXEC SQL                                                        
                                                                        
             FETCH RES_FEL_CUR                                          
                                                                        
             INTO  :DCLGENBQ41000T.DCPRN,                               
                   :DCLGENBQ41000T.DINDKAAR,                            
                   :DCLGENBQ41000T.EKOMNR,                              
                   :DCLGENBQ41000T.EEJDNR,                              
                   :DCLGENBQ41000T.EENHEDLBNR,                          
                   :DCLGENBQ41000T.ELBNR,                               
                   :DCLGENBQ41000T.EGENNR,                              
                   :DCLGENBQ41000T.FELTKODE,                            
                   :DCLGENBQ41000T.INDHOLD_C,                           
                   :DCLGENBQ41000T.INDHOLD_D;                           
                                                                        
        IF SQLCODE ^= 0                                                 
         & SQLCODE ^= 100                                               
        THEN                                                            
           DO;                                                          
             SQLCODE_PIC = SQLCODE;                                     
             ABENDTXT   =  '266 FETCH RES_FEL_CUR,SQLCODE= '            
                         !! SQLCODE_CH;                                 
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
 END FETCH_RES_FEL_CUR;                                                 
 /*********************************************************************/
 /*      DECLARE CURSOR FOR PERSON                                    */
 /*********************************************************************/
 DECLARE_PERSON: PROC;                                                  
                                                                        
       EXEC SQL DECLARE PERSON_CURSOR CURSOR FOR                        
                                                                        
       SELECT  T1.DCPRN                                                 
              ,T1.DINDKAAR                                              
              ,T1.EKOMNR                                                
              ,T1.EEJDNR                                                
              ,T1.EENHEDLBNR                                            
              ,T1.ELBNR                                                 
              ,T1.EGENNR                                                
              ,T1.CDATAFRA                                              
              ,T1.DFRAGLD                                               
              ,T1.DTILGLD                                               
              ,T1.CSCREGISTMP                                           
              ,T1.PERSKOD                                               
              ,T1.MYNDNR                                                
              ,T1.COMPLA                                                
              ,T1.DOMPLACPR                                             
              ,T1.CAJOUR                                                
              ,T1.CSUPPL                                                
              ,T1.FEJLNR                                                
                                                                        
       FROM  BQ30000T T1                                                
       WHERE T1.DINDKAAR    =  :DCLGENBQ40000T.DINDKAAR                 
        AND  T1.DCPRN       =  :DCLGENBQ40000T.DCPRN                    
        AND  T1.EKOMNR      =  :DCLGENBQ40000T.EKOMNR                   
        AND  T1.EEJDNR      =  :DCLGENBQ40000T.EEJDNR                   
        AND  T1.EENHEDLBNR  =  :DCLGENBQ40000T.EENHEDLBNR               
        AND  T1.ELBNR       =  :DCLGENBQ40000T.ELBNR                    
        AND  T1.DFRAGLD     =  :DCLGENBQ40000T.DFRAGLD                  
        FOR FETCH ONLY                                                  
       ;                                                                
                                                                        
 END DECLARE_PERSON;                                                    
 /*********************************************************************/
 /*      SKAF PERSON OPLYSNINGER                                      */
 /*********************************************************************/
 SKAF_PERSON: PROC;                                                     
                                                                        
       EXEC SQL FETCH PERSON_CURSOR                                     
          INTO                                                          
          :DCLGENBQ30000T.DCPRN                                         
         ,:DCLGENBQ30000T.DINDKAAR                                      
         ,:DCLGENBQ30000T.EKOMNR                                        
         ,:DCLGENBQ30000T.EEJDNR                                        
         ,:DCLGENBQ30000T.EENHEDLBNR                                    
         ,:DCLGENBQ30000T.ELBNR                                         
         ,:DCLGENBQ30000T.EGENNR                                        
         ,:DCLGENBQ30000T.CDATAFRA                                      
         ,:DCLGENBQ30000T.DFRAGLD                                       
         ,:DCLGENBQ30000T.DTILGLD                                       
         ,:DCLGENBQ30000T.CSCREGISTMP                                   
         ,:DCLGENBQ30000T.PERSKOD                                       
         ,:DCLGENBQ30000T.MYNDNR                                        
         ,:DCLGENBQ30000T.COMPLA                                        
         ,:DCLGENBQ30000T.DOMPLACPR                                     
         ,:DCLGENBQ30000T.CAJOUR                                        
         ,:DCLGENBQ30000T.CSUPPL                                        
         ,:DCLGENBQ30000T.FEJLNR                                        
       ;                                                                
                                                                        
       IF SQLCODE ^= 0                                                  
        & SQLCODE ^= 100                                                
       THEN                                                             
        DO;                                                             
         SQLCODE_PIC = SQLCODE;                                         
         ABENDTXT   =  '267 FETCH PERSON_CURSOR,SQLCODE= '              
                         !! SQLCODE_CH;                                 
         CALL SQL_FEJL;                                                 
        END;                                                            
                                                                        
        FPERS = FPERS + 1;                                              
 END SKAF_PERSON;                                                       
 /*************************************************************/        
 AABEN_PERSON_CURSOR: PROC;                                             
                                                                        
       EXEC SQL OPEN PERSON_CURSOR;                                     
       IF SQLCODE ^= 0                                                  
       THEN                                                             
        DO;                                                             
         SQLCODE_PIC = SQLCODE;                                         
         ABENDTXT   =  '268 OPEN PERSON_CURSOR,SQLCODE= '               
                         !! SQLCODE_CH;                                 
         CALL SQL_FEJL;                                                 
        END;                                                            
                                                                        
 END AABEN_PERSON_CURSOR;                                               
 /**********************************************************/           
 LUK_PERSON_CURSOR: PROC;                                               
                                                                        
       EXEC SQL CLOSE PERSON_CURSOR;                                    
                                                                        
       IF SQLCODE ^= 0                                                  
       THEN                                                             
        DO;                                                             
         SQLCODE_PIC = SQLCODE;                                         
         ABENDTXT   =  '269 CLOSE PERSON_CURSOR,SQLCODE= '              
                         !! SQLCODE_CH;                                 
         CALL SQL_FEJL;                                                 
        END;                                                            
                                                                        
 END LUK_PERSON_CURSOR;                                                 
 /*********************************************************************/
 /* LÆS EJERSKABSFELTTABEL OG FLYT DATA TIL PERSONTAB                 */
 /*********************************************************************/
 LÆS_EJERSKABS_FELTTABEL: PROC;                                         
                                                                        
       CALL DECLARE_ESK_FEL_CUR;                                        
                                                                        
       EXEC SQL OPEN ESK_FEL_CUR;                                       
                                                                        
       IF SQLCODE ^= 0                                                  
       THEN                                                             
          DO;                                                           
            SQLCODE_PIC = SQLCODE;                                      
            ABENDTXT   =  '270 OPEN ESK_FEL_CUR,SQLCODE= '              
                          !! SQLCODE_CH;                                
            CALL SQL_FEJL;                                              
          END;                                                          
                                                                        
       CALL FETCH_ESK_FEL_CUR;                                          
                                                                        
       DO WHILE(SQLCODE = 0);                                           
          EVS_ESK_FELT.INDHOLD_C = DCLGENBQ31000T.INDHOLD_C;            
          EVS_ESK_FELT.INDHOLD_D = DCLGENBQ31000T.INDHOLD_D;            
          EVS_ESK_FELT.FELTKODE  = DCLGENBQ31000T.FELTKODE;             
          CALL FLYT_ESK_FEL;                                            
          IF EVS_ESK_FELT.FELTKODE = 63                                 
          THEN                                                          
            DO; /* Check med JAM A,B,C værdier ? */                     
              IF SUBSTR(EVS_ESK_FELT.INDHOLD_C,1,1) >= '0' &            
                 SUBSTR(EVS_ESK_FELT.INDHOLD_C,1,1) <= '9'              
              THEN                                                      
                DO;                                                     
                  HJ_PICX = SUBSTR(EVS_ESK_FELT.INDHOLD_C,1,1);         
                  HJ_TX   = HJ_PICX;                                    
                  STATISTIK.CEJBEVS(HJ_TX).ANTAL += 1;                  
                END;                                                    
              IF SUBSTR(EVS_ESK_FELT.INDHOLD_C,1,1) = 'A'               
              THEN                                                      
                STATISTIK.CEJBEVS(10).ANTAL += 1;                       
              IF SUBSTR(EVS_ESK_FELT.INDHOLD_C,1,1) = 'B'               
              THEN                                                      
                STATISTIK.CEJBEVS(11).ANTAL += 1;                       
              IF SUBSTR(EVS_ESK_FELT.INDHOLD_C,1,1) = 'C'               
              THEN                                                      
                STATISTIK.CEJBEVS(12).ANTAL += 1;                       
            END;                                                        
          CALL FETCH_ESK_FEL_CUR;                                       
       END;                                                             
                                                                        
       EXEC SQL CLOSE ESK_FEL_CUR;                                      
                                                                        
       IF SQLCODE ^= 0                                                  
       THEN                                                             
          DO;                                                           
            SQLCODE_PIC = SQLCODE;                                      
            ABENDTXT   =  '271 CLOSE ESK_FEL_CUR,SQLCODE= '             
                          !! SQLCODE_CH;                                
            CALL SQL_FEJL;                                              
          END;                                                          
                                                                        
 END LÆS_EJERSKABS_FELTTABEL;                                           
 /*********************************************************************/
 /* DECLARE CURSOR TIL EVS_ESK_FELT                                   */
 /*********************************************************************/
 DECLARE_ESK_FEL_CUR: PROC;                                             
                                                                        
       EXEC SQL                                                         
                                                                        
            DECLARE ESK_FEL_CUR CURSOR FOR                              
                                                                        
            SELECT T1.DCPRN,                                            
                   T1.DINDKAAR,                                         
                   T1.EKOMNR,                                           
                   T1.EEJDNR,                                           
                   T1.EENHEDLBNR,                                       
                   T1.ELBNR,                                            
                   T1.EGENNR,                                           
                   T1.FELTKODE,                                         
                   T1.INDHOLD_C,                                        
                   T1.INDHOLD_D                                         
                                                                        
            FROM     BQ31000T T1                                        
                                                                        
            WHERE    T1.DCPRN      = :DCLGENBQ30000T.DCPRN              
            AND      T1.DINDKAAR   = :DCLGENBQ30000T.DINDKAAR           
            AND      T1.EKOMNR     = :DCLGENBQ30000T.EKOMNR             
            AND      T1.EEJDNR     = :DCLGENBQ30000T.EEJDNR             
            AND      T1.EENHEDLBNR = :DCLGENBQ30000T.EENHEDLBNR         
            AND      T1.ELBNR      = :DCLGENBQ30000T.ELBNR              
            AND      T1.EGENNR     = :DCLGENBQ30000T.EGENNR             
                                                                        
            ORDER BY T1.FELTKODE                                        
            FOR FETCH ONLY                                              
       ;                                                                
                                                                        
 END DECLARE_ESK_FEL_CUR;                                               
 /*********************************************************************/
 /* FETCH CURSOR TIL EVS_ESK_FELT                                     */
 /*********************************************************************/
 FETCH_ESK_FEL_CUR: PROC;                                               
                                                                        
       EXEC SQL                                                         
                                                                        
            FETCH ESK_FEL_CUR                                           
                                                                        
            INTO  :DCLGENBQ31000T.DCPRN,                                
                  :DCLGENBQ31000T.DINDKAAR,                             
                  :DCLGENBQ31000T.EKOMNR,                               
                  :DCLGENBQ31000T.EEJDNR,                               
                  :DCLGENBQ31000T.EENHEDLBNR,                           
                  :DCLGENBQ31000T.ELBNR,                                
                  :DCLGENBQ31000T.EGENNR,                               
                  :DCLGENBQ31000T.FELTKODE,                             
                  :DCLGENBQ31000T.INDHOLD_C,                            
                  :DCLGENBQ31000T.INDHOLD_D;                            
                                                                        
       IF SQLCODE ^= 0                                                  
        & SQLCODE ^= 100                                                
       THEN                                                             
          DO;                                                           
            SQLCODE_PIC = SQLCODE;                                      
            ABENDTXT   =  '272 FETCH ESK_FEL_CUR,SQLCODE= '             
                        !! SQLCODE_CH;                                  
            CALL SQL_FEJL;                                              
          END;                                                          
                                                                        
 END FETCH_ESK_FEL_CUR;                                                 
 /*********************************************************************/
 /*      DAN UDTRÆK                                                   */
 /*********************************************************************/
 DAN_UDTRAEK: PROC;                                                     
                                                                        
         UDTRAEK_UD = '';                                               
         UDTRAEK    = '';                                               
         UDTRAEK.DCPRN       =   RESULTATTAB.DCPRN;                     
         UDTRAEK.DINDKAAR    =   RESULTATTAB.DINDKAAR ;                 
         UDTRAEK.EKOMNR      =   RESULTATTAB.EKOMNR ;                   
         UDTRAEK.EEJDNR      =   RESULTATTAB.EEJDNR ;                   
         UDTRAEK.ELBNR       =   RESULTATTAB.ELBNR ;                    
         UDTRAEK.EGENNR      =   RESULTATTAB.EGENNR ;                   
         UDTRAEK.CDATAFRA    =   PERSONTAB.CDATAFRA;                    
         UDTRAEK.DFRAGLD     =   RESULTATTAB.DFRAGLD ;                  
         UDTRAEK.DTILGLD     =   PERSONTAB.DTILGLD ;                    
         UDTRAEK.CSCREGISTMP =  PERSONTAB.CSCREGISTMP ;                 
         UDTRAEK.PERSKOD     =  PERSONTAB.PERSKOD   ;                   
         UDTRAEK.UDSKRDTO    =  RESULTATTAB.UDSKRDTO ;                  
         UDTRAEK.MYNDNR      =  PERSONTAB.MYNDNR    ;                   
         UDTRAEK.BEJBOLANV   =  PERSONTAB.BEJBOLANV;                    
         UDTRAEK.CSUPPL      =  PERSONTAB.CSUPPL ;                      
         UDTRAEK.CAJOUR      =  PERSONTAB.CAJOUR ;                      
         UDTRAEK.CÆGTOPR     =  PERSONTAB.CÆGTOPR ;                     
         UDTRAEK.CFRÅR       =  PERSONTAB.CFRÅR  ;                      
         UDTRAEK.CEJBEVS     =  PERSONTAB.CEJBEVS ;                     
         UDTRAEK.CSLET       =  PERSONTAB.CSLET  ;                      
         UDTRAEK.CNULSTIL    =  PERSONTAB.CNULSTIL ;                    
         UDTRAEK.BBERGRL     =  PERSONTAB.BBERGRL;                      
                                                                        
         UDTRAEK.BBERGRL_02ANV =  PERSONTAB.BBERGRL_02ANV;              
                                                                        
         IF RESULTATTAB.EKOMNR = 999                                    
         THEN                                                           
           /*UDTRAEK.BBERGRL_015ANV  =  PERSONTAB.BBERGRLUDL_01+        
                                      PERSONTAB.BOMBTILBUDL_01; */      
           /* 20191204 EBD ret overstående felter er udgået */          
           UDTRAEK.BBERGRL_015ANV  = PERSONTAB.BBERGRL_015ANV;          
         ELSE                                                           
           UDTRAEK.BBERGRL_015ANV  =  PERSONTAB.BBERGRL_015ANV;         
                                                                        
         UDTRAEK.BBER2FAM_02ANV  =  PERSONTAB.BBER2FAM_02ANV;           
         UDTRAEK.BBER2FAM_015ANV =  PERSONTAB.BBER2FAM_015ANV;          
                                                                        
         UDTRAEK.CEJDTYPE    =  PERSONTAB.CEJDTYPE_AKT;                 
                                                                        
         IF INDK_EJERSK.BGRPROM1_I = 0                                  
         THEN                                                           
           UDTRAEK.BGRPROM1    =  PERSONTAB.BGRPROM1;                   
         ELSE                                                           
           UDTRAEK.BGRPROM1    =  0;                                    
         UDTRAEK.BPROM1      =  PERSONTAB.BPROM1;                       
         IF INDK_EJERSK.BGRPROM2_I = 0                                  
         THEN                                                           
           UDTRAEK.BGRPROM2    =  PERSONTAB.BGRPROM2;                   
         ELSE                                                           
           UDTRAEK.BGRPROM2    =  0;                                    
         UDTRAEK.BPROM2      =  PERSONTAB.BPROM2   ;                    
         UDTRAEK.CNEDSL1     =  PERSONTAB.CNEDSL1  ;                    
         UDTRAEK.BNEDSL1     =  PERSONTAB.BNEDSL1  ;                    
         UDTRAEK.BNEDSL2   =    PERSONTAB.BNEDSL2  ;                    
         UDTRAEK.CSKPLOMF  =    PERSONTAB.CSKPLOMF ;                    
         UDTRAEK.FELT759   =  PERSONTAB.FELT759    ;                    
         UDTRAEK.BPENSNED  =  PERSONTAB.BPENSNED   ;                    
         UDTRAEK.BPENSNÆ   =  PERSONTAB.BPENSNÆ    ;                    
         UDTRAEK.BPENSRED  =  RESULTATTAB.BPENSRED ;                    
         UDTRAEK.BSTIBGR   =  PERSONTAB.BSTIBEGR    ;                   
         UDTRAEK.CSTIBLB   =  PERSONTAB.CSTIBLB    ;                    
         UDTRAEK.BSTITIL   =  PERSONTAB.BSTITIL    ;                    
         UDTRAEK.BUDLSKC   =  PERSONTAB.BUDLSKC    ;                    
         UDTRAEK.CEKSEMP   =  PERSONTAB.CEKSEMP    ;                    
         UDTRAEK.DATO0107  =  PERSONTAB.DATO0107   ;                    
         UDTRAEK.DOVTG     =  PERSONTAB.DOVTG      ;                    
         UDTRAEK.DAFSTAA   =  PERSONTAB.DAFSTAA    ;                    
         IF INDK_EJERSK.GPCTEJER_I = 0                                  
         THEN                                                           
           UDTRAEK.GPCTEJER    =  PERSONTAB.GPCTEJER;                   
         ELSE                                                           
           UDTRAEK.GPCTEJER    =  0;                                    
         UDTRAEK.FDAGUDLE  =  PERSONTAB.FDAGUDLE   ;                    
         UDTRAEK.GPCTUDLE  =  PERSONTAB.GPCTUDLE   ;                    
         UDTRAEK.FUDL100   =  PERSONTAB.FUDL100    ;                    
         UDTRAEK.FDAGERHV  =  PERSONTAB.FDAGERHV   ;                    
         UDTRAEK.GPCTERHV  =  PERSONTAB.GPCTERHV   ;                    
         UDTRAEK.FERHVFLER =  PERSONTAB.FERHVFLER  ;                    
         UDTRAEK.CUDLMAN   =  PERSONTAB.CUDLMAN    ;                    
         UDTRAEK.CUDLHEL   =  PERSONTAB.CUDLHEL    ;                    
         UDTRAEK.CUDLDEL   =  PERSONTAB.CUDLDEL    ;                    
         UDTRAEK.CERHV     =  PERSONTAB.CERHV      ;                    
         UDTRAEK.BSUM1     =  PERSONTAB.BSUM1      ;                    
         UDTRAEK.BSUM2     =  PERSONTAB.BSUM2      ;                    
         UDTRAEK.BNETTO    =  PERSONTAB.BNETTO     ;                    
         IF INDK_EVS_RES.BEJERAN_I = 0                                  
         THEN                                                           
            UDTRAEK.BEJERAN = RESULTATTAB.BEJERAN;                      
         ELSE                                                           
            UDTRAEK.BEJERAN = 0;                                        
                                                                        
         FEJENDOMSVÆRDISKAT = FEJENDOMSVÆRDISKAT+UDTRAEK.BEJERAN;       
                                                                        
         IF INDK_EJERSK.BEVSMAN_I = 0                                   
         THEN                                                           
           UDTRAEK.BEVSMAN   =  PERSONTAB.BEVSMAN;                      
         ELSE                                                           
           UDTRAEK.BEVSMAN   = 0;                                       
                                                                        
         UDTRAEK.BMANEVSSTI = PERSONTAB.BMANEVSSTI;                     
         UDTRAEK.MANPENSSTI  = PERSONTAB.MANPENSSTI ;                   
                                                                        
         UDTRAEK.BMANNEDSL   = PERSONTAB.BMANNEDSL ;                    
         UDTRAEK.FEJLNR      = PERSONTAB.FEJLNR    ;                    
                                                                        
         IF PERSONTAB.FEJLNR > '0000'                                   
         THEN                                                           
            FFEJL = FFEJL + 1;                                          
                                                                        
         IF INDK_EJERSK.BBER2FAM_I = 0                                  
         THEN                                                           
           UDTRAEK.BBER2FAM   = PERSONTAB.BBER2FAM;                     
         ELSE                                                           
           UDTRAEK.BBER2FAM   = 0;                                      
                                                                        
         UDTRAEK.BEJBOL1    = PERSONTAB.BEJBOL1;                        
         UDTRAEK.BEJBOL2    = PERSONTAB.BEJBOL2;                        
         UDTRAEK.CANVEBOL   = PERSONTAB.CANVEBOL ;                      
         UDTRAEK.FELT760    = PERSONTAB.FELT760 ;                       
         UDTRAEK.CELØNCOR   = PERSONTAB.CELØNCOR ;                      
         UDTRAEK.CENKE      = PERSONTAB.CENKE  ;                        
         UDTRAEK.CPTYPGL    = PERSONTAB.CPTYPGL ;                       
         UDTRAEK.CPTYPSLUT  = PERSONTAB.CPTYPSLUT;                      
         IF INDK_EJERSK.BFORSKAT_I = 0                                  
         THEN                                                           
           UDTRAEK.BFORSKAT  = PERSONTAB.BFORSKAT;                      
         ELSE                                                           
           UDTRAEK.BFORSKAT  = 0;                                       
         UDTRAEK.CFORSKAT    = PERSONTAB.CFORSKAT   ;                   
         UDTRAEK.DOVTGFOR    = PERSONTAB.DOVTGFOR   ;                   
         UDTRAEK.DAFSTAAFOR  = PERSONTAB.DAFSTAAFOR ;                   
         UDTRAEK.GPCTEJERFOR = PERSONTAB.GPCTEJERFOR ;                  
         UDTRAEK.BFSKAT      = PERSONTAB.BFSKAT     ;                   
         UDTRAEK.BERHVAN     = PERSONTAB.BERHVAN    ;                   
         UDTRAEK.BPRIVAN     = PERSONTAB.BPRIVAN    ;                   
         IF INDK_EJERSK.BPENSNEDGL_I = 0                                
         THEN                                                           
           UDTRAEK.BPENSNEDGL  = PERSONTAB.BPENSNEDGL;                  
         ELSE                                                           
           UDTRAEK.BPENSNEDGL  = 0;                                     
         UDTRAEK.BEVSGL      = PERSONTAB.BEVSGL     ;                   
         IF INDK_EJERSK.BEVSGL_I = 0                                    
         THEN                                                           
           UDTRAEK.BEVSGL = PERSONTAB.BEVSGL;                           
         ELSE                                                           
           UDTRAEK.BEVSGL = 0;                                          
         UDTRAEK.CIVILSTAND  = PERSONTAB.CIVILSTAND ;                   
         IF INDK_EVS_RES.BPENSIND_I = 0                                 
         THEN                                                           
           UDTRAEK.BPENSIND    = RESULTATTAB.BPENSIND;                  
         ELSE                                                           
           UDTRAEK.BPENSIND    = 0;                                     
         UDTRAEK.COMPLA      = RESULTATTAB.COMPLA ;                     
         UDTRAEK.DOMPLACPR   = RESULTATTAB.DOMPLACPR;                   
         UDTRAEK.BSUM3       = PERSONTAB.BSUM3         ;                
         UDTRAEK.BGLSUM1     = PERSONTAB.BGLSUM1       ;                
         UDTRAEK.DINDFLYT    = PERSONTAB.DINDFLYT      ;                
         UDTRAEK.DFRAFLYT    = PERSONTAB.DFRAFLYT      ;                
         UDTRAEK.FUBEBOELIG  = PERSONTAB.FUBEBOELIG    ;                
         UDTRAEK.CINDFLYT    = PERSONTAB.CINDFLYT      ;                
         UDTRAEK.BFASTSTIGBGR = PERSONTAB.BFASTSTIGBGR  ;               
         UDTRAEK.CBERGRGLOP  = PERSONTAB.CBERGRGLOP    ;                
         UDTRAEK.BBER2FAM_AKT = PERSONTAB.BBER2FAM_AKT  ;               
         UDTRAEK.BBERGRL_AKT = PERSONTAB.BBERGRL_AKT   ;                
                                                                        
 END DAN_UDTRAEK;                                                       
 /*********************************************************************/
 /*      SKRIV UDTRÆK                                                 */
 /*********************************************************************/
 SKRIV_UDTRAEK: PROC;                                                   
         WRITE FILE (BQ300O) FROM (UDTRAEK_UD);                         
         FSKRIV  = FSKRIV + 1;                                          
 END SKRIV_UDTRAEK;                                                     
 /******************************************************************/   
 OVERFØR_DATA_PER: PROC;                                                
                                                                        
       PERSONTAB.CDATAFRA      =   DCLGENBQ30000T.CDATAFRA;             
       PERSONTAB.DTILGLD       =   DCLGENBQ30000T.DTILGLD;              
       PERSONTAB.CSCREGISTMP   =   DCLGENBQ30000T.CSCREGISTMP;          
       PERSONTAB.PERSKOD       =   DCLGENBQ30000T.PERSKOD;              
       PERSONTAB.MYNDNR        =   DCLGENBQ30000T.MYNDNR;               
       PERSONTAB.CAJOUR        =   DCLGENBQ30000T.CAJOUR;               
       PERSONTAB.CSUPPL        =   DCLGENBQ30000T.CSUPPL;               
       PERSONTAB.FEJLNR        =   DCLGENBQ30000T.FEJLNR;               
                                                                        
 END OVERFØR_DATA_PER;                                                  
 /******************************************************************/   
 OVERFØR_DATA_RES: PROC;                                                
                                                                        
       RESULTATTAB.DCPRN       =   DCLGENBQ40000T.DCPRN  ;              
       RESULTATTAB.DINDKAAR    =   DCLGENBQ40000T.DINDKAAR;             
       RESULTATTAB.EKOMNR      =   DCLGENBQ40000T.EKOMNR  ;             
       RESULTATTAB.EEJDNR      =   DCLGENBQ40000T.EEJDNR  ;             
       RESULTATTAB.EENHEDLBNR  =   DCLGENBQ40000T.EENHEDLBNR;           
       RESULTATTAB.ELBNR       =   DCLGENBQ40000T.ELBNR   ;             
       RESULTATTAB.EGENNR      =   DCLGENBQ40000T.EGENNR  ;             
       RESULTATTAB.DFRAGLD     =   DCLGENBQ40000T.DFRAGLD ;             
       RESULTATTAB.UDSKRDTO    =   DCLGENBQ40000T.UDSKRDTO;             
       RESULTATTAB.COMPLA      =   DCLGENBQ40000T.COMPLA;               
       RESULTATTAB.DOMPLACPR   =   DCLGENBQ40000T.DOMPLACPR;            
                                                                        
 END OVERFØR_DATA_RES;                                                  
 /*********************************************************************/
 /*      UDSKRIV KONTROLLISTE                                         */
 /*********************************************************************/
 UDSKRIV_KONTROLLISTE: PROC;                                            
                                                                        
 DCL     I               BIN FIXED(31);                                 
 DCL     HJ_PIC1         PIC       '9';                                 
 DCL     HJ_PIC8         PIC       'ZZZZZZZ9';                          
                                                                        
                                                                        
         LINIE      = ASAK1 !! ' ';                                     
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' BQ30000L            ' !!                         
                      'LISTE OVER OPTÆLLINGSTOTALER   ' !!              
                      'UDSKREVET DEN ' !! UDSKRDT;                      
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' ANTAL LÆSTE -  BQ40000T.......: ' !! FSKAF;      
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' ANTAL LÆSTE -  BQ30000T.......: ' !! FPERS;      
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' ANTAL SKREVNE - BQ30000D......: ' !! FSKRIV;     
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' ANTAL RÆKKER MED FEJL.........: ' !! FFEJL;      
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' ANTAL PERSONER MED EJERFORHOLD: ' !! FPERSON;    
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' ANTAL EJERFORHOLD.............: ' !!             
         FEJERFORHOLD;                                                  
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = ' SAMLET EJENDOMSVÆRDISKAT......: ' !!             
         FEJENDOMSVÆRDISKAT;                                            
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         LINIE      = '';                                               
         LIN.CC1   = ASAS2;                                             
         LIN.TEKST = 'FORDELING OVER CEJBEVS: ';                        
         CALL ZZ20300(LINIE,'02');                                      
                                                                        
         DO I = 0 TO 9;                                                 
           HJ_PIC1 = I;                                                 
           HJ_PIC8 = STATISTIK.CEJBEVS(I).ANTAL;                        
           LINIE      = '';                                             
           LIN.CC1   = ASAS2;                                           
           LIN.TEKST = '  CEJBEVS...' !! HJ_PIC1 !! '..ANTAL.....' !!   
                       HJ_PIC8;                                         
           CALL ZZ20300(LINIE,'02');                                    
         END;                                                           
                                                                        
         DO I = 10 TO 12;                                               
           SELECT(I);                                                   
             WHEN(10)                                                   
               HJ_CHAR1 = 'A';                                          
             WHEN(11)                                                   
               HJ_CHAR1 = 'B';                                          
             WHEN(12)                                                   
               HJ_CHAR1 = 'C';                                          
              OTHER;                                                    
           END; /*SELECT */                                             
           HJ_PIC1 = I;                                                 
           HJ_PIC8 = STATISTIK.CEJBEVS(I).ANTAL;                        
           LINIE      = '';                                             
           LIN.CC1   = ASAS2;                                           
           LIN.TEKST = '  CEJBEVS...' !! HJ_CHAR1 !! '..ANTAL.....' !!  
                       HJ_PIC8;                                         
           CALL ZZ20300(LINIE,'02');                                    
         END;                                                           
                                                                        
 END UDSKRIV_KONTROLLISTE;                                              
 /*********************************************************************/
 /*      LUK DIVERSE FILER                                            */
 /*********************************************************************/
 LUK_FILER: PROC;                                                       
         CLOSE FILE(BQ300O);                                            
         CALL ZZ20300(LINIE,'99');                                      
 END LUK_FILER;                                                         
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
        CALL ZS67000(SQLCA);                                            
        ABENDFILL1  = ' ';                                              
        ABENDFILL2  = ' ';                                              
        ABENDMODUL   = 'BQ30000';                                       
        ABENDMEDNR   = '**';                                            
        CALL ZS30101(5,ABENDMEDD,2);                                    
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /*      MACROER                                                      */
 /*********************************************************************/
         %INCLUDE BQ23020M;  /*#01*/     /* FLYT_ESK_FEL              */
         %INCLUDE BQ23016M;  /*#01*/     /* FLYT_RES_FEL              */
                                                                        
 END BQ30000;                                                           
