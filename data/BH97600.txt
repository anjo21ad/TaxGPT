  PROCESS OPT(TIME);                                                    
 BH97600: /* OPDATER EVS 2006 MED MANGLENDE DATA FRA EVS 2005        */ 
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /**********************************************************************
 *                                                                     *
 * FORMÅL : OPDATER EVS 2006 MED MANGLENDE DATA FRA EVS 2005           *
 *                                                                     *
 * UPDATE : BQ2X000T+BQ3X000T - EVS SLUT TABELLER                      *
 *                                                                     *
 * OUTPUT : D0311603.A782     - EVS DATA TIL SLUT PÅ CSC               *
 *          BH97601Y   KØRSELSKONTROLLISTE                             *
 *                                                                     *
 * PROGRAMMØR: BO SCHMIDT      MAJ       2007                          *
 *                                                                     *
 **********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
                                                                        
         DCL COPYRIGHT   CHAR      (30) STATIC                          
         INIT ('COPYRIGHT KOMMUNEDATA I/S 2007');                       
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL     SYSPRINT EXTERNAL FILE PRINT;                                  
 DCL     BH976O FILE RECORD OUTPUT;                                     
                                                                        
 /*********************************************************************/
 /* DECLARE AF DB2                                                    */
 /*********************************************************************/
                                                                        
         EXEC SQL INCLUDE SQLCA;         /* SQL KOMMUNIKATIONSAREAL   */
         EXEC SQL INCLUDE BQ30000T;      /* EVS SLUT EJERSKABSTABEL   */
         EXEC SQL INCLUDE XT90000T;      /* ESR KONVERTER TABEL       */
         EXEC SQL INCLUDE XT99800T;      /* ESR KONVERTER TABEL       */
                                                                        
 /********************************************************************* 
 *       DECLARE AF OUTPUT HERUNDER EVT. TEST IND-/UDDATA             * 
 *********************************************************************/ 
                                                                        
 DCL     1 UDTRAEK,                                                     
           2 DCPRN        DEC FIXED (11),                               
           2 EKOMNR_NY    BIN FIXED (15),                               
           2 EEJDNR_NY    BIN FIXED (31),                               
           2 ELBNR_NY     BIN FIXED (15),                               
           2 EKOMNR_GL    BIN FIXED (15),                               
           2 EEJDNR_GL    BIN FIXED (31);                               
                                                                        
 DCL     1 BH976,                                                       
           %INCLUDE BQ06002N;;                                          
                                                                        
 DCL     1 AREAL_2005 ALIGNED,                                          
           %INCLUDE BQ05010N;                                           
                                                                        
 DCL     1 IND_2005 ALIGNED,                                            
           %INCLUDE BQ05011N;;                                          
                                                                        
 DCL     1 AREAL_2006 ALIGNED,                                          
           %INCLUDE BQ06010N;                                           
                                                                        
 DCL     1 IND_2006 ALIGNED,                                            
           %INCLUDE BQ06011N;;                                          
                                                                        
 DCL     1 UD_2006 ALIGNED,                                             
           %INCLUDE BQ06011N;;                                          
                                                                        
 DCL     1 BQ06907N,                                                    
           %INCLUDE BQ06907N;;             /* BEREGN EVS KMD DEL      */
                                                                        
 DCL 1 FELTER_2005,                                                     
       5 DCPRN          DEC FIXED (11), /* PERSONNUMMER              */ 
       5 DINDKAAR       BIN FIXED (15), /* INDKOMSTÅR                */ 
       5 EKOMNR         BIN FIXED (15), /* KOMMUNENUMMER             */ 
       5 EEJDNR         BIN FIXED (31), /* EJENDOMSNUMMER            */ 
       5 ELBNR          BIN FIXED (15), /* LØBENUMMER                */ 
       5 EGENNR         BIN FIXED (15), /* GENERATIONSNUMMER         */ 
       5 TYPE           BIN FIXED (15), /* TYPE                      */ 
       5 STATUS         BIN FIXED (15), /* STATUS                    */ 
       5 RETURKODE      BIN FIXED (15), /* RETURKODE                 */ 
       5 RETURTEKST     CHAR      (70), /* RETURTEKST                */ 
       5 FEJLNR         PIC     '9999', /* FEJLNR                    */ 
       5 FEJLTEKST      CHAR      (70); /* FEJLTEKST                 */ 
                                                                        
 DCL 1 FELTER_2006,                                                     
       5 DCPRN          DEC FIXED (11), /* PERSONNUMMER              */ 
       5 DINDKAAR       BIN FIXED (15), /* INDKOMSTÅR                */ 
       5 EKOMNR         BIN FIXED (15), /* KOMMUNENUMMER             */ 
       5 EEJDNR         BIN FIXED (31), /* EJENDOMSNUMMER            */ 
       5 ELBNR          BIN FIXED (15), /* LØBENUMMER                */ 
       5 EGENNR         BIN FIXED (15), /* GENERATIONSNUMMER         */ 
       5 TYPE           BIN FIXED (15), /* TYPE                      */ 
       5 STATUS         BIN FIXED (15), /* STATUS                    */ 
       5 RETURKODE      BIN FIXED (15), /* RETURKODE                 */ 
       5 RETURTEKST     CHAR      (70), /* RETURTEKST                */ 
       5 FEJLNR         PIC     '9999', /* FEJLNR                    */ 
       5 FEJLTEKST      CHAR      (70); /* FEJLTEKST                 */ 
                                                                        
 /********************************************************************* 
 *       DECLARE AF BUILTIN'S                                         * 
 *********************************************************************/ 
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     SUBSTR          BUILTIN;                                       
 DCL     BQ05110         ENTRY;                                         
 DCL     BQ06110         ENTRY;                                         
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS67000         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    LIN_DEB          CHAR      (133);                               
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH97600L'),                                        
           2 F1          CHAR      (25)      INIT      (' '),           
           2 TEKST2      CHAR      (57)      INIT      (                
           'OPDATER EVS 2006 MED MANGLENDE DATA FRA EVS 2005'),         
           2 F2          CHAR      (12)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZZ',                       
           2 F2          CHAR      (61)      INIT      (' ');           
 DCL     1 LIN3,                                                        
          2 CTL          CHAR      (1),                                 
          2 F1           CHAR      (2)       INIT      (' '),           
          2 TEKST        CHAR      (52),                                
          2 ANT          PIC       'ZZZ.ZZZ.ZZZ.ZZZ.ZZ9',               
          2 REST         CHAR      (59)      INIT      (' ');           
 DCL     1 LIN_BLANK,                                                   
          2 CTL          CHAR      (1),                                 
          2 F1           CHAR      (132)     INIT      (' ');           
         % INCLUDE ZZ20301M;                                            
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
                                                                        
 DCL     FEJLTEKST       CHAR (20)        INIT(' ');                    
 DCL     ABENDMEDD       CHAR (56)        INIT(' ');                    
 DCL     FETCH_SQLKODE   FIXED BIN (15)   INIT(0);                      
                                                                        
 DCL     SKAL_ÆNDRES     BIT       (1);                                 
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
                                                                        
 DCL     TV_LÆS_UDTRAEK  FIXED     (7)       INIT      (0);             
 DCL     TV_LÆS_EVS_2005 FIXED     (7)       INIT      (0);             
 DCL     TV_LÆS_EVS_2006 FIXED     (7)       INIT      (0);             
 DCL     TV_ÆNDR_NEDSL   FIXED     (7)       INIT      (0);             
 DCL     TV_ÆNDR_FAST    FIXED     (7)       INIT      (0);             
 DCL     TV_ÆNDR_STIG    FIXED     (7)       INIT      (0);             
 DCL     TV_SKRIV_EVS    FIXED     (7)       INIT      (0);             
 DCL     TV_SKREVET      FIXED     (7)       INIT      (0);             
                                                                        
 DCL     UDDATO          CHAR      (10);                                
                                                                        
 DCL     DATO1           CHAR      (26);                                
 DCL     HJ_TIMESTAMP    CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
                                                                        
 DCL     HJ_EKOMNR_EEJDNR_CH     CHAR(10);                              
 DCL     1 HJ_EKOMNR_EEJDNR_DEF  BASED(ADDR(HJ_EKOMNR_EEJDNR_CH)),      
           2 EKOMNR_PIC           PIC '999',                            
           2 EEJDNR_PIC           PIC '9999999';                        
                                                                        
 DCL     HJ_CHAR1        CHAR      (1);                                 
 DCL     HJ_PIC1         PIC       '9'     BASED(ADDR(HJ_CHAR1));       
 DCL     HJ_CHAR2        CHAR      (2);                                 
 DCL     HJ_PIC2         PIC       '99'    BASED(ADDR(HJ_CHAR2));       
 DCL     HJ_CHAR3        CHAR      (3);                                 
 DCL     HJ_PIC3         PIC       '999'   BASED(ADDR(HJ_CHAR3));       
 DCL     HJ_CHAR4        CHAR      (4);                                 
 DCL     HJ_PIC4         PIC       '(4)9'  BASED(ADDR(HJ_CHAR4));       
 DCL     HJ_CHAR7        CHAR      (7);                                 
 DCL     HJ_PIC7         PIC       '(7)9'  BASED(ADDR(HJ_CHAR7));       
                                                                        
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
               ON ERROR SYSTEM;                                         
               PUT SKIP LIST ('PROGRAMFEJL');                           
               CALL PLIDUMP  ('SNHOB','MODUL BH97600');                 
            END;                                                        
                                                                        
         CALL ZZ20390 ('*OPEN','BH97601Y');                             
                                                                        
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         OVERLIN1.DATO  = UDDATO;                                       
                                                                        
         SIDELIN.CCA    = ZZIK1;                                        
         OVERLIN1.CCA   = ZZWS2;                                        
         OVERLIN2.CCA   = ZZWS3;                                        
                                                                        
         OPEN FILE (BH976O) TITLE ('BH97600O');                         
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL DECLARE_CURSOR;                                           
         CALL OPEN_UDTRÆK;                                              
         CALL FETCH_UDTRÆK;                                             
                                                                        
         DO WHILE (FETCH_SQLKODE = 0);                                  
           CALL BEHANDL_PERSON;                                         
           CALL FETCH_UDTRÆK;                                           
         END;                                                           
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /********************************************************************* 
 *       PERSONER SOM EVT. SKAL REPARERES                             * 
 *********************************************************************/ 
 BEHANDL_PERSON:                                                        
         PROC;                                                          
                                                                        
         IND_2005.PERSON = '';                                          
         IND_2005.EJENDOM = '';                                         
         IND_2005.INDK_PERS = -1;                                       
         IND_2005.INDK_EJD = -1;                                        
                                                                        
         FELTER_2005.DCPRN     = UDTRAEK.DCPRN;                         
         FELTER_2005.DINDKAAR  = 2005;                                  
         FELTER_2005.EKOMNR    = UDTRAEK.EKOMNR_GL;                     
         FELTER_2005.EEJDNR    = UDTRAEK.EEJDNR_GL;                     
         FELTER_2005.ELBNR     = 0;                                     
         FELTER_2005.TYPE      = 0;                                     
         FELTER_2005.RETURKODE = 0;                                     
                                                                        
         CALL DATA_MODUL_2005('LÆS');                                   
                                                                        
         IND_2006.PERSON = '';                                          
         IND_2006.EJENDOM = '';                                         
         IND_2006.INDK_PERS = -1;                                       
         IND_2006.INDK_EJD = -1;                                        
                                                                        
         FELTER_2006.DCPRN     = UDTRAEK.DCPRN;                         
         FELTER_2006.DINDKAAR  = 2006;                                  
         FELTER_2006.EKOMNR    = UDTRAEK.EKOMNR_NY;                     
         FELTER_2006.EEJDNR    = UDTRAEK.EEJDNR_NY;                     
         FELTER_2006.ELBNR     = UDTRAEK.ELBNR_NY;                      
         FELTER_2006.TYPE      = 0;                                     
         FELTER_2006.RETURKODE = 0;                                     
                                                                        
         CALL DATA_MODUL_2006('LÆS');                                   
                                                                        
         IF FELTER_2005.RETURKODE = 0                                   
          & FELTER_2006.RETURKODE = 0                                   
         THEN                                                           
            DO;                                                         
              CALL REPARER_PERSON;                                      
            END;                                                        
                                                                        
 END BEHANDL_PERSON;                                                    
 /********************************************************************* 
 *       REPARER PERSONEN HVIS DEN SKAL REPARERES                     * 
 *********************************************************************/ 
 REPARER_PERSON:                                                        
         PROC;                                                          
                                                                        
         SKAL_ÆNDRES = NEJ;                                             
                                                                        
         UD_2006 = IND_2006, BY NAME;                                   
                                                                        
         IF IND_2005.PERSON.CNEDSL1 < '30'                              
          & IND_2006.PERSON.CNEDSL1 > '30'                              
         THEN                                                           
            SKAL_ÆNDRES = JA;                                           
                                                                        
         IF IND_2005.INDK_PERS.BFASTSTIGBGR_I = 0                       
          & IND_2006.INDK_PERS.BFASTSTIGBGR_I = -1                      
         THEN                                                           
            SKAL_ÆNDRES = JA;                                           
                                                                        
         IF IND_2005.INDK_PERS.MANNEDSLSTI_I = 0                        
          & IND_2006.INDK_PERS.BFASTSTIGBGR_I = -1                      
         THEN                                                           
            SKAL_ÆNDRES = JA;                                           
                                                                        
         IF IND_2006.PERSON.CSLET = '1'                                 
         THEN                                                           
            SKAL_ÆNDRES = NEJ;                                          
         ELSE                                                           
            DO;                                                         
              CALL FLYT_2005_TIL_2006;                                  
              CALL BEREGN_EVS;                                          
            END;                                                        
                                                                        
         IF UD_2006.INDK_PERS.BSTIBEGR_I = 0                            
         THEN                                                           
            DO;                                                         
              SKAL_ÆNDRES = JA;                                         
              TV_ÆNDR_STIG = TV_ÆNDR_STIG + 1;                          
            END;                                                        
                                                                        
         IF SKAL_ÆNDRES = JA                                            
         THEN                                                           
            DO;                                                         
              FELTER_2006.DCPRN     = UDTRAEK.DCPRN;                    
              FELTER_2006.DINDKAAR  = 2006;                             
              FELTER_2006.EKOMNR    = UDTRAEK.EKOMNR_NY;                
              FELTER_2006.EEJDNR    = UDTRAEK.EEJDNR_NY;                
              FELTER_2006.ELBNR     = UDTRAEK.ELBNR_NY;                 
              FELTER_2006.TYPE      = 0;                                
              FELTER_2006.RETURKODE = 0;                                
                                                                        
              UD_2006.PERSON.CAJOUR = '1';                              
                                                                        
              CALL DATA_MODUL_2006('SKRIV');                            
                                                                        
              CALL DAN_DATA_TIL_SLUT;                                   
                                                                        
              WRITE FILE (BH976O) FROM (BH976);                         
              TV_SKREVET = TV_SKREVET + 1;                              
            END;                                                        
                                                                        
 END REPARER_PERSON;                                                    
 /**********************************************************************
 **     DATA_MODUL 2005                                               **
 **********************************************************************/
 DATA_MODUL_2005: PROC (FUNKTION);                                      
                                                                        
         DCL FUNKTION    CHAR (10);                                     
                                                                        
         AREAL_2005.KOMM        = '';                                   
         AREAL_2005.SØG         = '';                                   
         AREAL_2005.SØG.DCPRN   = FELTER_2005.DCPRN;                    
         AREAL_2005.SØG.DINDKAAR = FELTER_2005.DINDKAAR;                
         AREAL_2005.SØG.EKOMNR  = FELTER_2005.EKOMNR;                   
         AREAL_2005.SØG.EEJDNR  = FELTER_2005.EEJDNR;                   
         AREAL_2005.SØG.ELBNR   = FELTER_2005.ELBNR;                    
         AREAL_2005.KOMM.TYPE   = FELTER_2005.TYPE;                     
                                                                        
         SELECT (FUNKTION);                                             
                                                                        
            WHEN ('LÆS')                                                
              DO;                                                       
                AREAL_2005.FUNKTION = 1;                                
                CALL BQ05110 (AREAL_2005,IND_2005);                     
                TV_LÆS_EVS_2005 = TV_LÆS_EVS_2005 + 1;                  
              END;                                                      
                                                                        
            OTHER                                                       
              PUT SKIP LIST ('BQ05110 DATAMODUL FORKERT FUNKTION'!!     
                                                        FUNKTION);      
         END; /*SELECT (FUNKTION)*/                                     
                                                                        
         FELTER_2005.RETURKODE  = AREAL_2005.RETURKODE;                 
         FELTER_2005.RETURTEKST = AREAL_2005.RETURTEKST;                
         FELTER_2005.FEJLTEKST  = AREAL_2005.RETURTEKST;                
                                                                        
 END DATA_MODUL_2005;                                                   
 /**********************************************************************
 **     DATA_MODUL 2006                                               **
 **********************************************************************/
 DATA_MODUL_2006: PROC (FUNKTION);                                      
                                                                        
         DCL FUNKTION    CHAR (10);                                     
                                                                        
         AREAL_2006.KOMM        = '';                                   
         AREAL_2006.SØG         = '';                                   
         AREAL_2006.SØG.DCPRN   = FELTER_2006.DCPRN;                    
         AREAL_2006.SØG.DINDKAAR = FELTER_2006.DINDKAAR;                
         AREAL_2006.SØG.EKOMNR  = FELTER_2006.EKOMNR;                   
         AREAL_2006.SØG.EEJDNR  = FELTER_2006.EEJDNR;                   
         AREAL_2006.SØG.ELBNR   = FELTER_2006.ELBNR;                    
         AREAL_2006.KOMM.TYPE   = FELTER_2006.TYPE;                     
                                                                        
         SELECT (FUNKTION);                                             
                                                                        
            WHEN ('LÆS')                                                
              DO;                                                       
                AREAL_2006.FUNKTION = 1;                                
                CALL BQ06110 (AREAL_2006,IND_2006);                     
                TV_LÆS_EVS_2006 = TV_LÆS_EVS_2006 + 1;                  
              END;                                                      
                                                                        
            WHEN ('SKRIV')                                              
              DO;                                                       
                AREAL_2006.FUNKTION = 2;                                
                CALL BQ06110 (AREAL_2006,UD_2006);                      
                TV_SKRIV_EVS = TV_SKRIV_EVS + 1;                        
              END;                                                      
                                                                        
            OTHER                                                       
              PUT SKIP LIST ('BQ06110 DATAMODUL FORKERT FUNKTION'!!     
                                                        FUNKTION);      
         END; /*SELECT (FUNKTION)*/                                     
                                                                        
         FELTER_2006.RETURKODE  = AREAL_2006.RETURKODE;                 
         FELTER_2006.RETURTEKST = AREAL_2006.RETURTEKST;                
         FELTER_2006.FEJLTEKST  = AREAL_2006.RETURTEKST;                
                                                                        
 END DATA_MODUL_2006;                                                   
 /*********************************************************************/
 /* DECLARE CURSOR TIL LÆS AF UDTRÆK                                  */
 /*********************************************************************/
 DECLARE_CURSOR: PROC;                                                  
                                                                        
         EXEC SQL                                                       
         DECLARE UDTRAEK_CUR CURSOR FOR                                 
                                                                        
         SELECT T1.DCPRN,                                               
                T4.NY_KOMMUNENUMMER,                                    
                T4.NY_EJENDOMSNR,                                       
                T2.ELBNR,                                               
                T1.EKOMNR,                                              
                T1.EEJDNR                                               
         FROM BQ30000T T1,                                              
              BQ30000T T2,                                              
              XT90000T T3,                                              
              XT99800T T4                                               
         WHERE T1.DINDKAAR = 2005                                       
          AND  T2.DINDKAAR = 2006                                       
          AND  T1.DTILGLD  = '9999-12-31-23.59.59.999999'               
          AND  T2.DTILGLD  = '9999-12-31-23.59.59.999999'               
          AND  T2.DCPRN    = T1.DCPRN                                   
          AND  T1.EKOMNR   = T3.GL_KOMMUNENUMMER                        
          AND  T3.GL_FIKT_KOMMUNENR = T4.GL_KOMMUNENUMMER               
          AND  T1.EKOMNR  ^= T4.GL_KOMMUNENUMMER                        
          AND  T1.EEJDNR   = T4.GL_EJENDOMSNR                           
          AND  T2.EKOMNR   = T4.NY_KOMMUNENUMMER                        
          AND  T2.EEJDNR   = T4.NY_EJENDOMSNR                           
          AND  T2.DCPRN NOT IN                                          
                 (SELECT T5.DCPRN                                       
                  FROM BQ30000T T5                                      
                  WHERE T5.DINDKAAR = T2.DINDKAAR                       
                  AND   T5.DCPRN    = T2.DCPRN                          
                  AND   T5.EKOMNR   = T1.EKOMNR                         
                  AND   T5.EEJDNR   = T1.EEJDNR                         
                  AND   T5.DTILGLD  = T2.DTILGLD)                       
         ORDER BY T1.DCPRN, T4.NY_KOMMUNENUMMER,                        
                  T4.NY_EJENDOMSNR, T2.ELBNR                            
         FOR READ ONLY;                                                 
                                                                        
 END DECLARE_CURSOR;                                                    
 /*********************************************************************/
 /* OPEN CURSOR TIL LÆS AF UDTRÆK                                     */
 /*********************************************************************/
 OPEN_UDTRÆK: PROC;                                                     
                                                                        
         EXEC SQL OPEN UDTRAEK_CUR;                                     
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'OPEN UDTRAEK_CURSOR';                        
              ABENDMEDD = 'BH97600 ** 253 ' !! FEJLTEKST;               
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END OPEN_UDTRÆK;                                                       
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF UDTRÆK                                    */
 /*********************************************************************/
 FETCH_UDTRÆK: PROC;                                                    
                                                                        
         EXEC SQL FETCH UDTRAEK_CUR                                     
                                                                        
         INTO :UDTRAEK.DCPRN,                                           
              :UDTRAEK.EKOMNR_NY,                                       
              :UDTRAEK.EEJDNR_NY,                                       
              :UDTRAEK.ELBNR_NY,                                        
              :UDTRAEK.EKOMNR_GL,                                       
              :UDTRAEK.EEJDNR_GL;                                       
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
           WHEN (0)                                                     
               TV_LÆS_UDTRAEK = TV_LÆS_UDTRAEK + 1;                     
           WHEN (100);                                                  
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST = 'FETCH UDTRAEK_CURSOR';                      
               ABENDMEDD = 'BH97600 ** 253 ' !! FEJLTEKST;              
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
         FETCH_SQLKODE = SQLCA.SQLCODE;  /* GEMMES TIL SENERE BRUG */   
                                                                        
 END FETCH_UDTRÆK;                                                      
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF UDTRÆK                                    */
 /*********************************************************************/
 CLOSE_UDTRÆK: PROC;                                                    
                                                                        
         EXEC SQL CLOSE UDTRAEK_CUR;                                    
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'CLOSE UDTRAEK_CURSOR';                       
              ABENDMEDD = 'BH97600 ** 253 ' !! FEJLTEKST;               
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END CLOSE_UDTRÆK;                                                      
 /*********************************************************************/
 /*      FLYT 2005 OPLYSNINGER TIL 2006                               */
 /*********************************************************************/
 FLYT_2005_TIL_2006: PROC;                                              
                                                                        
         UD_2006.PERSON.CPTYPGL = IND_2005.PERSON.CPTYPSLUT;            
                                                                        
         IF IND_2005.PERSON.CNEDSL1 < '30'                              
          & IND_2006.PERSON.CNEDSL1 > '30'                              
         THEN                                                           
            DO;                                                         
              UD_2006.PERSON.CNEDSL1  = IND_2005.PERSON.CNEDSL1;        
              UD_2006.PERSON.DATO0107 = IND_2005.PERSON.DATO0107;       
              TV_ÆNDR_NEDSL = TV_ÆNDR_NEDSL + 1;                        
            END;                                                        
                                                                        
         IF IND_2005.INDK_PERS.BFASTSTIGBGR_I = 0                       
          & IND_2006.INDK_PERS.BFASTSTIGBGR_I = -1                      
         THEN                                                           
            DO;                                                         
              UD_2006.INDK_PERS.BFASTSTIGBGR_I =                        
                              IND_2005.INDK_PERS.BFASTSTIGBGR_I;        
              UD_2006.PERSON.BFASTSTIGBGR =                             
                              IND_2005.PERSON.BFASTSTIGBGR;             
              TV_ÆNDR_FAST = TV_ÆNDR_FAST + 1;                          
            END;                                                        
                                                                        
         IF IND_2005.INDK_PERS.MANNEDSLSTI_I = 0                        
          & IND_2006.INDK_PERS.BFASTSTIGBGR_I = -1                      
         THEN                                                           
            DO;                                                         
              UD_2006.INDK_PERS.BFASTSTIGBGR_I =                        
                              IND_2005.INDK_PERS.MANNEDSLSTI_I;         
              UD_2006.PERSON.BFASTSTIGBGR =                             
                              IND_2005.PERSON.MANNEDSLSTI;              
              TV_ÆNDR_FAST = TV_ÆNDR_FAST + 1;                          
            END;                                                        
                                                                        
         IF IND_2005.INDK_PERS.BMANEVSSTI_I = 0                         
          & IND_2006.INDK_PERS.BEVSGL_I = -1                            
         THEN                                                           
            DO;                                                         
              UD_2006.INDK_PERS.BEVSGL_I =                              
                              IND_2005.INDK_PERS.BMANEVSSTI_I;          
              UD_2006.PERSON.BEVSGL =                                   
                              IND_2005.PERSON.BMANEVSSTI;               
            END;                                                        
                                                                        
         IF IND_2005.INDK_PERS.BNETTO_I = 0                             
          & IND_2006.INDK_PERS.BEVSGL_I = -1                            
         THEN                                                           
            DO;                                                         
              UD_2006.INDK_PERS.BEVSGL_I =                              
                              IND_2005.INDK_PERS.BNETTO_I;              
              UD_2006.PERSON.BEVSGL =                                   
                              IND_2005.PERSON.BNETTO;                   
            END;                                                        
                                                                        
         IF IND_2005.INDK_PERS.MANPENSSTI_I = 0                         
          & IND_2006.INDK_PERS.BPENSNÆGL_I = -1                         
         THEN                                                           
            DO;                                                         
              UD_2006.INDK_PERS.BPENSNÆGL_I =                           
                              IND_2005.INDK_PERS.MANPENSSTI_I;          
              UD_2006.PERSON.BPENSNÆGL =                                
                              IND_2006.PERSON.MANPENSSTI;               
            END;                                                        
                                                                        
         IF IND_2005.INDK_PERS.BPENSNÆ_I = 0                            
          & IND_2006.INDK_PERS.BPENSNÆGL_I = -1                         
         THEN                                                           
            DO;                                                         
              UD_2006.INDK_PERS.BPENSNÆGL_I =                           
                              IND_2005.INDK_PERS.BPENSNÆ_I;             
              UD_2006.PERSON.BPENSNÆGL =                                
                              IND_2006.PERSON.BPENSNÆ;                  
            END;                                                        
                                                                        
 END FLYT_2005_TIL_2006;                                                
 /*********************************************************************/
 /*      BEREGN EVS 2006                                              */
 /*********************************************************************/
 BEREGN_EVS: PROC;                                                      
                                                                        
         IF UD_2006.PERSON.CEJBEVS = '1'                                
          ! UD_2006.PERSON.CEJBEVS = '2'                                
          ! UD_2006.PERSON.CEJBEVS = '3'                                
          ! UD_2006.PERSON.CEJBEVS = '6'                                
          ! UD_2006.PERSON.CEJBEVS = '7'                                
          ! UD_2006.PERSON.CEJBEVS = '8'                                
          ! UD_2006.PERSON.CEJBEVS = '9'                                
          ! UD_2006.PERSON.FERHVFLER = 360                              
          ! UD_2006.INDK_PERS.BEVSMAN_I = 0                             
          ! UD_2006.PERSON.CNULSTIL  = '1'                              
         THEN;                                                          
         ELSE                                                           
            DO;                                                         
              CALL BEHANDL_BEREGNING;                                   
              CALL REGULER_CSTIBLB;                                     
            END;                                                        
                                                                        
 END BEREGN_EVS;                                                        
 /**********************************************************************
 * BEHANDL_BEREGNING                                            RUTINE *
 **********************************************************************/
 BEHANDL_BEREGNING: PROC;                                               
                                                                        
   BQ06907N.TIL.BEVSGL          = UD_2006.PERSON.BEVSGL;                
   BQ06907N.TIL.BEVSGL_SW       = UD_2006.INDK_PERS.BEVSGL_I;           
   BQ06907N.TIL.BPENSNÆGL       = UD_2006.PERSON.BPENSNÆGL;             
   BQ06907N.TIL.BPENSNÆGL_SW    = UD_2006.INDK_PERS.BPENSNÆGL_I;        
   BQ06907N.TIL.CPTYPGL         = UD_2006.PERSON.CPTYPGL;               
   BQ06907N.TIL.CPTYPSLUT       = UD_2006.PERSON.CPTYPSLUT;             
   BQ06907N.TIL.BBERGRL         = UD_2006.PERSON.BBERGRL;               
   BQ06907N.TIL.BBERGRL_SW      = UD_2006.INDK_PERS.BBERGRL_I;          
   BQ06907N.TIL.BBER2FAM        = UD_2006.PERSON.BBER2FAM;              
   BQ06907N.TIL.BBER2FAM_SW     = UD_2006.INDK_PERS.BBER2FAM_I;         
   BQ06907N.TIL.CEJDTYPE_AKT    = UD_2006.PERSON.CEJDTYPE_AKT;          
   BQ06907N.TIL.CNEDSL1         = UD_2006.PERSON.CNEDSL1;               
   BQ06907N.TIL.FELT760         = UD_2006.PERSON.FELT760;               
   BQ06907N.TIL.FELT759         = UD_2006.PERSON.FELT759;               
   BQ06907N.TIL.BFASTSTIGBGR_SW = UD_2006.INDK_PERS.BFASTSTIGBGR_I;     
   BQ06907N.TIL.BFASTSTIGBGR    = UD_2006.PERSON.BFASTSTIGBGR;          
                                                                        
   CALL BEREGN_EVS_KMD_DEL(BQ06907N);                                   
                                                                        
   UD_2006.PERSON.BGLSUM1         = BQ06907N.FRA.BGLSUM1;               
   UD_2006.INDK_PERS.BGLSUM1_I    = BQ06907N.FRA.BGLSUM1_SW;            
   UD_2006.PERSON.BPENSNEDGL      = BQ06907N.FRA.BPENSNEDGL;            
   UD_2006.INDK_PERS.BPENSNEDGL_I = BQ06907N.FRA.BPENSNEDGL_SW;         
   UD_2006.PERSON.CBGLSUM1        = BQ06907N.FRA.CBGLSUM1;              
   UD_2006.PERSON.BGRPROM1        = BQ06907N.FRA.BGRPROM1;              
   UD_2006.INDK_PERS.BGRPROM1_I   = BQ06907N.FRA.BGRPROM1_SW;           
   UD_2006.PERSON.BGRPROM2        = BQ06907N.FRA.BGRPROM2;              
   UD_2006.INDK_PERS.BGRPROM2_I   = BQ06907N.FRA.BGRPROM2_SW;           
   UD_2006.PERSON.BSTITIL         = BQ06907N.FRA.BSTITIL;               
   UD_2006.INDK_PERS.BSTITIL_I    = BQ06907N.FRA.BSTITIL_SW;            
   UD_2006.PERSON.CSTIBLB         = BQ06907N.FRA.CSTIBLB;               
   UD_2006.PERSON.BPROM1          = BQ06907N.FRA.BPROM1;                
   UD_2006.INDK_PERS.BPROM1_I     = BQ06907N.FRA.BPROM1_SW;             
   UD_2006.PERSON.BPROM2          = BQ06907N.FRA.BPROM2;                
   UD_2006.INDK_PERS.BPROM2_I     = BQ06907N.FRA.BPROM2_SW;             
   UD_2006.PERSON.BNEDSL1         = BQ06907N.FRA.BNEDSL1;               
   UD_2006.INDK_PERS.BNEDSL1_I    = BQ06907N.FRA.BNEDSL1_SW;            
   UD_2006.PERSON.CNEDSL2         = BQ06907N.FRA.CNEDSL2;               
   UD_2006.PERSON.BNEDSL2         = BQ06907N.FRA.BNEDSL2;               
   UD_2006.INDK_PERS.BNEDSL2_I    = BQ06907N.FRA.BNEDSL2_SW;            
   UD_2006.PERSON.BPENSNED        = BQ06907N.FRA.BPENSNED;              
   UD_2006.INDK_PERS.BPENSNED_I   = BQ06907N.FRA.BPENSNED_SW;           
   UD_2006.PERSON.BPENSNÆ         = BQ06907N.FRA.BPENSNÆ;               
   UD_2006.INDK_PERS.BPENSNÆ_I    = BQ06907N.FRA.BPENSNÆ_SW;            
   UD_2006.PERSON.BSUM1           = BQ06907N.FRA.BSUM1;                 
   UD_2006.INDK_PERS.BSUM1_I      = BQ06907N.FRA.BSUM1_SW;              
   UD_2006.PERSON.BSUM2           = BQ06907N.FRA.BSUM2;                 
   UD_2006.INDK_PERS.BSUM2_I      = BQ06907N.FRA.BSUM2_SW;              
   UD_2006.PERSON.BSUM3           = BQ06907N.FRA.BSUM3;                 
   UD_2006.INDK_PERS.BSUM3_I      = BQ06907N.FRA.BSUM3_SW;              
   UD_2006.PERSON.BSTIBEGR        = BQ06907N.FRA.BSTIBEGR;              
   UD_2006.INDK_PERS.BSTIBEGR_I   = BQ06907N.FRA.BSTIBEGR_SW;           
   UD_2006.PERSON.BNETTO          = BQ06907N.FRA.BNETTO;                
   UD_2006.INDK_PERS.BNETTO_I     = BQ06907N.FRA.BNETTO_SW;             
                                                                        
 END BEHANDL_BEREGNING;                                                 
 /**********************************************************************
 * EFTERBRÆNDER TIL CSTIBLB                                     RUTINE *
 **********************************************************************/
 REGULER_CSTIBLB: PROC;                                                 
                                                                        
   SELECT (UD_2006.PERSON.CSTIBLB);                                     
                                                                        
     WHEN ('01')                                                        
       DO;                                                              
         IF (UD_2006.PERSON.CPTYPSLUT = '2' &                           
             UD_2006.PERSON.CPTYPGL = '3')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '05';                              
                                                                        
         IF  UD_2006.PERSON.CPTYPSLUT = '3' &                           
            (UD_2006.PERSON.CPTYPGL = '1' !                             
             UD_2006.PERSON.CPTYPGL = '2')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '03';                              
       END;                                                             
                                                                        
     WHEN ('02')                                                        
       DO;                                                              
         IF (UD_2006.PERSON.CPTYPSLUT = '2' &                           
             UD_2006.PERSON.CPTYPGL = '3')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '06';                              
                                                                        
         IF  UD_2006.PERSON.CPTYPSLUT = '3' &                           
            (UD_2006.PERSON.CPTYPGL = '1' !                             
             UD_2006.PERSON.CPTYPGL = '2')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '04';                              
       END;                                                             
     WHEN ('05')                                                        
                                                                        
         IF (UD_2006.PERSON.CPTYPSLUT = '2' &                           
             UD_2006.PERSON.CPTYPGL = '1')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '01';                              
                                                                        
     WHEN ('06')                                                        
                                                                        
         IF (UD_2006.PERSON.CPTYPSLUT = '2' &                           
             UD_2006.PERSON.CPTYPGL = '1')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '02';                              
                                                                        
     WHEN ('07')                                                        
                                                                        
         IF (UD_2006.PERSON.CPTYPSLUT = '1' !                           
             UD_2006.PERSON.CPTYPSLUT = '2') &                          
             UD_2006.PERSON.CPTYPGL = '3'                               
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '09';                              
                                                                        
     WHEN ('08')                                                        
                                                                        
         IF (UD_2006.PERSON.CPTYPSLUT = '1' !                           
             UD_2006.PERSON.CPTYPSLUT = '2') &                          
             UD_2006.PERSON.CPTYPGL = '3'                               
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '10';                              
                                                                        
     WHEN ('09')                                                        
                                                                        
         IF (UD_2006.PERSON.CPTYPSLUT = '1' &                           
             UD_2006.PERSON.CPTYPGL = '1')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '07';                              
                                                                        
     WHEN ('10')                                                        
                                                                        
         IF (UD_2006.PERSON.CPTYPSLUT = '1' &                           
             UD_2006.PERSON.CPTYPGL = '1')                              
         THEN                                                           
            UD_2006.PERSON.CSTIBLB = '08';                              
                                                                        
     OTHER                                                              
        ;                                                               
                                                                        
   END;                                                                 
                                                                        
 END REGULER_CSTIBLB;                                                   
 /*********************************************************************/
 /*      DANNE DATA TIL SLUT CSC VEDR. REPARATION                     */
 /*********************************************************************/
 DAN_DATA_TIL_SLUT: PROC;                                               
                                                                        
    HJ_EKOMNR_EEJDNR_DEF.EKOMNR_PIC = UDTRAEK.EKOMNR_NY;                
    HJ_EKOMNR_EEJDNR_DEF.EEJDNR_PIC = UDTRAEK.EEJDNR_NY;                
                                                                        
    BH976.INDVNR         = '812';                                       
    BH976.INDVLGD        = STG(BH976);                                  
    BH976.FELTLGD        = STG(BH976);                                  
    BH976.HEADER         = 'EVSSUPPL';                                  
    BH976.DINDKAAR       = '2006';                                      
    BH976.DCPRN          = UDTRAEK.DCPRN;                               
    BH976.EKOMNR_EEJDNR  = HJ_EKOMNR_EEJDNR_CH;                         
    BH976.ELBNR          = UDTRAEK.ELBNR_NY;                            
                                                                        
    BH976.CSLET             = UD_2006.PERSON.CSLET;                     
    BH976.CSKPLOMF          = UD_2006.PERSON.CSKPLOMF;                  
    BH976.CEJBEVS           = UD_2006.PERSON.CEJBEVS;                   
    BH976.BOBEHAKOD         = UD_2006.PERSON.BOBEHAKOD;                 
    BH976.MANPENSSTI_I      = UD_2006.INDK_PERS.MANPENSSTI_I;           
    BH976.MANPENSSTI        = UD_2006.PERSON.MANPENSSTI;                
    BH976.BBERGRL_015ANV_I  = UD_2006.INDK_PERS.BBERGRL_015ANV_I;       
    BH976.BBERGRL_015ANV    = UD_2006.PERSON.BBERGRL_015ANV;            
    BH976.BBERGRL_02ANV_I   = UD_2006.INDK_PERS.BBERGRL_02ANV_I;        
    BH976.BBERGRL_02ANV     = UD_2006.PERSON.BBERGRL_02ANV;             
    BH976.BBERGRL_AKT_I     = UD_2006.INDK_PERS.BBERGRL_AKT_I;          
    BH976.BBERGRL_AKT       = UD_2006.PERSON.BBERGRL_AKT;               
    BH976.BBERGRLUDL_01_I   = UD_2006.INDK_PERS.BBERGRLUDL_01_I;        
    BH976.BBERGRLUDL_01     = UD_2006.PERSON.BBERGRLUDL_01;             
    BH976.BOMBTILBUDL_01_I  = UD_2006.INDK_PERS.BOMBTILBUDL_01_I;       
    BH976.BOMBTILBUDL_01    = UD_2006.PERSON.BOMBTILBUDL_01;            
    BH976.BBER2FAM_015ANV_I = UD_2006.INDK_PERS.BBER2FAM_015ANV_I;      
    BH976.BBER2FAM_015ANV   = UD_2006.PERSON.BBER2FAM_015ANV;           
    BH976.BBER2FAM_02ANV_I  = UD_2006.INDK_PERS.BBER2FAM_02ANV_I;       
    BH976.BBER2FAM_02ANV    = UD_2006.PERSON.BBER2FAM_02ANV;            
    BH976.BBER2FAM_AKT_I    = UD_2006.INDK_PERS.BBER2FAM_AKT_I;         
    BH976.BBER2FAM_AKT      = UD_2006.PERSON.BBER2FAM_AKT;              
    BH976.EJDBELIG          = UD_2006.EJENDOM.EJDBELIG;                 
    BH976.CEJDTYPE          = UD_2006.PERSON.CEJDTYPE_AKT;              
    BH976.CÆGTOPR           = UD_2006.PERSON.CÆGTOPR;                   
    BH976.DOVTG             = UD_2006.PERSON.DOVTG;                     
    BH976.DAFSTAA           = UD_2006.PERSON.DAFSTAA;                   
    BH976.GPCTEJER          = UD_2006.PERSON.GPCTEJER;                  
    BH976.GPCTEJER_I        = UD_2006.INDK_PERS.GPCTEJER_I;             
    BH976.FDAGUDLE          = UD_2006.PERSON.FDAGUDLE;                  
    BH976.GPCTUDLE          = UD_2006.PERSON.GPCTUDLE;                  
    BH976.FUDL100           = UD_2006.PERSON.FUDL100;                   
    BH976.GPCTERHV          = UD_2006.PERSON.GPCTERHV;                  
    BH976.FDAGERHV          = UD_2006.PERSON.FDAGERHV;                  
    BH976.FERHVFLER         = UD_2006.PERSON.FERHVFLER;                 
    BH976.CENKE             = UD_2006.PERSON.CENKE;                     
    BH976.CPTYPSLUT         = UD_2006.PERSON.CPTYPSLUT;                 
    BH976.CPTYPGL           = UD_2006.PERSON.CPTYPGL;                   
    BH976.FELT759           = UD_2006.PERSON.FELT759;                   
    BH976.FELT760           = UD_2006.PERSON.FELT760;                   
    BH976.BEVSGL_I          = UD_2006.INDK_PERS.BEVSGL_I;               
    BH976.BEVSGL            = UD_2006.PERSON.BEVSGL;                    
    BH976.BPENSNEDGL_I      = UD_2006.INDK_PERS.BPENSNEDGL_I;           
    BH976.BPENSNEDGL        = UD_2006.PERSON.BPENSNEDGL;                
    BH976.DINDFLYT          = UD_2006.PERSON.DINDFLYT;                  
    BH976.DFRAFLYT          = UD_2006.PERSON.DFRAFLYT;                  
    BH976.FUBEBOELIG        = UD_2006.PERSON.FUBEBOELIG;                
    BH976.BFASTSTIGBGR_I    = UD_2006.INDK_PERS.BFASTSTIGBGR_I;         
    BH976.BFASTSTIGBGR      = UD_2006.PERSON.BFASTSTIGBGR;              
    BH976.CINDFLYT          = UD_2006.PERSON.CINDFLYT;                  
    BH976.CBERGRGLOP        = UD_2006.PERSON.CBERGRGLOP;                
    BH976.BMANEVSSTI_I      = UD_2006.INDK_PERS.BMANEVSSTI_I;           
    BH976.BMANEVSSTI        = UD_2006.PERSON.BMANEVSSTI;                
    BH976.BEVSMAN_I         = UD_2006.INDK_PERS.BEVSMAN_I;              
    BH976.BEVSMAN           = UD_2006.PERSON.BEVSMAN;                   
    BH976.BMANNEDSL_I       = UD_2006.INDK_PERS.BMANNEDSL_I;            
    BH976.BMANNEDSL         = UD_2006.PERSON.BMANNEDSL;                 
    BH976.CEKSEMP           = UD_2006.PERSON.CEKSEMP;                   
    BH976.MANNEDSLSTI_I     = UD_2006.INDK_PERS.MANNEDSLSTI_I;          
    BH976.MANNEDSLSTI       = UD_2006.PERSON.MANNEDSLSTI;               
    BH976.BUDLSKC_I         = UD_2006.INDK_PERS.BUDLSKC_I;              
    BH976.BUDLSKC           = UD_2006.PERSON.BUDLSKC;                   
    BH976.BEJBOL1_AKT_I     = UD_2006.INDK_PERS.BEJBOL1_AKT_I;          
    BH976.BEJBOL1_AKT       = UD_2006.PERSON.BEJBOL1_AKT;               
    BH976.BEJBOL2_AKT_I     = UD_2006.INDK_PERS.BEJBOL2_AKT_I;          
    BH976.BEJBOL2_AKT       = UD_2006.PERSON.BEJBOL2_AKT;               
    BH976.DAFSTAAFOR        = UD_2006.PERSON.DAFSTAAFOR;                
    BH976.CVURDOPR          = UD_2006.EJENDOM.CVURDOPR;                 
    BH976.BEJBOL1_02ANV_I   = UD_2006.INDK_PERS.BEJBOL1_02ANV_I;        
    BH976.BEJBOL1_02ANV     = UD_2006.PERSON.BEJBOL1_02ANV;             
    BH976.BEJBOL2_02ANV_I   = UD_2006.INDK_PERS.BEJBOL2_02ANV_I;        
    BH976.BEJBOL2_02ANV     = UD_2006.PERSON.BEJBOL2_02ANV;             
    BH976.CBENYT            = UD_2006.EJENDOM.CBENYT;                   
    BH976.CSCREGISTMP       = UD_2006.PERSON.CSCREGISTMP;               
    BH976.COMBYG            = UD_2006.EJENDOM.COMBYG;                   
    BH976.CBERGRL           = UD_2006.EJENDOM.CBERGRL;                  
    BH976.BPROM2_I          = UD_2006.INDK_PERS.BPROM2_I;               
    BH976.BPROM2            = UD_2006.PERSON.BPROM2;                    
    BH976.BPROM1_I          = UD_2006.INDK_PERS.BPROM1_I;               
    BH976.BPROM1            = UD_2006.PERSON.BPROM1;                    
    BH976.CELØNCOR          = UD_2006.PERSON.CELØNCOR;                  
    BH976.GPCTEJERFOR       = UD_2006.PERSON.GPCTEJERFOR;               
    BH976.CERHV             = UD_2006.PERSON.CERHV;                     
    BH976.BGLSUM1_I         = UD_2006.INDK_PERS.BGLSUM1_I;              
    BH976.BGLSUM1           = UD_2006.PERSON.BGLSUM1;                   
    BH976.BBERGRL_I         = UD_2006.INDK_PERS.BBERGRL_I;              
    BH976.BBERGRL           = UD_2006.PERSON.BBERGRL;                   
    BH976.CBERGROP          = UD_2006.PERSON.CBERGROP;                  
    BH976.BSTIBEGR_I        = UD_2006.INDK_PERS.BSTIBEGR_I;             
    BH976.BSTIBEGR          = UD_2006.PERSON.BSTIBEGR;                  
    BH976.BFORSKAT_I        = UD_2006.INDK_PERS.BFORSKAT_I;             
    BH976.BFORSKAT          = UD_2006.PERSON.BFORSKAT;                  
    BH976.CFORSKAT          = UD_2006.PERSON.CFORSKAT;                  
    BH976.BNEDSL1_I         = UD_2006.INDK_PERS.BNEDSL1_I;              
    BH976.BNEDSL1           = UD_2006.PERSON.BNEDSL1;                   
    BH976.BPENSNED_I        = UD_2006.INDK_PERS.BPENSNED_I;             
    BH976.BPENSNED          = UD_2006.PERSON.BPENSNED;                  
    BH976.BNEDSL2_I         = UD_2006.INDK_PERS.BNEDSL2_I;              
    BH976.BNEDSL2           = UD_2006.PERSON.BNEDSL2;                   
    BH976.CNULSTIL          = UD_2006.PERSON.CNULSTIL;                  
    BH976.CUDLMAN           = UD_2006.PERSON.CUDLMAN;                   
    BH976.BBER2FAM_I        = UD_2006.INDK_PERS.BBER2FAM_I;             
    BH976.BBER2FAM          = UD_2006.PERSON.BBER2FAM;                  
    BH976.FEJLNR            = UD_2006.PERSON.FEJLNR;                    
    BH976.BEJBOL1_015ANV_I  = UD_2006.INDK_PERS.BEJBOL1_015ANV_I;       
    BH976.BEJBOL1_015ANV    = UD_2006.PERSON.BEJBOL1_015ANV;            
    BH976.BEJBOL2_015ANV_I  = UD_2006.INDK_PERS.BEJBOL2_015ANV_I;       
    BH976.BEJBOL2_015ANV    = UD_2006.PERSON.BEJBOL2_015ANV;            
    BH976.CSKPLOMFGL        = UD_2006.PERSON.CSKPLOMFGL;                
    BH976.DFRAGLD           = UD_2006.PERSON.DFRAGLD;                   
    BH976.CNEDSL1           = UD_2006.PERSON.CNEDSL1;                   
    BH976.FLEJL             = UD_2006.EJENDOM.FLEJL;                    
    BH976.BGRPROM2_I        = UD_2006.INDK_PERS.BGRPROM2_I;             
    BH976.BGRPROM2          = UD_2006.PERSON.BGRPROM2;                  
    BH976.DOVTGFOR          = UD_2006.PERSON.DOVTGFOR;                  
    BH976.CSTIBLB           = UD_2006.PERSON.CSTIBLB;                   
    BH976.CDATAFRA          = UD_2006.PERSON.CDATAFRA;                  
    BH976.CUDLHEL           = UD_2006.PERSON.CUDLHEL;                   
    BH976.CUDLDEL           = UD_2006.PERSON.CUDLDEL;                   
    BH976.BGRPROM1_I        = UD_2006.INDK_PERS.BGRPROM1_I;             
    BH976.BGRPROM1          = UD_2006.PERSON.BGRPROM1;                  
                                                                        
    IF UD_2006.EJENDOM.EKOMNR_GL > 0                                    
    THEN                                                                
       DO;                                                              
         HJ_PIC3 = UD_2006.EJENDOM.EKOMNR_GL;                           
         BH976.EKOMNR_GL = HJ_CHAR3;                                    
         HJ_PIC7 = UD_2006.EJENDOM.EEJDNR_GL;                           
         BH976.EEJDNR_GL = HJ_PIC7;                                     
       END;                                                             
    ELSE                                                                
       DO;                                                              
         BH976.EKOMNR_GL = ' ';                                         
         BH976.EEJDNR_GL = ' ';                                         
       END;                                                             
                                                                        
    IF UD_2006.INDK_PERS.BPENSNEDGL_I = -1                              
    THEN                                                                
       DO;                                                              
         BH976.BGLSUM1_I = -1;                                          
         BH976.BGLSUM1   = 0;                                           
       END;                                                             
                                                                        
 END DAN_DATA_TIL_SLUT;                                                 
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         CLOSE FILE (BH976O);                                           
         CALL ZS67000(SQLCA);                                           
                                                                        
         EXEC SQL ROLLBACK;                                             
                                                                        
         IF SQLCODE ^= 0                                                
         THEN                                                           
            CALL ZS67000 (SQLCA);                                       
                                                                        
         CALL ZS30101 (5, ABENDMEDD, 2);                                
                                                                        
 END SQL_FEJL;                                                          
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
         PROC;                                                          
                                                                        
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV_LÆS_UDTRAEK;                                
         DETLIN1.TEKST = 'ANTAL LÆSTE PÅ UDTRÆK PÅ DB2';                
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV_LÆS_EVS_2005;                               
         DETLIN1.TEKST = 'ANTAL LÆSTE EVS 2005                       '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV_LÆS_EVS_2006;                               
         DETLIN1.TEKST = 'ANTAL LÆSTE EVS 2006                       '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV_ÆNDR_NEDSL;                                 
         DETLIN1.TEKST = 'ANTAL ÆNDRET 1/7 NEDSLAG                   '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV_ÆNDR_FAST;                                  
         DETLIN1.TEKST = 'ANTAL ÆNDRET FASTFROSSETNEDSLAG            '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV_ÆNDR_STIG;                                  
         DETLIN1.TEKST = 'ANTAL ÆNDRET STIGNINGSBEGRÆNSNING          '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV_SKRIV_EVS;                                  
         DETLIN1.TEKST = 'ANTAL AJOURFØRTE EVS 2006                   ';
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV_SKREVET;                                    
         DETLIN1.TEKST = 'ANTAL SUPPL INDIVIDER TIL CSC D0311603.A782'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
 END TOTALLISTE;                                                        
 /********************************************************************* 
 *       AFSLUT PROGRAM                                               * 
 *********************************************************************/ 
 AFSLUT:                                                                
         PROC;                                                          
                                                                        
         CALL TOTALLISTE;                                               
                                                                        
         CALL ZZ20300((133)' ','99');                                   
                                                                        
         CLOSE FILE (BH976O);                                           
         CALL CLOSE_UDTRÆK;                                             
                                                                        
 END AFSLUT;                                                            
                                                                        
 /*********************************************************************/
           %INCLUDE BQ06907M;                  /* BEREGN_EVS_KMD_DEL  */
                                                                        
      ; /* UNDGÅ PROBLEMER MED LABEL */                                 
 DCL 1 ZM,                                                              
       2  DUMMY           CHAR (01);                                    
 END  BH97600;                                                          
