  PROCESS OPT(TIME);                                                    
 BH93200: /* DAN 2. UDGAVE AF BEREGNINGSBÅND TIL EVS-BEREGNING        */
         PROCEDURE (EXECPARM) OPTIONS (MAIN) REORDER;                   
 /*********************************************************************/
         DCL COPYRIGHT   CHAR      (30) STATIC                          
                         INIT ('COPYRIGHT KOMMUNEDATA I/S 2013');       
 /**********************************************************************
 * NY UDGAVE AF PROGRAMMET BH94100L SOM ER TILRETTET TIL AT KØRER MOD  *
 * CSRP-DATA ISTEDET FOR P-DATA.                                       *
 *                                                                     *
 * FORMÅL:  BEREGN.BÅND OPSÆTTES MED OPLYSNINGERNE VEDR. STATUS FOR    *
 *          1/7-98-EJERSKAB. DESUDEN DANNES DIVERSE KODER JVF. EJERS   *
 *          OG EVT. ÆGTEFÆLLES ALDER TIL STYRING AF AKTUEL PERSONTYPE. *
 *                                                                     *
 * INPUT  : OBS.: ER KØRSEL LIG OPRETTELSE I ENTEN SLUT ELLER FORSKUD  *
 *                ER DSN-NAVNE FOR INPUT DATASÆTTENE LIG MED:          *
 *          B.H94601D  BEREGNINGSBÅND 1. UDGAVE EFTER PÅSÆTNING AF     *
 *                     ESR-STAMOPLYSNINGER I VISSE SITUATIONER.        *
 *                                                                     *
 *          OBS.: HVIS KØRSEL ER LIG SUPPLEMENT (TIL EVS SLUT)         *
 *                ER DSN-NAVNE FOR INPUT-DATASÆTTENE LIG MED:          *
 *          B.H90501D  UDTRÆK FRA ESR AJOURFØRT MED OPLYSNINGERNE FRA  *
 *                     MINI MT-FIL FRA FORSKUD                         *
 *                                                                     *
 *          B.H65501D  MINI-MTFIL                                      *
 *                                                                     *
 * OUTPUT : B.H94110D  AJOURFØRT UDTRÆK - KUN SOMMERHUSE               *
 *          B.H94120D  AJOURFØRT UDTRÆK - ØVRIGE EJENDOMME             *
 *          BH93201Y   KØRSELSKONTROLLISTE                             *
 *          BH93202Y   FEJLLISTE FRA MASKINEL AFSTEMNING               *
 *                                                                     *
 * FORSKUD06     SUSANNE KROGH VILLUMSEN   02-06-2005                  *
 *               TILRETNING AF FORSKUD06                               *
 *               VURDOPL0 ÆNDRET TIL VURDOPLNY                         *
 *               VURDOPL1 ÆNDRET TIL VURDOPLGL                         *
 *               VURDOPL2 ÆNDRET TIL VURDOPL02                         *
 *               VURDOPL3 ÆNDRET TIL VURDOPL01                         *
 *               VURDOPL0.OMBER02 ÆNDRET TIL VURDOPLNY.OMBER01         *
 *               VURDOPL1.OMBER02 ÆNDRET TIL VURDOPLGL.OMBER01         *
 *   NB!   FELTÆNDRINGERNE ER IKKE MÆRKET I PROGRAMMET PGA AT MAN DA   *
 *         VILLE KOMME TIL AT MÆRKE NÆSTEN ALLE LINIER I PROGRAMMET    *
 * SLUT05        SUSANNE KROGH VILLUMSEN   08-11-2005                  *
 *               TILRETNING AF SLUT 2005                               *
 * FORSKUD07     BO SCHMIDT                14-05-2006                  *
 *               TILRETNING AF FORSKUD07                               *
 * SLUT06        BO SCHMIDT                04-10-2006                  *
 *               TILRETNING AF SLUT06                                  *
 * FORSKUD08     BO SCHMIDT                23-05-2007                  *
 *               TILRETNING AF FORSKUD08                               *
 * SLUT07        BO SCHMIDT                19-11-2007                  *
 *               TILRETNING AF SLUT07                                  *
 * FORSKUD09     BO SCHMIDT                23-06-2008                  *
 *               TILRETNING AF FORSKUD09                               *
 * SLUT08        BO SCHMIDT                19-11-2008                  *
 *               TILRETNING AF SLUT08                                  *
 * FORSKUD10     GERD HOLM-PEDERSEN        20-04-2009                  *
 *               TILRETNING AF FORSKUD10 + RUL                         *
 *               NYT FELT CEJFOER0107. SE OPSÆT_DATO_0107              *
 * SLUT09        GERD HOLM-PEDERSEN        06-10-2009                  *
 *               TILRETNING AF SLUT09      BH90000N TIL SLUT  SAMT     *
 *               KRAV #18-02: OPSÆTNING AF BEREGNINGSGRL. FOR UDL. EJ  *
 *               KRAV #18-03: NEDTAGNING AF 158=7                      *
 *               NY SNITFLADE TIL P-DATA  AS78200->AS78203             *
 * FORSKUD11     GERD HOLM-PEDERSEN        08-06-2010                  *
 *               TILRETNING AF FORSKUD11 + RUL                         *
 * SLUT10        GERD HOLM-PEDERSEN        08-10-2010                  *
 *               TILRETNING AF SLUT09      BH90000N TIL SLUT            
 * FORSKUD12     GERD HOLM-PEDERSEN        MAJ 2011                    *
 *               TILRETNING AF FORSKUD12 + RUL                         *
 * SLUT11        GERD HOLM-PEDERSEN        22-09-2011                  *
 *               TILRETNING AF SLUT11      BH90000N TIL SLUT           *
 *               SAMT KRAV 18-05 OVERFØRSEL AF UDENLANDSKE EJENDOMME   *
 *               FELT 616 OG 626 SKAL IKKE OVERFØRES.                  *
 *               ER DERFOR SLETTEDE.                                   *
 ********************************************************************** 
 * FORSKUD13     LARS KAAE HARRITSHØR      MAJ 2012                    *
 *               TILRETNING AF FORSKUD13 + RUL                         *
 *               Ændring i BH90100N                                    *
 *               Følgende felter er tilføjet i BH90100N                *
 *               UDL_615                                               *
 *               UDL_615_SW                                            *
 *               UDL_616                                               *
 *               UDL_616_SW                                            *
 *               UDL_621                                               *
 *               UDL_621_SW                                            *
 *               UDL_622                                               *
 *               UDL_622_SW                                            *
 *               UDL_626                                               *
 *               UDL_626_SW                                            *
 * SLUT12        ESBEN BRODERSEN NOV 2012                              *
 *               TILRETNING TIL SLUT 2012 BH90000N TIL SLUT            *
 *               KRAV 18-01 NYT FELT CEANV I STRUKTUR BH32202N         *
 ********************************************************************** 
 * FORSKUD14     ESBEN BRODERSEN MAJ 2013                              *
 *               TILRETNING AF FORSKUD14 + RUL                         *
 *               SKIFT TIL BH90100N                                    *
 * SLUT13        JØRGEN SAUGMANN           OKT 2013                    *
 *               TILRETNING AF SLUT13      BH90000N TIL SLUT           *
 *               INDLÆGNING AF PENSIONISTNEDSLAG FOR BEGRÆNSET SKATTE- *
 *               PLIGT OG DOBBELTDOMICILEREDE (SKATTEPLIGT: 1,3,8).    *
 *                                                         SØG #01     *
 * FORSKUD15     JØRGEN SAUGMANN JULI 2014                             *
 *               TILRETNING AF FORSKUD15 + RUL                         *
 *               TEST PÅ CSKPLOMF ER UDVIDET MED ET EKSTRA FELT SØG #02*
 *               SLUT KØRSEL                                           *
 * SLUT14        JØRGEN SAUGMANN           OKT 2014                    *
 *               TILRETNING AF SLUT14      BH90000N TIL SLUT           *
 * SLUT14        Esben Brodersen           NOV 2014                    *
 * OPRETTET SOM KOPI AF BH94300 OG TILRETTE                            *
 **********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /*********************************************************************/
 /*      PARAMETER TIL ANGIVELSE AF OM DET ER PRODUKTION ELLER        */
 /*      TESTKØRSEL AF HENSYN TIL MASKINEL AFSTEMNING                 */
 /*********************************************************************/
 DCL     EXECPARM        CHAR      (6) VAR;                             
 DCL     EX_PARM         CHAR      (4);                                 
         EX_PARM = EXECPARM;                                            
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL     BH655I FILE RECORD INPUT;      /* MINI MTFIL                */ 
 DCL     BH946I FILE RECORD INPUT;      /* BEREGNINGSBÅND            */ 
 DCL     BH9321O FILE RECORD OUTPUT;    /* KUN SOMMERHUSE            */ 
 DCL     BH9322O FILE RECORD OUTPUT;    /* ØVRIGE EJENDOMME          */ 
 DCL     SYSPRINT FILE OUTPUT;                                          
 /********************************************************************* 
 *       DECLARE AF UDTRÆK FRA ESR                                    * 
 *********************************************************************/ 
 DCL     BH946_AR        CHAR      (6000) VAR;                          
 DCL     1 BH946         BASED     (ADDR(BH946_AR)),                    
           3 LÆNGDE      BIN FIXED (15),                                
                                                                        
 /*RUL */  %INCLUDE BH90000N;;   /******** HVIS KØRSEL = EVS SLUT    */ 
 /*RUL     %INCLUDE BH90100N;;    ******** HVIS KØRSEL = EVS FORSKUD */ 
 DCL     1 BH94699       BASED     (ADDR(BH946_AR)),                    
           3 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH90099N;                                           
 /********************************************************************* 
 *       DECLARE AF UDTRÆK (BEREGNINGSBÅND)                           * 
 *********************************************************************/ 
 DCL     1 BH93299,                         /* BEREGNINGSBÅND         */
           %INCLUDE BH90099N;               /* OPTÆLLINGSINDIVID      */
 /*********************************************************************/
 /*      DECLARE AF MT-FIL                                            */
 /*********************************************************************/
 DCL     1 MTFIL,                                                       
           %INCLUDE BH65300N;;                                          
 DCL     1 MTFIL_OPT     BASED(ADDR(MTFIL)),                            
           %INCLUDE BH65399N;                                           
 /********************************************************************* 
 *       DB2                                                          * 
 *********************************************************************/ 
         EXEC SQL INCLUDE SQLCA;       /* SQL KOMMUNIKATIONSAREAL    */ 
         EXEC SQL INCLUDE BQ70000T;    /* AKTUEL CSRP DATA           */ 
         EXEC SQL INCLUDE BQ71000T;    /* HISTORIK CSRP DATA         */ 
 /********************************************************************* 
 *               DECLARE AF DIV. TÆLLEVÆRKER                          * 
 *********************************************************************/ 
 DCL     1 TV,                   /* TÆLLEVÆRKER TIL TOTALLISTEN */      
           2 LÆS_BH946   FIXED DEC (7),                                 
           2 LÆS_BH655   FIXED DEC (7),                                 
           2 BK16        FIXED DEC (7),                                 
           2 HANST       FIXED DEC (7),                                 
           2 HENT_PCT    FIXED DEC (7),                                 
           2 CENKE3_OPS  FIXED DEC (7),                                 
           2 CENKE3_NED  FIXED DEC (7),                                 
           2 CENKE4_OPS  FIXED DEC (7),                                 
           2 CENKE4_NED  FIXED DEC (7),                                 
           2 FMT         FIXED DEC (7),                                 
           2 EJMT        FIXED DEC (7),                                 
           2 EJPNR       FIXED DEC (7),                                 
           2 FORSKEL1    FIXED DEC (7),                                 
           2 FORSKEL2    FIXED DEC (7),                                 
           2 FORSKEL3    FIXED DEC (7),                                 
           2 PGF4A       FIXED DEC (7),                                 
           2 PGF4B       FIXED DEC (7),                                 
           2 SOMMERHUSE  FIXED DEC (7),                                 
           2 CPR_INDFLYT FIXED DEC (7),                                 
           2 CPR_FRAFLYT FIXED DEC (7),                                 
           2 CPR_BEBOET  FIXED DEC (7),                                 
           2 CSRPDATA    FIXED DEC (7),                  /*SLUT05*/     
           2 ØVRIGE      FIXED DEC (7);                                 
 /********************************************************************* 
 *       DECLARE AF DIV. FÆLLESMACROER (ESKEMA/BOY/FORSKUD)           * 
 *********************************************************************/ 
 DCL     1 BH65300M,                                                    
           %INCLUDE BH90800M; /*KOPI AF BH65300M FRA SLUT2014*/         
                                                                        
 DCL     1 BH60101M      ALIGNED,                                       
           %INCLUDE BH60101M;                                           
 /********************************************************************* 
 *       DECLARE AF BUILTIN'S                                         * 
 *********************************************************************/ 
 DCL     TRANSLATE       BUILTIN;                                       
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     VERIFY          BUILTIN;                                       
 DCL     SUBSTR          BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     STG             BUILTIN;                                       
 DCL     CHAR            BUILTIN;                                       
 DCL     NULL            BUILTIN;                                       
 /********************************************************************* 
 *       DECLARE AF ENTRY'S                                           * 
 *********************************************************************/ 
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 DCL     ZS67000         ENTRY;                       /* SQL-ABEND    */
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH93200L'),                                        
           2 F1          CHAR      (21)      INIT      (' '),           
           2 TEKST2      CHAR      (61)      INIT      (                
           'DAN 2. UDGAVE AF BEREGNINGSBÅND TIL EVS-BEREGNING '),       
           2 F2          CHAR      (12)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN0,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (41),                                
           2 CPUÅR       PIC       '99',                                
           2 TEKST2      CHAR      (11),                                
           2 START       PIC       '999999',                            
           2 TEKST3      CHAR      (9),                                 
           2 SLUT        PIC       '999999',                            
           2 TEKST4      CHAR      (57);                                
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZZ',                       
           2 F2          CHAR      (61)      INIT      (' ');           
 DCL     1 DETLIN2,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (33),                                
           2 RCKOD       CHAR      (01)      INIT      (' '),           
           2 F1          CHAR      (19)      INIT      (' '),           
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (68)      INIT      (' ');           
 DCL     1 DETLIN3,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (10)      INIT      (' '),           
           2 TEKST2      CHAR      (07)      INIT      ('BELØB: '),     
           2 BELØB       PIC       'ZZZ.ZZZ.ZZZ.ZZZ.ZZ9',               
           2 F3          CHAR      (25)      INIT      (' ');           
         % INCLUDE ZZ20301M;                                            
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
 EXTERNAL INIT ('NOTEST(ALL,,;)');                                      
 DCL     EOF_BH946       BIT       (1);                                 
 DCL     EOF_BH655       BIT       (1);                                 
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
 DCL     HJ_CPR          PIC       '(10)9';                             
 DCL     CRETUR          CHAR      (1);                                 
 DCL     HJVÆRDI2        FIXED     (13,3);                              
 DCL     PRDATO1         FIXED     (9);                                 
 DCL     PRDATO2         FIXED     (9);                                 
                                                                        
 DCL     TFLAG           BIT       (1)     INIT('0'B);                  
                                                                        
 DCL     DAN_4_BEHANDL_PRDATO1  FIXED BIN(31)    INIT(0);               
 DCL     DAN_4_BEHANDL_PRDATO2  FIXED BIN(31)    INIT(0);               
 DCL     DAN_4_OPSÆT_PERSONTYPE FIXED BIN(31)    INIT(0);               
                                                                        
 DCL     1 INP_OPSÆT,                                                   
     6 CANVEBOL      CHAR  (1),    /* FRA EVS SLUT EJER SIDSTE        */
     6 ESR_EKOMNR    FIXED (3),    /* BELIGGENHEDSKOMMUNE             */
     6 BOPÆLSKODE    CHAR  (1),    /* BOPÆLSKODE                      */
     6 CBENYT        CHAR  (2),    /* BENYTTELSESKODE                 */
     6 FLEJL         FIXED (5),    /* ANTAL LEJLIGHEDER               */
     6 BEJDVÆR       FIXED (11),   /* EJD.VÆRDI                       */
     6 CEJERL        CHAR  (1),    /* KODE UDLEJET EJERLEJLIGHED      */
     6 EJEBOL(2),                  /*                                 */
      7 VEJK_EJEB BIN FIXED(15),   /* EJERBOLIG VEJKODE               */
      7 HUSNR_EJEB   CHAR  (4),    /* EJERBOLIG HUSNR+BOGSTAV         */
      7 ETAGE_EJEB   CHAR  (2),    /* EJERBOLIG ETAGE                 */
      7 SDØR_EJEB    CHAR  (4),    /* EJERBOLIG SIDE/DØRNR            */
      7 EJBOLTYP     CHAR  (1),    /* EJERBOLIGTYPE(FELT 450)         */
      7 BEJEBOL      FIXED (11),   /* EJERBOLIG-/STUEHUSVÆRDI         */
     6 ANT_FOR_1     FIXED (5),    /* ANTAL EJERBOLIGFORDELINGER IALT */
     6 ANT_FOR_2     FIXED (5),    /* ANTAL EJERBOLIGFORDELINGER IALT */
     6 ANT_FOR_4     FIXED (5),    /* ANTAL EJERBOLIGFORDELINGER IALT */
     6 ANT_FOR_5     FIXED (5),    /* ANTAL EJERBOLIGFORDELINGER IALT */
     6 ANT_FOR_6     FIXED (5),    /* ANTAL EJERBOLIGFORDELINGER IALT */
     6 ANT_FOR_8     FIXED (5),    /* ANTAL EJERBOLIGFORDELINGER IALT */
     6 ANT_FOR_9     FIXED (5);    /* ANTAL EJERBOLIGFORDELINGER IALT */
                                                                        
 DCL     INDKOMSTÅR  BIN FIXED (15);                                    
                                                                        
 DCL     UDDATO          CHAR      (10);                                
                                                                        
 DCL     DATO1           CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (4),                                 
           2 F1          CHAR      (1),                                 
           2 MD          CHAR      (2),                                 
           2 F2          CHAR      (1),                                 
           2 DG          CHAR      (2);                                 
                                                                        
 DCL     TMP_START       CHAR      (08);                                
 DCL     TMP_SLUT        CHAR      (08);                                
                                                                        
 DCL     HJ_DATO         CHAR      (10);                                
 DCL     HJ_PIC4         PIC       '(4)9';                              
 DCL     HJ_CHAR1        CHAR      (1);                                 
 DCL     HJDATO_FRA      CHAR      (10);                                
 DCL     HJDATO_TIL      CHAR      (10);                                
 DCL     CHAR_DATO       CHAR      (8);                                 
 DCL     PIC_DATO        PIC       '(8)9' DEF CHAR_DATO;                
                                                                        
 DCL     CHAR_CPRNR      CHAR      (10);                                
 DCL     PIC_CPRNR       PIC       '(10)9' DEF CHAR_CPRNR;              
 DCL     FRAFLYTDATO_SAT BIT       (1)     INIT ('0'B);                 
 DCL     INDFLYTDATO_SAT BIT       (1)     INIT ('0'B);                 
                                                                        
 DCL     CHAR_ÅR         CHAR      (4);                                 
 DCL     PIC_ÅR          PIC       '(4)9' DEF CHAR_ÅR;                  
                                                                        
 DCL     SØG_DCPR        DEC FIXED (11);                                
 DCL     SØG_EKOMNR      BIN FIXED (15);                                
 DCL     SØG_VEJK_EJD    CHAR      (04);;  /*RETTET FRA BIN(15)*/       
 DCL     SØG_HUSNR_EJD1  CHAR      (03);                                
 DCL     SØG_HUSNR_EJD2  CHAR      (03);                                
 DCL     SØG_ETAGE1      CHAR      (02);                                
 DCL     SØG_ETAGE2      CHAR      (02);                                
 DCL     SØG_ETAGE3      CHAR      (02);                                
 DCL     SØG_SIDE_DØRNR1 CHAR      (04);                                
 DCL     SØG_SIDE_DØRNR2 CHAR      (04);                                
 DCL     SØG_SIDE_DØRNR3 CHAR      (04);                                
 DCL     SØG_HUSBOGSTAV1 CHAR      (01); /*NY*/                         
 DCL     SØG_HUSBOGSTAV2 CHAR      (01); /*NY*/                         
 DCL     SØG_HUSBOGSTAV3 CHAR      (01); /*NY*/                         
                                                                        
 DCL     PER_IX          BIN FIXED (15)      INIT      (0);  /*#18-03*/ 
 /********************************************************************* 
 *       DECLARE AF HJÆLPEFELTER TIL MASKINEL AFSTEMNING              * 
 *********************************************************************/ 
 DCL     BH946_ANT_INDV FIXED      (7)       INIT      (0);             
 DCL     (I,J,K,N)       BIN FIXED (15)      INIT      (0);             
 DCL     SWFEJL          CHAR      (1)       INIT      (' ');           
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
         CALL DECLARE_CURSOR;                                           
         CALL DECLARE_ERHVERV_CSRP_CUR;                                 
                                                                        
         EOF_BH946 = NEJ;                                               
         EOF_BH655 = NEJ;                                               
         ON ERROR                                                       
            CALL PLIDUMP ('SNHOB');                                     
         OPEN FILE (BH946I)  TITLE ('BH94601I');                        
         OPEN FILE (BH9321O) TITLE ('BH93210O');                        
         OPEN FILE (BH9322O) TITLE ('BH93220O');                        
         OPEN FILE (BH655I)  TITLE ('BH65501I');                        
                                                                        
         ON ENDFILE (BH946I)                                            
            EOF_BH946 = JA;                                             
                                                                        
         ON ENDFILE (BH655I)                                            
            EOF_BH655 = JA;                                             
                                                                        
         CALL ZZ20390 ('*OPEN','BH93201Y');                             
                                                                        
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         OVERLIN1.DATO  = UDDATO;                                       
                                                                        
         SIDELIN.CCA    = ZZIK1;                                        
         OVERLIN1.CCA   = ZZWS2;                                        
         OVERLIN2.CCA   = ZZWS3;                                        
                                                                        
         TV = 0;                                                        
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL LÆS_BH946;                                                
         CALL LÆS_BH655;                                                
                                                                        
         DO WHILE ( EOF_BH946 = NEJ );                                  
                                                                        
            SELECT;                                                     
               WHEN ( MTFIL.DCPRN < BH946.SORT_CPR & EOF_BH655 = NEJ )  
                  CALL LÆS_BH655;                                       
               OTHERWISE                                                
                  DO;                                                   
                     CALL BEHANDL;                                      
                     CALL LÆS_BH946;                                    
                  END;                                                  
                                                                        
            END; /* SELECT */                                           
                                                                        
         END;                                                           
                                                                        
         DO WHILE ( EOF_BH655 = NEJ );                                  
            CALL LÆS_BH655;                                             
         END;                                                           
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /********************************************************************* 
 *       LÆS BEREGNINGSBÅND                                           * 
 *********************************************************************/ 
 LÆS_BH946:                                                             
         PROC;                                                          
         READ FILE (BH946I) INTO (BH946_AR);                            
         IF BH946.SORT_CPR = 99999999999     /* OPTÆLL.INDV. */         
         THEN                                                           
            DO;                                                         
               BH946_ANT_INDV = BH94699.ANT_INDV;                       
               READ FILE (BH946I) INTO (BH946_AR);                      
            END;                                                        
                                                                        
         IF EOF_BH946 = NEJ                                             
         THEN DO;                                                       
            TV.LÆS_BH946 = TV.LÆS_BH946 + 1;                            
            IF TFLAG THEN DO;                                           
               PUT SKIP LIST('LOGNING af CPRNR = '!!                    
                             BH946.SORT_CPR);                           
            END;                                                        
         END;                                                           
                                                                        
                                                                        
 END LÆS_BH946;                                                         
 /*********************************************************************/
 /*      LÆS MINI-MTFIL B.H65501D  KOMMER FRA BH90100                 */
 /*********************************************************************/
 LÆS_BH655:                                                             
         PROC;                                                          
         READ FILE (BH655I) INTO (MTFIL);                               
         IF EOF_BH655 = NEJ &                                           
            MTFIL_OPT.DCPRN < 9999999999 /* OPTÆLLINGSINDV.*/           
         THEN                                                           
            TV.LÆS_BH655 = TV.LÆS_BH655 + 1;                            
         IF MTFIL_OPT.DCPRN >= 9999999999 /* OPTÆLLINGSINDV.*/          
         THEN                                                           
            READ FILE (BH655I) INTO (MTFIL);                            
 END LÆS_BH655;                                                         
 /********************************************************************* 
 *       PERSONER SOM EVT. SKAL BEHANDLES/BEREGNES                    * 
 *********************************************************************/ 
 BEHANDL:                                                               
 PROC;                                                                  
                                                                        
         IF BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '16' !                 
           (BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '  ' &                 
            BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '16')                  
         THEN                                                           
           DO;                                                          
              /* EJENDOMME VURDERET SOM UDGÅET */                       
              /* SKAL IKKE VIDEREFØRES UANSET  */                       
              /* EJERSKAB.                     */                       
              /* NY REGEL FRA OG MED SLUT 2004 */                       
              /* P.G.A. HANSTHOLM SITUATIONER  */                       
              TV.BK16 = TV.BK16 + 1;                                    
              RETURN;                                                   
           END;                                                         
                                                                        
         BH946.TIL_EVS.GPCTEJER_SW = -1;                                
         BH946.TIL_EVS.BFASTSTIGBGR_SW = -1;                            
         BH946.TIL_EVS.BEVSGL_SW = -1;                                  
         BH946.TIL_EVS.BPENSNEDGL_SW = -1;                              
         BH946.TIL_EVS.BPENSNÆGL_SW = -1;                               
         BH946.TIL_EVS.BGLSUM1_SW = -1;                                 
                                                                        
         IF BH946.EVS_SLUT_EJER.DCPRN > 0                               
          & BH946.EVS_SLUT_EJER.SIDSTE.COMPLA > '0'                     
         THEN                                                           
            DO;                                                         
              BH946.TIL_EVS.AKT_EJER.COMPLA =                           
                     BH946.EVS_SLUT_EJER.SIDSTE.COMPLA;                 
              BH946.TIL_EVS.AKT_EJER.DOMPLACPR =                        
                     BH946.EVS_SLUT_EJER.SIDSTE.DOMPLACPR;              
            END;                                                        
                                                                        
         IF BH946.AKT_EJER.COMPLA = '2' &                               
            BH946.AKT_EJER.DOMPLAÅR > 0 &                               
            BH946.TIL_EVS.CDATAFRA = ' '                                
         THEN                                                           
            DO;                                                         
               IF BH946.AKT_EJER.DOMPLAÅR = SLUTÅR                      
               THEN                                                     
                  BH946.TIL_EVS.CDATAFRA = '2';                         
               ELSE                                                     
                  BH946.TIL_EVS.CDATAFRA = '1';                         
            END;                                                        
                                                                        
         /* SKAF DIVERSE DATA FRA EVS UDTRÆKKENE */                     
         /* TIL BRUG FOR BEREGNING M.V.          */                     
                                                                        
         CALL SKAF_FASTFROSSEN;                                         
                                                                        
         IF BH946.SORT_KOMNR = 999                                      
         THEN                                                           
            CALL SKAF_DIV_EVSOPL;                                       
                                                                        
         IF BH946.ESR.EKOMNR > 0 &                                      
            BH946.ESR.CFRED = '1'                                       
         THEN                                                           
            DO;                                                         
               /* KODE FOR FREDNING SKAL ALTID TAGES FRA */             
               /* ESR-UDTRÆKKET HVIS MULIGT              */             
               BH946.TIL_EVS.CFRED = BH946.ESR.CFRED;                   
               BH946.TIL_FORSKUD.COPR_CFRED = 'E';                      
            END;                                                        
                                                                        
         IF BH946.EVS_FORSK_EJER.CENKE >= '3'                           
         THEN                                                           
            DO;                                                         
              BH946.TIL_EVS.CENKE = BH946.EVS_FORSK_EJER.CENKE;         
              BH946.TIL_FORSKUD.COPR_CENKE = 'F';                       
            END;                                                        
                                                                        
         IF BH946.EVS_SLUT_EJER.DCPRN > 0 &                             
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                    
            BH946.EVS_SLUT_EJER.SIDSTE.CENKE >= '3' &                   
            BH946.TIL_EVS.CENKE = ' '                                   
         THEN                                                           
           DO;                                                          
             BH946.TIL_EVS.CENKE =                                      
             BH946.EVS_SLUT_EJER.SIDSTE.CENKE;                          
             BH946.TIL_FORSKUD.COPR_CENKE = 'S';                        
           END;                                                         
                                                                        
         CALL INIT_INDIKATORER(BH946.VURD_AKT);                         
         CALL INIT_INDIK015ANV(BH946.VURD_02ANV);                       
         CALL INIT_INDIKATORER(BH946.VURD_02);                          
         CALL INIT_INDIKATORER(BH946.VURD_02OM);                        
         CALL INIT_INDIKATORER(BH946.VURD_02OMNY);                      
         CALL INIT_INDIKATORER(BH946.VURD_01OM);                        
         CALL INIT_INDIKATORER(BH946.VURD_01OMNY);                      
         CALL INIT_INDIKATORER(BH946.VURD_015PCT);                      
         CALL INIT_INDIK015ANV(BH946.VURD_015ANV);                      
                                                                        
  /*     BH946.EJERSKAB.BBERGRLUDL_01_SW = -1;      /* #18-02 SLUT09 */ 
         BH946.EJERSKAB.UDL_614_SW = -1;            /*#18-02  SLUT10 */ 
         BH946.EJERSKAB.UDL_615_SW = -1;            /*#18-05  SLUT11 */ 
         BH946.EJERSKAB.UDL_621_SW = -1;            /*#18-05  SLUT11 */ 
         BH946.EJERSKAB.UDL_622_SW = -1;            /*#18-05  SLUT11 */ 
                                                                        
         BH946.EJERSKAB.BBERGRL_SW = -1;                                
         BH946.EJERSKAB.BBER2FAM_SW = -1;                               
         BH946.EJERSKAB.BEJBOLANV_SW = -1;                              
                                                                        
         BH946.EJENDOM.BEJDVÆR_SW = -1;                                 
         BH946.EJENDOM.BEJBOL1_SW = -1;                                 
         BH946.EJENDOM.BEJBOL2_SW = -1;                                 
                                                                        
         IF (BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '09' !                
             BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '17' !                
             BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '49') &               
            (BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '01' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '02' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '05' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '08' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '41' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '42') &               
            (BH946.ESR.VURDOPLNY.OMBER01(1).KONSEKVENS = 'J' !          
             BH946.ESR.VURDOPLNY.OMBER01(1).KONSEKVENS = 'N' !          
             BH946.ESR.VURDOPLNY.OMBER01(2).KONSEKVENS = 'J' !          
             BH946.ESR.VURDOPLNY.OMBER01(2).KONSEKVENS = 'N' ) &        
             BH946.ESR.VURDOPLNY.CUOP ^= '6'                            
         THEN                                                           
           DO;                                                          
              /* NY REGEL FRA OG MED SLUT 2004    */                    
              /* P.G.A. HANSTHOLM SITUATIONER     */                    
              /* HVOR DIV VURDOPL IKKE SKAL       */                    
              /* OPSÆTTES (SKAL HAVE FEJLNR. 5019)*/                    
              TV.HANST = TV.HANST + 1;                                  
           END;                                                         
         ELSE                                                           
            CALL OPSÆT_DIV_VURDOPL;                                     
                                                                        
 /* FORSKUD11 INGEN FORSKEL PÅ DANSKE OG UDENLANDSKE EJD I BEREGNINGEN  
         IF BH946.SORT_KOMNR = 999 &                                    
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1'                      
         THEN                                                           
           DO;                                                          
  *#18-02*    BH946.EJERSKAB.UDL_614 =                                  
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRLUDL_01 +                
              BH946.EVS_SLUT_EJER.SIDSTE.BOMBTILBUDL_01;                
              BH946.EJERSKAB.UDL_614_SW =                               
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRLUDL_01_SW;  * SLUT09 *  
                                                           FORSKUD11 */ 
 /*#18-02     BH946.EJERSKAB.BBERGRLUDL_01 =                            
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRLUDL_01 +                
              BH946.EVS_SLUT_EJER.SIDSTE.BOMBTILBUDL_01;                
              BH946.EJERSKAB.BBERGRLUDL_01_SW =                         
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRLUDL_01_SW;    SLUT09 */ 
                                                                        
      /*      BH946.VURD_015ANV.BBER2FAM_015ANV =           #18-02-01   
              BH946.EVS_SLUT_EJER.SIDSTE.BBER2FAM_015ANV;    SLUT 2006  
              BH946.VURD_015ANV.BBER2FAM_015ANV_SW =                    
              BH946.EVS_SLUT_EJER.SIDSTE.BBER2FAM_015ANV_SW;  */        
 /*        END;                                             FORSKUD11 */
                                                                        
 /*#SLUT10  DE SAMME FELTER BRUGES TIL DANSKE OG UDENLANDSKE EJD */     
         IF BH946.SORT_KOMNR = 999 &                                    
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1'                      
         THEN                                                           
           DO;                                                          
              BH946.EJERSKAB.UDL_614 =                                  
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRL_015ANV;                
              BH946.EJERSKAB.UDL_614_SW =                               
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRL_015ANV_SW;             
              BH946.EJERSKAB.UDL_615 =                        /*slut11*/
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRL_02ANV;       /*slut11*/
              BH946.EJERSKAB.UDL_615_SW =                     /*slut11*/
              BH946.EVS_SLUT_EJER.SIDSTE.BBERGRL_02ANV_SW;    /*slut11*/
              BH946.EJERSKAB.UDL_621 =                        /*slut11*/
              BH946.EVS_SLUT_EJER.SIDSTE.BBER2FAM_015ANV;     /*slut11*/
              BH946.EJERSKAB.UDL_621_SW =                     /*slut11*/
              BH946.EVS_SLUT_EJER.SIDSTE.BBER2FAM_015ANV_SW;  /*slut11*/
              BH946.EJERSKAB.UDL_622 =                        /*slut11*/
              BH946.EVS_SLUT_EJER.SIDSTE.BBER2FAM_02ANV;      /*slut11*/
              BH946.EJERSKAB.UDL_622_SW =                     /*slut11*/
              BH946.EVS_SLUT_EJER.SIDSTE.BBER2FAM_02ANV_SW;   /*slut11*/
           END;                                                         
                                                                        
         IF BH946.SORT_CPR < MTFIL.DCPRN                                
         THEN                                                           
            DO;                                                         
               /* PERSONEN FINDES  I K K E  PÅ MT-FILEN */              
                                                                        
               IF BH946.CINVPNR = '0'                                   
               THEN                                                     
                  CALL LÆS_PERSON_CSRPDATA;                             
                                                                        
               BH946.DSORP = BH946.SORT_CPR;                            
               BH946.CPART = '1';                                       
               /* OPSÆT DEFAULT REGNSKABSÅR */                          
               BH946.MT.DRGNÅRFRA = BH65300M.ÅR0101;                    
               BH946.MT.DRGNÅRTIL = BH65300M.ÅR1231;                    
                                                                        
               IF BH946.CINVPNR = '0'                                   
               THEN                                                     
                  TV.EJMT = TV.EJMT + 1;                                
               ELSE                                                     
                  TV.EJPNR = TV.EJPNR + 1;                              
            END;                                                        
         ELSE                                                           
            DO;                                                         
               /* PERSONEN ER FUNDET PÅ MT-FILEN */                     
               TV.FMT = TV.FMT + 1;                                     
               BH946.MT = MTFIL, BY NAME;                               
            END;                                                        
                                                                        
         BH60101M = '';                                                 
                                                                        
         /* OPSÆT SKÆRINGSDATOER TIL BEREGNING AF ALDER     */          
         /* UNDER HENSYNTAGEN TIL EVT. FORSKUDT REGNSKABSÅR */          
                                                                        
         IF BH946.MT.CFRÅR > '01'                                       
         THEN                                                           
            DO;                                                         
               PRDATO1 = BH946.MT.DRGNÅRTIL;                            
               PRDATO2 = BH946.MT.DRGNÅRTIL + 10000;                    
            END;                                                        
         ELSE                                                           
            DO;                                                         
               PRDATO1 = PR_DATO1;                                      
               PRDATO2 = PR_DATO2;                                      
            END;                                                        
                                                                        
         /* UNDERSØG OM AKTUEL PERSON          */                       
         /* ER PENSIONIST I 2008 (65-/67-ÅRIG) */                       
         /* OG/ELLER                           */                       
         /* ER PENSIONIST I 2009 (65-/67-ÅRIG) */                       
                                                                        
         HJ_CPR = BH946.SORT_CPR;                                       
                                                                        
         IF TFLAG                                                       
         THEN DO;                                                       
            PUT SKIP LIST('SORT_KOMNR       = '!!BH946.SORT_KOMNR);     
            PUT SKIP LIST('PRDATO1             = '!!PRDATO1);           
            PUT SKIP LIST('PRDATO2             = '!!PRDATO2);           
            PUT SKIP LIST('EVS_UDTRÆK/CSKPLOMF = '!!                    
             BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF);           
            PUT SKIP LIST('INFO FRA GLSLUTÅR (2013)');                  
            PUT SKIP LIST('SAMBESKATNINGKODE   = '!!                    
                          BH946.MT.HIST_OPL(GLSLUTÅR).CSBSK);           
            PUT SKIP LIST('SKATTEPLIG OMFANG   = '!!                    
                          BH946.MT.HIST_OPL(GLSLUTÅR).CSKPLOM);         
            PUT SKIP LIST('FØR- / EFTERLØNNER  = '!!                    
                          BH946.MT.HIST_OPL(GLSLUTÅR).CFØREFT);         
            PUT SKIP LIST('INFO FRA SLUTÅR (2014)');                    
            PUT SKIP LIST('SAMBESKATNINGKODE   = '!!                    
                          BH946.MT.HIST_OPL(SLUTÅR).CSBSK);             
            PUT SKIP LIST('SKATTEPLIG OMFANG   = '!!                    
                          BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM);           
            PUT SKIP LIST('FØR- / EFTERLØNNER  = '!!                    
                          BH946.MT.HIST_OPL(SLUTÅR).CFØREFT);           
            PUT SKIP LIST('INFO FRA FORSKUDÅR (2015)');                 
            PUT SKIP LIST('SAMBESKATNINGKODE   = '!!                    
                          BH946.MT.HIST_OPL(FORSKÅR).CSBSK);            
            PUT SKIP LIST('SKATTEPLIG OMFANG   = '!!                    
                          BH946.MT.HIST_OPL(FORSKÅR).CSKPLOM);          
            PUT SKIP LIST('FØR- / EFTERLØNNER  = '!!                    
                          BH946.MT.HIST_OPL(FORSKÅR).CFØREFT);          
         END;                                                           
                                                                        
         IF PERSON_ALDER_OK(PRDATO1,HJ_CPR,'1')   /*FØRST I 2008*/      
          ! PERSON_ALDER_OK(PRDATO1,HJ_CPR,'4')                         
         THEN                                                           
            DO;                                                         
               HJ67 = '1';                                              
               IF (BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1' /* #01 */    
                 ! BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3'              
                 ! BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8')             
                /* #02 */                                               
                ! (BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '1' 
                 ! BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '3' 
                 ! BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '8')
               THEN DO;                                                 
                  IF BH946.SORT_KOMNR = 999                             
                  THEN DO;                                              
                     BH946.TIL_EVS.CPTYPSLUT = '2';                     
                     BH946.TIL_EVS.CPTYPFOR  = '2';                     
                  END;                                                  
                  ELSE DO;                                              
                     BH946.TIL_EVS.CPTYPSLUT = '4';                     
                     BH946.TIL_EVS.CPTYPFOR  = '4';                     
                     DAN_4_BEHANDL_PRDATO1  += 1;                       
                  END;                                                  
               END;                                                     
               ELSE DO;                                                 
                  BH946.TIL_EVS.CPTYPSLUT = '3';                        
                  BH946.TIL_EVS.CPTYPFOR  = '3';                        
               END;                                                     
            END;                                                        
         ELSE                                                           
            IF PERSON_ALDER_OK(PRDATO2,HJ_CPR,'1')   /*SÅ 2009*/        
             ! PERSON_ALDER_OK(PRDATO2,HJ_CPR,'4')                      
            THEN DO;                                                    
               IF (BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1' /* #01 */    
                 ! BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3'              
                 ! BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8')             
               /* #02 */                                                
                ! (BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '1' 
                 ! BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '3' 
                 ! BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '8')
               THEN DO;                                                 
                  BH946.TIL_EVS.CPTYPFOR  = '4';                        
                  DAN_4_BEHANDL_PRDATO2  += 1;                          
               END;                                                     
               ELSE                                                     
                  BH946.TIL_EVS.CPTYPFOR = '3';                         
            END;                                                        
                                                                        
         IF TFLAG                                                       
         THEN DO;                                                       
            PUT SKIP LIST('CPTYPE           = '!!                       
                          BH946.TIL_EVS.CPTYPFOR);                      
         END;                                                           
                                                                        
         IF BH946.CINVPNR = '0'                                         
         THEN                                                           
            DO;                                                         
               IF BH946.AKT_EJER.DCPRCIR > 0                            
               THEN                                                     
                  DO;                                                   
                     /* REGNSKABSÅR-OPLYSNINGER OPSÆTTES  */            
                     /* PÅ AKTUEL EJER LIG MT-OPLYSNINGER */            
                     /* A.H.T. SUPPLEMENTSKØRSEL          */            
                     BH946.AKT_EJER.DRGNÅRFRA = BH946.MT.DRGNÅRFRA;     
                     BH946.AKT_EJER.DRGNÅRTIL = BH946.MT.DRGNÅRTIL;     
                     CALL OPSÆT_1_7_98_STATUS                           
                     (BH946.AKT_EJER,BH946.NEDSLAG.EJER);               
                                                                        
                     IF BH946.MT.HIST_OPL(SLUTÅR).DCIÆN > 0 &           
                        BH946.NEDSLAG.EJER.DATO0107 <=                  
                        BH946.MT.HIST_OPL(SLUTÅR).DCIÆN                 
                     THEN                                               
                     /* EJENDOMMEN VAR OGSÅ EJET AF     */              
                     /* EJEREN FØR ELLER PÅ DEN         */              
                     /* SENESTE CIVILSTANDSÆNDRINGSDATO */              
                        BH946.NEDSLAG.CÆGTEJET = 1;                     
                  END;                                                  
                                                                        
               IF BH946.AKT_ÆGTF.DCPRCIR > 0                            
               THEN                                                     
                  DO;                                                   
                     CALL OPSÆT_1_7_98_STATUS                           
                     (BH946.AKT_ÆGTF,BH946.NEDSLAG.ÆGTF);               
                                                                        
                     IF BH946.MT.HIST_OPL(SLUTÅR).DCIÆN > 0 &           
                        BH946.NEDSLAG.ÆGTF.DATO0107 <=                  
                        BH946.MT.HIST_OPL(SLUTÅR).DCIÆN                 
                     THEN                                               
                     /* EJENDOMMEN VAR OGSÅ EJET AF     */              
                     /* ÆGTEFÆLLEN FØR ELLER PÅ DEN     */              
                     /* SENESTE CIVILSTANDSÆNDRINGSDATO */              
                        BH946.NEDSLAG.CÆGTEJET = 1;                     
                  END;                                                  
                                                                        
               CALL OVERFØR_1_7_98_STATUS(BH946.NEDSLAG);               
                                                                        
               CALL ENDELIG_CNEDSL1(BH946.TIL_EVS.CNEDSL1,              
                                    BH946.TIL_FORSKUD.COPR_CNEDSL1);    
               CALL ENDELIG_1_7_98_DATO(BH946.TIL_EVS.DATO0107,         
                                        BH946.TIL_EVS.CNEDSL1,          
                                        BH946.TIL_FORSKUD.COPR_CNEDSL1);
            END;                                                        
                                                                        
         IF BH946.MT.CCIVS = 'D'                                        
         THEN                                                           
            DO;                                                         
               /* HVIS PERSONEN ER DØD IFLG. MT-FIL   */                
               /* SKAL DER IKKE BEREGNES, MEN PERSO-  */                
               /* MEDTAGES AF HENSYN TIL OPSÆTNING AF */                
               /* BETALT FORSKUDSSKAT, 1/7-98-STATUS  */                
               /* SAMT EVT. HELÅRSSOMMERHUSSTATUS PÅ  */                
               /* EVT. EFTERLEVENDE                   */                
               BH946.DSORP = BH946.SORT_CPR;                            
               BH946.CPART = '1';                                       
            END;                                                        
                                                                        
         IF BH946.MT.DCPRN > 0                                          
         THEN                                                           
            /* PERSONEN FANDTES PÅ MT-FILEN */                          
            CALL OPSÆT_OPLYSNINGER_FRA_MTFIL;                           
                                                                        
         CALL OPSÆT_PERSONTYPE;                                         
                                                                        
         IF BH946.CINVPNR ^= '0'                                        
         THEN                                                           
            DO;                                                         
               BH946.TIL_EVS.CPTYPSLUT = ' ';                           
               BH946.TIL_EVS.CPTYPFOR = ' ';                            
            END;                                                        
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH946.AKT_EJER.DCPRCIR > 0)                            
             DO;                                                        
               IF BH946.AKT_EJER.GANE > 0                               
               THEN                                                     
                 DO;                                                    
                   BH946.TIL_EVS.GPCTEJER = BH946.AKT_EJER.GANE / 100;  
                   BH946.TIL_EVS.GPCTEJER_SW = 0;                       
                 END;                                                   
               ELSE                                                     
                 IF BH946.AKT_EJER.FEJER = 1                            
                 THEN                                                   
                   DO;                                                  
                     BH946.TIL_EVS.GPCTEJER = 100.00;                   
                     BH946.TIL_EVS.GPCTEJER_SW = 0;                     
                   END;                                                 
               IF BH946.TIL_EVS.GPCTEJER_SW = 0                         
               THEN                                                     
                  BH946.TIL_FORSKUD.COPR_GPCTEJER = 'E';                
               CALL HENT_EJERANDEL;                                     
            END;                                                        
                                                                        
         WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                          
               BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                 
               BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9')                
           DO;                                                          
              IF BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0             
              THEN                                                      
                 DO;                                                    
                    BH946.TIL_EVS.GPCTEJER =                            
                    BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER;                
                    BH946.TIL_EVS.GPCTEJER_SW = 0;                      
                    BH946.TIL_FORSKUD.COPR_GPCTEJER = 'S';              
                 END;                                                   
           END;                                                         
                                                                        
         WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                          
               BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                 
               BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '9' &               
               BH946.EVS_SLUT_EJER.SIDSTE.CÆGTOPR < '1')                
           DO;                                                          
              IF BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0             
              THEN                                                      
                 DO;                                                    
                    BH946.TIL_EVS.GPCTEJER =                            
                    BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER;                
                    BH946.TIL_EVS.GPCTEJER_SW = 0;                      
                    BH946.TIL_FORSKUD.COPR_GPCTEJER = 'S';              
                 END;                                                   
           END;                                                         
                                                                        
         WHEN (BH946.EVS_FORSK_EJER.DCPRN > 0)                          
           DO;                                                          
             IF BH946.EVS_FORSK_EJER.GPCTEJER > 0                       
             THEN                                                       
               DO;                                                      
                 BH946.TIL_EVS.GPCTEJER =                               
                 BH946.EVS_FORSK_EJER.GPCTEJER / 100;                   
                 BH946.TIL_EVS.GPCTEJER_SW = 0;                         
                 BH946.TIL_FORSKUD.COPR_GPCTEJER = 'F';                 
               END;                                                     
             ELSE                                                       
               IF BH946.EVS_FORSK_EJER.CEJBEVS = '0' !                  
                  BH946.EVS_FORSK_EJER.CEJBEVS = '4'                    
               THEN                                                     
                 DO;                                                    
                   BH946.TIL_EVS.GPCTEJER = 100.00;                     
                   BH946.TIL_EVS.GPCTEJER_SW = 0;                       
                   BH946.TIL_FORSKUD.COPR_GPCTEJER = 'F';               
                 END;                                                   
           END;                                                         
                                                                        
           OTHERWISE;                                                   
                                                                        
         END;                                                           
                                                                        
         SELECT;                                                        
                                                                        
           WHEN ( BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '8' &            
                  BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' )              
              BH946.TIL_EVS.CEJBEVS = '8';                              
                                                                        
           WHEN ( BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '7' &            
                  BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' )              
              BH946.TIL_EVS.CEJBEVS = '7';                              
                                                                        
           WHEN ( BH946.EVS_SLUT_EJER.SIDSTE.FDAGUDLE = 360 &           
                  BH946.EVS_SLUT_EJER.SIDSTE.GPCTUDLE = 100.00 &        
                  BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' )              
             DO;                                                        
                BH946.TIL_EVS.CEJBEVS = '7';                            
             END;                                                       
                                                                        
    /*     WHEN ( BH946.EVS_FORSK_EJER.CEJBEVS = '7' &   *SLUT05*       
                  BH946.EVS_FORSK_EJER.COPR_CEJBEVS = 'K' )             
                BH946.TIL_EVS.CEJBEVS = '7';                  */        
                                                                        
    /*     WHEN ( BH946.EVS_FORSK_EJER.CEJBEVS = '8' )   *SLUT05*       
                BH946.TIL_EVS.CEJBEVS = '8';                  */        
                                                                        
           OTHERWISE                                                    
             DO;                                                        
             END;                                                       
                                                                        
         END;  /* SELECT */                                             
                                                                        
         IF BH946.TIL_EVS.CEJBEVS < '7' &                               
            BH946.EVS_SLUT_EJER.FØRSTE.CEJBEVS < '7' &                  
          ((BH946.EVS_SLUT_EJER.SIDSTE.FERHVFLER > 0 &                  
            BH946.EVS_SLUT_EJER.SIDSTE.FERHVFLER < 360) &               
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1')                     
         THEN                                                           
            BH946.TIL_EVS.CEJBEVS = '7';                                
                                                                        
         IF BH946.TIL_EVS.CEJBEVS = '7' &                               
            BH946.EVS_SLUT_EJER.FØRSTE.CEJBEVS = '7' &                  
           (BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '7' &                  
           (BH946.EVS_SLUT_EJER.SIDSTE.FERHVFLER > 0 &                  
            BH946.EVS_SLUT_EJER.SIDSTE.FERHVFLER < 360) &               
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1')                     
         THEN                                                           
            BH946.TIL_EVS.CEJBEVS = ' ';                                
                                                                        
         CALL OPSÆT_SAMMENLIGN_GRLAG;                                   
                                                                        
         CALL OPSÆT_FLYTTE_DATOER;                                      
                                                                        
         IF BH946.TIL_EVS.CEJBEVS = '7'  /* #18-03 SLUT09 */            
         THEN                                                           
            CALL SKAF_DERHVPER;                                         
                                                                        
         IF BH946.AKT_VURD.BEJDVÆP4A ^= 0 /*OPTÆL PGF 4 VURDEREDE EJD*/ 
         THEN                                                           
            TV.PGF4A = TV.PGF4A + 1;                                    
                                                                        
         IF BH946.ESR.BEJDVÆP4B ^= 0 /*OPTÆL PGF 4 VURDEREDE EJD*/      
         THEN                                                           
            TV.PGF4B = TV.PGF4B + 1;                                    
                                                                        
         IF BH946.AKT_VURD.CFORSKEL = '1'                               
         THEN                                                           
            TV.FORSKEL1 = TV.FORSKEL1 + 1;                              
                                                                        
         IF BH946.AKT_VURD.CFORSKEL = '2'                               
         THEN                                                           
            TV.FORSKEL2 = TV.FORSKEL2 + 1;                              
                                                                        
         IF BH946.AKT_VURD.CFORSKEL = '3'                               
         THEN                                                           
            TV.FORSKEL3 = TV.FORSKEL3 + 1;                              
                                                                        
         BH946.HJ_67    = HJ67;                                         
         BH946.HJ_HNV67 = HJHNV67;                                      
                                                                        
         CALL SKRIV_PERSON;                                             
                                                                        
 END BEHANDL;                                                           
                                                                        
 /********************************************************************* 
 *       SKAF DIVERSE DATA FRA EVS-UDTRÆKKENE SOM IKKE BLIVER OPSAT   * 
 *       HVIS DER MANGLER ESR-OPLYSNINGER                             * 
 *********************************************************************/ 
 SKAF_DIV_EVSOPL:                                                       
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &             
                 BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1')                
              DO;                                                       
                 IF BH946.EVS_SLUT_EJER.SIDSTE.FELT760 = '1'            
                 THEN                                                   
                    DO;                                                 
                       BH946.TIL_EVS.CFRED =                            
                       BH946.EVS_SLUT_EJER.SIDSTE.FELT760;              
                       BH946.TIL_FORSKUD.COPR_CFRED = 'S';              
                    END;                                                
              END;                                                      
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                        
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS < '9' &             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1')                
              DO;                                                       
                 IF BH946.EVS_SLUT_ÆGTF.SIDSTE.FELT760 = '1'            
                 THEN                                                   
                    DO;                                                 
                       BH946.TIL_EVS.CFRED =                            
                       BH946.EVS_SLUT_ÆGTF.SIDSTE.FELT760;              
                       BH946.TIL_FORSKUD.COPR_CFRED = 'S';              
                    END;                                                
              END;                                                      
                                                                        
           WHEN (BH946.EVS_FORSK_EJER.DCPRN > 0)                        
              DO;                                                       
                 IF BH946.EVS_FORSK_EJER.CFRED = '1'                    
                 THEN                                                   
                    DO;                                                 
                       BH946.TIL_EVS.CFRED =                            
                       BH946.EVS_FORSK_EJER.CFRED;                      
                       BH946.TIL_FORSKUD.COPR_CFRED = 'F';              
                    END;                                                
              END;                                                      
                                                                        
           WHEN (BH946.EVS_FORSK_ÆGTF.DCPRN > 0)                        
              DO;                                                       
                 IF BH946.EVS_FORSK_ÆGTF.CFRED = '1'                    
                 THEN                                                   
                    DO;                                                 
                       BH946.TIL_EVS.CFRED =                            
                       BH946.EVS_FORSK_ÆGTF.CFRED;                      
                       BH946.TIL_FORSKUD.COPR_CFRED = 'F';              
                    END;                                                
              END;                                                      
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END SKAF_DIV_EVSOPL;                                                   
 /********************************************************************  
 *    BEBOEDE PERIODER HENTES FRA CSRP TABELLER       #18-03 SLUT09  *  
 *********************************************************************/ 
 SKAF_DERHVPER:PROC;                                                    
                                                                        
      BH946.EJERSKAB.DERHVPER_FRA1 = '';                                
      BH946.EJERSKAB.DERHVPER_TIL1 = '';                                
      BH946.EJERSKAB.DERHVPER_FRA2 = '';                                
      BH946.EJERSKAB.DERHVPER_TIL2 = '';                                
      BH946.EJERSKAB.DERHVPER_FRA3 = '';                                
      BH946.EJERSKAB.DERHVPER_TIL3 = '';                                
      BH946.EJERSKAB.DERHVPER_FRA4 = '';                                
      BH946.EJERSKAB.DERHVPER_TIL4 = '';                                
      BH946.EJERSKAB.DERHVPER_FRA5 = '';                                
      BH946.EJERSKAB.DERHVPER_TIL5 = '';                                
      BH946.EJERSKAB.FERHVPER_ANT  = 0;                                 
      BH946.EJERSKAB.FERHVPER_DAGE = 0;                                 
      BH946.EJERSKAB.CNEDTAG158    = ' ';                               
                                                                        
                                                                        
      IF (BH946.AKT_VURD.ANT_FOR_1 +                                    
          BH946.AKT_VURD.ANT_FOR_2 +                                    
          BH946.AKT_VURD.ANT_FOR_4 +                                    
          BH946.AKT_VURD.ANT_FOR_5 +                                    
          BH946.AKT_VURD.ANT_FOR_6 +                                    
          BH946.AKT_VURD.ANT_FOR_8 +                                    
          BH946.AKT_VURD.ANT_FOR_9) > 0                                 
      THEN                                                              
         CALL OPSÆT_EJD_ERHVERV_PER_CSRP;                               
      ELSE                                                              
         CALL OPSÆT_ERHVERV_PER_CSRP;                                   
                                                                        
      IF PER_IX > 5                                                     
      THEN                                                              
         PUT SKIP LIST ('CPR_NR > 5 PER:', BH946.EVS_SLUT_EJER.DCPRN);  
                                                                        
 END SKAF_DERHVPER;                                                     
 /*********************************************************************/
 /* OPSÆT BELØB VEDR. SAMMENLIGNINGSGRUNDLAG M.V. TIL BRUG VED        */
 /* BEREGNING AF EVT. STIGNINGSBEGRÆNSNING FRA GL. TIL NYT SLUTÅR     */
 /*********************************************************************/
 OPSÆT_SAMMENLIGN_GRLAG:                                                
 PROC;                                                                  
                                                                        
         IF BH946.TIL_EVS.CINVPNR ^= '0' !                              
          ((BH946.EVS_SLUT_EJER.DCPRN = 0 !                             
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET = '1' !                    
            BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS > '6') &                 
           (BH946.EVS_SLUT_ÆGTF.DCPRN = 0 !                             
            BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET = '1' !                    
            BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS > '6'))                  
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BH946.EVS_SLUT_EJER.DCPRN > 0 &                             
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                    
           (BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !                  
            BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !                  
            BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !                  
            BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6')                   
         THEN                                                           
            CALL OPSÆT_BEVSGL_EJER;                                     
                                                                        
         IF BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                             
            BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &                    
           (BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS = '0' !                  
            BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS = '4' !                  
            BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS = '5' !                  
            BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS = '6') &                 
            BH946.TIL_EVS.BEVSGL_SW = -1                                
         THEN                                                           
            CALL OPSÆT_BEVSGL_ÆGTF;                                     
                                                                        
         IF BH946.TIL_EVS.BEVSGL_SW = 0 &                               
            BH946.TIL_EVS.BEVSGL < 0                                    
         THEN                                                           
            BH946.TIL_EVS.BEVSGL = 0;                                   
                                                                        
         IF BH946.TIL_EVS.BPENSNEDGL_SW = 0 &                           
            BH946.TIL_EVS.BPENSNEDGL < 0                                
         THEN                                                           
            BH946.TIL_EVS.BPENSNEDGL = 0;                               
                                                                        
         IF BH946.TIL_EVS.BPENSNÆGL_SW = 0 &                            
            BH946.TIL_EVS.BPENSNÆGL < 0                                 
         THEN                                                           
            BH946.TIL_EVS.BPENSNÆGL = 0;                                
                                                                        
         IF BH946.TIL_EVS.CGLSLUTEVS > '0' &                            
            BH946.TIL_EVS.BGLSLUTEVS < 0                                
         THEN                                                           
            BH946.TIL_EVS.BGLSLUTEVS = 0;                               
                                                                        
         IF BH946.TIL_EVS.CGLSLUTEVS > '0' &                            
            BH946.TIL_EVS.BGLPENSNED < 0                                
         THEN                                                           
            BH946.TIL_EVS.BGLPENSNED = 0;                               
                                                                        
 /*********************************************************************/
 /* OPSÆT UDGANGSPUNKT FOR STIGNINGSBEGRÆNSNING                       */
 /* FRA 2007 TIL 2008 JVF. AKTUEL PERSONTYPE                          */
 /*********************************************************************/
 OPSÆT_BEVSGL_EJER:                                                     
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW = 0 &            
                 BH946.EVS_SLUT_EJER.SIDSTE.BMANEVSSTI_SW = 0)          
              DO;                                                       
                 BH946.TIL_EVS.BEVSGL =                                 
                 BH946.EVS_SLUT_EJER.SIDSTE.BMANEVSSTI;                 
                 BH946.TIL_EVS.BEVSGL_SW = 0;                           
                                                                        
                 BH946.TIL_EVS.BGLSLUTEVS =                             
                 BH946.EVS_SLUT_EJER.SIDSTE.BMANEVSSTI;                 
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '1';                        
                                                                        
                 BH946.TIL_EVS.CPTYPGL =                                
                 BH946.EVS_SLUT_EJER.SIDSTE.CPTYPSLUT;                  
                 BH946.TIL_EVS.CSKPLOMFGL =                             
                 BH946.EVS_SLUT_EJER.SIDSTE.CSKPLOMF;                   
              END;                                                      
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW = 0);            
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.SIDSTE.BNETTO_SW = 0)              
              DO;                                                       
                 BH946.TIL_EVS.BEVSGL =                                 
                 BH946.EVS_SLUT_EJER.SIDSTE.BNETTO;                     
                 BH946.TIL_EVS.BEVSGL_SW = 0;                           
                                                                        
                 BH946.TIL_EVS.BGLSLUTEVS =                             
                 BH946.EVS_SLUT_EJER.SIDSTE.BNETTO;                     
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '4';                        
                                                                        
                 BH946.TIL_EVS.CPTYPGL =                                
                 BH946.EVS_SLUT_EJER.SIDSTE.CPTYPSLUT;                  
                 BH946.TIL_EVS.CSKPLOMFGL =                             
                 BH946.EVS_SLUT_EJER.SIDSTE.CSKPLOMF;                   
              END;                                                      
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW = 0 &            
                 BH946.EVS_SLUT_EJER.SIDSTE.BMANEVSSTI_SW = 0 &         
                 BH946.EVS_SLUT_EJER.SIDSTE.MANPENSSTI_SW = 0)          
              DO;                                                       
                 BH946.TIL_EVS.BPENSNÆGL =                              
                 BH946.EVS_SLUT_EJER.SIDSTE.MANPENSSTI;                 
                 BH946.TIL_EVS.BPENSNÆGL_SW = 0;                        
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '2';                        
                                                                        
                 BH946.TIL_EVS.BGLPENSNED =                             
                 BH946.EVS_SLUT_EJER.SIDSTE.MANPENSSTI;                 
              END;                                                      
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW = 0);            
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.SIDSTE.BPENSNED > 0)               
              DO;                                                       
                 BH946.TIL_EVS.BPENSNÆGL =                              
                 BH946.EVS_SLUT_EJER.SIDSTE.BPENSNED;                   
                 BH946.TIL_EVS.BPENSNÆGL_SW = 0;                        
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '3';                        
                                                                        
                 BH946.TIL_EVS.BGLPENSNED =                             
                 BH946.EVS_SLUT_EJER.SIDSTE.BPENSNED;                   
              END;                                                      
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.SIDSTE.BNETTO_SW = 0 &             
                 BH946.EVS_SLUT_EJER.SIDSTE.BPENSNÆ > 0)                
              DO;                                                       
                 BH946.TIL_EVS.BPENSNÆGL =                              
                 BH946.EVS_SLUT_EJER.SIDSTE.BPENSNÆ;                    
                 BH946.TIL_EVS.BPENSNÆGL_SW = 0;                        
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '4';                        
                                                                        
                 BH946.TIL_EVS.BGLPENSNED =                             
                 BH946.EVS_SLUT_EJER.SIDSTE.BPENSNÆ;                    
              END;                                                      
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_BEVSGL_EJER;                                                 
                                                                        
 /*********************************************************************/
 /* OPSÆT UDGANGSPUNKT FOR STIGNINGSBEGRÆNSNING                       */
 /* FRA 2007 TIL 2008 JVF. AKTUEL PERSONTYPE                          */
 /*********************************************************************/
 OPSÆT_BEVSGL_ÆGTF:                                                     
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW = 0 &            
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BMANEVSSTI_SW = 0)          
              DO;                                                       
                 BH946.TIL_EVS.BEVSGL =                                 
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BMANEVSSTI;                 
                 BH946.TIL_EVS.BEVSGL_SW = 0;                           
                                                                        
                 BH946.TIL_EVS.BGLSLUTEVS =                             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BMANEVSSTI;                 
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '1';                        
                                                                        
                 BH946.TIL_EVS.CPTYPGL =                                
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CPTYPSLUT;                  
                 BH946.TIL_EVS.CSKPLOMFGL =                             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CSKPLOMF;                   
              END;                                                      
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW = 0);            
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.SIDSTE.BNETTO_SW = 0)              
              DO;                                                       
                 BH946.TIL_EVS.BEVSGL =                                 
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BNETTO;                     
                 BH946.TIL_EVS.BEVSGL_SW = 0;                           
                                                                        
                 BH946.TIL_EVS.BGLSLUTEVS =                             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BNETTO;                     
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '4';                        
                                                                        
                 BH946.TIL_EVS.CPTYPGL =                                
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CPTYPSLUT;                  
                 BH946.TIL_EVS.CSKPLOMFGL =                             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CSKPLOMF;                   
              END;                                                      
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW = 0 &            
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BMANEVSSTI_SW = 0 &         
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.MANPENSSTI_SW = 0)          
              DO;                                                       
                 BH946.TIL_EVS.BPENSNÆGL =                              
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BMANEVSSTI;                 
                 BH946.TIL_EVS.BPENSNÆGL_SW = 0;                        
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '2';                        
                                                                        
                 BH946.TIL_EVS.BGLPENSNED =                             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BMANEVSSTI;                 
              END;                                                      
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW = 0);            
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.SIDSTE.BPENSNED > 0)               
              DO;                                                       
                 BH946.TIL_EVS.BPENSNÆGL =                              
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BPENSNED;                   
                 BH946.TIL_EVS.BPENSNÆGL_SW = 0;                        
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '3';                        
                                                                        
                 BH946.TIL_EVS.BGLPENSNED =                             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BPENSNED;                   
              END;                                                      
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.SIDSTE.BNETTO_SW = 0 &             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BPENSNÆ > 0)                
              DO;                                                       
                 BH946.TIL_EVS.BPENSNÆGL =                              
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BPENSNÆ;                    
                 BH946.TIL_EVS.BPENSNÆGL_SW = 0;                        
                                                                        
                 BH946.TIL_EVS.CGLSLUTEVS = '4';                        
                                                                        
                 BH946.TIL_EVS.BGLPENSNED =                             
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BPENSNED;                   
              END;                                                      
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_BEVSGL_ÆGTF;                                                 
                                                                        
 END OPSÆT_SAMMENLIGN_GRLAG;                                            
                                                                        
 /*********************************************************************/
 /* OPSÆT AF IND- OG UDFLYTNINGS DATOER                               */
 /*********************************************************************/
 OPSÆT_FLYTTE_DATOER:                                                   
 PROC;                                                                  
                                                                        
         IF BH946.TIL_EVS.CINVPNR > '0'                                 
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BH946.MT.CCIVS = 'D'                                        
          & BH946.MT.HIST_OPL(SLUTÅR).DCIÆN <= BH946.MT.DRGNÅRTIL       
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BH946.SORT_KOMNR = 999                                      
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF (BH946.AKT_VURD.ANT_FOR_1 +                                 
             BH946.AKT_VURD.ANT_FOR_2 +                                 
             BH946.AKT_VURD.ANT_FOR_4 +                                 
             BH946.AKT_VURD.ANT_FOR_5 +                                 
             BH946.AKT_VURD.ANT_FOR_6 +                                 
             BH946.AKT_VURD.ANT_FOR_8 +                                 
             BH946.AKT_VURD.ANT_FOR_9) > 0                              
         THEN                                                           
            CALL OPSÆT_EJD_IND_FRAFLYT;                                 
         ELSE                                                           
            CALL OPSÆT_IND_FRAFLYT;                                     
                                                                        
 END OPSÆT_FLYTTE_DATOER;                                               
                                                                        
 /*********************************************************************/
 /* SKAF BELØB VEDR. FASTFROSSEN STIGNINGSBEGRÆNSNING FOR EJEREN      */
 /* ELLER EVT. DENNES ÆGTEFÆLLE FRA EVS SLUT 2006                     */
 /*********************************************************************/
 SKAF_FASTFROSSEN:                                                      
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' &            
                 BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &               
                 BH946.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW = 0 &            
                 BH946.EVS_SLUT_EJER.SIDSTE.MANNEDSLSTI_SW = 0)         
            DO;                                                         
               BH946.TIL_EVS.BFASTSTIGBGR =                             
               BH946.EVS_SLUT_EJER.SIDSTE.MANNEDSLSTI;                  
               BH946.TIL_EVS.BFASTSTIGBGR_SW = 0;                       
               BH946.TIL_FORSKUD.COPR_BFASTSTIGBGR = 'S';               
            END;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' &            
                 BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &               
                 BH946.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW = 0)             
            DO;                                                         
               BH946.TIL_EVS.BFASTSTIGBGR = 0;                          
               BH946.TIL_EVS.BFASTSTIGBGR_SW = 0;                       
               BH946.TIL_FORSKUD.COPR_BFASTSTIGBGR = 'S';               
            END;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' &            
                 BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &               
                 BH946.EVS_SLUT_EJER.SIDSTE.BFASTSTIGBGR_SW = 0)        
            DO;                                                         
               BH946.TIL_EVS.BFASTSTIGBGR =                             
               BH946.EVS_SLUT_EJER.SIDSTE.BFASTSTIGBGR;                 
               BH946.TIL_EVS.BFASTSTIGBGR_SW = 0;                       
               BH946.TIL_FORSKUD.COPR_BFASTSTIGBGR = 'S';               
            END;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                        
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS ^= '9' &            
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &               
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW = 0 &            
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.MANNEDSLSTI_SW = 0)         
            DO;                                                         
               BH946.TIL_EVS.BFASTSTIGBGR =                             
               BH946.EVS_SLUT_ÆGTF.SIDSTE.MANNEDSLSTI;                  
               BH946.TIL_EVS.BFASTSTIGBGR_SW = 0;                       
               BH946.TIL_FORSKUD.COPR_BFASTSTIGBGR = 'S';               
            END;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                        
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS ^= '9' &            
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &               
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW = 0)             
            DO;                                                         
               BH946.TIL_EVS.BFASTSTIGBGR = 0;                          
               BH946.TIL_EVS.BFASTSTIGBGR_SW = 0;                       
               BH946.TIL_FORSKUD.COPR_BFASTSTIGBGR = 'S';               
            END;                                                        
                                                                        
           WHEN (BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                        
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS ^= '9' &            
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &               
                 BH946.EVS_SLUT_ÆGTF.SIDSTE.BFASTSTIGBGR_SW = 0)        
            DO;                                                         
               BH946.TIL_EVS.BFASTSTIGBGR =                             
               BH946.EVS_SLUT_ÆGTF.SIDSTE.BFASTSTIGBGR;                 
               BH946.TIL_EVS.BFASTSTIGBGR_SW = 0;                       
               BH946.TIL_FORSKUD.COPR_BFASTSTIGBGR = 'S';               
            END;                                                        
                                                                        
           OTHERWISE                                                    
              DO;                                                       
                 BH946.TIL_EVS.BFASTSTIGBGR = 0;                        
                 BH946.TIL_EVS.BFASTSTIGBGR_SW = -1;                    
                 BH946.TIL_FORSKUD.COPR_BFASTSTIGBGR = ' ';             
              END;                                                      
                                                                        
         END; /* SELECT */                                              
                                                                        
 END SKAF_FASTFROSSEN;                                                  
                                                                        
 /*********************************************************************/
 /* INITIER DIVERSE INDIKATORFELTER TIL EN GIVEN VURDERING ( = -1)    */
 /*********************************************************************/
 INIT_INDIKATORER:                                                      
 PROC(IND);                                                             
                                                                        
 DCL     1 IND,                                                         
  3 CBENYT           CHAR  (2),    /* BENYTTELSESKODE                 */
  3 FLEJL            FIXED (5),    /* ANTAL LEJLIGHEDER               */
  3 BEJDVÆR          FIXED (11),   /* EJENDOMSVÆRDI                   */
  3 BEJDVÆR_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJERL           CHAR  (1),    /* KODE FOR EJERLEJLIGHED          */
  3 BEJBOL1          FIXED (11),   /* EJERBOLIG 1-VÆRDI               */
  3 BEJBOL1_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP1       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOL2          FIXED (11),   /* EJERBOLIG 2-VÆRDI               */
  3 BEJBOL2_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP2       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOLANV        FIXED (11),   /* EJERBOLIG ?-VÆRDI ANVENDT       */
  3 BEJBOLANV_SW BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CANVEBOL         CHAR  (1),    /* ANVENDT EJERBOLIG               */
  3 BOPÆLSKODE       CHAR  (1),    /* BOPÆLSKODE                      */
  3 CEJDTYPE         CHAR  (1),    /* KODE FOR EJENDOMSTYPE           */
  3 CBERGRL          CHAR  (1),    /* KODE FOR BEREGNINGSGRUNDLAG     */
  3 BBERGRL          FIXED (11),   /* BEREGN.GRUNDLAG                 */
  3 BBERGRL_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 BBER2FAM         FIXED (11),   /* EJD.VÆRDI 2 FAM.                */
  3 BBER2FAM_SW  BIN FIXED (15) UNAL;         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
                                                                        
         IND.BEJDVÆR_SW = -1;                                           
         IND.BEJBOL1_SW = -1;                                           
         IND.BEJBOL2_SW = -1;                                           
         IND.BEJBOLANV_SW = -1;                                         
         IND.BBERGRL_SW = -1;                                           
         IND.BBER2FAM_SW = -1;                                          
                                                                        
 END INIT_INDIKATORER;                                                  
                                                                        
 /*********************************************************************/
 /* INITIER DIVERSE INDIKATORFELTER   ( = -1)                         */
 /*********************************************************************/
 INIT_INDIK015ANV:                                                      
 PROC(IND);                                                             
                                                                        
 DCL     1 IND,                                                         
  3 GL_NY            CHAR  (1),    /* BENYTTELSESKODE                 */
  3 CBENYT           CHAR  (2),    /* BENYTTELSESKODE                 */
  3 FLEJL            FIXED (5),    /* ANTAL LEJLIGHEDER               */
  3 BEJDVÆR          FIXED (11),   /* EJENDOMSVÆRDI                   */
  3 BEJDVÆR_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJERL           CHAR  (1),    /* KODE FOR EJERLEJLIGHED          */
  3 BEJBOL1          FIXED (11),   /* EJERBOLIG 1-VÆRDI               */
  3 BEJBOL1_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP1       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOL2          FIXED (11),   /* EJERBOLIG 2-VÆRDI               */
  3 BEJBOL2_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP2       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOLANV        FIXED (11),   /* EJERBOLIG ?-VÆRDI ANVENDT       */
  3 BEJBOLANV_SW BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CANVEBOL         CHAR  (1),    /* ANVENDT EJERBOLIG               */
  3 BOPÆLSKODE       CHAR  (1),    /* BOPÆLSKODE                      */
  3 CEJDTYPE         CHAR  (1),    /* KODE FOR EJENDOMSTYPE           */
  3 CBERGRL          CHAR  (1),    /* KODE FOR BEREGNINGSGRUNDLAG     */
  3 BBERGRL          FIXED (11),   /* BEREGN.GRUNDLAG                 */
  3 BBERGRL_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 BBER2FAM         FIXED (11),   /* EJD.VÆRDI 2 FAM.                */
  3 BBER2FAM_SW  BIN FIXED (15) UNAL;         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
                                                                        
         IND.BEJDVÆR_SW = -1;                                           
         IND.BEJBOL1_SW = -1;                                           
         IND.BEJBOL2_SW = -1;                                           
         IND.BEJBOLANV_SW = -1;                                         
         IND.BBERGRL_SW = -1;                                           
         IND.BBER2FAM_SW = -1;                                          
                                                                        
 END INIT_INDIK015ANV;                                                  
                                                                        
 /*********************************************************************/
 /* FLYT VURDERINGSOPLYSNINGER FRA ESR-UDTRÆK TIL AKTUEL PLADS        */
 /*********************************************************************/
 OPSÆT_DIV_VURDOPL:                                                     
 PROC;                                                                  
                                                                        
         IF BH946.ESR.VURDOPL01.DVURDÅR = '2001'                        
         THEN                                                           
            DO;                                                         
               INP_OPSÆT = BH946.ESR.VURDOPL01, BY NAME;                
               CALL OPSÆT_BOPÆLSKODE;                                   
                                                                        
               IF BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9'              
               THEN                                                     
                  INP_OPSÆT.CANVEBOL =                                  
                  BH946.EVS_SLUT_EJER.SIDSTE.CANVEBOL;                  
               ELSE                                                     
                  INP_OPSÆT.CANVEBOL = ' ';                             
                                                                        
               INP_OPSÆT.ESR_EKOMNR = BH946.ESR.EKOMNR;                 
                                                                        
               CALL OPSÆT_BBERGRL_MV(BH946.VURD_015PCT);                
            END;                                                        
                                                                        
                                       /*FORSKUD06  HERFRA*/            
         IF BH946.ESR.SKATSTOP.DSTOPÅR ^= ''                            
         THEN                                                           
           DO;                                                          
               BH946.EJERSKAB.CBERGRLANV = '2';                         
               BH946.EJENDOM.CSTOPÅR = BH946.ESR.SKATSTOP.DSTOPÅR;      
           END;                                                         
                                                                        
         IF BH946.ESR.SKATSTOP.DSTOPÅR ^= ''                            
         &  BH946.ESR.SKATSTOP.OMBER01(1).KONSEKVENS = 'J'              
         THEN                                                           
            DO;                                                         
               INP_OPSÆT = BH946.ESR.SKATSTOP.OMBER01(1), BY NAME;      
               CALL OPSÆT_BOPÆLSKODE;                                   
                                                                        
               IF BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9'              
               THEN                                                     
                  INP_OPSÆT.CANVEBOL =                                  
                  BH946.EVS_SLUT_EJER.SIDSTE.CANVEBOL;                  
               ELSE                                                     
                  INP_OPSÆT.CANVEBOL = ' ';                             
                                                                        
               CALL OPSÆT_BBERGRL_MV(BH946.VURD_01OM);                  
            END;                                                        
                                                                        
                                                                        
         IF BH946.ESR.SKATSTOP.DSTOPÅR ^= '' &                          
            BH946.ESR.SKATSTOP.OMBER01(2).KONSEKVENS = 'J'              
         THEN                                                           
            DO;                                                         
               INP_OPSÆT = BH946.ESR.SKATSTOP.OMBER01(2), BY NAME;      
               CALL OPSÆT_BOPÆLSKODE;                                   
                                                                        
               IF BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9'              
               THEN                                                     
                  INP_OPSÆT.CANVEBOL =                                  
                  BH946.EVS_SLUT_EJER.SIDSTE.CANVEBOL;                  
               ELSE                                                     
                  INP_OPSÆT.CANVEBOL = ' ';                             
                                                                        
               INP_OPSÆT.ESR_EKOMNR = BH946.ESR.EKOMNR;                 
               INP_OPSÆT.CEJERL = ' ';                                  
                                                                        
               CALL OPSÆT_BBERGRL_MV(BH946.VURD_01OMNY);                
            END;                                                        
                                                                        
         IF BH946.ESR.SKATSTOP.DSTOPÅR > '2002' &                       
            BH946.ESR.SKATSTOP.OMBER02(1).KONSEKVENS = 'J'              
         THEN                                                           
            DO;                                                         
               INP_OPSÆT = BH946.ESR.SKATSTOP.OMBER02(1), BY NAME;      
               CALL OPSÆT_BOPÆLSKODE;                                   
                                                                        
               IF BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9'              
               THEN                                                     
                  INP_OPSÆT.CANVEBOL =                                  
                  BH946.EVS_SLUT_EJER.SIDSTE.CANVEBOL;                  
               ELSE                                                     
                  INP_OPSÆT.CANVEBOL = ' ';                             
                                                                        
               INP_OPSÆT.ESR_EKOMNR = BH946.ESR.EKOMNR;                 
               INP_OPSÆT.CEJERL = ' ';                                  
                                                                        
               CALL OPSÆT_BBERGRL_MV(BH946.VURD_02OM);                  
                                                                        
               BH946.EJERSKAB.CBERGRLANV = '3';                         
            END;                                                        
                                                                        
         IF BH946.ESR.SKATSTOP.DSTOPÅR > '2002' &                       
            BH946.ESR.SKATSTOP.OMBER02(2).KONSEKVENS = 'J'              
         THEN                                                           
            DO;                                                         
               INP_OPSÆT = BH946.ESR.SKATSTOP.OMBER02(2), BY NAME;      
               CALL OPSÆT_BOPÆLSKODE;                                   
                                                                        
               IF BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9'              
               THEN                                                     
                  INP_OPSÆT.CANVEBOL =                                  
                  BH946.EVS_SLUT_EJER.SIDSTE.CANVEBOL;                  
               ELSE                                                     
                  INP_OPSÆT.CANVEBOL = ' ';                             
                                                                        
               INP_OPSÆT.ESR_EKOMNR = BH946.ESR.EKOMNR;                 
               INP_OPSÆT.CEJERL = ' ';                                  
                                                                        
               CALL OPSÆT_BBERGRL_MV(BH946.VURD_02OMNY);                
                                                                        
               BH946.EJERSKAB.CBERGRLANV = '3';                         
            END;                                                        
                                   /*FORSKUD06  HERTIL*/                
                                                                        
         IF BH946.ESR.VURDOPL02.DVURDÅR = '2002'                        
         THEN                                                           
            DO;                                                         
               INP_OPSÆT = BH946.ESR.VURDOPL02.ÅRSVURD, BY NAME;        
               CALL OPSÆT_BOPÆLSKODE;                                   
                                                                        
               IF BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9'              
               THEN                                                     
                  INP_OPSÆT.CANVEBOL =                                  
                  BH946.EVS_SLUT_EJER.SIDSTE.CANVEBOL;                  
               ELSE                                                     
                  INP_OPSÆT.CANVEBOL = ' ';                             
                                                                        
               INP_OPSÆT.ESR_EKOMNR = BH946.ESR.EKOMNR;                 
                                                                        
               CALL OPSÆT_BBERGRL_MV(BH946.VURD_02);                    
            END;                                                        
                                                                        
         IF BH946.ESR.VURDOPLNY.DVURDÅR = '2014'  /*FORSKUD14 *RUL*/    
         THEN                                                           
           DO;                                                          
              IF (BH946.ESR.VURDOPLNY.OMBER01(1).KONSEKVENS = 'J' !     
                  BH946.ESR.VURDOPLNY.OMBER01(1).KONSEKVENS = 'N' !     
                  BH946.ESR.VURDOPLNY.OMBER01(2).KONSEKVENS = 'J' !     
                  BH946.ESR.VURDOPLNY.OMBER01(2).KONSEKVENS = 'N' ) &   
                  BH946.ESR.VURDOPLNY.CUOP ^= '6' &                     
                  BH946.ESR.VURDOPLGL.DVURDÅR = '' &                    
                  BH946.ESR.VURDOPLGL.CBENYT  = ''                      
              THEN                                                      
                 DO;                                                    
                  BH946.ESR.VURDOPLNY.CUOP = '6';                       
                 END;                                                   
              IF (BH946.ESR.VURDOPLNY.OMBER01(1).KONSEKVENS = 'J' !     
                  BH946.ESR.VURDOPLNY.OMBER01(1).KONSEKVENS = 'N' !     
                  BH946.ESR.VURDOPLNY.OMBER01(2).KONSEKVENS = 'J' !     
                  BH946.ESR.VURDOPLNY.OMBER01(2).KONSEKVENS = 'N' ) &   
                  BH946.ESR.VURDOPLNY.CUOP ^= '6'                       
              THEN                                                      
                 DO;                                                    
                    /* DER ER OMBEREGNINGER TIL AKTUEL VURDERING, */    
                    /* D.V.S. AT VURDERINGSOPLYSNINGERNE FRA DEN  */    
                    /* NÆRMESTE FOREGÅENDE VURDERING              */    
                    /* (DENNE GANG FRA ÅRSVURDERINGEN PR. 1/10-05)*/    
                    /* SKAL BENYTTES SOM AKTUEL VURDERING D.V.S.  */    
                    /* TIL OPSÆTNING AF FEJLNR, CEJBEVS SAMT BE-  */    
                    /* REGNINGSGRUNDLAG M.V..                     */    
                    INP_OPSÆT = BH946.ESR.VURDOPLGL.ÅRSVURD, BY NAME;   
                    CALL OPSÆT_BOPÆLSKODE;                              
                    BH946.AKT_EJER.BOPÆLSKODE = INP_OPSÆT.BOPÆLSKODE;   
                    BH946.AKT_VURD =                                    
                                 BH946.ESR.VURDOPLGL.ÅRSVURD, BY NAME;  
                    BH946.AKT_VURD.CVURDOPR = '2';                      
                 END;                                                   
              ELSE                                                      
                 DO;                                                    
                    INP_OPSÆT = BH946.ESR.VURDOPLNY.ÅRSVURD, BY NAME;   
                    CALL OPSÆT_BOPÆLSKODE;                              
                    BH946.AKT_EJER.BOPÆLSKODE = INP_OPSÆT.BOPÆLSKODE;   
                    BH946.AKT_VURD =                                    
                                BH946.ESR.VURDOPLNY.ÅRSVURD, BY NAME;   
                    BH946.AKT_VURD.CVURDOPR = '1';                      
    /*FORSKUD 2014*/   IF BH946.ESR.VURDOPLGL.DVURDÅR = '2013' /*RUL*/  
                    THEN                                                
                       DO;                                              
                          BH946.EJENDOM.CEJERL_GL =                     
                          BH946.ESR.VURDOPLGL.ÅRSVURD.CEJERL;           
                       END;                                             
                    ELSE                                                
                       BH946.EJENDOM.CEJERL_GL = ' ';                   
                 END;                                                   
                                                                        
                                                                        
              IF BH946.AKT_VURD.CBENYT ^= '  '                          
              THEN                                                      
                 BH946.AKT_VURD.DVURDÅR = BH946.ESR.VURDOPLNY.DVURDÅR;  
                                                                        
              IF BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &               
                 BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9'               
              THEN                                                      
                 INP_OPSÆT.CANVEBOL =                                   
                 BH946.EVS_SLUT_EJER.SIDSTE.CANVEBOL;                   
              ELSE                                                      
                 INP_OPSÆT.CANVEBOL = ' ';                              
                                                                        
              INP_OPSÆT.ESR_EKOMNR = BH946.ESR.EKOMNR;                  
                                                                        
              CALL OPSÆT_BBERGRL_MV(BH946.VURD_AKT);                    
                                                                        
              BH946.EJENDOM.CBENYT = BH946.VURD_AKT.CBENYT_AKT;         
              /*EVS SLUT 2012 KS1801*/                                  
              IF BH946.VURD_AKT.CBENYT_AKT = '25' &                     
                (BH946.ESR.CEANV = '510' !     /*SOMMERHUS*/            
                 BH946.ESR.CEANV = '520')      /*FERIEBYGNING*/         
              THEN                                                      
                DO;                                                     
                  IF BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !         
                     BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !         
                     BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !         
                     BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6' !         
                     BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '7' !         
                     BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '8' !         
                     BH946.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '9'           
                  THEN; /*DISSE SKAL IKKE ÆNDRES*/                      
                  ELSE                                                  
                    BH946.VURD_AKT.CEJDTYPE_AKT = '8';                  
                END;                                                    
              BH946.EJENDOM.CEJDTYPE = BH946.VURD_AKT.CEJDTYPE_AKT;     
              BH946.EJERSKAB.CEJDTYPE = BH946.VURD_AKT.CEJDTYPE_AKT;    
              BH946.EJERSKAB.CEJDTYPE_AKT = BH946.VURD_AKT.CEJDTYPE_AKT;
              BH946.EJENDOM.CBERGRL = BH946.VURD_AKT.CBERGRL_AKT;       
              BH946.EJENDOM.FLEJL = BH946.VURD_AKT.FLEJL_AKT;           
                                                                        
           END;                                                         
                                                                        
         /* FORSKUD13 ÆNDRES NU AF HENSYN TIL SLUT */                   
         IF BH946.ESR.VURDOPLGL.DVURDÅR = '2013' &    /*FORSKUD14 RUL */
            BH946.ESR.VURDOPLGL.OMBER01(1).KONSEKVENS = 'J' &           
            BH946.ESR.VURDOPLGL.OMBER01(1).STK15 ^= 'J'                 
         THEN                                                           
            DO;                                                         
               BH946.EJENDOM.COMBYG = '1';                              
            END;                                                        
                                                                        
 /*********************************************************************/
 /* OPSÆT BOPÆLSKODE FOR AKTUEL EJER A.H.T. TIL AFGØRELSE AF EVT.     */
 /* 'HELÅRSBEBOELSE' I SOMMERHUS SAMT OPSÆTNING AF KODE FOR ANVENDT   */
 /* EJERBOLIG (CANVEBOL).                                             */
 /*********************************************************************/
 OPSÆT_BOPÆLSKODE:                                                      
 PROC;                                                                  
                                                                        
    DCL HJ_SDØR     CHAR     (4); /* SIDE/DØRNR */                      
    DCL HJ_SDØR_P1  PIC   'ZZZ9'  BASED(ADDR(HJ_SDØR));                 
    DCL HJ_SDØR_P2  PIC   '9999'  BASED(ADDR(HJ_SDØR));                 
                                                                        
    %INCLUDE AS27100N;                                                  
                                                                        
    INP_OPSÆT.BOPÆLSKODE = ' ';                                         
                                                                        
    /* KONVERTER 'STORE' BOGSTAVER TIL 'SMÅ' */                         
    /* A.H.T. OPSÆTNING AF BOPÆLSKODE        */                         
                                                                        
    AS271_PTR = ADDR(BH946.ETAGE_EJD);                                  
    AS271_LGD = STG(BH946.ETAGE_EJD);                                   
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    AS271_PTR = ADDR(BH946.SDØR_EJD);                                   
    AS271_LGD = STG(BH946.SDØR_EJD);                                    
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    AS271_PTR = ADDR(INP_OPSÆT.EJEBOL(1).ETAGE_EJEB);                   
    AS271_LGD = STG(INP_OPSÆT.EJEBOL(1).ETAGE_EJEB);                    
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    AS271_PTR = ADDR(INP_OPSÆT.EJEBOL(1).SDØR_EJEB);                    
    AS271_LGD = STG(INP_OPSÆT.EJEBOL(1).SDØR_EJEB);                     
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    AS271_PTR = ADDR(INP_OPSÆT.EJEBOL(2).ETAGE_EJEB);                   
    AS271_LGD = STG(INP_OPSÆT.EJEBOL(2).ETAGE_EJEB);                    
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    AS271_PTR = ADDR(INP_OPSÆT.EJEBOL(2).SDØR_EJEB);                    
    AS271_LGD = STG(INP_OPSÆT.EJEBOL(2).SDØR_EJEB);                     
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    /* KONVERTER FORANSTILLEDE BLANKE TIL NULLER */                     
    /* A.H.T. OPSÆTNING AF BOPÆLSKODE            */                     
                                                                        
    IF BH946.SDØR_EJD > '    '                                          
    THEN                                                                
       DO;                                                              
          HJ_SDØR = BH946.SDØR_EJD;                                     
          IF VERIFY(HJ_SDØR,' 0123456789') = 0                          
          THEN                                                          
             DO;                                                        
                HJ_SDØR_P2 = HJ_SDØR_P1;                                
                BH946.SDØR_EJD = HJ_SDØR;                               
             END;                                                       
       END;                                                             
                                                                        
    IF INP_OPSÆT.EJEBOL(1).SDØR_EJEB > '    '                           
    THEN                                                                
       DO;                                                              
          HJ_SDØR = INP_OPSÆT.EJEBOL(1).SDØR_EJEB;                      
          IF VERIFY(HJ_SDØR,' 0123456789') = 0                          
          THEN                                                          
             DO;                                                        
                HJ_SDØR_P2 = HJ_SDØR_P1;                                
                INP_OPSÆT.EJEBOL(1).SDØR_EJEB = HJ_SDØR;                
             END;                                                       
       END;                                                             
                                                                        
    IF INP_OPSÆT.EJEBOL(2).SDØR_EJEB > '    '                           
    THEN                                                                
       DO;                                                              
          HJ_SDØR = INP_OPSÆT.EJEBOL(2).SDØR_EJEB;                      
          IF VERIFY(HJ_SDØR,' 0123456789') = 0                          
          THEN                                                          
             DO;                                                        
                HJ_SDØR_P2 = HJ_SDØR_P1;                                
                INP_OPSÆT.EJEBOL(2).SDØR_EJEB = HJ_SDØR;                
             END;                                                       
       END;                                                             
                                                                        
    /* OPSÆTNING AF BOPÆLSKODE */                                       
                                                                        
    /* KONVERTER 'STORE' BOGSTAVER TIL 'SMÅ' */                         
    /* A.H.T. OPSÆTNING AF BOPÆLSKODE        */                         
                                                                        
    AS271_PTR = ADDR(BH946.AKT_EJER.ETAGE_EJER);                        
    AS271_LGD = STG(BH946.AKT_EJER.ETAGE_EJER);                         
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    AS271_PTR = ADDR(BH946.AKT_EJER.SDØR_EJER);                         
    AS271_LGD = STG(BH946.AKT_EJER.SDØR_EJER);                          
    CALL AS27100(RUT_SMÅT,AS271_PTR,AS271_LGD);                         
                                                                        
    /* KONVERTER FORANSTILLEDE BLANKE TIL NULLER */                     
    /* A.H.T. OPSÆTNING AF BOPÆLSKODE            */                     
                                                                        
    IF BH946.AKT_EJER.SDØR_EJER > '    '                                
    THEN                                                                
       DO;                                                              
          HJ_SDØR = BH946.AKT_EJER.SDØR_EJER;                           
          IF VERIFY(HJ_SDØR,' 0123456789') = 0                          
          THEN                                                          
             DO;                                                        
                HJ_SDØR_P2 = HJ_SDØR_P1;                                
                BH946.AKT_EJER.SDØR_EJER = HJ_SDØR;                     
             END;                                                       
       END;                                                             
                                                                        
    IF BH946.AKT_EJER.DCPRCIR   = 0 !                                   
       BH946.AKT_EJER.VEJK_EJER = 0                                     
    THEN                                                                
       RETURN;                                                          
                                                                        
    IF (INP_OPSÆT.ANT_FOR_1 +                                           
        INP_OPSÆT.ANT_FOR_2 +                                           
        INP_OPSÆT.ANT_FOR_4 +                                           
        INP_OPSÆT.ANT_FOR_5 +                                           
        INP_OPSÆT.ANT_FOR_6 +                                           
        INP_OPSÆT.ANT_FOR_8 +                                           
        INP_OPSÆT.ANT_FOR_9) > 0                                        
    THEN                                                                
       DO;                                                              
          IF BH946.AKT_EJER.VEJK_EJER =                                 
             INP_OPSÆT.EJEBOL(1).VEJK_EJEB &                            
             BH946.AKT_EJER.HUSNR_EJER =                                
             INP_OPSÆT.EJEBOL(1).HUSNR_EJEB &                           
             BH946.AKT_EJER.ETAGE_EJER =                                
             INP_OPSÆT.EJEBOL(1).ETAGE_EJEB &                           
             BH946.AKT_EJER.SDØR_EJER =                                 
             INP_OPSÆT.EJEBOL(1).SDØR_EJEB                              
          THEN                                                          
             INP_OPSÆT.BOPÆLSKODE = '3';                                
          ELSE                                                          
           IF BH946.AKT_EJER.VEJK_EJER =                                
              INP_OPSÆT.EJEBOL(2).VEJK_EJEB &                           
              BH946.AKT_EJER.HUSNR_EJER =                               
              INP_OPSÆT.EJEBOL(2).HUSNR_EJEB &                          
              BH946.AKT_EJER.ETAGE_EJER =                               
              INP_OPSÆT.EJEBOL(2).ETAGE_EJEB &                          
              BH946.AKT_EJER.SDØR_EJER =                                
              INP_OPSÆT.EJEBOL(2).SDØR_EJEB                             
           THEN                                                         
              INP_OPSÆT.BOPÆLSKODE = '4';                               
           ELSE                                                         
            IF (BH946.AKT_EJER.VEJK_EJER =                              
                INP_OPSÆT.EJEBOL(1).VEJK_EJEB &                         
                SUBSTR(BH946.AKT_EJER.HUSNR_EJER,1,3) =                 
                SUBSTR(INP_OPSÆT.EJEBOL(1).HUSNR_EJEB,1,3))             
            THEN                                                        
               INP_OPSÆT.BOPÆLSKODE = '5';                              
            ELSE                                                        
             IF (BH946.AKT_EJER.VEJK_EJER =                             
                 INP_OPSÆT.EJEBOL(2).VEJK_EJEB &                        
                 SUBSTR(BH946.AKT_EJER.HUSNR_EJER,1,3) =                
                 SUBSTR(INP_OPSÆT.EJEBOL(2).HUSNR_EJEB,1,3))            
             THEN                                                       
                INP_OPSÆT.BOPÆLSKODE = '6';                             
       END;                                                             
    ELSE                                                                
       DO;                                                              
          IF BH946.AKT_EJER.VEJK_EJER = BH946.VEJK_EJD &                
             BH946.AKT_EJER.HUSNR_EJER = BH946.HUSNR_EJD &              
             BH946.AKT_EJER.ETAGE_EJER = BH946.ETAGE_EJD &              
             BH946.AKT_EJER.SDØR_EJER = BH946.SDØR_EJD                  
          THEN                                                          
             INP_OPSÆT.BOPÆLSKODE = '1';                                
          ELSE                                                          
             IF BH946.AKT_EJER.VEJK_EJER = BH946.VEJK_EJD &             
                SUBSTR(BH946.AKT_EJER.HUSNR_EJER,1,3) =                 
                SUBSTR(BH946.HUSNR_EJD,1,3)                             
             THEN                                                       
                INP_OPSÆT.BOPÆLSKODE = '2';                             
       END;                                                             
                                                                        
 END OPSÆT_BOPÆLSKODE;                                                  
                                                                        
 /*********************************************************************/
 /* OPSÆT CEJDTYPE,CBERGRL,BBERGRL,BBER2FAM M.V. P.G.A. EN GIVEN VURD */
 /*********************************************************************/
 OPSÆT_BBERGRL_MV:                                                      
 PROC(UD);                                                              
                                                                        
 DCL     1 UD,                                                          
  3 CBENYT           CHAR  (2),    /* BENYTTELSESKODE                 */
  3 FLEJL            FIXED (5),    /* ANTAL LEJLIGHEDER               */
  3 BEJDVÆR          FIXED (11),   /* EJENDOMSVÆRDI                   */
  3 BEJDVÆR_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJERL           CHAR  (1),    /* KODE FOR EJERLEJLIGHED          */
  3 BEJBOL1          FIXED (11),   /* EJERBOLIG 1-VÆRDI               */
  3 BEJBOL1_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP1       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOL2          FIXED (11),   /* EJERBOLIG 2-VÆRDI               */
  3 BEJBOL2_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP2       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOLANV        FIXED (11),   /* EJERBOLIG ?-VÆRDI ANVENDT       */
  3 BEJBOLANV_SW BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CANVEBOL         CHAR  (1),    /* ANVENDT EJERBOLIG               */
  3 BOPÆLSKODE       CHAR  (1),    /* BOPÆLSKODE                      */
  3 CEJDTYPE         CHAR  (1),    /* KODE FOR EJENDOMSTYPE           */
  3 CBERGRL          CHAR  (1),    /* KODE FOR BEREGNINGSGRUNDLAG     */
  3 BBERGRL          FIXED (11),   /* BEREGN.GRUNDLAG                 */
  3 BBERGRL_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 BBER2FAM         FIXED (11),   /* EJD.VÆRDI 2 FAM.                */
  3 BBER2FAM_SW  BIN FIXED (15) UNAL;         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
                                                                        
 DCL     HJVÆRDI     FIXED (11);                                        
                                                                        
         CALL INIT_INDIKATORER(UD);                                     
                                                                        
         UD.CBENYT = INP_OPSÆT.CBENYT;                                  
         UD.FLEJL = INP_OPSÆT.FLEJL;                                    
         UD.BEJDVÆR = INP_OPSÆT.BEJDVÆR;                                
         UD.CEJERL  = INP_OPSÆT.CEJERL;                                 
         UD.BOPÆLSKODE = INP_OPSÆT.BOPÆLSKODE;                          
                                                                        
         IF INP_OPSÆT.CBENYT ^= '  '                                    
         THEN                                                           
            UD.BEJDVÆR_SW = 0;                                          
                                                                        
         IF INP_OPSÆT.EJEBOL(1).EJBOLTYP > '0'                          
         THEN                                                           
            DO;                                                         
               UD.BEJBOL1 =                                             
               INP_OPSÆT.EJEBOL(1).BEJEBOL;                             
               UD.BEJBOL1_SW = 0;                                       
               UD.CEJBOLTYP1 =                                          
               INP_OPSÆT.EJEBOL(1).EJBOLTYP;                            
            END;                                                        
                                                                        
         IF INP_OPSÆT.EJEBOL(2).EJBOLTYP > '0'                          
         THEN                                                           
            DO;                                                         
               UD.BEJBOL2 =                                             
               INP_OPSÆT.EJEBOL(2).BEJEBOL;                             
               UD.BEJBOL2_SW = 0;                                       
               UD.CEJBOLTYP2 =                                          
               INP_OPSÆT.EJEBOL(2).EJBOLTYP;                            
            END;                                                        
                                                                        
         SELECT;                                                        
                                                                        
            WHEN ( INP_OPSÆT.CBENYT = '28' )                            
               UD.CEJDTYPE = '8';                                       
                                                                        
            WHEN ( INP_OPSÆT.CBENYT = '21' !                            
                   INP_OPSÆT.CBENYT = '22' !                            
                   INP_OPSÆT.CBENYT = '23' !                            
                   INP_OPSÆT.CBENYT = '24' !                            
                   INP_OPSÆT.CBENYT = '25' !                            
                   INP_OPSÆT.CBENYT = '26' !                            
                   INP_OPSÆT.CBENYT = '27' !                            
                   INP_OPSÆT.CBENYT = '29' )                            
               UD.CEJDTYPE = '7';                                       
                                                                        
            WHEN ( INP_OPSÆT.ANT_FOR_1 > 0 !                            
                   INP_OPSÆT.ANT_FOR_2 > 0 )                            
               UD.CEJDTYPE = '7';                                       
                                                                        
            WHEN ( INP_OPSÆT.CBENYT = '08' !                            
                   INP_OPSÆT.CBENYT = '48' )                            
               UD.CEJDTYPE = '3';                                       
                                                                        
            WHEN ((INP_OPSÆT.CBENYT = '01' !                            
                   INP_OPSÆT.CBENYT = '41') &                           
                   INP_OPSÆT.FLEJL = 2 &                                
                   INP_OPSÆT.ANT_FOR_4 = 0 &                            
                  (INP_OPSÆT.ANT_FOR_5 +                                
                   INP_OPSÆT.ANT_FOR_6 +                                
                   INP_OPSÆT.ANT_FOR_8 +                                
                   INP_OPSÆT.ANT_FOR_9 = 2))                            
               UD.CEJDTYPE = '4';                                       
                                                                        
            WHEN ((INP_OPSÆT.CBENYT = '01' !                            
                   INP_OPSÆT.CBENYT = '41') &                           
                   INP_OPSÆT.FLEJL = 2 &                                
                   INP_OPSÆT.ANT_FOR_4 = 0 &                            
                  (INP_OPSÆT.ANT_FOR_5 +                                
                   INP_OPSÆT.ANT_FOR_6 +                                
                   INP_OPSÆT.ANT_FOR_8 +                                
                   INP_OPSÆT.ANT_FOR_9 = 1))                            
               UD.CEJDTYPE = '5';                                       
                                                                        
            WHEN (INP_OPSÆT.ANT_FOR_4 +                                 
                  INP_OPSÆT.ANT_FOR_5 +                                 
                  INP_OPSÆT.ANT_FOR_6 +                                 
                  INP_OPSÆT.ANT_FOR_8 +                                 
                  INP_OPSÆT.ANT_FOR_9 > 0)                              
               UD.CEJDTYPE = '9';                                       
                                                                        
            OTHERWISE                                                   
               UD.CEJDTYPE = '1';                                       
                                                                        
         END; /* SELECT */                                              
                                                                        
         IF INP_OPSÆT.CBENYT = '  '                                     
         THEN                                                           
            UD.CEJDTYPE = ' ';                                          
                                                                        
         HJVÆRDI = 0;                                                   
                                                                        
         SELECT;                                                        
                                                                        
       /*   WHEN (INP_OPSÆT.ANT_FOR_1 > 0)        FRA 2003 SKAL DISSE   
               DO;                                MED TAGES I OPSÆT     
                   * MINDRE UDLEJNINGSEJENDOM *   AF EJD. VÆRDIER       
               END;                               */                    
                                                                        
            WHEN (INP_OPSÆT.ANT_FOR_2 > 0)                              
               DO;                                                      
                  /* BOFÆLLESSKAB           */                          
               END;                                                     
                                                                        
            WHEN ((INP_OPSÆT.ANT_FOR_1 = 0 &        /* 2003 */          
                   INP_OPSÆT.ANT_FOR_4 = 0 &                            
                   INP_OPSÆT.ANT_FOR_5 = 0 &                            
                   INP_OPSÆT.ANT_FOR_6 = 0 &                            
                   INP_OPSÆT.ANT_FOR_8 = 0 &                            
                   INP_OPSÆT.ANT_FOR_9 = 0) &                           
                   INP_OPSÆT.CBENYT ^= '  ')                            
               DO;                                                      
                  /* INGEN EJERBOLIG- ELLER STUEHUSVÆRDI */             
                  /* ELLER MINDRE UDLEJN ELLER BOFÆLLES  */             
                  /* SÅ BENYT EJENDOMSVÆRDI              */             
                  HJVÆRDI = INP_OPSÆT.BEJDVÆR;                          
                  UD.BBERGRL = HJVÆRDI;                                 
                  UD.BBERGRL_SW = 0;                                    
                  UD.CBERGRL = '1';                                     
               END;                                                     
                                                                        
            WHEN (INP_OPSÆT.ANT_FOR_1 +         /* 2003 */              
                  INP_OPSÆT.ANT_FOR_4 +                                 
                  INP_OPSÆT.ANT_FOR_5 +                                 
                  INP_OPSÆT.ANT_FOR_6 +                                 
                  INP_OPSÆT.ANT_FOR_8 +                                 
                  INP_OPSÆT.ANT_FOR_9 = 1)                              
               DO;                                                      
                  /* DER FINDES KUN 1 EJERBOLIG- ELLER   */             
                  /* STUEHUSVÆRDI, SOM DERFOR BENYTTES I */             
                  /* STEDET FOR EJENDOMSVÆRDIEN          */             
                  HJVÆRDI = INP_OPSÆT.EJEBOL(1).BEJEBOL;                
                  UD.BBERGRL = HJVÆRDI;                                 
                  UD.BBERGRL_SW = 0;                                    
                  IF INP_OPSÆT.ANT_FOR_4 = 1                            
                  THEN                                                  
                     UD.CBERGRL = '3';                                  
                  ELSE                                                  
                     UD.CBERGRL = '2';                                  
               END;                                                     
                                                                        
            WHEN ((INP_OPSÆT.ANT_FOR_1 +        /* 2003 */              
                   INP_OPSÆT.ANT_FOR_4 +                                
                   INP_OPSÆT.ANT_FOR_5 +                                
                   INP_OPSÆT.ANT_FOR_6 +                                
                   INP_OPSÆT.ANT_FOR_8 +                                
                   INP_OPSÆT.ANT_FOR_9 = 2) &                           
                   INP_OPSÆT.BOPÆLSKODE = '3')                          
               DO;                                                      
                  /* DER FINDES 2 EJERBOLIG- OG/ELLER   */              
                  /* STUEHUSVÆRDIER MEN EJERENS ADRESSE */              
                  /* JVF. PDATA ER 100% LIG EJERBOLIG 1 */              
                  HJVÆRDI = INP_OPSÆT.EJEBOL(1).BEJEBOL;                
                  UD.BBERGRL = HJVÆRDI;                                 
                  UD.BBERGRL_SW = 0;                                    
                  UD.BEJBOLANV = HJVÆRDI;                               
                  UD.BEJBOLANV_SW = 0;                                  
                  UD.CANVEBOL = '1';                                    
                  IF INP_OPSÆT.ANT_FOR_4 = 1                            
                  THEN                                                  
                     UD.CBERGRL = '3';                                  
                  ELSE                                                  
                     UD.CBERGRL = '2';                                  
               END;                                                     
                                                                        
            WHEN ((INP_OPSÆT.ANT_FOR_1 +        /* 2003 */              
                   INP_OPSÆT.ANT_FOR_4 +                                
                   INP_OPSÆT.ANT_FOR_5 +                                
                   INP_OPSÆT.ANT_FOR_6 +                                
                   INP_OPSÆT.ANT_FOR_8 +                                
                   INP_OPSÆT.ANT_FOR_9 = 2) &                           
                   INP_OPSÆT.BOPÆLSKODE = '4')                          
               DO;                                                      
                  /* DER FINDES 2 EJERBOLIG- OG/ELLER   */              
                  /* STUEHUSVÆRDIER MEN EJERENS ADRESSE */              
                  /* JVF. PDATA ER 100% LIG EJERBOLIG 2 */              
                  HJVÆRDI = INP_OPSÆT.EJEBOL(2).BEJEBOL;                
                  UD.BBERGRL = HJVÆRDI;                                 
                  UD.BBERGRL_SW = 0;                                    
                  UD.BEJBOLANV = HJVÆRDI;                               
                  UD.BEJBOLANV_SW = 0;                                  
                  UD.CANVEBOL = '2';                                    
                  IF INP_OPSÆT.ANT_FOR_4 = 1                            
                  THEN                                                  
                     UD.CBERGRL = '3';                                  
                  ELSE                                                  
                     UD.CBERGRL = '2';                                  
               END;                                                     
                                                                        
            WHEN ((INP_OPSÆT.ANT_FOR_1 +     /* 2003 */                 
                   INP_OPSÆT.ANT_FOR_4 +                                
                   INP_OPSÆT.ANT_FOR_5 +                                
                   INP_OPSÆT.ANT_FOR_6 +                                
                   INP_OPSÆT.ANT_FOR_8 +                                
                   INP_OPSÆT.ANT_FOR_9 = 2) &                           
                   INP_OPSÆT.EJEBOL(1).BEJEBOL =                        
                   INP_OPSÆT.EJEBOL(2).BEJEBOL)                         
               DO;                                                      
                  /* DER FINDES 2 EJERBOLIG- OG/ELLER  */               
                  /* STUEHUSVÆRDIER SOM IØVRIGT ER ENS */               
                  HJVÆRDI = INP_OPSÆT.EJEBOL(1).BEJEBOL;                
                  UD.BBERGRL = HJVÆRDI;                                 
                  UD.BBERGRL_SW = 0;                                    
                  IF INP_OPSÆT.ANT_FOR_4 = 1                            
                  THEN                                                  
                     UD.CBERGRL = '3';                                  
                  ELSE                                                  
                     UD.CBERGRL = '2';                                  
               END;                                                     
                                                                        
            WHEN ((INP_OPSÆT.ANT_FOR_1 +      /* 2003 */                
                   INP_OPSÆT.ANT_FOR_4 +                                
                   INP_OPSÆT.ANT_FOR_5 +                                
                   INP_OPSÆT.ANT_FOR_6 +                                
                   INP_OPSÆT.ANT_FOR_8 +                                
                   INP_OPSÆT.ANT_FOR_9 = 2) &                           
                  (INP_OPSÆT.CANVEBOL = '1' !                           
                   INP_OPSÆT.CANVEBOL = '2'))                           
               DO;                                                      
                  /* DER FINDES 2 UENS EJERBOLIG- OG/ELLER */           
                  /* STUEHUSVÆRDIER SOM UNDERSØGES FOR     */           
                  /* CANVEBOL I GL. SLUTÅR                 */           
                  SELECT;                                               
                    WHEN (INP_OPSÆT.CANVEBOL = '1')                     
                      DO;                                               
                        HJVÆRDI = INP_OPSÆT.EJEBOL(1).BEJEBOL;          
                        UD.CANVEBOL = '1';                              
                      END;                                              
                    WHEN (INP_OPSÆT.CANVEBOL = '2')                     
                      DO;                                               
                        HJVÆRDI = INP_OPSÆT.EJEBOL(2).BEJEBOL;          
                        UD.CANVEBOL = '2';                              
                      END;                                              
                    OTHERWISE;                                          
                  END;                                                  
                  UD.BBERGRL = HJVÆRDI;                                 
                  UD.BBERGRL_SW = 0;                                    
                  UD.BEJBOLANV = HJVÆRDI;                               
                  UD.BEJBOLANV_SW = 0;                                  
                  IF INP_OPSÆT.ANT_FOR_4 = 1                            
                  THEN                                                  
                     UD.CBERGRL = '3';                                  
                  ELSE                                                  
                     UD.CBERGRL = '2';                                  
               END;                                                     
                                                                        
            OTHERWISE;                                                  
                                                                        
         END;                                                           
                                                                        
         IF UD.BBERGRL_SW = -1                                          
         THEN                                                           
            UD.CBERGRL = '9';                                           
         ELSE                                                           
            UD.BBERGRL = HJVÆRDI;                                       
                                                                        
         IF INP_OPSÆT.ESR_EKOMNR > 0 &                                  
           (UD.CEJDTYPE = '4' !                                         
            UD.CEJDTYPE = '5')                                          
         THEN                                                           
            DO;                                                         
               UD.BBER2FAM =                                            
               INP_OPSÆT.BEJDVÆR;                                       
               UD.BBER2FAM_SW = 0;                                      
            END;                                                        
                                                                        
 END OPSÆT_BBERGRL_MV;                                                  
                                                                        
 END OPSÆT_DIV_VURDOPL;                                                 
                                                                        
 /*********************************************************************/
 /* OPSÆT EJERSTATUS PR. 1/7-1998 JVF. EJER-OPLYSNINGERNE FRA ESR     */
 /*********************************************************************/
 OPSÆT_1_7_98_STATUS:                                                   
 PROC(AKT_PERS,NEDSLAG);                                                
                                                                        
 DCL 1 AKT_PERS,                                                        
     %INCLUDE BH32201N;;                                                
                                                                        
 DCL 1 NEDSLAG,                                                         
       4 CNEDSL1    CHAR   (2),      /* KODE FOR 2 PROMILLE NEDSLAG   */
       4 DATO0107   FIXED  (9);      /* EJET FRA DATO (1/7-98-DATO)   */
                                                                        
         NEDSLAG.DATO0107 = 0;                                          
         NEDSLAG.CNEDSL1 = '  ';                                        
                                                                        
         SELECT;                                                        
           WHEN (BH946.AKT_VURD.CBENYT = '09' !                         
                 BH946.AKT_VURD.CBENYT = '17' !                         
                 BH946.AKT_VURD.CBENYT = '70' !                         
                 BH946.AKT_VURD.CBENYT = '71')                          
             DO;                                                        
                NEDSLAG.CNEDSL1 = '50';                                 
             END;                                                       
           WHEN (BH946.VURDOPLNY.ÅRSVURD.CBENYT = '  ' &                
                 BH946.VURDOPLGL.ÅRSVURD.CBENYT = '  ' &                
                 BH946.ESR.STAMOPL.GL_BEJDV = 0)                        
             DO;                                                        
                NEDSLAG.CNEDSL1 = '50';                                 
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
                CALL OPSÆT_DATO_0107;                                   
                IF NEDSLAG.CNEDSL1 >= '10'                              
                 & NEDSLAG.CNEDSL1 < '20'                               
                THEN                                                    
                   CALL ÆNDRE_DATO_0107;                                
             END;                                                       
         END;                                                           
                                                                        
 /*********************************************************************/
 /*    OPSÆT DATO_0107 P.G.A. SLUTSEDDEL-/OVERTAGELSES- ELLER         */
 /*    SKØDEDATO SAMT OPSÆT KODE FOR EVT. 2 PROMILLE NEDSLAG I EJEN-  */
 /*    DOMSVÆRDISKATTEN                                               */
 /*********************************************************************/
 OPSÆT_DATO_0107:                                                       
 PROC;                                                                  
                                                                        
         SELECT;                                                        
           WHEN (AKT_PERS.CEJFOER0107 = 'J')        /* FORSKUD10 */     
              DO;                                                       
                 NEDSLAG.DATO0107 = 19980701;                           
                 NEDSLAG.CNEDSL1  = '11';                               
              END;                                                      
           WHEN (AKT_PERS.DSLUTS > 0 &                                  
                 AKT_PERS.DSLUTS <= 19980701)                           
              DO;                                                       
                 NEDSLAG.DATO0107 = AKT_PERS.DSLUTS;                    
                 NEDSLAG.CNEDSL1 = '10';                                
              END;                                                      
           WHEN (AKT_PERS.DOVTG_GL > 0 &                                
                 AKT_PERS.DOVTG_GL <= 19980701)                         
              DO;                                                       
                 NEDSLAG.DATO0107 = AKT_PERS.DOVTG_GL;                  
                 NEDSLAG.CNEDSL1 = '11';                                
              END;                                                      
           WHEN (AKT_PERS.DOVTG > 0 &                                   
                 AKT_PERS.DOVTG <= 19980701)                            
              DO;                                                       
                 NEDSLAG.DATO0107 = AKT_PERS.DOVTG;                     
                 NEDSLAG.CNEDSL1 = '11';                                
              END;                                                      
           WHEN (AKT_PERS.DSKØDE > 0 &                                  
                 AKT_PERS.DSKØDE <= 19980701)                           
              DO;                                                       
                 NEDSLAG.DATO0107 = AKT_PERS.DSKØDE;                    
                 NEDSLAG.CNEDSL1 = '12';                                
              END;                                                      
           OTHERWISE                                                    
              DO;                                                       
                 IF AKT_PERS.DOVTG_GL > 0                               
                 THEN                                                   
                    NEDSLAG.DATO0107 = AKT_PERS.DOVTG_GL;               
                 ELSE                                                   
                    NEDSLAG.DATO0107 = AKT_PERS.DOVTG;                  
                 IF NEDSLAG.DATO0107 = 0                                
                 THEN                                                   
                    DO;                                                 
                       IF AKT_PERS.DSLUTS > 0                           
                       THEN                                             
                          NEDSLAG.DATO0107 = AKT_PERS.DSLUTS;           
                       ELSE                                             
                          NEDSLAG.DATO0107 = AKT_PERS.DSKØDE;           
                    END;                                                
                 IF NEDSLAG.DATO0107 <= 19980701                        
                 THEN                                                   
                    NEDSLAG.DATO0107 = 19980702;                        
                 NEDSLAG.CNEDSL1 = '31';                                
              END;                                                      
         END;                                                           
                                                                        
 END OPSÆT_DATO_0107;                                                   
                                                                        
 /*********************************************************************/
 /*    ÆNDRE DATO_0107 P.G.A  BOLIGEN FØRST ER BYGGET EFTER 2002 ÅRS  */
 /*    VURDERING SAMT OPSÆT KODE FOR EVT. 2 PROMILLE NEDSLAG I EJEN-  */
 /*    DOMSVÆRDISKATTEN                                               */
 /*********************************************************************/
 ÆNDRE_DATO_0107:                                                       
 PROC;                                                                  
                                                                        
         IF (BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '09' !                
             BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '17')                 
          & (BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '01' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '02' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '05' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '08')                 
         THEN                                                           
            DO;                                                         
              NEDSLAG.DATO0107 = 19980702;                              
              NEDSLAG.CNEDSL1 = '34';                                   
            END;                                                        
         ELSE                                                           
         IF (BH946.ESR.VURDOPL02.ÅRSVURD.CBENYT = '  ' !                
             BH946.ESR.VURDOPL02.ÅRSVURD.CBENYT = '09' !                
             BH946.ESR.VURDOPL02.ÅRSVURD.CBENYT = '17')                 
          & (BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '01' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '02' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '05' !                
             BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '08')                 
         THEN                                                           
            DO;                                                         
              NEDSLAG.DATO0107 = 19980702;                              
              NEDSLAG.CNEDSL1 = '34';                                   
            END;                                                        
         ELSE                                                           
         IF (BH946.ESR.VURDOPL02.ÅRSVURD.CBENYT = '  ' !                
             BH946.ESR.VURDOPL02.ÅRSVURD.CBENYT = '09' !                
             BH946.ESR.VURDOPL02.ÅRSVURD.CBENYT = '17')                 
          & (BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '01' !                
             BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '02' !                
             BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '05' !                
             BH946.ESR.VURDOPLGL.ÅRSVURD.CBENYT = '08')                 
          & (BH946.ESR.VURDOPLNY.ÅRSVURD.CBENYT = '  ')                 
         THEN                                                           
            DO;                                                         
              NEDSLAG.DATO0107 = 19980702;                              
              NEDSLAG.CNEDSL1 = '34';                                   
            END;                                                        
                                                                        
 END ÆNDRE_DATO_0107;                                                   
                                                                        
 END OPSÆT_1_7_98_STATUS;                                               
 /*********************************************************************/
 /* OVERFØR EJERSTATUS PR. 1/7-1998 JVF. EJER-OPLYSNINGERNE FRA ESR   */
 /* MELLEM ÆGTEFÆLLER (NUVÆRENDE OG/ELLER TIDLIGERE)                  */
 /*********************************************************************/
 OVERFØR_1_7_98_STATUS:                                                 
 PROC(NEDSLAG);                                                         
                                                                        
         DCL 1 NEDSLAG,                                                 
               3 EJER,                                                  
                 4 CNEDSL1 CHAR  (2),                                   
                 4 DATO0107 FIXED (9),                                  
               3 ÆGTF,                                                  
                 4 CNEDSL1 CHAR  (2),                                   
                 4 DATO0107 FIXED (9),                                  
               3 CÆGTEJET     PIC    '9',                               
                                                                        
                                                                        
               3 OVERFØRT,                                              
                 4 CNEDSL1 CHAR  (2),                                   
                 4 DATO0107 FIXED (9);                                  
                                                                        
         IF NEDSLAG.EJER.CNEDSL1 ^= '  '                                
         THEN                                                           
            NEDSLAG.OVERFØRT.CNEDSL1 = NEDSLAG.EJER.CNEDSL1;            
         ELSE                                                           
            NEDSLAG.OVERFØRT.CNEDSL1 = NEDSLAG.ÆGTF.CNEDSL1;            
                                                                        
         IF NEDSLAG.EJER.DATO0107 ^= 0                                  
         THEN                                                           
            NEDSLAG.OVERFØRT.DATO0107 = NEDSLAG.EJER.DATO0107;          
         ELSE                                                           
            NEDSLAG.OVERFØRT.DATO0107 = NEDSLAG.ÆGTF.DATO0107;          
                                                                        
         IF NEDSLAG.ÆGTF.CNEDSL1 = '  '                                 
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF NEDSLAG.EJER.DATO0107 > NEDSLAG.ÆGTF.DATO0107 &             
            NEDSLAG.ÆGTF.DATO0107 > 0                                   
         THEN                                                           
            NEDSLAG.OVERFØRT.DATO0107 = NEDSLAG.ÆGTF.DATO0107;          
                                                                        
         IF NEDSLAG.EJER.CNEDSL1 < '30' & NEDSLAG.ÆGTF.CNEDSL1 < '30'   
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF NEDSLAG.EJER.CNEDSL1 > '29' & NEDSLAG.ÆGTF.CNEDSL1 > '29'   
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF NEDSLAG.EJER.CNEDSL1 > '29' &                               
           (NEDSLAG.ÆGTF.CNEDSL1 >= '10' & NEDSLAG.ÆGTF.CNEDSL1 < '30') 
         THEN                                                           
            DO;                                                         
               NEDSLAG.OVERFØRT.CNEDSL1 = NEDSLAG.ÆGTF.CNEDSL1;         
               /* ENKE EFTER  E L L E R            */                   
               /* SKILSMISSE/ÆGTEFÆLLEOVERDRAGELSE */                   
               IF BH946.MT.CCIVS = 'G' !                                
                  BH946.MT.CCIVS = 'P' !                                
                  BH946.MT.CCIVS = 'F' !                                
                  BH946.MT.CCIVS = 'S' !                                
                  BH946.MT.CCIVS = 'O'                                  
               THEN                                                     
                  NEDSLAG.OVERFØRT.CNEDSL1 = '17';                      
               ELSE                                                     
                  NEDSLAG.OVERFØRT.CNEDSL1 = '16';                      
            END;                                                        
                                                                        
 END OVERFØR_1_7_98_STATUS;                                             
 /*********************************************************************/
 /* OPSÆT EJERSTATUS PR. 1/7-1998 JVF. EJER-OPLYSNINGERNE FRA         */
 /* EVS GL. SLUTÅR, FORSKUD ELLER ESR I NÆVNTE PRIORITETSRÆKKEFØLGE   */
 /*********************************************************************/
 ENDELIG_CNEDSL1:                                                       
 PROC(CNEDSL1,COPR_CNEDSL1);                                            
                                                                        
         DCL CNEDSL1       CHAR  (2);                                   
         DCL COPR_CNEDSL1  CHAR  (1);                                   
                                                                        
         CNEDSL1 = '  ';                                                
         COPR_CNEDSL1 = ' ';                                            
                                                                        
         SELECT;                                                        
                                                                        
            WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                       
                  BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                 (BH946.EVS_SLUT_EJER.SIDSTE.CNEDSL1 >= '10' &          
                  BH946.EVS_SLUT_EJER.SIDSTE.CNEDSL1 <  '30'))          
              DO;                                                       
                CNEDSL1 = BH946.EVS_SLUT_EJER.SIDSTE.CNEDSL1;           
                COPR_CNEDSL1 = 'S';                                     
              END;                                                      
                                                                        
            WHEN (BH946.EVS_SLUT_EJER.DCPRN > 0 &                       
                  BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CNEDSL1 > '29')            
              DO;                                                       
                IF BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                      
                   BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &             
                  (BH946.EVS_SLUT_ÆGTF.SIDSTE.CNEDSL1 >= '10' &         
                   BH946.EVS_SLUT_ÆGTF.SIDSTE.CNEDSL1 <  '30')          
                THEN                                                    
                   CNEDSL1 = BH946.EVS_SLUT_ÆGTF.SIDSTE.CNEDSL1;        
                ELSE                                                    
                   CNEDSL1 = BH946.EVS_SLUT_EJER.SIDSTE.CNEDSL1;        
                COPR_CNEDSL1 = 'S';                                     
              END;                                                      
                                                                        
            WHEN (BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                       
                  BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &              
                  BH946.EVS_SLUT_ÆGTF.SIDSTE.CNEDSL1 >= '10')           
              DO;                                                       
                CNEDSL1 = BH946.EVS_SLUT_ÆGTF.SIDSTE.CNEDSL1;           
                COPR_CNEDSL1 = 'S';                                     
              END;                                                      
                                                                        
            WHEN (BH946.EVS_FORSK_EJER.DCPRN > 0 &                      
                 (BH946.EVS_FORSK_EJER.CNEDSL1 >= '10' &                
                  BH946.EVS_FORSK_EJER.CNEDSL1 <  '30'))                
              DO;                                                       
                CNEDSL1 = BH946.EVS_FORSK_EJER.CNEDSL1;                 
                COPR_CNEDSL1 = 'F';                                     
              END;                                                      
                                                                        
            WHEN (BH946.EVS_FORSK_EJER.DCPRN > 0 &                      
                  BH946.EVS_FORSK_EJER.CNEDSL1 > '29')                  
              DO;                                                       
                IF BH946.EVS_FORSK_ÆGTF.DCPRN > 0 &                     
                  (BH946.EVS_FORSK_ÆGTF.CNEDSL1 >= '10' &               
                   BH946.EVS_FORSK_ÆGTF.CNEDSL1 <  '30')                
                THEN                                                    
                   CNEDSL1 = BH946.EVS_FORSK_ÆGTF.CNEDSL1;              
                ELSE                                                    
                   CNEDSL1 = BH946.EVS_FORSK_EJER.CNEDSL1;              
                COPR_CNEDSL1 = 'F';                                     
              END;                                                      
                                                                        
            WHEN (BH946.EVS_FORSK_ÆGTF.DCPRN > 0 &                      
                  BH946.EVS_FORSK_ÆGTF.CNEDSL1 >= '10')                 
              DO;                                                       
                CNEDSL1 = BH946.EVS_FORSK_ÆGTF.CNEDSL1;                 
                COPR_CNEDSL1 = 'F';                                     
              END;                                                      
                                                                        
            OTHERWISE                                                   
              DO;                                                       
                 CNEDSL1 = BH946.NEDSLAG.OVERFØRT.CNEDSL1; /* FRA ESR */
                 IF CNEDSL1 = '  '                                      
                 THEN                                                   
                    CNEDSL1 = BH946.NEDSLAG.ÆGTF.CNEDSL1;               
                 IF CNEDSL1 >= '10'                                     
                 THEN                                                   
                    COPR_CNEDSL1 = 'E';                                 
              END;                                                      
                                                                        
         END; /* SELECT */                                              
                                                                        
 END ENDELIG_CNEDSL1;                                                   
 /*********************************************************************/
 /* OPSÆT EJERSTATUS PR. 1/7-1998 JVF. EJER-OPLYSNINGERNE FRA         */
 /* EVS GL. SLUTÅR, FORSKUD ELLER ESR I NÆVNTE PRIORITETSRÆKKEFØLGE   */
 /*********************************************************************/
 ENDELIG_1_7_98_DATO:                                                   
 PROC(DATO0107,CNEDSL1,COPR_CNEDSL1);                                   
                                                                        
         DCL DATO0107      FIXED (9);                                   
         DCL HJ_DATO0107   FIXED (9);                                   
         DCL CNEDSL1       CHAR  (2);                                   
         DCL COPR_CNEDSL1  CHAR  (1);                                   
                                                                        
         HJ_DATO0107 = 0;                                               
                                                                        
         IF BH946.EVS_SLUT_EJER.DCPRN > 0 &                             
            BH946.EVS_SLUT_EJER.SIDSTE.CSLET = ' ' &                    
            BH946.EVS_SLUT_EJER.SIDSTE.DATO0107 > 0                     
         THEN                                                           
            HJ_DATO0107 = BH946.EVS_SLUT_EJER.SIDSTE.DATO0107;          
                                                                        
         IF BH946.EVS_SLUT_ÆGTF.DCPRN > 0 &                             
            BH946.EVS_SLUT_ÆGTF.SIDSTE.CSLET = ' ' &                    
           (BH946.EVS_SLUT_ÆGTF.SIDSTE.DATO0107 > 0 &                   
           (BH946.EVS_SLUT_ÆGTF.SIDSTE.DATO0107 < HJ_DATO0107 !         
            HJ_DATO0107 = 0))                                           
         THEN                                                           
            HJ_DATO0107 = BH946.EVS_SLUT_ÆGTF.SIDSTE.DATO0107;          
                                                                        
         IF BH946.EVS_FORSK_EJER.DCPRN > 0 &                            
           (BH946.EVS_FORSK_EJER.DATO0107 > 0 &                         
           (BH946.EVS_FORSK_EJER.DATO0107 < HJ_DATO0107 !               
            HJ_DATO0107 = 0))                                           
         THEN                                                           
            HJ_DATO0107 = BH946.EVS_FORSK_EJER.DATO0107;                
                                                                        
         IF BH946.EVS_FORSK_ÆGTF.DCPRN > 0 &                            
           (BH946.EVS_FORSK_ÆGTF.DATO0107 > 0 &                         
           (BH946.EVS_FORSK_ÆGTF.DATO0107 < HJ_DATO0107 !               
            HJ_DATO0107 = 0))                                           
         THEN                                                           
            HJ_DATO0107 = BH946.EVS_FORSK_EJER.DATO0107;                
                                                                        
         IF BH946.NEDSLAG.EJER.DATO0107 > 0 &                           
           (BH946.NEDSLAG.EJER.DATO0107 < HJ_DATO0107 !                 
            HJ_DATO0107 = 0)                                            
         THEN                                                           
            HJ_DATO0107 = BH946.NEDSLAG.EJER.DATO0107;                  
                                                                        
         IF BH946.NEDSLAG.ÆGTF.DATO0107 > 0 &                           
           (BH946.NEDSLAG.ÆGTF.DATO0107 < HJ_DATO0107 !                 
            HJ_DATO0107 = 0)                                            
         THEN                                                           
            HJ_DATO0107 = BH946.NEDSLAG.ÆGTF.DATO0107;                  
                                                                        
         DATO0107 = HJ_DATO0107;                                        
                                                                        
         IF DATO0107 = 0                                                
         THEN                                                           
            DATO0107 = BH946.AKT_EJER.DOVTG_GL;                         
                                                                        
         IF DATO0107 = 0                                                
         THEN                                                           
            DATO0107 = BH946.TIL_EVS.DOVTG;                             
                                                                        
         IF (CNEDSL1 >= '10' & CNEDSL1 <= '29') &                       
            DATO0107 > 19980701                                         
         THEN                                                           
            DATO0107 = 19980701;                                        
                                                                        
         IF DATO0107 = 0 &                                              
            (CNEDSL1 >= '10' & CNEDSL1 <= '29')                         
         THEN                                                           
            DATO0107 = 19980701;                                        
                                                                        
         IF DATO0107 > 0                                                
          & CNEDSL1 = '  '                                              
         THEN                                                           
            DO;                                                         
              IF DATO0107 <= 19980701                                   
              THEN                                                      
                 CNEDSL1 = '11';                                        
              ELSE                                                      
                 CNEDSL1 = '31';                                        
              COPR_CNEDSL1 = 'E';                                       
            END;                                                        
                                                                        
 END ENDELIG_1_7_98_DATO;                                               
 /*********************************************************************/
 /* EJER ANDELS PROCENT SKAL I VISSE TILFÆLDE 'HENTES' FRA EVS SLUT   */
 /* GAMMELT INDKOMSTÅR I STEDET FOR DEN FRA ESR LEVEREDE PROCENT      */
 /*********************************************************************/
 HENT_EJERANDEL:                                                        
 PROC;                                                                  
                                                                        
         IF BH946.AKT_EJER.DCPRCIR > 0   &                              
            BH946.AKT_EJER.CTILKØB = 'J' &                              
            BH946.AKT_EJER.DAFSTÅ  = 0                                  
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF (AKT_VURD.ANT_FOR_1 +          /* DISSE ER MED I S2003 */   
             AKT_VURD.ANT_FOR_4 +                                       
             AKT_VURD.ANT_FOR_5 +                                       
             AKT_VURD.ANT_FOR_6 +                                       
             AKT_VURD.ANT_FOR_8 +                                       
             AKT_VURD.ANT_FOR_9 = 2) &                                  
             BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                   
             BH946.EVS_SLUT_EJER.SIDSTE.BEJBOL1_SW = 0 &                
             BH946.EVS_SLUT_EJER.SIDSTE.BEJBOL2_SW = 0 &                
             BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0 &               
             BH946.EVS_SLUT_EJER.SIDSTE.CÆGTOPR = ' ' &                 
             BH946.TIL_EVS.CÆGTOPR  = ' ' &                             
             BH946.TIL_EVS.CDATAFRA = ' '                               
         THEN                                                           
            DO;                                                         
               /* TIL_EVS.GPCTEJER ER EVT. TIDLIGERE */                 
               /* OPSAT LIG ESR.EJER'S GANE */                          
               IF BH946.TIL_EVS.GPCTEJER_SW = -1 !                      
                 (BH946.TIL_EVS.GPCTEJER_SW = 0 &                       
                 (BH946.TIL_EVS.GPCTEJER ^=                             
                  BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER))                 
               THEN                                                     
                  DO;                                                   
                     BH946.TIL_EVS.GPCTEJER_SW = 0;                     
                     BH946.TIL_EVS.GPCTEJER =                           
                     BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER;               
                     BH946.TIL_EVS.CDATAFRA = '3';                      
                     BH946.TIL_FORSKUD.COPR_GPCTEJER = 'S';             
                     TV.HENT_PCT = TV.HENT_PCT + 1;                     
                  END;                                                  
            END;                                                        
                                                                        
         IF (AKT_VURD.ANT_FOR_1 +         /* DISSE ER MED I S2003 */    
             AKT_VURD.ANT_FOR_4 +                                       
             AKT_VURD.ANT_FOR_5 +                                       
             AKT_VURD.ANT_FOR_6 +                                       
             AKT_VURD.ANT_FOR_8 +                                       
             AKT_VURD.ANT_FOR_9 = 1) &                                  
             BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                   
           ((BH946.EVS_SLUT_EJER.SIDSTE.BEJBOL1_SW = 0 &                
             BH946.EVS_SLUT_EJER.SIDSTE.BEJBOL2_SW = -1) !              
            (BH946.EVS_SLUT_EJER.SIDSTE.BEJBOL1_SW = -1 &               
             BH946.EVS_SLUT_EJER.SIDSTE.BEJBOL2_SW = 0)) &              
             BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0 &               
             BH946.EVS_SLUT_EJER.SIDSTE.CÆGTOPR = ' ' &                 
             BH946.TIL_EVS.CÆGTOPR  = ' ' &                             
             BH946.TIL_EVS.CDATAFRA = ' '                               
         THEN                                                           
            DO;                                                         
               /* TIL_EVS.GPCTEJER ER EVT. TIDLIGERE */                 
               /* OPSAT LIG ESR.EJER'S GANE */                          
               IF BH946.TIL_EVS.GPCTEJER_SW = -1 !                      
                 (BH946.TIL_EVS.GPCTEJER_SW = 0 &                       
                 (BH946.TIL_EVS.GPCTEJER ^=                             
                  BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER))                 
               THEN                                                     
                  DO;                                                   
                     BH946.TIL_EVS.GPCTEJER_SW = 0;                     
                     BH946.TIL_EVS.GPCTEJER =                           
                     BH946.EVS_SLUT_EJER.SIDSTE.GPCTEJER;               
                     BH946.TIL_EVS.CDATAFRA = '3';                      
                     BH946.TIL_FORSKUD.COPR_GPCTEJER = 'S';             
                     TV.HENT_PCT = TV.HENT_PCT + 1;                     
                  END;                                                  
            END;                                                        
                                                                        
 END HENT_EJERANDEL;                                                    
                                                                        
 /*********************************************************************/
 /*      OPSÆT OPLYSNINGER FRA MINI MT-FIL                            */
 /*********************************************************************/
 OPSÆT_OPLYSNINGER_FRA_MTFIL:                                           
         PROC;                                                          
         IF ((BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '1'                   
            ! BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '3'                   
            ! BH946.MT.HIST_OPL(SLUTÅR).CSKPLOM = '8')                  
              /* #02 */                                                 
            ! (BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '1'     
            ! BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '3'      
            ! BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF = '8'))    
          & (BH946.MT.CCIVS = 'G'                                       
           ! BH946.MT.CCIVS = 'P')                                      
          &  BH946.MT.HIST_OPL(SLUTÅR).DCIÆN < BH946.MT.DRGNÅRFRA       
          &  BH946.SORT_KOMNR ^= 999                                    
          THEN DO;                                                      
             BH946.TIL_EVS.CPTYPSLUT = '4';                             
          END;                                                          
          ELSE DO;                                                      
             IF BH946.MT.CSBSK(SLUTÅR) = '2' !                          
                BH946.MT.CSBSK(SLUTÅR) = '3' !                          
               (BH946.MT.CSBSK(SLUTÅR) = '4' &                          
                BH946.MT.DCIÆN(SLUTÅR) > BH946.MT.DRGNÅRTIL) !          
                BH946.MT.CSBSK(SLUTÅR) = '5' !                          
                BH946.MT.CSBSK(SLUTÅR) = '6'                            
             THEN DO;                                                   
               /* KUN SAMBESKATTEDE PERSONER */                         
                IF BH946.MT.DHENVN(SLUTÅR) > 0                          
                THEN DO;                                                
                   /* UNDERSØG OM ÆGTEFÆLLE              */             
                   /* ER PENSIONIST I 2008 (65-/67-ÅRIG) */             
                   HJ_CPR = BH946.MT.DHENVN(SLUTÅR);                    
                   IF PERSON_ALDER_OK(PRDATO1,HJ_CPR,'1') !             
                      PERSON_ALDER_OK(PRDATO1,HJ_CPR,'4')               
                   THEN DO;                                             
                      HJHNV67 = '1';                                    
                      BH946.TIL_EVS.CPTYPSLUT = '3';                    
                   END;                                                 
                   BH946.TIL_EVS.DHENVN = BH946.MT.DHENVN(SLUTÅR);      
                END;                                                    
                                                                        
                IF (BH946.MT.CSBSK(FORSKÅR) = '2' !                     
                    BH946.MT.CSBSK(FORSKÅR) = '3' !                     
                    BH946.MT.CSBSK(FORSKÅR) = '5') &                    
                    BH946.MT.DHENVN(FORSKÅR) > 0                        
                THEN DO;                                                
                /* UNDERSØG OM ÆGTEFÆLLE              */                
                /* ER PENSIONIST I 2008 (65-/67-ÅRIG) */                
                   HJ_CPR = BH946.MT.DHENVN(FORSKÅR);                   
                   IF PERSON_ALDER_OK(PRDATO2,HJ_CPR,'1') !             
                      PERSON_ALDER_OK(PRDATO2,HJ_CPR,'4')               
                   THEN                                                 
                   BH946.TIL_EVS.CPTYPFOR = '3';                        
                   BH946.TIL_EVS.DHENVN_FOR = BH946.MT.DHENVN(FORSKÅR); 
                END;                                                    
             END;                                                       
          END;                                                          
                                                                        
         IF BH946.EVS_FORSK_EJER.DCPRN > 0 &                            
            BH946.EVS_FORSK_EJER.CENKE >= '3'                           
         THEN                                                           
            DO;                                                         
              BH946.TIL_EVS.CENKE = BH946.EVS_FORSK_EJER.CENKE;         
              BH946.TIL_FORSKUD.COPR_CENKE = 'F';                       
            END;                                                        
         ELSE                                                           
            IF BH946.EVS_SLUT_EJER.DCPRN > 0 &                          
               BH946.EVS_SLUT_EJER.SIDSTE.CENKE >= '3' &                
               BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1'                   
            THEN                                                        
              DO;                                                       
                BH946.TIL_EVS.CENKE = BH946.EVS_SLUT_EJER.SIDSTE.CENKE; 
                BH946.TIL_FORSKUD.COPR_CENKE = 'S';                     
              END;                                                      
                                                                        
         IF ((BH946.EVS_SLUT_EJER.DCPRN > 0 &                           
             (BH946.EVS_SLUT_EJER.FØRSTE.CENKE >= '3' &                 
              BH946.EVS_SLUT_EJER.FØRSTE.CSLET < '1' &                  
              BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                  
              BH946.EVS_SLUT_EJER.SIDSTE.CENKE = ' ')) !                
              HJ67 = '1' !                                              
            ((BH946.MT.CSBSK(SLUTÅR) = '2' !                            
              BH946.MT.CSBSK(SLUTÅR) = '3' !                            
              BH946.MT.CSBSK(SLUTÅR) = '5' !                            
              BH946.MT.CSBSK(SLUTÅR) = '6') &                           
             (BH946.MT.DCIÆN(SLUTÅR) > 0 &                              
              BH946.MT.DCIÆN(SLUTÅR) <                                  
              BH946.MT.DRGNÅRFRA))) &                                   
             (BH946.TIL_EVS.CENKE = '3' !                               
              BH946.TIL_EVS.CENKE = '4')                                
         THEN                                                           
            DO;                                                         
               /* CENKE-KODEN SLETTES, HVIS       */                    
               /* PERSONEN HAR GIFTET SIG IGEN    */                    
               /* I ÅRET FØR SLUTÅRET             */                    
               /* ELLER ER FYLDT 67 ÅR I SLUTÅRET */                    
               BH946.TIL_EVS.CENKE = ' ';                               
               BH946.TIL_FORSKUD.COPR_CENKE = ' ';                      
               IF BH946.EVS_FORSK_EJER.CENKE = '3' !                    
                 (BH946.EVS_SLUT_EJER.SIDSTE.CENKE = '3' &              
                  BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1')               
               THEN                                                     
                  TV.CENKE3_NED = TV.CENKE3_NED + 1;                    
               ELSE                                                     
                  IF BH946.EVS_FORSK_EJER.CENKE = '4' !                 
                    (BH946.EVS_SLUT_EJER.SIDSTE.CENKE = '4' &           
                     BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1')            
                  THEN                                                  
                     TV.CENKE4_NED = TV.CENKE4_NED + 1;                 
            END;                                                        
                                                                        
         IF BH946.TIL_EVS.CENKE = '3' !                                 
            BH946.TIL_EVS.CENKE = '4'                                   
         THEN                                                           
            DO;                                                         
               IF BH946.MT.CCIVS = 'E' !                                
                  BH946.MT.CCIVS = 'L'                                  
               THEN;                                                    
               ELSE                                                     
                 IF (BH946.MT.DCIÆN(SLUTÅR) > 0 &                       
                     BH946.MT.DCIÆN(SLUTÅR) < BH946.MT.DRGNÅRFRA)       
                 THEN                                                   
                    DO;                                                 
                      BH946.TIL_EVS.CENKE = ' ';                        
                      BH946.TIL_FORSKUD.COPR_CENKE = ' ';               
                      IF BH946.EVS_FORSK_EJER.CENKE = '3' !             
                        (BH946.EVS_SLUT_EJER.SIDSTE.CENKE = '3' &       
                         BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1')        
                      THEN                                              
                         TV.CENKE3_NED = TV.CENKE3_NED + 1;             
                      ELSE                                              
                         IF BH946.EVS_FORSK_EJER.CENKE = '4' !          
                           (BH946.EVS_SLUT_EJER.SIDSTE.CENKE = '4' &    
                            BH946.EVS_SLUT_EJER.SIDSTE.CSLET < '1')     
                         THEN                                           
                            TV.CENKE4_NED = TV.CENKE4_NED + 1;          
                    END;                                                
            END;                                                        
                                                                        
         IF BH946.TIL_EVS.CENKE = ' ' &                                 
            BH946.MT.CDØDÆGTF > '0' &                                   
            BH946.NEDSLAG.CÆGTEJET > 0 &                                
            HJ67 ^= '1'                                                 
         THEN                                                           
            DO;                                                         
               /* CENKE-KODE 3 / 4 OPSÆTTES,    */                      
               /* HVIS ÆGTEFÆLLEN ER DØD I 2008 */                      
               IF BH946.MT.CDØDÆGTF = '1'                               
               THEN                                                     
                  DO;                                                   
                     /* ENKE EFTER 67-ÅRIG */                           
                     BH946.TIL_EVS.CENKE = '3';                         
                     BH946.TIL_FORSKUD.COPR_CENKE = 'S';    /*RUL  */   
                  /* HVIS KØRSEL=SLUT */                                
                  /* BH946.TIL_FORSKUD.COPR_CENKE = 'F'; */  /*RUL  */  
                  /* HVIS KØRSEL=FORSKUD */                             
                  END;                                                  
               ELSE                                                     
                  DO;                                                   
                     /* ENKE EFTER FØRTIDSPENS */                       
                     BH946.TIL_EVS.CENKE = '4';                         
                     BH946.TIL_FORSKUD.COPR_CENKE = 'S';    /*RUL  */   
                  /* HVIS KØRSEL=SLUT */                                
                  /* BH946.TIL_FORSKUD.COPR_CENKE = 'F'; */   /*RUL  */ 
                  /* HVIS KØRSEL=FORSKUD */                             
                  END;                                                  
               BH946.TIL_EVS.DHENVN = BH946.MT.DHENVN(SLUTÅR-1);        
               IF BH946.TIL_EVS.CENKE = '3'                             
               THEN                                                     
                  TV.CENKE3_OPS = TV.CENKE3_OPS + 1;                    
               ELSE                                                     
                  TV.CENKE4_OPS = TV.CENKE4_OPS + 1;                    
            END;                                                        
                                                                        
         IF BH946.MT.CCIVS = 'D' &                                      
           (BH946.MT.DCIÆN(SLUTÅR) >= GLÅR0901 &                        
            BH946.MT.DCIÆN(SLUTÅR) <= ÅR1231)                           
         THEN                                                           
            BH946.TIL_EVS.DHENVN = BH946.MT.DHENVN(SLUTÅR-1);           
                                                                        
 END OPSÆT_OPLYSNINGER_FRA_MTFIL;                                       
                                                                        
 /********************************************************************* 
 *       OPSÆT KODER FOR PERSONTYPE TIL SLUT OG FORSKUD               * 
 *********************************************************************/ 
 OPSÆT_PERSONTYPE: PROC;                                                
                                                                        
 DCL W_CSKPLOM        CHAR(1);                   /* #001     2014     */
                                                                        
         W_CSKPLOM = ' ';                                               
         IF BH946.TIL_EVS.CENKE = '3'                                   
         THEN                                                           
            DO;                                                         
               /* HVIS EJER EFTERLEVER ÆGTEFÆLLE     */                 
               /* PÅ 65/67 ÅR ELLER DEROVER BEREGNES */                 
               /* EVS M.V. SOM 65/67-ÅRIG            */                 
               BH946.TIL_EVS.CPTYPSLUT = '3';                           
               BH946.TIL_EVS.CPTYPFOR = '3';                            
               RETURN;                                                  
            END;                                                        
                                                                        
         /* HVIS EJER ER FYLDT 65/67 I INDKOMSTÅR TIL SLUT     */       
         /* ELLER ÆGTEFÆLLE LEVER OG ER FYLDT 65/67 I SAMME ÅR */       
         /* SÅ ER KODERNE ALLEREDE OPSAT P.G.A. ALDER          */       
                                                                        
         IF HJ67    = '1' !                                             
            HJHNV67 = '1'                                               
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BH946.TIL_EVS.CENKE = '4' !                                 
            BH946.MT.CFØREFT(SLUTÅR) > 0                                
         THEN                                                           
            DO;                                                         
               IF BH946.TIL_EVS.CPTYPSLUT = '1'                         
               THEN                                                     
                  BH946.TIL_EVS.CPTYPSLUT = '2';                        
                  /*EFTERLØN/FØRTID SLUT-ÅR*/                           
               IF BH946.TIL_EVS.CPTYPFOR = '1'                          
               THEN                                                     
                  BH946.TIL_EVS.CPTYPFOR = '2';                         
                  /*EFTERLØN/FØRTID FORSKUD-ÅR*/                        
            END;                                                        
                                                                        
         IF BH946.TIL_EVS.CPTYPFOR = '1' &                              
            BH946.MT.CFØREFT(FORSKÅR) > 0                               
         THEN                                                           
            BH946.TIL_EVS.CPTYPFOR = '2';                               
                                                                        
         /* START FORSKUD 2015 UDENLANSKE PENSIONIST NEDSLAG #001     */
         IF BH946.TIL_EVS.CPTYPFOR = '3'                                
         THEN DO;                                                       
            IF BH946.MT.HIST_OPL(BH65300M.FORSKÅR).CSKPLOM ^= ' '       
            THEN DO;                                                    
               W_CSKPLOM = BH946.MT.HIST_OPL(BH65300M.FORSKÅR).CSKPLOM; 
               IF TFLAG                                                 
               THEN                                                     
                  PUT SKIP LIST('CSKPLOM FRA '!!                        
                                BH65300M.FORSKÅR!!')');                 
            END;                                                        
            ELSE DO;                                                    
               IF BH946.MT.HIST_OPL(BH65300M.SLUTÅR).CSKPLOM ^= ' '     
               THEN DO;                                                 
                  W_CSKPLOM =                                           
                           BH946.MT.HIST_OPL(BH65300M.SLUTÅR).CSKPLOM;  
                  IF TFLAG                                              
                  THEN                                                  
                     PUT SKIP LIST('CSKPLOM FRA '!!                     
                                    BH65300M.SLUTÅR!!')');              
               END;                                                     
               ELSE DO;                                                 
                  IF BH946.MT.HIST_OPL(BH65300M.GLSLUTÅR).CSKPLOM ^= ' '
                  THEN DO;                                              
                     W_CSKPLOM =                                        
                         BH946.MT.HIST_OPL(BH65300M.GLSLUTÅR).CSKPLOM;  
                     IF TFLAG                                           
                     THEN                                               
                        PUT SKIP LIST('CSKPLOM FRA '!!                  
                                       BH65300M.GLSLUTÅR);              
                  END;                                                  
                  ELSE DO;                                              
                     W_CSKPLOM =                                        
                         BH946.EVS_UDTRÆK.EVS_SLUT_EJER.SIDSTE.CSKPLOMF;
                  END;                                                  
               END;                                                     
            END;                                                        
            IF TFLAG                                                    
            THEN                                                        
               PUT SKIP LIST('CSKPLOM = '!!W_CSKPLOM);                  
            IF W_CSKPLOM = '1'                                          
             ! W_CSKPLOM = '3'                                          
             ! W_CSKPLOM = '8'                                          
           THEN DO;                                                     
              BH946.TIL_EVS.CPTYPFOR  = '4';                            
              DAN_4_OPSÆT_PERSONTYPE += 1;                              
           END;                                                         
         END;                                                           
         IF TFLAG                                                       
         THEN                                                           
            PUT SKIP LIST('CTYPFOR = '!!BH946.TIL_EVS.CPTYPFOR);        
         /* SLUT #001  FORSKUD 2015                                   */
                                                                        
                                                                        
                                                                        
 END OPSÆT_PERSONTYPE;                                                  
                                                                        
 /********************************************************************* 
 *       HER SKRIVES PERSONEN PÅ DATASÆT MED SOMMERHUSE HVIS BENYT-   * 
 *       TELSESKODEN ER 08,28,48  E L L E R  PÅ DATASÆT MED ØVRIGE    * 
 *       EJENDOMME.                                                   * 
 *********************************************************************/ 
 SKRIV_PERSON:                                                          
         PROC;                                                          
                                                                        
         IF BH946.AKT_VURD.CBENYT = '08' !                              
            BH946.AKT_VURD.CBENYT = '28' !                              
            BH946.AKT_VURD.CBENYT = '48' !                              
           (BH946.AKT_VURD.CBENYT = '25' &                              
            BH946.VURD_AKT.CEJDTYPE_AKT = '8' & /* ÆNDRET PGA CEANV*/   
           (BH946.ESR.CEANV = '510' !                                   
            BH946.ESR.CEANV = '520'))                                   
         THEN                                                           
            DO;                                                         
               WRITE FILE (BH9321O) FROM (BH946_AR);                    
               TV.SOMMERHUSE = TV.SOMMERHUSE + 1;                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               TV.ØVRIGE = TV.ØVRIGE + 1;                               
               WRITE FILE (BH9322O) FROM (BH946_AR);                    
            END;                                                        
                                                                        
 END SKRIV_PERSON;                                                      
                                                                        
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
         PROC;                                                          
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆS_BH946;                                  
         DETLIN1.TEKST = 'ANTAL LÆSTE PÅ UDTRÆK             B.H94601D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.BK16;                                       
         DETLIN1.TEKST = '      HERAF UDGÅEDE EJENDOMME SOM OVERLÆSES'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.SOMMERHUSE;                                 
         DETLIN1.TEKST = 'ANTAL SKREVNE SOMMERHUSE          B.H94110D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.ØVRIGE;                                     
         DETLIN1.TEKST = 'ANTAL SKREVNE ØVRIGE EJENDOMME    B.H94120D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.LÆS_BH655;                                  
         DETLIN1.TEKST = 'ANTAL LÆSTE PÅ MINI MT-FIL        B.H65501D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.EJPNR;                                      
         DETLIN1.TEKST = 'ESR-EJERE IKKE EN PERSON             ANTAL:'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FMT;                                        
         DETLIN1.TEKST = 'ESR-EJERE FUNDET PÅ MINI MT-FIL      ANTAL:'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.EJMT;                                       
         DETLIN1.TEKST = 'ESR-EJERE IKKE FUNDET PÅ MINI MT-FIL ANTAL:'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.CSRPDATA;                                   
         DETLIN1.TEKST = 'ESR-EJERE FUNDET I CSRPDATA       ANTAL:';    
         CALL ZZ20300 (DETLIN1,'01');                    /*SLUT05*/     
         DETLIN1.CCA = ZZWS1;                            /*SLUT05*/     
         DETLIN1.ANTAL = TV.CENKE3_OPS;                                 
         DETLIN1.TEKST = 'ANTAL OPSAT CENKE-KODE 3(ENKE EFT 67 ÅR)';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.CENKE3_NED;                                 
         DETLIN1.TEKST = 'ANTAL NEDTAGET CENKE-KODE 3             ';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.CENKE4_OPS;                                 
         DETLIN1.TEKST = 'ANTAL OPSAT CENKE-KODE 4(ENKE EFT EFTLØ)';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.CENKE4_NED;                                 
         DETLIN1.TEKST = 'ANTAL NEDTAGET CENKE-KODE 4             ';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL EJERANDEL HENTET FRA GL. SLUTÅR     ';  
         DETLIN1.ANTAL = TV.HENT_PCT;                                   
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL BK ÆNDRET FRA GRUND TIL BOLIG       ';  
         DETLIN1.ANTAL = TV.HANST;                                      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL CFORSKEL=1 (EVT. REDUCERET I 2008)  ';  
         DETLIN1.ANTAL = TV.FORSKEL1;                                   
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL CFORSKEL=2 (IKKE REDUCERET)         ';  
         DETLIN1.ANTAL = TV.FORSKEL2;                                   
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.TEKST = 'ANTAL CFORSKEL=3 (IKKE REDUCERET)         ';  
         DETLIN1.ANTAL = TV.FORSKEL3;                                   
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = '      HERAF PGF4A VURDEREDE     ';            
         DETLIN1.ANTAL = TV.PGF4A;                                      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = '      HERAF PGF4B VURDEREDE     ';            
         DETLIN1.ANTAL = TV.PGF4B;                                      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL CSRP-DATA INDFLYTNING     ';            
         DETLIN1.ANTAL = TV.CPR_INDFLYT;                                
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL CSRP-DATA FRAFLYTNING     ';            
         DETLIN1.ANTAL = TV.CPR_FRAFLYT;                                
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL CSRP-DATA BEBOET          ';            
         DETLIN1.ANTAL = TV.CPR_BEBOET;                                 
         CALL ZZ20300 (DETLIN1,'01');                                   
  END TOTALLISTE;                                                       
 /********************************************************************* 
 *       SKRIVNING AF OPTÆLLINGSINDIVID                               * 
 *********************************************************************/ 
 SKRIV_OPTÆLLING:                                                       
         PROC;                                                          
                                                                        
         BH93299            = '';                                       
         BH93299.SORT_CPR   = 99999999999;                              
         BH93299.SORT_KOMNR = 999;                                      
         BH93299.SORT_EJDNR = 9999999;                                  
         BH93299.ANT_INDV   = TV.ØVRIGE;                                
         WRITE FILE (BH9322O) FROM (BH93299);                           
                                                                        
         BH93299.ANT_INDV   = TV.SOMMERHUSE;                            
         WRITE FILE (BH9321O) FROM (BH93299);                           
                                                                        
 END SKRIV_OPTÆLLING;                                                   
 /********************************************************************* 
 *       MASKINEL AFSTEMNING                                          * 
 *********************************************************************/ 
 MASK_AFSTEMNING:                                                       
         PROC;                                                          
         IF EX_PARM = 'TEST'                                            
         THEN                                                           
            RETURN;                                                     
         IF BH94699.SORT_KOMNR ^= 999 &                                 
            BH94699.SORT_EJDNR ^= 99999999999                           
         THEN                                                           
            CALL FEJLLISTE('1');                                        
         IF BH946_ANT_INDV ^= TV.LÆS_BH946                              
         THEN                                                           
            CALL FEJLLISTE('2');                                        
         IF MTFIL_OPT.DCPRN ^= 99999999999                              
         THEN                                                           
            CALL FEJLLISTE('3');                                        
         IF MTFIL_OPT.ANT_INDV ^= TV.LÆS_BH655                          
         THEN                                                           
            CALL FEJLLISTE('4');                                        
 END MASK_AFSTEMNING;                                                   
 /*********************************************************************/
 /*      UDSKRIV FEJLLISTE VEDR. KONSTATERET AFSTEMNINGFEJL PÅ ???    */
 /*********************************************************************/
 FEJLLISTE:                                                             
         PROC(FEJL);                                                    
 DCL     FEJL            CHAR      (01);                                
         CALL ZZ20390 ('*OPEN','BH93202Y');                             
         CALL ZZ20300(SIDELIN,'02');                                    
         CALL ZZ20300(OVERLIN1,'02');                                   
         OVERLIN2.CCA = ZZWS3;                                          
         OVERLIN2.TEKST1 = 'FEJLLISTE VEDR. MASKINEL AFSTEMNING';       
         CALL ZZ20300(OVERLIN2,'02');                                   
         IF FEJL = '1'                                                  
         THEN                                                           
            DO;                                                         
               DETLIN1.CCA   = ZZWS3;                                   
               DETLIN1.TEKST  =                                         
               'AFSTEMNINGSINDIVID MANGLER PÅ B.H94600D';               
               DETLIN1.ANTAL = '';                                      
               CALL ZZ20300(DETLIN1,'02');                              
            END;                                                        
         IF FEJL = '2'                                                  
         THEN                                                           
            DO;                                                         
               DETLIN1.CCA   = ZZWS3;                                   
               DETLIN1.TEKST = 'ANTAL LÆSTE INDIVIDER PÅ B.H94600D';    
               DETLIN1.ANTAL = TV.LÆS_BH946;                            
               CALL ZZ20300(DETLIN1,'02');                              
               DETLIN1.TEKST =                                          
               'ANTAL IFØLGE AFSTEMNINGSINDIVID IALT  :';               
               DETLIN1.ANTAL = BH946_ANT_INDV;                          
               CALL ZZ20300(DETLIN1,'02');                              
            END;                                                        
         IF FEJL = '3'                                                  
         THEN                                                           
            DO;                                                         
               DETLIN1.CCA   = ZZWS3;                                   
               DETLIN1.TEKST  =                                         
               'AFSTEMNINGSINDIVID MANGLER PÅ B.H65501D';               
               DETLIN1.ANTAL = '';                                      
               CALL ZZ20300(DETLIN1,'02');                              
            END;                                                        
         IF FEJL = '4'                                                  
         THEN                                                           
            DO;                                                         
               DETLIN1.CCA   = ZZWS3;                                   
               DETLIN1.TEKST  = 'ANTAL LÆSTE PERSONER PÅ  B.H65501D';   
               DETLIN1.ANTAL = TV.LÆS_BH655;                            
               CALL ZZ20300(DETLIN1,'02');                              
               DETLIN1.TEKST  =                                         
               'ANTAL PERSONER IFØLGE AFSTEMNINGSINDIVID';              
               DETLIN1.ANTAL = MTFIL_OPT.ANT_INDV;                      
               CALL ZZ20300(DETLIN1,'02');                              
            END;                                                        
            SWFEJL = '1';                                               
 END FEJLLISTE;                                                         
 /**********************************************************************
 * HER UDSKRIVES SQL FEJL VED HJÆLP AF STANDARD RUTINE          RUTINE *
 **********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
       CALL ZS67000(SQLCA);                                             
       CALL ZS30101(4,'BH93200 ** 250 ' !!                              
               'FEJL VED OPEN EL. CLOSE AF CURSOR',2);                  
                                                                        
 END SQL_FEJL;                                                          
 /********************************************************************* 
 *       AFSLUT PROGRAM                                               * 
 *********************************************************************/ 
 AFSLUT: PROC;                                                          
                                                                        
         CALL TOTALLISTE;                                               
         CALL SKRIV_OPTÆLLING;                                          
         CALL MASK_AFSTEMNING;                                          
         CALL ZZ20300((133)' ','99');                                   
         CLOSE FILE (BH946I),                                           
               FILE (BH655I),                                           
               FILE (BH9321O),                                          
               FILE (BH9322O);                                          
                                                                        
         IF SWFEJL = '1'                                                
         THEN                                                           
            CALL ZS30101(4,'BH93200 ** 251 ' !!                         
                 'MASKINEL KONSTATERET AFSTEMNINGSFEJL',2);             
 END AFSLUT;                                                            
 %INCLUDE BH65500M;     /* UNDERSØG/BEREGN EN PERSON'S ALDER         */ 
 %INCLUDE BH94301M;     /* HENT FLYTTEDATOERNE FRA CSRP TABEL        */ 
 %INCLUDE BH94302M;     /* HENT PERSONOPLYSNINGER FRA CSRP   *SLUT05**/ 
 %INCLUDE BH94303M;     /* HENT BEBOEDE ERHV. PER FRA CSRP   #18-03  */ 
 %INCLUDE BH94304M;     /* FÆLLES SØGEKRITERIER                      */ 
 %INCLUDE ZM90013M;     /* OMSÆT DATO TIL/FRA DB2 FORMAT             */ 
 END  BH93200;                                                          
