 PROCESS OPT(TIME);                                                     
 BH94400:/* BEHANDL SOMMERHUSE A.H.T. BEREGNING SOM HELÅRSBEBOELSE  */  
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /*********************************************************************/
         DCL COPYRIGHT   CHAR      (30) STATIC                          
                         INIT ('COPYRIGHT KOMMUNEDATA A/S 2004');       
 /********************************************************************* 
 *                                                                    * 
 * FORMÅL : AT OVERFØRE KODE FOR HELÅRSBEREGNING OPSAT I BH94200      * 
 *          FRA EN ANDEN EJER AF SAMME EJENDOM TIL DEN AKTUELLE EJER, * 
 *          MEN KUN HVIS DEN AKTUELLE EJER OGSÅ ER TILMELDT EJENDOM-  * 
 *          MENS ADRESSE JVF. P-DATA. DESUDEN RETTES KODE FOR HELÅRS- * 
 *          BEREGNING, HVIS DEN ANDEN EJER'S KODE HAR 'HØJERE' VÆRDI. * 
 *          OVERFØRSEL LAVES DOG KUN HVIS DEN AKTUELLE EJER HAR       * 
 *          STATUS SOM 65/67-ÅRIG.                                    * 
 *                                                                    * 
 * INPUT  : B.H94201D  UDTRÆK FRA ESR (SORTERET I BH94300)            * 
 *                                                                    * 
 * OUTPUT : B.H94400D  BEHANDLET ESR-UDTRÆK                           * 
 *          BH94401Y   KONTROLLISTE OG STATISTIK                      * 
 *          BH94402Y   FEJLLISTE FRA MASKINEL AFSTEMNING              * 
 *                                                                    * 
 * PROGRAMMØR:   AAGE RASMUSSEN  PUS AUGUST 1999                      * 
 * ÅRSTILRETTET: AAGE RASMUSSEN  PUS JULI   2000                      * 
 * ÅRSTILRETTET: AAGE RASMUSSEN  PUS JAN    2001                      * 
 * ÅRSTILRETTET: AAGE RASMUSSEN  LSU T&S AUG 2001 - FORSKUD 2002      * 
 *       RETTET: AAGE RASMUSSEN  LSU T&S DEC 2001 - SLUT 2001         * 
 * ÅRSTILRETTET: ESBEN BRODERSEN LSU T&S AUG 2002 - FORSKUD 2003      * 
 *       RETTET: AAGE RASMUSSEN  LSU T&S DEC 2002 - SLUT 2002         * 
 * ÅRSTILRETTET: BO SCHMIDT      LSU T&S AUG 2003 - FORSKUD 2004      * 
 * ÅRSTILRETTET: BO SCHMIDT      LSU T&S JUN 2004 - FORSKUD 2005      * 
 * FORSKUD06     SUSANNE KROGH VILLUMSEN          02-06-2005          * 
 *               TILRETTET FORSKUD 2006                               * 
 *               STAT2005 ÆNDRES TIL STAT2006 MED C ALL               * 
 *               STAT2004 ÆNDRES TIL STAT2005 MED C ALL               * 
 * SLUT05        SUSANNE KROGH VILLUMSEN          08-11-2005          * 
 *               TILRETTET SLUT05                                     * 
 * FORSKUD07     BO SCHMIDT                       14-05-2006          * 
 *               TILRETTET FORSKUD 2007                               * 
 *               STAT2006 ÆNDRES TIL STAT2007 MED C ALL               * 
 *               STAT2005 ÆNDRES TIL STAT2006 MED C ALL               * 
 * SLUT06        BO SCHMIDT                       04-10-2007          * 
 *               TILRETTET SLUT06                                     * 
 * FORSKUD08     BO SCHMIDT                       14-05-2007          * 
 *               TILRETTET FORSKUD 2008                               * 
 *               STAT2007 ÆNDRES TIL STAT2008 MED C ALL               * 
 *               STAT2006 ÆNDRES TIL STAT2007 MED C ALL               * 
 * SLUT07        BO SCHMIDT                       19-11-2007          * 
 *               TILRETTET SLUT07                                     * 
 * FORSKUD09     BO SCHMIDT                       23-06-2008          * 
 *               TILRETTET FORSKUD 2009                               * 
 *               STAT2008 ÆNDRES TIL STAT_SIDSTE_ÅR MED C ALL         * 
 *               STAT2007 ÆNDRES TIL STAT2008 MED C ALL               * 
 * SLUT08        BO SCHMIDT                       19-11-2008          * 
 *               TILRETTET SLUT08                                     * 
 * FORSKUD10     GERD HOLM-PEDERSEN               20-04-2009          * 
 *               TILRETTET FORSKUD 2010, RUL                          * 
 *               STAT_SIDSTE_ÅR ÆNDRES TIL STAT2010 MED C ALL         * 
 *               STAT2008 ÆNDRES TIL STAT_2009      MED C ALL         * 
 * SLUT09        GERD HOLM-PEDERSEN               13-10-2009          * 
 *               TILRETTET SLUT09                                     * 
 * FORSKUD11     GERD HOLM-PEDERSEN               08-06-2010          * 
 *               TILRETTET FORSKUD 2011, RUL                          * 
 * SLUT10        GERD HOLM-PEDERSEN               08-10-2010          * 
 *               TILRETTET SLUT10                                     * 
 * FORSKUD12     GERD HOLM-PEDERSEN               06-04-2011          * 
 *               ÅRSTILRETTET TIL FORSKUD 2012                RUL     * 
 *               SAMT ÆNDRET PROCEDURE- OG VARIABELNAVNE TIL AT VÆRE  * 
 *               ÅRSUAFHÆNGIGE.                                       * 
 *               F2011HELÅR     -> F_SIDSTE_HELÅR                     * 
 *               F2012HELÅR     -> F_AKT_HELÅR                        * 
 *               STATISTIK_2011 -> STATISTIK_SIDSTE_ÅR                * 
 *               STATISTIK_2012 -> STATISTIK_AKT_ÅR                   * 
 *               STAT2011       -> STAT_SIDSTE_ÅR                     * 
 *               STAT2012       -> STAT_AKT_ÅR                        * 
 *               OPTÆL2011_67   -> OPTÆL_AKT_ÅR_67                    * 
 *               OPTÆL2012_67   -> OPTÆL_SIDSTE_ÅR_67                 * 
 *               OPTÆL2011_OVF  -> OPTÆL_AKT_ÅR_OVF                   * 
 *               OPTÆL2012_OVF  -> OPTÆL_SIDSTE_ÅR_OVF                * 
 * SLUT11        GERD HOLM-PEDERSEN               22-09-2010          * 
 *               TILRETTET SLUT11                                     * 
 * SLUT11        GERD HOLM-PEDERSEN                                   * 
 *               DET VAR FORSKUDSSTRUKTUREN DER BLEV BRUGT            * 
 *               SAMT I LÆS: ÆNDRET BBRF380 TIL 0000 HVIS 0001   #GEH * 
 * FORSKUD13     LARS KAAE HARRITSHØJ             30-05-2012          * 
 *               ÅRSTILRETTET TIL FORSKUD 2013                RUL     * 
 *               BH90000N => BH90100N                                 * 
 *               ÆNDRINGER FORETAGET I BH90100N                       * 
 * SLUT12        LARS KAAE HARRITSHØJ             SEP 2012            * 
 *               TILRETTET SLUT12                                     * 
 *               BH90100N => BH90000N                                 * 
 * FORSKUD14     LARS KAAE HARRITSHØJ             Maj 2013            * 
 *               ÅRSTILRETTET TIL FORSKUD 2014                RUL     * 
 *               BH90000N => BH90100N                                 * 
 * SLUT   13     JØRGEN SAUGMANN                  OKT 2013            * 
 *               ÅRSTILRETTET TIL SLUT 2013                   RUL     * 
 *               BH90100N => BH90000N                                 * 
 * FORSKUD15     JØRGEN SAUGMANN                  JUN 2014            * 
 *               ÅRSTILRETTET TIL FORSKUD 2015                RUL     * 
 *               BH90000N => BH90100N                                 * 
 * SLUT   14     JØRGEN SAUGMANN                  OKT 2014            * 
 *               ÅRSTILRETTET TIL SLUT 2014                   RUL     * 
 *               BH90100N => BH90000N                                 * 
 * FORSKUD16     JØRGEN SAUGMANN                  JUN 2015            * 
 *               ÅRSTILRETTET TIL FORSKUD 2016                RUL     * 
 *               BH90000N => BH90100N                                 * 
 * SLUT   15     Z6JNK                            OKT 2015            * 
 *               ÅRSTILRETTET TIL SLUT 2015.      (søg efter RUL)     * 
 *               BH90100N => BH90000N                                 * 
 * SLUT   15     QEB                              MARTS 2016          * 
 *               UDVIDET BRUG AF DATOMACRO BH65300M #01               * 
 *               RETTELSE AF KRITERIE FOR OVERFØRSELS KODE  #02       * 
 * FORSKUD17     ESBEN BRODERSEN                  JUN 2016            * 
 *               ÅRSTILRETTET TIL FORSKUD 2017               RUL      * 
 *               BH90000N => BH90100N                                 * 
 * SLUT   16     Lene Maj Jensen                  SEP 2016            * 
 *               STRUKTUR ÆNDRET FRA FORSKUD TIL SLUT        RUL      * 
 *               BH90100N => BH90000N                                 * 
 * FORSKUD18     ESBEN BRODERSEN                  JUN 2017            * 
 *               ÅRSTILRETTET TIL FORSKUD 2018               RUL      * 
 *               BH90000N => BH90100N                                 * 
 *               L121  Reglen er at sommerhuset skal være ejet i      * 
 *               mindst 1 år i løbet af indkomståret tidligere 8 år   * 
 * SLUT   17     Esben Brodersen QEB              OKT 2017            * 
 *               STRUKTUR ÆNDRET FRA FORSKUD TIL SLUT        RUL      * 
 *               BH90100N => BH90000N                                 * 
 *               SKIFTET TIL NY RUTINE TEST_EJET_ANTAL_ÅR_OK          * 
 *               I BH94200M                                             
 *********************************************************************/ 
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL     BH942I FILE RECORD INPUT;                                      
 DCL     BH944O FILE RECORD OUTPUT;                                     
 DCL     SYSPRINT FILE OUTPUT;                                          
 /********************************************************************* 
 *       DECLARE AF UDTRÆK                                            * 
 *********************************************************************/ 
 DCL     BH942_AR        CHAR      (6000) VAR;                          
 DCL     1 BH942         BASED     (ADDR(BH942_AR)),                    
           2 LÆNGDE      BIN FIXED (15),                                
                                                                        
 /*RUL*/    %INCLUDE BH90000N;;  /* DENNE STRUKTUR NÅR KØRSEL=SLUT */   
 /*RUL      %INCLUDE BH90100N;;  /* DENNE STRUKTUR NÅR KØRSEL=FORSKUD */
                                                                        
 DCL     1 BH94299       BASED     (ADDR(BH942_AR)),                    
           3 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH90099N;                                           
                                                                        
 DCL     1 BH942_ID,                                                    
      2 EKOMNR       FIXED   (3),   /* KOM.NR. BELIG.                 */
      2 EEJDNR       FIXED   (7),   /* EJENDOMSNR.                    */
      2 C_SÆLGER     CHAR    (1);   /* KODE: ER PERSONEN EN SÆLGER?   */
                                                                        
 DCL     BH942ID         CHAR      (7)    BASED(ADDR(BH942_ID));        
                                                                        
 DCL     CHELÅR_SLUT_DATO   DEC FIXED(09);                              
 DCL     CHELÅR_FORSK_DATO  DEC FIXED(09);                              
 DCL     ANTAL_ÅR           BIN FIXED(15);                              
 /********************************************************************* 
 *               DECLARE AF DIV. FÆLLESMACROER (ESKEMA/BOY/FORSKUD)   * 
 *********************************************************************/ 
 DCL     1 BH65300M,                                                    
           %INCLUDE BH65300M;                                           
 /********************************************************************* 
 *               DECLARE AF DIV. TÆLLEVÆRKER                          * 
 *********************************************************************/ 
 DCL     1 STAT_SIDSTE_ÅR(100:999), /* TÆLLEVÆRKER TIL STATISTIK  */    
           2 CLIN          PIC       '9'  INIT (0),                     
           2 PLIN(20),                                                  
             3 A379        FIXED DEC (7), /* BBRF379 = A          */    
             3 B379        FIXED DEC (7), /* BBRF379 = B          */    
             3 C379        FIXED DEC (7), /* BBRF379 = C          */    
             3 D379        FIXED DEC (7), /* BBRF379 = D          */    
             3 U379        FIXED DEC (7), /* BBRF379 = BLANK      */    
             3 IALT        FIXED DEC (7);                               
 DCL     1 STAT_AKT_ÅR(100:999),   /* TÆLLEVÆRKER TIL STATISTIK   */    
           2 CLIN          PIC       '9'  INIT (0),                     
           2 PLIN(14),                                                  
             3 A379        FIXED DEC (7), /* BBRF379 = A          */    
             3 B379        FIXED DEC (7), /* BBRF379 = B          */    
             3 C379        FIXED DEC (7), /* BBRF379 = C          */    
             3 D379        FIXED DEC (7), /* BBRF379 = D          */    
             3 U379        FIXED DEC (7), /* BBRF379 = BLANK      */    
             3 IALT        FIXED DEC (7);                               
 DCL     1 TV,                    /* TÆLLEVÆRKER TIL TOTALLISTEN */     
           2 LÆS_BH942   FIXED DEC (9),                                 
           2 FSOM_UBOP   FIXED DEC (9),                                 
           2 FSOM_MBOP   FIXED DEC (9),                                 
           2 FSEJDTYP3Æ  FIXED DEC (9),                                 
           2 FSEJDTYP8Æ  FIXED DEC (9),                                 
           2 FFEJDTYP3Æ  FIXED DEC (9),                                 
           2 FFEJDTYP8Æ  FIXED DEC (9),                                 
                                                                        
           2 F_SIDSTE_HELÅR FIXED DEC (9),     /* AKTUELT SLUTÅR     */ 
                                                                        
           2 F_AKT_HELÅR FIXED DEC (9);        /* AKTUELT FORSKUDSÅR */ 
 /********************************************************************* 
 *       DECLARE AF HJÆLPEFELTER TIL MASKINEL AFSTEMNING              * 
 *********************************************************************/ 
 DCL     SWFEJL          CHAR      (1)       INIT      (' ');           
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     EOF_BH942       BIT       (1);                                 
 DCL     I               BIN FIXED (15);                                
 DCL     INDX            BIN FIXED (31);                                
 DCL     HJ_CPR          PIC       '(10)9';                             
 DCL     DATO1           CHAR      (26);                                
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DAG         CHAR      (02);                                
 DCL     C_OVERFØRT      CHAR      (1);                                 
 DCL     1 GEMEJD,                                                      
      2 EKOMNR       FIXED   (3),   /* KOM.NR. BELIG.                 */
      2 EEJDNR       FIXED   (7),   /* EJENDOMSNR.                    */
      2 C_SÆLGER     CHAR    (1),   /* KODE: ER PERSONEN EN SÆLGER?   */
      2 CHELÅR       CHAR    (1);   /* HELÅRS. JVF. BBR OG/ELL ESR?   */
 DCL     GEMID           CHAR      (7) BASED(ADDR(GEMEJD));             
 /********************************************************************* 
 *       DECLARE AF ENTRY OG BUILTIN                                  * 
 *********************************************************************/ 
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     SUBSTR          BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     LOW             BUILTIN;                                       
 DCL     HIGH            BUILTIN;                                       
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
         EXTERNAL INIT ('NOTEST(ALL,,;)');                              
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVLIN1,                                                      
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH94400L'),                                        
           2 F1          CHAR      (25)      INIT      (' '),           
           2 TEKST2      CHAR      (57)      INIT      (                
           'STATISTIK M.V. VEDR. HELÅRSBEBOELSE I SOMMERHUSE'),         
           2 F2          CHAR      (09)      INIT      (' '),           
           2 TEKST3      CHAR      (14)      INIT      (                
           'UDSKREVET DEN '),                                           
           2 DATO,                                                      
             3 DAG         CHAR      (02),                              
             3 F1          CHAR      (01) INIT ('.'),                   
             3 MD          CHAR      (02),                              
             3 F2          CHAR      (01) INIT ('.'),                   
             3 ÅR          CHAR      (04);                              
 DCL     1 OVLIN2,                                                      
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 OVLIN3,                                                      
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (11),                                
           2 KOMNR       PIC      'ZZZ',                                
           2 FYLD        CHAR       (6)      INIT ((6)' '),             
           2 TEKST1      CHAR     (088),                                
           2 TEKST2      CHAR      (14)      INIT                       
           ('UDSKREVET DEN '),                                          
           2 DATO,                                                      
             3 DAG         CHAR      (02),                              
             3 F1          CHAR      (01) INIT ('.'),                   
             3 MD          CHAR      (02),                              
             3 F2          CHAR      (01) INIT ('.'),                   
             3 ÅR          CHAR      (04);                              
 DCL     1 OVLIN4,                                                      
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR     (132);                                
 DCL     1 DETLIN0,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (41),                                
           2 CPUÅR       PIC       '99',                                
           2 TEKST2      CHAR      (11),                                
           2 START       PIC       '999999',                            
           2 TEKST3      CHAR      (9),                                 
           2 SLUT        PIC       '999999',                            
           2 TEKST4      CHAR      (57);                                
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (80),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZZ',                       
           2 F2          CHAR      (41)      INIT      (' ');           
 DCL     1 DETLIN2,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (33),                                
           2 RCKOD       CHAR      (01)      INIT      (' '),           
           2 F1          CHAR      (19)      INIT      (' '),           
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (68)      INIT      (' ');           
 DCL     1 DETLIN3,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (10)      INIT      (' '),           
           2 TEKST2      CHAR      (07)      INIT      ('BELØB: '),     
           2 ANTAL2      PIC       'ZZZZ.ZZZ.ZZZ.ZZ9',                  
           2 F3          CHAR      (28)      INIT      (' ');           
 DCL     1 DETLIN4,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (30),                                
           2 F1          CHAR      (5)       INIT      (' '),           
           2 ANTAL1      PIC       'ZZZ.ZZZ',                           
           2 F2          CHAR      (5)       INIT      (' '),           
           2 F3          CHAR      (5)       INIT      (' '),           
           2 ANTAL2      PIC       'ZZZ.ZZZ',                           
           2 F4          CHAR      (5)       INIT      (' '),           
           2 F5          CHAR      (5)       INIT      (' '),           
           2 ANTAL3      PIC       'ZZZ.ZZZ',                           
           2 F6          CHAR      (5)       INIT      (' '),           
           2 F7          CHAR      (5)       INIT      (' '),           
           2 ANTAL4      PIC       'ZZZ.ZZZ',                           
           2 F8          CHAR      (5)       INIT      (' '),           
           2 F9          CHAR      (5)       INIT      (' '),           
           2 ANTAL5      PIC       'ZZZ.ZZZ',                           
           2 F10         CHAR      (5)       INIT      (' '),           
           2 F11         CHAR      (5)       INIT      (' '),           
           2 ANTAL6      PIC       'ZZZ.ZZZ',                           
           2 F12         CHAR      (5)       INIT      (' ');           
         % INCLUDE ZZ20301M;                                            
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
         EOF_BH942 = '0'B;                                              
         ON ERROR                                                       
            CALL PLIDUMP ('SNHOB');                                     
         OPEN FILE (BH942I) TITLE ('BH94201I');                         
         OPEN FILE (BH944O) TITLE ('BH94400O');                         
         ON ENDFILE (BH942I)                                            
            EOF_BH942 = '1'B;                                           
         CALL ZZ20390 ('*OPEN','BH94401Y');                             
         CALL ZS38100(DATO1);                                           
         SIDELIN.CCA = ZZIK1;                                           
         OVLIN1.DATO = DATO2, BY NAME;                                  
         OVLIN1.CCA  = ZZWS2;                                           
         OVLIN2.CCA  = ZZWS3;                                           
         OVLIN3.CCA  = ZZWS1;                                           
         TV = 0;                                                        
         DO INDX = 100 TO 999;                                          
            STAT_SIDSTE_ÅR(INDX).CLIN = 0;                              
            DO I = 1 TO 20;                                             
               STAT_SIDSTE_ÅR(INDX).PLIN(I).A379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).B379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).C379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).D379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).U379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).IALT = 0;                   
            END;                                                        
         END;                                                           
         STAT_SIDSTE_ÅR(100).CLIN = 1;                                  
         DO INDX = 100 TO 999;                                          
            STAT_AKT_ÅR(INDX).CLIN = 0;                                 
            DO I = 1 TO 14;                                             
               STAT_AKT_ÅR(INDX).PLIN(I).A379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).B379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).C379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).D379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).U379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).IALT = 0;                      
            END;                                                        
         END;                                                           
         STAT_AKT_ÅR(100).CLIN = 1;                                     
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
         CALL LÆS_BH942;                                                
         IF ^EOF_BH942                                                  
         THEN                                                           
            DO;                                                         
              GEMEJD.EKOMNR = BH942.SORT_KOMNR;                         
              GEMEJD.EEJDNR = BH942.SORT_EJDNR;                         
              GEMEJD.C_SÆLGER = BH942.TIL_EVS.C_SÆLGER;                 
              GEMEJD.CHELÅR   = BH942.TIL_EVS.CHELÅR;                   
              CALL SKRIV;                                               
              CALL LÆS_BH942;                                           
            END;                                                        
         DO WHILE ( ^EOF_BH942 );                                       
            IF GEMID ^= BH942ID                                         
            THEN                                                        
               DO;                                                      
                  GEMEJD.EKOMNR = BH942.SORT_KOMNR;                     
                  GEMEJD.EEJDNR = BH942.SORT_EJDNR;                     
                  GEMEJD.C_SÆLGER = BH942.TIL_EVS.C_SÆLGER;             
                  GEMEJD.CHELÅR   = BH942.TIL_EVS.CHELÅR;               
               END;                                                     
            ELSE                                                        
               CALL BEHANDL;   /* BEHANDLING AF ESR-UDTRÆK */           
            CALL SKRIV;                                                 
            CALL LÆS_BH942;                                             
         END;                                                           
         CALL AFSLUT;                                                   
 /********************************************************************* 
 *       LÆS UDTRÆK FRA ESR                                           * 
 *********************************************************************/ 
 LÆS_BH942:                                                             
         PROC;                                                          
         READ FILE (BH942I) INTO (BH942_AR);                            
         IF BH94299.SORT_CPR = 99999999999     /* OPTÆLLINGSINDIVID */  
         THEN                                                           
            DO;                                                         
               EOF_BH942 = '1'B;                                        
               CALL SKRIV;                                              
            END;                                                        
         IF ^EOF_BH942                                                  
         THEN                                                           
            DO;                                                         
               BH942_ID.EKOMNR   = BH942.ESR.EKOMNR;                    
               BH942_ID.EEJDNR   = BH942.ESR.EEJDNR;                    
               BH942_ID.C_SÆLGER = BH942.TIL_EVS.C_SÆLGER;              
               TV.LÆS_BH942 = TV.LÆS_BH942 + 1;                         
                                                                        
               IF BH942.BBRF380 = '0001'                      /*#GEH */ 
               THEN                                                     
                  BH942.BBRF380 = '0000';                               
                                                                        
            END;                                                        
 END LÆS_BH942;                                                         
 /********************************************************************* 
 *       HER AFGØRES OM DEN AKTUELLE EJER SKAL HAVE OVERFØRT KODE     * 
 *       FOR HELÅRSBEREGNING FRA EN ANDEN EJER.                       * 
 *       DER OVERFØRES KUN TIL PERSONER MED STATUS SOM '65/67-ÅRIG'.  * 
 *********************************************************************/ 
 BEHANDL:PROC;                                                          
                                                                        
         IF BH942.AKT_EJER.BOPÆLSKODE > '0' &                           
            BH942.CHELÅR < GEMEJD.CHELÅR                                
         THEN                                                           
            DO;                                                         
                                                                        
               BH942.CHELÅR = GEMEJD.CHELÅR;                            
                                                                        
               /* FØRST UNDERSØGES SIDSTE ÅR OG DER OVERFØRES   */      
               /* KUN HVIS PERSONEN ER '65/67 ÅRIG' M.V.   */           
                                                                        
               IF (BH942.TIL_EVS.CPTYPSLUT ^= '3' &        /*#02*/      
                   BH942.TIL_EVS.CPTYPSLUT ^= '4') !                    
                   BH942.CHELÅR_ORD ^= '1'                              
               THEN; /*gør ikke noget*/                                 
               ELSE                                                     
                  DO;                                                   
                     SELECT (BH942.CHELÅR);                             
                       WHEN ('1','2','3','7','8','9')                   
                         DO;                                            
                            BH942.CHELÅR_ORD = '4';                     
                         END;                                           
                       OTHERWISE;                                       
                     END;                                               
                  END;                                                  
                                                                        
               /* OG SÅ UNDERSØGES AKT ÅR OG DER OVERFØRES   */         
               /* KUN HVIS PERSONEN ER '65/67 ÅRIG' M.V.   */           
                                                                        
               IF (BH942.TIL_EVS.CPTYPFOR ^= '3' &        /*#02*/       
                   BH942.TIL_EVS.CPTYPFOR ^= '4') !                     
                   BH942.CHELÅR_FOR ^= '1'                              
               THEN; /*gør ikke noget*/                                 
               ELSE                                                     
                  DO;                                                   
                     SELECT (BH942.CHELÅR);                             
                       WHEN ('4','5','6','7','8','9')                   
                         DO;                                            
                            BH942.CHELÅR_FOR = '4';                     
                         END;                                           
                       OTHERWISE;                                       
                     END;                                               
                  END;                                                  
            END;                                                        
 END BEHANDL;                                                           
 /********************************************************************* 
 *       SKRIV ALLE INDIVIDER EFTER EVT. BEHANDLIG.                   * 
 *********************************************************************/ 
 SKRIV:                                                                 
         PROC;                                                          
                                                                        
         IF BH94299.SORT_CPR ^= 99999999999     /* OPTÆLLINGSINDIVID */ 
         THEN                                                           
            DO;                                                         
               IF (BH942.CHELÅR >= '1' & BH942.CHELÅR <= '3') !         
                  (BH942.CHELÅR >= '7' & BH942.CHELÅR <= '9')           
               THEN                                                     
                  DO;                                                   
 /*SLUTÅR*/          TV.F_SIDSTE_HELÅR = TV.F_SIDSTE_HELÅR + 1;         
                     IF BH942.EJERSKAB.CEJDTYPE_AKT = '3'               
                     THEN                                               
                        DO;                                             
                           BH942.EJERSKAB.CEJDTYPE_AKT = '1';           
                           TV.FSEJDTYP3Æ = TV.FSEJDTYP3Æ + 1;           
                        END;                                            
                     ELSE                                               
                        DO;                                             
                           BH942.EJERSKAB.CEJDTYPE_AKT = '7';           
                           TV.FSEJDTYP8Æ = TV.FSEJDTYP8Æ + 1;           
                        END;                                            
                  END;                                                  
               IF (BH942.CHELÅR >= '4' & BH942.CHELÅR <= '9')           
               THEN                                                     
                  DO;                                                   
 /*FORSKUDÅR*/      TV.F_AKT_HELÅR = TV.F_AKT_HELÅR + 1;                
                     IF BH942.EJERSKAB.CEJDTYPE = '3'                   
                     THEN                                               
                        DO;                                             
                           BH942.EJERSKAB.CEJDTYPE = '1';               
                           TV.FFEJDTYP3Æ = TV.FFEJDTYP3Æ + 1;           
                        END;                                            
                     ELSE                                               
                        DO;                                             
                           BH942.EJERSKAB.CEJDTYPE = '7';               
                           TV.FFEJDTYP8Æ = TV.FFEJDTYP8Æ + 1;           
                        END;                                            
                  END;                                                  
               CALL KONTROL_OPTÆL;                                      
            END;                                                        
                                                                        
         WRITE FILE (BH944O) FROM (BH942_AR);                           
                                                                        
 END SKRIV;                                                             
                                                                        
 /********************************************************************* 
 *       OPTÆL INDIVIDER TIL STATISTIK                                * 
 *********************************************************************/ 
 KONTROL_OPTÆL:                                                         
         PROC;                                                          
                                                                        
         IF (BH942.AKT_EJER.DAFSTÅ > 0 &                                
             BH942.AKT_EJER.DAFSTÅ <                                    
             BH942.AKT_EJER.DRGNÅRFRA)                                  
         THEN                                                           
            RETURN;                     /* SALG FØR INDKOMSTÅRET */     
                                        /* SPRINGES OVER         */     
                                                                        
         INDX = BH942.ESR.EKOMNR;                                       
         STAT_SIDSTE_ÅR(INDX).CLIN = 1;                                 
         STAT_AKT_ÅR(INDX).CLIN = 1;                                    
                                                                        
         IF BH942.AKT_EJER.BOPÆLSKODE > '0'                             
         THEN;                                                          
         ELSE                                                           
            DO;                                                         
               TV.FSOM_UBOP = TV.FSOM_UBOP + 1;                         
               /* OPTÆL INDIVIDER UDEN BOPÆLSKODE  */                   
               /* MEN MED DISP. IFLG. BBR F379     */                   
               IF (BH942.BBRF379 >= 'A' & BH942.BBRF379 <= 'D') &       
                  (BH942.BBRF380 <= '0000' !                            
                   BH942.BBRF380 >= BH65300M.INDKÅR1)                   
               THEN                                                     
                  CALL OPTÆL_EJ_BOPÆL;                                  
               RETURN;                                                  
            END;                                                        
                                                                        
         TV.FSOM_MBOP = TV.FSOM_MBOP + 1;                               
                                                                        
         /*#01 TAG HENSYN TIL AFSTÅELSES DATO FOR CHELÅR*/              
         IF BH942.TIL_EVS.DATO_CHELÅR > 0                               
         THEN                                                           
           DO;                                                          
             /* DATO TIL BESTMMELSE AF CHELÅR FOR EVS SLUT*/            
             IF BH942.TIL_EVS.DATO_CHELÅR >= HJ_DATO1                   
             THEN                                                       
               CHELÅR_SLUT_DATO = HJ_DATO1;                             
             ELSE                                                       
               CHELÅR_SLUT_DATO = BH942.TIL_EVS.DATO_CHELÅR;            
                                                                        
             /* DATO TIL BESTMMELSE AF CHELÅR FOR EVS FORSKUD*/         
             IF BH942.TIL_EVS.DATO_CHELÅR >= HJ_DATO2                   
             THEN                                                       
               CHELÅR_FORSK_DATO = HJ_DATO2;                            
             ELSE                                                       
               CHELÅR_FORSK_DATO = BH942.TIL_EVS.DATO_CHELÅR;           
           END;                                                         
         ELSE /* HVIS TIL_EVS.DATO_CHELÅR IKKE ER BLEVET SAT */         
           DO;                                                          
             CHELÅR_SLUT_DATO  = HJ_DATO1;                              
             CHELÅR_FORSK_DATO = HJ_DATO2;                              
           END;                                                         
                                                                        
                                                                        
        /*For slut 2017 skal nogle behandles efter 8 års reglen */      
        /* ellers er det altid 1 år som et sommerhus skal være ejet*/   
        /* for at blive behandlet som helårs bolig*/                    
        IF BH942.TIL_EVS.CHELÅR_REGL = '8'                              
        THEN                                                            
          DO;                                                           
            ANTAL_ÅR = 8;                                               
          END;                                                          
        ELSE                                                            
          DO;                                                           
            ANTAL_ÅR = 1;                                               
          END;                                                          
                                                                        
                                                                        
         /* FØRST OPTÆLLES VEDR. SIDSTE ÅR */                           
                                                                        
         IF BH942.CHELÅR_ORD = '1'                                      
         THEN                                                           
            CALL OPTÆL_SIDSTE_ÅR_67;                                    
                                                                        
         IF BH942.CHELÅR_ORD = '4'                                      
         THEN                                                           
            CALL OPTÆL_SIDSTE_ÅR_OVF;                                   
                                                                        
         /* SÅ OPTÆLLES VEDR. AKTUELT ÅR   */                           
         /* MEN IKKE SÆLGERE       */                                   
                                                                        
         IF BH942.C_SÆLGER = '1'                                        
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BH942.CHELÅR_FOR = '1'                                      
         THEN                                                           
            CALL OPTÆL_AKT_ÅR_67;                                       
                                                                        
         IF BH942.CHELÅR_FOR = '4'                                      
         THEN                                                           
            CALL OPTÆL_AKT_ÅR_OVF;                                      
                                                                        
 END KONTROL_OPTÆL;                                                     
                                                                        
 OPTÆL_SIDSTE_ÅR_67: PROC;                                              
                                                                        
         /* OPTÆL HVIS EJER'S PERSONTYPE ER */                          
         /* OPSAT SOM 65/67-ÅRIG M.V.       */                          
         /* D.V.S. IKKE HELÅRSBEREGNING     */                          
                                                                        
         STAT_SIDSTE_ÅR(INDX).PLIN(1).IALT =                            
         STAT_SIDSTE_ÅR(INDX).PLIN(1).IALT + 1;                         
         STAT_SIDSTE_ÅR(100).PLIN(1).IALT =                             
         STAT_SIDSTE_ÅR(100).PLIN(1).IALT + 1;                          
                                                                        
         IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,               
                                 CHELÅR_SLUT_DATO,ANTAL_ÅR) &           
            BH942.C_SÆLGER < '1'                                        
         THEN                                                           
           DO;                                                          
              STAT_SIDSTE_ÅR(INDX).PLIN(2).IALT =                       
              STAT_SIDSTE_ÅR(INDX).PLIN(2).IALT + 1;                    
              STAT_SIDSTE_ÅR(100).PLIN(2).IALT =                        
              STAT_SIDSTE_ÅR(100).PLIN(2).IALT + 1;                     
           END;                                                         
                                                                        
         IF BH942.C_SÆLGER = '1' &                                      
           (TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,               
                                     CHELÅR_SLUT_DATO,ANTAL_ÅR) !       
           ((BH942.BBRF379 >= 'A' &                                     
             BH942.BBRF379 <= 'D') &                                    
            (BH942.BBRF380 <= '0000' !                                  
             BH942.BBRF380 >= BH65300M.INDKÅR1)))                       
         THEN                                                           
           DO;                                                          
              STAT_SIDSTE_ÅR(INDX).PLIN(4).IALT =                       
              STAT_SIDSTE_ÅR(INDX).PLIN(4).IALT + 1;                    
              STAT_SIDSTE_ÅR(100).PLIN(4).IALT =                        
              STAT_SIDSTE_ÅR(100).PLIN(4).IALT + 1;                     
           END;                                                         
                                                                        
         IF (BH942.BBRF379 >= 'A' &                                     
             BH942.BBRF379 <= 'D') &                                    
            (BH942.BBRF380 <= '0000' !                                  
             BH942.BBRF380 >= BH65300M.INDKÅR1)                         
         THEN                                                           
            DO;                                                         
               SELECT (BH942.BBRF379);                                  
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).A379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).A379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).A379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).A379 + 1;             
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).A379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).A379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).A379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).A379 + 1;        
                        END;                                            
                      ELSE                                              
                        IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,
                                 CHELÅR_SLUT_DATO,ANTAL_ÅR)             
                         THEN                                           
                           DO;                                          
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).A379 =       
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).A379 + 1;    
                              STAT_SIDSTE_ÅR(100).PLIN(2).A379 =        
                              STAT_SIDSTE_ÅR(100).PLIN(2).A379 + 1;     
                           END;                                         
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).B379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).B379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).B379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).B379 + 1;             
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).B379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).B379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).B379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).B379 + 1;        
                        END;                                            
                      ELSE                                              
                        IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,
                                 CHELÅR_SLUT_DATO,ANTAL_ÅR)             
                         THEN                                           
                           DO;                                          
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).B379 =       
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).B379 + 1;    
                              STAT_SIDSTE_ÅR(100).PLIN(2).B379 =        
                              STAT_SIDSTE_ÅR(100).PLIN(2).B379 + 1;     
                           END;                                         
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).C379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).C379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).C379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).C379 + 1;             
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).C379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).C379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).C379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).C379 + 1;        
                        END;                                            
                      ELSE                                              
                        IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,
                                CHELÅR_SLUT_DATO,ANTAL_ÅR)              
                        THEN                                            
                          DO;                                           
                            STAT_SIDSTE_ÅR(INDX).PLIN(2).C379 =         
                            STAT_SIDSTE_ÅR(INDX).PLIN(2).C379 + 1;      
                            STAT_SIDSTE_ÅR(100).PLIN(2).C379 =          
                            STAT_SIDSTE_ÅR(100).PLIN(2).C379 + 1;       
                          END;                                          
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).D379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).D379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).D379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).D379 + 1;             
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).D379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).D379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).D379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).D379 + 1;        
                        END;                                            
                      ELSE                                              
                         IF TEST_EJET_ANTAL_ÅR_OK(                      
                                             BH942.TIL_EVS.DATO0107,    
                                             CHELÅR_SLUT_DATO,ANTAL_ÅR) 
                         THEN                                           
                           DO;                                          
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).D379 =       
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).D379 + 1;    
                              STAT_SIDSTE_ÅR(100).PLIN(2).D379 =        
                              STAT_SIDSTE_ÅR(100).PLIN(2).D379 + 1;     
                           END;                                         
                   END;                                                 
                 OTHERWISE;                                             
               END;  /* SELECT (BH942.BBRF379) */                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_SIDSTE_ÅR(INDX).PLIN(1).U379 =                      
               STAT_SIDSTE_ÅR(INDX).PLIN(1).U379 + 1;                   
               STAT_SIDSTE_ÅR(100).PLIN(1).U379 =                       
               STAT_SIDSTE_ÅR(100).PLIN(1).U379 + 1;                    
               IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,         
                                             CHELÅR_SLUT_DATO,ANTAL_ÅR) 
               THEN                                                     
                 DO;                                                    
                    IF BH942.C_SÆLGER = '1'                             
                    THEN                                                
                      DO;                                               
                         STAT_SIDSTE_ÅR(INDX).PLIN(4).U379 =            
                         STAT_SIDSTE_ÅR(INDX).PLIN(4).U379 + 1;         
                         STAT_SIDSTE_ÅR(100).PLIN(4).U379 =             
                         STAT_SIDSTE_ÅR(100).PLIN(4).U379 + 1;          
                      END;                                              
                    ELSE                                                
                      DO;                                               
                         STAT_SIDSTE_ÅR(INDX).PLIN(2).U379 =            
                         STAT_SIDSTE_ÅR(INDX).PLIN(2).U379 + 1;         
                         STAT_SIDSTE_ÅR(100).PLIN(2).U379 =             
                         STAT_SIDSTE_ÅR(100).PLIN(2).U379 + 1;          
                      END;                                              
                 END;                                                   
            END;                                                        
                                                                        
 END OPTÆL_SIDSTE_ÅR_67;                                                
                                                                        
 OPTÆL_SIDSTE_ÅR_OVF:                                                   
         PROC;                                                          
                                                                        
         STAT_SIDSTE_ÅR(INDX).PLIN(13).IALT =                           
         STAT_SIDSTE_ÅR(INDX).PLIN(13).IALT + 1;                        
         STAT_SIDSTE_ÅR(100).PLIN(13).IALT =                            
         STAT_SIDSTE_ÅR(100).PLIN(13).IALT + 1;                         
         IF BH942.C_SÆLGER = '1'                                        
         THEN                                                           
           DO;                                                          
              STAT_SIDSTE_ÅR(INDX).PLIN(14).IALT =                      
              STAT_SIDSTE_ÅR(INDX).PLIN(14).IALT + 1;                   
              STAT_SIDSTE_ÅR(100).PLIN(14).IALT =                       
              STAT_SIDSTE_ÅR(100).PLIN(14).IALT + 1;                    
           END;                                                         
                                                                        
         IF BH942.BBRF380  = '    ' !                                   
            BH942.BBRF380  = '0000' !                                   
            BH942.BBRF380 >= BH65300M.INDKÅR1                           
         THEN                                                           
            DO;                                                         
               SELECT (BH942.BBRF379);                                  
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).A379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).A379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).A379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).A379 + 1;            
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).A379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).A379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).A379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).A379 + 1;       
                        END;                                            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).B379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).B379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).B379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).B379 + 1;            
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).B379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).B379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).B379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).B379 + 1;       
                        END;                                            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).C379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).C379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).C379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).C379 + 1;            
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).C379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).C379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).C379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).C379 + 1;       
                        END;                                            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).D379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).D379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).D379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).D379 + 1;            
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).D379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).D379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).D379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).D379 + 1;       
                        END;                                            
                   END;                                                 
                 OTHERWISE                                              
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).U379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).U379 + 1;            
                      IF BH942.C_SÆLGER = '1'                           
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).U379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).U379 + 1;       
                        END;                                            
                   END;                                                 
               END;                                                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 =                     
               STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 + 1;                  
               STAT_SIDSTE_ÅR(100).PLIN(13).U379 =                      
               STAT_SIDSTE_ÅR(100).PLIN(13).U379 + 1;                   
               IF BH942.C_SÆLGER = '1'                                  
               THEN                                                     
                 DO;                                                    
                    STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 =                
                    STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 + 1;             
                    STAT_SIDSTE_ÅR(100).PLIN(14).U379 =                 
                    STAT_SIDSTE_ÅR(100).PLIN(14).U379 + 1;              
                 END;                                                   
            END;                                                        
                                                                        
 END OPTÆL_SIDSTE_ÅR_OVF;                                               
                                                                        
 OPTÆL_AKT_ÅR_67: PROC;                                                 
                                                                        
         /*HUSK at sætte dato til Forskud */                            
         /* TEST_EJET_1ÅR_OK(BH942.TIL_EVS.DATO0107,HJ_DATO2) */        
                                                                        
         STAT_AKT_ÅR(INDX).PLIN(1).IALT =                               
         STAT_AKT_ÅR(INDX).PLIN(1).IALT + 1;                            
         STAT_AKT_ÅR(100).PLIN(1).IALT =                                
         STAT_AKT_ÅR(100).PLIN(1).IALT + 1;                             
                                                                        
         IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,               
                                  CHELÅR_FORSK_DATO,ANTAL_ÅR)           
         THEN                                                           
           DO;                                                          
              STAT_AKT_ÅR(INDX).PLIN(2).IALT =                          
              STAT_AKT_ÅR(INDX).PLIN(2).IALT + 1;                       
              STAT_AKT_ÅR(100).PLIN(2).IALT =                           
              STAT_AKT_ÅR(100).PLIN(2).IALT + 1;                        
           END;                                                         
                                                                        
         IF (BH942.BBRF379 >= 'A' &                                     
             BH942.BBRF379 <= 'D') &                                    
            (BH942.BBRF380 <= '0000' !                                  
             BH942.BBRF380 >= BH65300M.INDKÅR2)                         
         THEN                                                           
            DO;                                                         
               SELECT (BH942.BBRF379);                                  
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).A379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).A379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).A379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).A379 + 1;                
                                                                        
                      IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,  
                                  CHELÅR_FORSK_DATO,ANTAL_ÅR)           
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).A379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).A379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).A379 =              
                           STAT_AKT_ÅR(100).PLIN(2).A379 + 1;           
                        END;                                            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).B379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).B379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).B379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).B379 + 1;                
                      IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,  
                                  CHELÅR_FORSK_DATO,ANTAL_ÅR)           
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).B379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).B379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).B379 =              
                           STAT_AKT_ÅR(100).PLIN(2).B379 + 1;           
                        END;                                            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).C379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).C379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).C379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).C379 + 1;                
                      IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,  
                                  CHELÅR_FORSK_DATO,ANTAL_ÅR)           
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).C379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).C379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).C379 =              
                           STAT_AKT_ÅR(100).PLIN(2).C379 + 1;           
                        END;                                            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).D379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).D379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).D379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).D379 + 1;                
                      IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,  
                                           CHELÅR_FORSK_DATO,ANTAL_ÅR)  
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).D379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).D379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).D379 =              
                           STAT_AKT_ÅR(100).PLIN(2).D379 + 1;           
                        END;                                            
                   END;                                                 
                 OTHERWISE;                                             
               END;  /* SELECT (BH942.BBRF379) */                       
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_AKT_ÅR(INDX).PLIN(1).U379 =                         
               STAT_AKT_ÅR(INDX).PLIN(1).U379 + 1;                      
               STAT_AKT_ÅR(100).PLIN(1).U379 =                          
               STAT_AKT_ÅR(100).PLIN(1).U379 + 1;                       
               IF TEST_EJET_ANTAL_ÅR_OK(BH942.TIL_EVS.DATO0107,         
                                           CHELÅR_FORSK_DATO,ANTAL_ÅR)  
               THEN                                                     
                 DO;                                                    
                    STAT_AKT_ÅR(INDX).PLIN(2).U379 =                    
                    STAT_AKT_ÅR(INDX).PLIN(2).U379 + 1;                 
                    STAT_AKT_ÅR(100).PLIN(2).U379 =                     
                    STAT_AKT_ÅR(100).PLIN(2).U379 + 1;                  
                 END;                                                   
            END;                                                        
                                                                        
 END OPTÆL_AKT_ÅR_67;                                                   
                                                                        
 OPTÆL_AKT_ÅR_OVF:                                                      
         PROC;                                                          
                                                                        
         STAT_AKT_ÅR(INDX).PLIN(13).IALT =                              
         STAT_AKT_ÅR(INDX).PLIN(13).IALT + 1;                           
         STAT_AKT_ÅR(100).PLIN(13).IALT =                               
         STAT_AKT_ÅR(100).PLIN(13).IALT + 1;                            
                                                                        
         IF BH942.BBRF380  = '    ' !                                   
            BH942.BBRF380  = '0000' !                                   
            BH942.BBRF380 >= BH65300M.INDKÅR2                           
         THEN                                                           
            DO;                                                         
               SELECT (BH942.BBRF379);                                  
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).A379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).A379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).A379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).A379 + 1;               
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).B379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).B379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).B379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).B379 + 1;               
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).C379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).C379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).C379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).C379 + 1;               
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).D379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).D379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).D379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).D379 + 1;               
                   END;                                                 
                 OTHERWISE                                              
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).U379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).U379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).U379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).U379 + 1;               
                   END;                                                 
               END;                                                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_AKT_ÅR(INDX).PLIN(13).U379 =                        
               STAT_AKT_ÅR(INDX).PLIN(13).U379 + 1;                     
               STAT_AKT_ÅR(100).PLIN(13).U379 =                         
               STAT_AKT_ÅR(100).PLIN(13).U379 + 1;                      
            END;                                                        
                                                                        
 END OPTÆL_AKT_ÅR_OVF;                                                  
                                                                        
 OPTÆL_EJ_BOPÆL:                                                        
         PROC;                                                          
                                                                        
         IF BH942.AKT_EJER.FEJER < 2                                    
         THEN                                                           
            DO;                                                         
               SELECT (BH942.BBRF379);                                  
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).A379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).A379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).A379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).A379 + 1;            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).B379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).B379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).B379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).B379 + 1;            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).C379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).C379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).C379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).C379 + 1;            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).D379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).D379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).D379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).D379 + 1;            
                   END;                                                 
                 OTHERWISE;                                             
               END;                                                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
               /* FLERE END 1 EJER */                                   
               SELECT (BH942.BBRF379);                                  
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).A379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).A379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).A379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).A379 + 1;            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).B379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).B379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).B379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).B379 + 1;            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).C379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).C379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).C379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).C379 + 1;            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).D379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).D379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).D379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).D379 + 1;            
                   END;                                                 
                 OTHERWISE;                                             
               END;                                                     
            END;                                                        
                                                                        
 END OPTÆL_EJ_BOPÆL;                                                    
                                                                        
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
         PROC;                                                          
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVLIN1,'01');                                     
         CALL ZZ20300(OVLIN2,'01');                                     
         DETLIN0.CCA = ZZWS2;                                           
         DETLIN0.TEKST1 = 'DENNE BEREGNING ER UDFØRT FOR INDKOMSTÅR=';  
         DETLIN0.CPUÅR = SLUTÅR;                                        
         DETLIN0.TEKST2 = ' MED START=';                                
         DETLIN0.START = ÅR0101;                                        
         DETLIN0.TEKST3 = ' OG SLUT=';                                  
         DETLIN0.SLUT  = ÅR1231;                                        
         DETLIN0.TEKST4 = ' ';                                          
         CALL ZZ20300 (DETLIN0,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.LÆS_BH942;                                  
         DETLIN1.TEKST = 'ANTAL LÆSTE PÅ UDTRÆK FRA ESR B.H94201D';     
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FSOM_UBOP;                                  
         DETLIN1.TEKST = 'ANTAL SOMMERHUSE UDEN HELÅRSBEBOELSE';        
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FSOM_MBOP;                                  
         DETLIN1.TEKST = 'ANTAL SOMMERHUSE MED HELÅRSBEBOELSE';         
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.F_SIDSTE_HELÅR;                             
         DETLIN1.TEKST = '      HERAF MED HELÅRSBEREGNING I SLUTÅR';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FSEJDTYP3Æ;                                 
         DETLIN1.TEKST = '            HERAF EJDTYPE 3 ÆNDRET TIL 1';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FSEJDTYP8Æ;                                 
         DETLIN1.TEKST = '            HERAF EJDTYPE 8 ÆNDRET TIL 7';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.F_AKT_HELÅR;                                
         DETLIN1.TEKST = '      HERAF MED HELÅRSBEREGNING I FORSKUDSÅR';
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FFEJDTYP3Æ;                                 
         DETLIN1.TEKST = '            HERAF EJDTYPE 3 ÆNDRET TIL 1';    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FFEJDTYP8Æ;                                 
         DETLIN1.TEKST = '            HERAF EJDTYPE 8 ÆNDRET TIL 7';    
         CALL ZZ20300 (DETLIN1,'01');                                   
  END TOTALLISTE;                                                       
 /********************************************************************* 
 *       SKRIV STATISTIK VEDR. SIDSTE ÅR                              * 
 *********************************************************************/ 
 STATISTIK_SIDSTE_ÅR:                                                   
         PROC;                                                          
         CALL ZZ20300(SIDELIN,'01');                                    
         IF INDX = 100                                                  
         THEN                                                           
            DO;                                                         
               OVLIN3.TEKST = 'LANDSTOTAL';                             
               OVLIN3.KOMNR = 0;                                        
            END;                                                        
         ELSE                                                           
            DO;                                                         
               OVLIN3.TEKST = 'KOMMUNENR.';                             
               OVLIN3.KOMNR = INDX;                                     
            END;                                                        
         OVLIN3.TEKST1 = 'STATISTIK OVER ANTAL PERSONER MED MULIGHED FOR
  DISPENSATION TIL HELÅRSBEBOELSE';                                     
         OVLIN3.DATO = DATO2, BY NAME;                                  
         CALL ZZ20300(OVLIN3,'01');                                     
         OVLIN4.CCA = ZZWS3;                                            
         OVLIN4.TEKST1 = '                    (2 PCT BEREGNING) I SOMMER
 HUSE (BK 08, 28 ELLER 48) I INDKOMSTÅR ' !! BH65300M.INDKÅR1 !! '.';   
         CALL ZZ20300(OVLIN4,'01');                                     
         OVLIN4.CCA = ZZWS1;                                            
  /*#01*/OVLIN4.TEKST1 = 'PERSONER MED BOPÆLSKODE       HERAF ' !!      
        'BBR F379=A  HERAF BBR F379=B ' !!                              
        ' HERAF BBR F379=C HERAF BBR F379=D HERAF BBR F379 ' !!         
        'ALT ANTAL';                                                    
         CALL ZZ20300(OVLIN4,'01');                                     
         OVLIN4.CCA = ZZWS2;                                            
  /*#01*/OVLIN4.TEKST1 = 'ALDER = STATUS I ' !! BH65300M.INDKÅR1 !!     
                         '         OG F380 >= ' !! BH65300M.INDKÅR1 !!  
                         '   OG F380 >= ' !! BH65300M.INDKÅR1 !!        
                         '   OG F380 >= ' !! BH65300M.INDKÅR1 !!        
                         '   OG F380 >= ' !! BH65300M.INDKÅR1 !!        
                         '    = BLANK';                                 
         CALL ZZ20300(OVLIN4,'01');                                     
                                                                        
         DETLIN4.CCA = ZZWS1;                                           
         DETLIN4.TEKST = '65/67-ÅRIGE M.V.              ';              
         DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(1).A379;            
         DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(1).B379;            
         DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(1).C379;            
         DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(1).D379;            
         DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(1).U379;            
         DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(1).IALT;            
         CALL ZZ20300(DETLIN4,'01');                                    
         DETLIN4.CCA = ZZWS1;                                           
         DETLIN4.TEKST = 'HERAF 8 ÅRS EJERE EXCL SÆLGER ';              
         DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(2).A379;            
         DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(2).B379;            
         DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(2).C379;            
         DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(2).D379;            
         DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(2).U379;            
         DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(2).IALT;            
         CALL ZZ20300(DETLIN4,'01');                                    
         DETLIN4.CCA = ZZWS3;                                           
         DETLIN4.TEKST = 'HERAF SÆLGERE MED DISP.       ';              
         DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(4).A379;            
         DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(4).B379;            
         DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(4).C379;            
         DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(4).D379;            
         DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(4).U379;            
         DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(4).IALT;            
         CALL ZZ20300(DETLIN4,'01');                                    
                                                                        
         DETLIN4.CCA = ZZWS1;                                           
         DETLIN4.TEKST = 'OVERFØRT FRA OVENSTÅENDE      ';              
         DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(13).A379;           
         DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(13).B379;           
         DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(13).C379;           
         DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(13).D379;           
         DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(13).U379;           
         DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(13).IALT;           
         CALL ZZ20300(DETLIN4,'01');                                    
         DETLIN4.CCA = ZZWS3;                                           
         DETLIN4.TEKST = 'HERAF SÆLGERE MED DISP.       ';              
         DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(14).A379;           
         DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(14).B379;           
         DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(14).C379;           
         DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(14).D379;           
         DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(14).U379;           
         DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(14).IALT;           
         CALL ZZ20300(DETLIN4,'01');                                    
                                                                        
         OVLIN4.CCA = ZZWS2;                                            
         OVLIN4.TEKST1 = 'ANTAL PERSONER UDEN BOPÆLSKODE  M E N  MED BBR
  F379 FORSKELLIG FRA BLANK:';                                          
         CALL ZZ20300(OVLIN4,'01');                                     
                                                                        
         DETLIN4.CCA = ZZWS1;                                           
         DETLIN4.TEKST = 'EEN-EJERE                     ';              
         DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(19).A379;           
         DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(19).B379;           
         DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(19).C379;           
         DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(19).D379;           
         DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(19).U379;           
         DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(19).IALT;           
         CALL ZZ20300(DETLIN4,'01');                                    
         DETLIN4.CCA = ZZWK1;                                           
         DETLIN4.TEKST = 'FLER-EJERE                    ';              
         DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(20).A379;           
         DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(20).B379;           
         DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(20).C379;           
         DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(20).D379;           
         DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(20).U379;           
         DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(20).IALT;           
         CALL ZZ20300(DETLIN4,'01');                                    
                                                                        
  END STATISTIK_SIDSTE_ÅR;                                              
 /********************************************************************* 
 *       SKRIV STATISTIK VEDR. AKTUELT ÅR                               
 *********************************************************************/ 
 STATISTIK_AKT_ÅR:                                                      
         PROC;                                                          
         CALL ZZ20300(SIDELIN,'01');                                    
         IF INDX = 100                                                  
         THEN                                                           
            DO;                                                         
               OVLIN3.TEKST = 'LANDSTOTAL';                             
               OVLIN3.KOMNR = 0;                                        
            END;                                                        
         ELSE                                                           
            DO;                                                         
               OVLIN3.TEKST = 'KOMMUNENR.';                             
               OVLIN3.KOMNR = INDX;                                     
            END;                                                        
         OVLIN3.TEKST1 = 'STATISTIK OVER ANTAL PERSONER MED MULIGHED '  
                   !!    'FOR DISPENSATION TIL HELÅRSBEBOELSE';         
         OVLIN3.DATO = DATO2, BY NAME;                                  
         CALL ZZ20300(OVLIN3,'01');                                     
         OVLIN4.CCA = ZZWS3;                                            
  /*#01*/OVLIN4.TEKST1 = '        (2 PCT BEREGNING) I SOMMERHUSE ' !!   
         '(BK 08, 28 ELLER 48) I INDKOMSTÅR ' !! BH65300M.INDKÅR1 !!    
         '.';                                                           
         CALL ZZ20300(OVLIN4,'01');                                     
         OVLIN4.CCA = ZZWS1;                                            
         OVLIN4.TEKST1 = 'PERSONER MED BOPÆLSKODE    ' !!               
         '  HERAF BBR F379=A ' !!                                       
         ' HERAF BBR  F379=B  HERAF BBR F379=C ' !!                     
         ' HERAF BBR F379=D   HERAF BBR F379 '   !!                     
         'ALT ANTAL';                                                   
         CALL ZZ20300(OVLIN4,'01');                                     
         OVLIN4.CCA = ZZWS2;                                            
  /*#01*/OVLIN4.TEKST1 = 'ALDER = STATUS I ' !! BH65300M.INDKÅR2 !!     
                         '        OG F380 >= ' !! BH65300M.INDKÅR2 !!   
                         '   OG F380 >= ' !! BH65300M.INDKÅR2 !!        
                         '    OG F380 >= ' !! BH65300M.INDKÅR2 !!       
                         '    OG F380 >= ' !! BH65300M.INDKÅR2 !!       
                         '      = BLANK';                               
         CALL ZZ20300(OVLIN4,'01');                                     
                                                                        
         DETLIN4.CCA = ZZWS1;                                           
         DETLIN4.TEKST = '65/67-ÅRIGE M.V.              ';              
         DETLIN4.ANTAL1 = STAT_AKT_ÅR(INDX).PLIN(1).A379;               
         DETLIN4.ANTAL2 = STAT_AKT_ÅR(INDX).PLIN(1).B379;               
         DETLIN4.ANTAL3 = STAT_AKT_ÅR(INDX).PLIN(1).C379;               
         DETLIN4.ANTAL4 = STAT_AKT_ÅR(INDX).PLIN(1).D379;               
         DETLIN4.ANTAL5 = STAT_AKT_ÅR(INDX).PLIN(1).U379;               
         DETLIN4.ANTAL6 = STAT_AKT_ÅR(INDX).PLIN(1).IALT;               
         CALL ZZ20300(DETLIN4,'01');                                    
         DETLIN4.CCA = ZZWS3;                                           
         DETLIN4.TEKST = 'HERAF 8 ÅRS EJERE             ';              
         DETLIN4.ANTAL1 = STAT_AKT_ÅR(INDX).PLIN(2).A379;               
         DETLIN4.ANTAL2 = STAT_AKT_ÅR(INDX).PLIN(2).B379;               
         DETLIN4.ANTAL3 = STAT_AKT_ÅR(INDX).PLIN(2).C379;               
         DETLIN4.ANTAL4 = STAT_AKT_ÅR(INDX).PLIN(2).D379;               
         DETLIN4.ANTAL5 = STAT_AKT_ÅR(INDX).PLIN(2).U379;               
         DETLIN4.ANTAL6 = STAT_AKT_ÅR(INDX).PLIN(2).IALT;               
         CALL ZZ20300(DETLIN4,'01');                                    
                                                                        
         DETLIN4.CCA = ZZWK1;                                           
         DETLIN4.TEKST = 'OVERFØRT FRA OVENSTÅENDE      ';              
         DETLIN4.ANTAL1 = STAT_AKT_ÅR(INDX).PLIN(13).A379;              
         DETLIN4.ANTAL2 = STAT_AKT_ÅR(INDX).PLIN(13).B379;              
         DETLIN4.ANTAL3 = STAT_AKT_ÅR(INDX).PLIN(13).C379;              
         DETLIN4.ANTAL4 = STAT_AKT_ÅR(INDX).PLIN(13).D379;              
         DETLIN4.ANTAL5 = STAT_AKT_ÅR(INDX).PLIN(13).U379;              
         DETLIN4.ANTAL6 = STAT_AKT_ÅR(INDX).PLIN(13).IALT;              
         CALL ZZ20300(DETLIN4,'01');                                    
                                                                        
  END STATISTIK_AKT_ÅR;                                                 
 /********************************************************************* 
 *       MASKINEL AFSTEMNING                                          * 
 *********************************************************************/ 
 MASK_AFSTEMNING:                                                       
         PROC;                                                          
         IF BH94299.SORT_KOMNR ^= 999                                   
         THEN                                                           
            CALL FEJLLISTE('1');                                        
         ELSE                                                           
            IF BH94299.ANT_INDV ^= TV.LÆS_BH942                         
            THEN                                                        
               CALL FEJLLISTE('2');                                     
 END MASK_AFSTEMNING;                                                   
 /*********************************************************************/
 /*      UDSKRIV FEJLLISTE VEDR. KONSTATERET AFSTEMNINGFEJL PÅ ???    */
 /*********************************************************************/
 FEJLLISTE:                                                             
         PROC(FEJL);                                                    
 DCL     FEJL            CHAR      (01);                                
         CALL ZZ20390 ('*OPEN','BH94402Y');                             
         CALL ZZ20300(SIDELIN,'02');                                    
         CALL ZZ20300(OVLIN1,'02');                                     
         OVLIN2.CCA = ZZWS3;                                            
         OVLIN2.TEKST1 = 'FEJLLISTE VEDR. MASKINEL AFSTEMNING';         
         CALL ZZ20300(OVLIN2,'02');                                     
         IF FEJL = '1'                                                  
         THEN                                                           
            DO;                                                         
               DETLIN1.CCA   = ZZWS3;                                   
               DETLIN1.TEKST  =                                         
               'AFSTEMNINGSINDIVID MANGLER PÅ B.H94201D';               
               DETLIN1.ANTAL = '';                                      
               CALL ZZ20300(DETLIN1,'02');                              
            END;                                                        
         IF FEJL = '2'                                                  
         THEN                                                           
            DO;                                                         
               DETLIN1.CCA   = ZZWS3;                                   
               DETLIN1.TEKST  = 'ANTAL LÆSTE PERSONER PÅ  B.H94201D';   
               DETLIN1.ANTAL = TV.LÆS_BH942;                            
               CALL ZZ20300(DETLIN1,'02');                              
               DETLIN1.TEKST  =                                         
               'ANTAL PERSONER IFØLGE AFSTEMNINGSINDIVID IALT  :';      
               DETLIN1.ANTAL = BH94299.ANT_INDV;                        
               CALL ZZ20300(DETLIN1,'02');                              
            END;                                                        
            SWFEJL = '1';                                               
 END FEJLLISTE;                                                         
 /********************************************************************* 
 *       AFSLUT PROGRAM                                               * 
 *********************************************************************/ 
 AFSLUT:                                                                
         PROC;                                                          
         CALL TOTALLISTE;                                               
         DO INDX = 100 TO 100;                                          
            IF STAT_SIDSTE_ÅR(INDX).CLIN = 1                            
            THEN                                                        
               CALL STATISTIK_SIDSTE_ÅR;                                
         END;                                                           
         DO INDX = 100 TO 100;                                          
            IF STAT_AKT_ÅR(INDX).CLIN = 1                               
            THEN                                                        
               CALL STATISTIK_AKT_ÅR;                                   
         END;                                                           
         CALL MASK_AFSTEMNING;                                          
         CALL ZZ20300((133)' ','99');                                   
         CLOSE FILE (BH942I),                                           
               FILE (BH944O);                                           
         IF SWFEJL = '1'                                                
         THEN                                                           
            CALL ZS30101(4,'BH94400 ** 251 ' !!                         
                 'MASKINEL KONSTATERET AFSTEMNINGSFEJL',2);             
 END AFSLUT;                                                            
 %INCLUDE BH94200M; /*CHECK HAR PERSONEN EJET EJENDOMMEN I MINDST X ÅR*/
 END  BH94400;                                                          
