 BH55500:/*** AJOURFØR ÆGTEFÆLLLER TIL FØRTIDSPENS. M.FL.     ***/      
         PROC OPTIONS (MAIN);                                           
 /*********************************************************************/
 /*                                                                   */
 /*      NAVN            AJOURFØR CFØREFT KODER PÅ ÆGTEFÆLLER         */
 /*                                                                   */
 /*      FUNKTION        AT AJOURFØRE MT TIL FORSKUD OG SLUT EVS      */
 /*                      SÅLEDES AT ÆGTEFÆLLER TIL                    */
 /*                      FØRTIDSPENSIONISTER OG EFTERLØNSMODTAGERE    */
 /*                      M.V. OGSÅ BLIVER REDUCERET SOM DISSE.        */
 /*                      DERFOR OVERFØRES ÆGTEFÆLLENS EVT. KODE       */
 /*                      (CFØREFT).                                   */
 /*                                                                   */
 /*      INDDATA         BQ76000T     MINI MT TIL FORSKUD/SLUT        */
 /*                                   HOP. ORDEN                      */
 /*                                                                   */
 /*      UDDATA          BQ76000T     AJOURFØRT MINI-MT               */
 /*                      BH55501Y     KØRSELSKONTROLLISTE             */
 /*                      BH55502Y     FEJLLISTE                       */
 /*                                                                   */
 /*      PROGRAMMØR      AAGE RASMUSSEN    PUS NOV 1994               */
 /*                      (LAVET P.G.A. BH95500)                       */
 /*                                                                   */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PUV PUSLPS  JULI 1995      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PFB SKAT    JULI 1996      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PFB SKAT    JAN  1997      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PFB SKAT    AUG  1997      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PFB SKAT    JULI 1998      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PFB SKAT    AUG  1999      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PFB SKAT    JUNI 2000      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    PFB SKAT    DEC. 2001      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    LSU T&S     AUG. 2001      */
 /*      ÅRSTILRETTET    AAGE RASMUSSEN    LSU T&S     NOV. 2001      */
 /*      ÅRSTILRETTET    OLUF MØRK         LSU T&S     JUNI 2002      */
 /*      ÅRSTILRETTET    BO SCHMIDT        LSU T&S     JULI 2003      */
 /*      ÅRSTILRETTET    BO SCHMIDT        LSU T&S     JUN  2004      */
 /* FORSKUD06    SUSANNE KROGH VILLUMSEN               26/05-2005     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD07    BO SCHMIDT                            14/05-2006     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD08    BO SCHMIDT                            23/05-2007     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD09    BO SCHMIDT                            23/06-2008     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD10    GERD HOLM-PEDERSEN                    16/04-2009     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD11    GERD HOLM-PEDERSEN                    03/06-2010     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD12    GERD HOLM-PEDERSEN                    JUNI  2011     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD13    ESBEN BRODERSEN                       MAJ   2012     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD14    ESBEN BRODERSEN                       MAJ   2013     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD15    JØRGEN SAUGMANN                       JUNI  2014     */
 /*      ÅRSTILRETTET                                                 */
 /* FORSKUD16    Z6JNK.  ÅRSRULLET                        08.06.2015  */
 /* SLUT15 QEB ESBEN BRODERSEN                         MARTS 2016     */
 /*        UDVIDET BRUG BH65300DATO MACRO #01                         */
 /* FORSKUD17   ESBEN BRODERSEN  QEB                   JUNI  2016     */
 /*      KOMPILERET TIL FORSKUD 2017                                  */
 /*                                                                   */
 /* DB2-omlægning  Lene Maj  QLE                       FEBR  2017     */
 /*      MT-fil omlægges til DB2                                      */
 /*                                                                   */
 /*********************************************************************/
         DEFAULT RANGE(*) STATIC UNALIGNED CONN;                        
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF TABELLER og FILER                                 */
 /*                                                                   */
 /*********************************************************************/
 DCL     BH555I FILE RECORD INPUT;     /* Parameter Forskud-Slut */     
                                                                        
 EXEC SQL INCLUDE SQLCA;          /* SQL KOMMUNIKATIONSAREAL        */  
 /*********************************************************************/
 /*      PARAMETER INPUT                                              */
 /*********************************************************************/
                                                                        
 DCL     1 BH555_PARM,                                                  
         %INCLUDE BH54900N;                                             
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF MT-FIL FOR PERSON1 og PERSON2                     */
 /*                                                                   */
 /*********************************************************************/
 DCL     1 PERS1,                                                       
         %INCLUDE BQ7600TN;  /* afspejler tabel BQ76000T */             
                                                                        
 DCL     1 PERS2,                                                       
         %INCLUDE BQ7600TN;  /* afspejler tabel BQ76000T */             
                                                                        
         %INCLUDE BQ70000T;  /* csrp */                                 
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF ENTRY OG BUILTIN                                  */
 /*                                                                   */
 /*********************************************************************/
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 DCL     ZS30101         ENTRY;              /* PROGRAM-KOMMUNIKATION */
 DCL     ZS61900         ENTRY;              /* UDSKRIV SSI-DATO      */
 DCL     ZS67000         ENTRY;                                         
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     PROCNAME        BUILTIN;                                       
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
         EXTERNAL INIT ('NOTEST(ALL,,;)');                              
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF TÆLLEVÆRKER                                       */
 /*                                                                   */
 /*********************************************************************/
 DCL     1 TV,                                                          
           2 ANT_PERS1       FIXED     (7),  /* ANTAL MT PERSON1 */     
           2 ANT_PERS2       FIXED     (7),  /* ANTAL match PERSON2 */  
           2 ANT_ÆGTF2_OK    FIXED     (7),  /* ANTAL DUB2 MED ÆGTF   */
           2 ANT_ÆGTF1_UD    FIXED     (7),  /* ANTAL DUB1 UDEN ÆGTF  */
           2 ANT_ÆGTF2_UD    FIXED     (7),  /* ANTAL DUB2 UDEN ÆGTF  */
                                                                        
           2 ANT_PENS_FORRIGE_ÅR FIXED (7),  /* ANTAL LÆST PENSIONIST */
                                                                        
           2 ANT_PENS_AKT_ÅR FIXED     (7),  /* ANTAL LÆST PENSIONIST */
                                                                        
           2 ANT_AJOUR_FORRIGE_ÅR FIXED (7), /* ANTAL AJOURFØRTE      */
                                                                        
           2 ANT_AJOUR_AKT_ÅR FIXED    (7),  /* ANTAL AJOURFØRTE      */
           2 ANT_SKR         FIXED     (7),  /* ANTAL SKREVNE MT      */
           2 ANT_TOT         FIXED     (7);  /* ANTAL skriv ialt      */
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF ABEND STRUKTUR m.v.                               */
 /*                                                                   */
 /*********************************************************************/
 DCL     ABENDKODE     FIXED       (2) INIT(5);                         
 DCL     1 ABENDMEDD,                                                   
          2 ABENDMODUL CHAR      (7) INIT ('BH55500'),                  
          2 ABENDFILL1 CHAR      (1) INIT (' '),                        
          2 ABENDMEDNR CHAR      (2) INIT ('**'),                       
          2 ABENDFILL2 CHAR      (1) INIT (' '),                        
          2 ABENDTXT   CHAR      (45);                                  
                                                                        
 DCL     ABENDRTKODE   FIXED     (1) INIT (2);                          
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF ØVRIGE FELTER                                     */
 /*                                                                   */
 /*********************************************************************/
                                                                        
 DCL     WS_FORSKUD_SLUT_TXT            CHAR(16) INIT (' ');            
                                                                        
 DCL     WS_TIL_EVS_AAR                 BIN FIXED (15);                 
                                                                        
 DCL     WS_GLSLUTÅR                    BIN FIXED (15);                 
                                                                        
 DCL     WS_TIL_EVS_AAR_GL              BIN FIXED (15);                 
 DCL     WS_SLUT_AFVIKLINGS_ID          CHAR(16) INIT (' ');            
                                                                        
 DCL     WS_PROGRAMNAVN                 CHAR(8)  INIT ('BH55500');      
                                                                        
 DCL     KALDT_FRA      CHAR (20)        INIT(' ');                     
                                                                        
 DCL     MT_FUNDET       BIT       (01)      INIT      ('0'B);          
 DCL     CSRP_FUNDET       BIT       (01)      INIT      ('0'B);        
                                                                        
 DCL     EOF_BH555       BIT       (01)      INIT      ('0'B);          
 DCL     TEST_PUT           BIT       (1)     INIT ('0'B);              
 DCL     JA                 BIT       (1)     INIT ('1'B);              
 DCL     NEJ                BIT       (1)     INIT ('0'B);              
                                                                        
 DCL     WS_CSRP_PNR     DEC FIXED(11,0);                               
                                                                        
 DCL     GL_NØGLE        DEC FIXED (11)      INIT      (0);             
 DCL     NY_NØGLE        DEC FIXED (11)      INIT      (0);             
 DCL     HJ_CPR          PIC       '(10)9';                             
 DCL     1 HJ_CPR1       BASED(ADDR(HJ_CPR)),                           
           2 F1          CHAR      (04),                                
           2 ÅR          PIC       '99',                                
           2 LBNR        PIC       '9',                                 
           2 F2          CHAR      (2),                                 
           2 CHKCIF      PIC       '9';                                 
 DCL     C67_ÅRIG        CHAR      (01);                                
 DCL     1 BH65300M,     /* EVS STD. MACRO */                           
           %INCLUDE BH65300M; /* OPSÆT AKTUELT INDKOMSTÅR M.V. */       
                                                                        
 DCL     UDDATO          CHAR      (10);                                
                                                                        
 DCL     DATO1           CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF PRINTLINIER TIL KONTROLLISTEN                     */
 /*                                                                   */
 /*********************************************************************/
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH55500L'),                                        
           2 F1          CHAR      (18)      INIT      (' '),           
           2 TEKST2      CHAR      (55)      INIT      (                
           'AJOURFØRING AF ÆGTEFÆLLER TIL FØRTIDSPENSIONISTER M.FL.'),  
           2 F2          CHAR      (18)      INIT      (' '),           
           2 TEKST3      CHAR      (14)      INIT      (                
           'UDSKREVET DEN '),                                           
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (43)      INIT      (' '),           
           2 TEKST1      CHAR      (89)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (53),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZZ',                       
           2 F1          CHAR      (68)      INIT      (' ');           
         % INCLUDE ZZ20301M;                                            
 /*********************************************************************/
 /* M A C R O E R der SKAL ligge før koden grundet declare af cursors */
 /*********************************************************************/
 %INCLUDE BH54999M; /* CHECK OM OMKØRSEL, OG UDFØR EVT OPRYDNING */     
 /*********************************************************************/
 /* Declare af CURSORS                                                */
 /*********************************************************************/
         EXEC SQL DECLARE MTPERS1 CURSOR WITH HOLD FOR                  
              SELECT                                                    
               TIL_EVS_AAR,                                             
               AFVIKLINGS_ID,                                           
               DCPRN,                                                   
               PROGRAMNAVN,                                             
               DB2FUNKTION,                                             
               CCIVS,                                                   
               CPENS,                                                   
               CRGN,                                                    
               DSORP,                                                   
               CPART,                                                   
               CFRÅR,                                                   
               CFRÅROPR,                                                
               DRGNÅRFRA,                                               
               DRGNÅRTIL,                                               
               BPENSIND,                                                
               BPENSGR,                                                 
               CSTATUS,                                                 
               CDØDÆGTF,                                                
               CDUBLET,                                                 
               CÆGTF_OK,                                                
               CFØRFORS,                                                
               CFØRCOR,                                                 
               CFØRPENS,                                                
               COVF_DHE,                                                
               FØROPL_DCIÆN_GL,                                         
               FØROPL_CCIVS_GL,                                         
               HIST_OPD_SIDSTE_DHENVN,                                  
               HIST_OPD_SIDSTE_CSBSK,                                   
               HIST_OPD_SIDSTE_CFØREFT,                                 
               HIST_OPD_SIDSTE_CSKPLOM,                                 
               HIST_OPD_SIDSTE_DCIÆN,                                   
               HIST_OPD_DETTE_DHENVN,                                   
               HIST_OPD_DETTE_CSBSK,                                    
               HIST_OPD_DETTE_CFØREFT,                                  
               HIST_OPD_DETTE_CSKPLOM,                                  
               HIST_OPD_DETTE_DCIÆN,                                    
               HIST_OPD_NAESTE_DHENVN,                                  
               HIST_OPD_NAESTE_CSBSK,                                   
               HIST_OPD_NAESTE_CFØREFT,                                 
               HIST_OPD_NAESTE_CSKPLOM,                                 
               HIST_OPD_NAESTE_DCIÆN                                    
          FROM BQ76000T                                                 
          WHERE TIL_EVS_AAR = :WS_TIL_EVS_AAR                           
          AND   AFVIKLINGS_ID = :WS_FORSKUD_SLUT_TXT                    
          AND   HIST_OPD_DETTE_DHENVN > 0                               
          ORDER BY TIL_EVS_AAR, AFVIKLINGS_ID, DSORP, DCPRN;            
 /*********************************************************************/
 /*                                                                   */
 /*      HOUSEKEEPING                                                 */
 /*                                                                   */
 /*********************************************************************/
         PUT SKIP LIST ('START ' !! WS_PROGRAMNAVN);                    
                                                                        
         EOF_BH555 = NEJ;                                               
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
                ON ERROR SYSTEM;                                        
                PUT SKIP LIST ('PROGRAMFEJL');                          
                CALL PLIDUMP  ('SNHOB','PROGRAM BH55500L');             
            END;                                                        
                                                                        
         CALL ZS61900;                            /* UDSKRIV SSI-DATO */
                                                                        
         CALL ZZ20390 ('*OPEN','BH55501Y');                             
         CALL ZZ20390 ('*OPEN','BH55502Y');                             
         TV = '';                                                       
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         OVERLIN1.DATO  = UDDATO;                                       
                                                                        
         OPEN FILE (BH555I) TITLE ('BH55500P');                         
                                                                        
         ON ENDFILE (BH555I)                                            
         BEGIN;                                                         
            EOF_BH555 = JA;                                             
         END;                                                           
 /*********************************************************************/
 /* OMKØRSELSCHECK                                                    */
 /*********************************************************************/
         READ FILE (BH555I) INTO (BH555_PARM);                          
                                                                        
         IF EOF_BH555 = NEJ                                             
         THEN DO;                                                       
            SELECT (BH555_PARM.FS_MRK);                                 
               WHEN ('F')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH555_PARM.FORSKUD_TXT;      
                     WS_TIL_EVS_AAR = BH65300M.FORSKÅR;                 
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH555_PARM.SLUT_TXT;       
                  END;                                                  
               WHEN ('S')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH555_PARM.SLUT_TXT;         
                     WS_TIL_EVS_AAR = BH65300M.SLUTÅR;                  
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH555_PARM.SLUT_TXT;       
                  END;                                                  
               WHEN ('U')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH555_PARM.SUPPL_TXT;        
                     WS_TIL_EVS_AAR = BH65300M.SLUTÅR;                  
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH555_PARM.SLUT_TXT;       
                  END;                                                  
               OTHERWISE                                                
                  DO;                                                   
                     ABENDTXT = '101 PARAMETERFEJL';                    
                     CALL PROGRAM_FEJL;                                 
                  END;                                                  
            END; /* select */                                           
                                                                        
         END;                                                           
                                                                        
         /********************************************************/     
         /*  CHECK OM FORGÆNGERE ER KØRT                         */     
         /********************************************************/     
         CALL CHECK_SEKVENS (BH555_PARM.FS_MRK); /* BH54997M */         
                                                                        
         /********************************************************/     
         /*  NU STARTER CHECK AF OMKØRSEL                        */     
         /********************************************************/     
         CALL CHECK_OM_OMKØRSEL; /* kode ligger i macro BH54999M */     
         IF DER_SKAL_KØRES_OM                                           
         THEN DO;                                                       
            PUT SKIP LIST ('Omkørsel af ' !! WS_PROGRAMNAVN);           
            CALL RYD_OP_FØR_OMKØRSEL;                                   
         END;                                                           
         ELSE DO;                                                       
            PUT SKIP LIST ('Normal kørsel af ' !! WS_PROGRAMNAVN);      
         END;                                                           
                                                                        
                                                                        
         /********************************************************/     
         /*  NU STARTER NORMALT FLOW                             */     
         /********************************************************/     
         CALL OPDATER_KØRSELSTABEL('START',BH555_PARM.FS_MRK);          
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      PROCESS                                                      */
 /*                                                                   */
 /*********************************************************************/
         CALL CLOSE_MTPERS1;                                            
         CALL OPEN_MTPERS1;                                             
         CALL FETCH_MTPERS1;                                            
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
           WHEN (0)                                                     
             DO;                                                        
                DO WHILE (SQLCA.SQLCODE = 0);                           
                   ANT_PERS1 = ANT_PERS1 + 1;                           
                   CALL LÆS_MTPERS2;                                    
                   IF MT_FUNDET                                         
                   THEN DO;                                             
                      if pers1.dcprn = 103562368 !                      
                         pers2.dcprn = 103562368 !                      
                         pers1.dcprn = 611621221 !                      
                         pers2.dcprn = 611621221                        
                      then do;                                          
                        put skip list ('BEGGE personer fundet:');       
                        put skip list ('  pers1.dcprn ' !! pers1.dcprn);
                        put skip list ('  pers1.dsorp ' !! pers1.dsorp);
                        put skip list ('  pers2.dcprn ' !! pers2.dcprn);
                        put skip list ('  pers2.dsorp ' !! pers2.dsorp);
                      end;                                              
                      ANT_PERS2 = ANT_PERS2 + 1;                        
                      IF PERS1.DSORP = PERS2.DSORP                      
                      THEN DO;                                          
                         CALL BEHANDL;                                  
                         IF PERS1.CCIVS = 'D' !                         
                            PERS2.CCIVS = 'D'                           
                         THEN DO;                                       
                            CALL KODE_DØD_ÆGTF;                         
                         END;                                           
                         CALL UPDATE_MTPERS1;                           
                         CALL UPDATE_MTPERS2;                           
                         IF ANT_TOT > 9999                              
                         THEN DO;                                       
                            EXEC SQL COMMIT;                            
                            Put skip list ('Commit efter ' !! ANT_TOT !!
                            ' opdateringer.  Ialt ' !! ANT_SKR !!       
                            ' opdateringer');                           
                            ANT_TOT = 0;                                
                         END;                                           
                      END;                                              
                      else do; /* nyt qle 8.12 */                       
                         if (PERS1.CCIVS = 'E' !                        
                             PERS1.CCIVS = 'L') &                       
                             PERS2.CCIVS = 'D'                          
                         THEN DO;                                       
                            CALL KODE_DØD_ÆGTF_X;                       
                         END;                                           
                         /* if PERS2.CCIVS = 'E' !                      
                            PERS2.CCIVS = 'L'                           
                         then                                           
                            CALL UPDATE_MTPERS2; */                     
                         CALL UPDATE_MTPERS1;                           
                         CALL UPDATE_MTPERS2;                           
                         IF ANT_TOT > 9999                              
                         THEN DO;                                       
                            EXEC SQL COMMIT;                            
                            Put skip list ('Commit efter ' !! ANT_TOT !!
                            ' opdateringer.  Ialt ' !! ANT_SKR !!       
                            ' opdateringer');                           
                            ANT_TOT = 0;                                
                         END;                                           
                      end;                                              
                   END;                                                 
                   ELSE DO;                                             
                      /* personen fandt ikke sin makker */              
                      if pers1.ccivs = 'D' &                            
                         pers1.hist_opd_dette_dhenvn > 0                
                      then do;                                          
                        WS_CSRP_PNR = pers1.hist_opd_dette_dhenvn;      
                        call Check_aegtefaelle_csrp;                    
                        if csrp_fundet &                                
                           dclbq70000t.civiskod = 'D' &                 
                           dclbq70000t.cvisfradto <= pers1.drgnÅRTIL    
                        then do;                                        
                           pers1.bpensind = 0;                          
                           pers1.bpensgr = 0;                           
                           pers1.cstatus = ' ';                         
                           pers1.covf_dhe = ' ';                        
                           pers1.hist_opd_sidste_dhenvn = 0;            
                           pers1.hist_opd_sidste_csbsk = ' ';           
                           pers1.hist_opd_sidste_cfØreft = 0;           
                           pers1.hist_opd_sidste_cskplom = ' ';         
                           pers1.hist_opd_sidste_dciÆn = 0;             
                           pers1.hist_opd_dette_dhenvn = 0;             
                           pers1.hist_opd_naeste_dhenvn = 0;            
                           pers1.hist_opd_naeste_csbsk = ' ';           
                           pers1.hist_opd_naeste_cfØreft = 0;           
                           pers1.hist_opd_naeste_cskplom = ' ';         
                           pers1.hist_opd_naeste_dciÆn = 0;             
                           CALL UPDATE_MTPERS1;                         
                        end;                                            
                      end;                                              
                   END;                                                 
                   CALL FETCH_MTPERS1;                                  
                END;                                                    
             END;                                                       
           WHEN (100)                                                   
             DO;                                                        
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
               ABENDTXT = '101 FETCH MTPERS1';                          
               CALL SQL_FEJL;                                           
             END;                                                       
         END;  /* select */                                             
                                                                        
         IF ANT_TOT > 0                                                 
         THEN DO;                                                       
            EXEC SQL COMMIT;                                            
            Put skip list ('Commit efter ' !! ANT_TOT !!                
                           ' opdateringer.  Ialt ' !! ANT_SKR !!        
                           ' opdateringer');                            
         END;                                                           
                                                                        
         CALL CLOSE_MTPERS1;                                            
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      BEHANDLING AF PERSON1 og PERSON2                             */
 /*                                                                   */
 /*********************************************************************/
 BEHANDL:  PROC;                                                        
                                                                        
         if pers1.dsorp = 103562368 !                                   
            pers2.dsorp = 103562368 !                                   
            pers1.dsorp = 611621221 !                                   
            pers2.dsorp = 611621221                                     
         then do;                                                       
            put skip list ('BEHANDL med flg. pers:');                   
            put skip list ('  pers1.dsorp ' !! pers1.dsorp);            
            put skip list ('  pers2.dsorp ' !! pers2.dsorp);            
         end;                                                           
                                                                        
         /* optælling */                                                
         IF PERS1.HIST_OPD_DETTE_CFØREFT > 0 /*#01 fra 2015*/           
         THEN                                                           
            ANT_PENS_FORRIGE_ÅR = ANT_PENS_FORRIGE_ÅR + 1;              
         IF PERS1.HIST_OPD_NAESTE_CFØREFT > 0 /*#01 fra 2016 */         
         THEN                                                           
            ANT_PENS_AKT_ÅR = ANT_PENS_AKT_ÅR + 1;                      
                                                                        
         IF PERS2.HIST_OPD_DETTE_CFØREFT > 0  /*#01 fra 2015*/          
         THEN                                                           
            ANT_PENS_FORRIGE_ÅR = ANT_PENS_FORRIGE_ÅR + 1;              
         IF PERS2.HIST_OPD_NAESTE_CFØREFT > 0 /*#01 fra 2016*/          
         THEN                                                           
            ANT_PENS_AKT_ÅR = ANT_PENS_AKT_ÅR + 1;                      
                                                                        
         CALL OPSÆT_KODE;                                               
                                                                        
 END BEHANDL;                                                           
 /*********************************************************************/
 /*                                                                   */
 /*      OPSÆTNING AF KODE                                            */
 /*                                                                   */
 /*********************************************************************/
 OPSÆT_KODE: PROC;                                                      
                                                                        
         if pers1.dsorp = 103562368 !                                   
            pers2.dsorp = 103562368 !                                   
            pers1.dsorp = 611621221 !                                   
            pers2.dsorp = 611621221                                     
        then do;                                                        
           put skip list ('OPSÆT_KODE check1 med flg. pers:');          
           put skip list ('  pers1.dcprn ' !! pers1.dcprn);             
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers1.ccivs ' !! pers1.ccivs);             
           put skip list ('  pers2.dcprn ' !! pers2.dcprn);             
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
           put skip list ('  pers2.ccivs ' !! pers2.ccivs);             
        end;                                                            
                                                                        
        /* EFTERFØLGENDE OPSÆTTES KUN HVIS PERSONERNE ER */             
        /* SAMBESKATTET I SLUT-ÅRET                      */             
        /* #01*/ /*#02 DER SPØRGES KUN PÅ SLUTÅR SOM I TIDLIGERE  */    
        /* VERSIONER                                              */    
        IF (PERS1.HIST_OPD_DETTE_CSBSK = '2' !                          
            PERS1.HIST_OPD_DETTE_CSBSK = '3' !                          
            PERS1.HIST_OPD_DETTE_CSBSK = '5' !                          
            PERS1.HIST_OPD_DETTE_CSBSK = '6') &                         
           (PERS2.HIST_OPD_DETTE_CSBSK = '2' !                          
            PERS2.HIST_OPD_DETTE_CSBSK = '3' !                          
            PERS2.HIST_OPD_DETTE_CSBSK = '5' !                          
            PERS2.HIST_OPD_DETTE_CSBSK = '6')                           
        THEN;                                                           
        ELSE                                                            
           RETURN; /*EJ SAMBESKATTET I SLUTÅRET */                      
                                                                        
        if pers1.dsorp = 103562368 !                                    
            pers2.dsorp = 103562368 !                                   
            pers1.dsorp = 611621221 !                                   
            pers2.dsorp = 611621221                                     
        then do;                                                        
           put skip list ('OPSÆT_KODE check2 med flg. pers:');          
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
        end;                                                            
                                                                        
        /* OPSÆT KODE FOR EFTERLØN/FØRTIDSPENSION */                    
        SELECT; /*#01*/                                                 
           WHEN (PERS1.HIST_OPD_DETTE_CFØREFT  > 0 &                    
                 PERS2.HIST_OPD_DETTE_CFØREFT = 0)                      
              DO;                                                       
                 PERS2.HIST_OPD_DETTE_CFØREFT  =                        
                     PERS1.HIST_OPD_DETTE_CFØREFT + 2;                  
                 ANT_AJOUR_FORRIGE_ÅR = ANT_AJOUR_FORRIGE_ÅR + 1;       
              END;                                                      
           WHEN (PERS2.HIST_OPD_DETTE_CFØREFT  > 0 &                    
                 PERS1.HIST_OPD_DETTE_CFØREFT = 0)                      
              DO;                                                       
                 PERS1.HIST_OPD_DETTE_CFØREFT  =                        
                     PERS2.HIST_OPD_DETTE_CFØREFT + 2;                  
                 ANT_AJOUR_FORRIGE_ÅR = ANT_AJOUR_FORRIGE_ÅR + 1;       
              END;                                                      
           OTHERWISE;                                                   
        END;                                                            
                                                                        
        if pers1.dsorp = 103562368 !                                    
            pers2.dsorp = 103562368 !                                   
            pers1.dsorp = 611621221 !                                   
            pers2.dsorp = 611621221                                     
        then do;                                                        
           put skip list ('OPSÆT_KODE check3 med flg. pers:');          
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
        end;                                                            
                                                                        
        /* EFTERFØLGENDE OPSÆTTES KUN HVIS PERSONERNE ER */             
        /* SAMBESKATTET I FORSKUDS-ÅRET                  */             
        /* #01 */                                                       
        IF (PERS1.HIST_OPD_NAESTE_CSBSK = '2' !                         
            PERS1.HIST_OPD_NAESTE_CSBSK = '3' !                         
            PERS1.HIST_OPD_NAESTE_CSBSK = '5') &                        
           (PERS2.HIST_OPD_NAESTE_CSBSK = '2' !                         
            PERS2.HIST_OPD_NAESTE_CSBSK = '3' !                         
            PERS2.HIST_OPD_NAESTE_CSBSK = '5')                          
        THEN do;                                                        
        end;                                                            
        ELSE do;                                                        
           RETURN;                                                      
        end;                                                            
                                                                        
        if pers1.dsorp = 103562368 !                                    
            pers2.dsorp = 103562368 !                                   
            pers1.dsorp = 611621221 !                                   
            pers2.dsorp = 611621221                                     
        then do;                                                        
           put skip list ('OPSÆT_KODE check4 med flg. pers:');          
           put skip list ('  pers1.dcprn ' !! pers1.dcprn);             
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers1.HIST_OPD_NAESTE_CFØREFT ' !!         
                             pers1.HIST_OPD_NAESTE_CFØREFT);            
           put skip list ('  pers2.dcprn ' !! pers2.dcprn);             
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
           put skip list ('  pers2.HIST_OPD_NAESTE_CFØREFT ' !!         
                             pers2.HIST_OPD_NAESTE_CFØREFT);            
        end;                                                            
                                                                        
        SELECT;  /* #01 */                                              
           WHEN (PERS1.HIST_OPD_NAESTE_CFØREFT > 0 &                    
                 PERS2.HIST_OPD_NAESTE_CFØREFT = 0)                     
              DO;                                                       
                 PERS2.HIST_OPD_NAESTE_CFØREFT =                        
                       PERS1.HIST_OPD_NAESTE_CFØREFT + 2;               
                 ANT_AJOUR_AKT_ÅR    = ANT_AJOUR_AKT_ÅR + 1;            
              END;                                                      
           WHEN (PERS2.HIST_OPD_NAESTE_CFØREFT > 0 &                    
                 PERS1.HIST_OPD_NAESTE_CFØREFT = 0)                     
              DO;                                                       
                 PERS1.HIST_OPD_NAESTE_CFØREFT =                        
                    PERS2.HIST_OPD_NAESTE_CFØREFT + 2;                  
                 ANT_AJOUR_AKT_ÅR    = ANT_AJOUR_AKT_ÅR + 1;            
              END;                                                      
           OTHERWISE;                                                   
        END;                                                            
                                                                        
        if pers1.dsorp = 103562368 !                                    
            pers2.dsorp = 103562368 !                                   
            pers1.dsorp = 611621221 !                                   
            pers2.dsorp = 611621221                                     
        then do;                                                        
           put skip list ('OPSÆT_KODE check5 med flg. pers:');          
           put skip list ('  pers1.dcprn ' !! pers1.dcprn);             
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers1.HIST_OPD_NAESTE_CFØREFT ' !!         
                             pers1.HIST_OPD_NAESTE_CFØREFT);            
           put skip list ('  pers2.dcprn ' !! pers2.dcprn);             
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
           put skip list ('  pers2.HIST_OPD_NAESTE_CFØREFT ' !!         
                             pers2.HIST_OPD_NAESTE_CFØREFT);            
        end;                                                            
 END OPSÆT_KODE;                                                        
 /*********************************************************************/
 /*      OPSÆT KODE FOR ÆGTEFÆLLE DØD I 2007 ELLER 2009 AF HENSYN TIL */
 /*      OPSÆTNINGEN AF KODE FOR ENKE EFTER (CENKE) 3 ELLER 4 SENERE  */
 /*      I PROGRAM BH94300.                                           */
 /*      DOG  I K K E  HVIS ÆGTEFÆLLERNE VAR SEPARERET.               */
 /*********************************************************************/
 KODE_DØD_ÆGTF:                                                         
        PROC;                                                           
                                                                        
        if pers1.dsorp = 103562368 !                                    
           pers2.dsorp = 103562368 !                                    
           pers1.dsorp = 611621221 !                                    
           pers2.dsorp = 611621221                                      
        then do;                                                        
           test_put = JA;                                               
        end;                                                            
        else do;                                                        
           test_put = NEJ;                                              
        end;                                                            
                                                                        
        if test_put                                                     
        then do;                                                        
           put skip list ('KODE_DØD_ÆGTF check1 med flg. pers:');       
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
        end;                                                            
                                                                        
        IF PERS1.HIST_OPD_SIDSTE_CSBSK = '4' !    /*#01*/               
           PERS1.HIST_OPD_DETTE_CSBSK   = '4' !    /*#01*/              
           PERS2.HIST_OPD_SIDSTE_CSBSK = '4' !    /*#01*/               
           PERS2.HIST_OPD_DETTE_CSBSK   = '4'      /*#01*/              
        THEN                                                            
           RETURN; /* HVIS SEPARERET */                                 
                                                                        
        SELECT;                                                         
           WHEN (PERS1.CCIVS = 'E' ! PERS1.CCIVS = 'L')                 
              DO;                                                       
                 if test_put                                            
                 then do;                                               
                    put skip list ('KODE_DØD_ÆGTF check2 med pers:');   
                    put skip list ('  pers1.dsorp ' !! pers1.dsorp);    
                    put skip list ('  pers1.CCIVS ' !! pers1.CCIVS);    
                    put skip list ('  pers1.DRGNÅRTIL ' !!              
                                      pers1.DRGNÅRTIL);                 
                    put skip list ('  pers2.dsorp ' !! pers2.dsorp);    
                    put skip list ('  pers2.ccivs ' !! pers2.ccivs);    
                    put skip list ('  pers2.HIST_OPD_DETTE_DCIÆN ' !!   
                                      pers2.HIST_OPD_DETTE_DCIÆN);      
                 end;                                                   
                 IF PERS2.CCIVS = 'D' &                                 
   /*#01*/         PERS2.HIST_OPD_DETTE_DCIÆN <= PERS1.DRGNÅRTIL        
                 THEN                                                   
                    DO;                                                 
                       if test_put                                      
                       then do;                                         
                          put skip list ('KODE_DØD_ÆGTF check2a');      
                       end;                                             
                       HJ_CPR = PERS2.DCPRN;                            
                       /* HVIS DØD SKAL ALDER */                        
                       /* VÆRE PÅ DØDSDAGEN   */                        
   /*#01*/             IF PERSON_ALDER_OK(PERS2.HIST_OPD_DETTE_DCIÆN,   
                                   HJ_CPR,'1') /*67 ÅR?*/ !             
   /*#01*/                PERSON_ALDER_OK(PERS2.HIST_OPD_DETTE_DCIÆN,   
                                   HJ_CPR,'4') /*65 ÅR?*/               
                       THEN                                             
                          C67_ÅRIG = '1';                               
                       ELSE                                             
                          C67_ÅRIG = '0';                               
                       if test_put                                      
                       then do;                                         
                          put skip list ('KODE_DØD_ÆGTF check2b');      
                          put skip list (' P2.HIST_OPD_SIDSTE_CFØREFT ' 
                          !! PERS2.HIST_OPD_SIDSTE_CFØREFT);            
                          put skip list (' P2.HIST_OPD_DETTE_CFØREFT '  
                          !! PERS2.HIST_OPD_DETTE_CFØREFT);             
                          put skip list (' C67_ÅRIG ' !! C67_ÅRIG);     
                       end;                                             
    /*#01*/            IF PERS2.HIST_OPD_SIDSTE_CFØREFT > 0 !           
    /*#01*/               PERS2.HIST_OPD_DETTE_CFØREFT > 0              
                       THEN                                             
                          PERS1.CDØDÆGTF = '2' ;  /* ENKE EFTER FØRTP.*/
                       IF C67_ÅRIG = '1'                                
                       THEN                                             
                          PERS1.CDØDÆGTF = '1' ;  /* ENKE EFTER 67-ÅR */
                    END;                                                
              END;                                                      
           WHEN (PERS2.CCIVS = 'E' ! PERS2.CCIVS = 'L')                 
              DO;                                                       
                 if test_put                                            
                 then do;                                               
                    put skip list ('KODE_DØD_ÆGTF check3 med pers:');   
                    put skip list ('  pers2.dsorp ' !! pers2.dsorp);    
                    put skip list ('  pers2.CCIVS ' !! pers2.CCIVS);    
                    put skip list ('  pers2.DRGNÅRTIL ' !!              
                                      pers2.DRGNÅRTIL);                 
                    put skip list ('  pers1.dsorp ' !! pers1.dsorp);    
                    put skip list ('  pers1.ccivs ' !! pers1.ccivs);    
                    put skip list ('  pers1.HIST_OPD_DETTE_DCIÆN ' !!   
                                      pers1.HIST_OPD_DETTE_DCIÆN);      
                 end;                                                   
                 IF PERS1.CCIVS = 'D' &                                 
   /*#01*/          PERS1.HIST_OPD_DETTE_DCIÆN <= PERS2.DRGNÅRTIL       
                 THEN                                                   
                    DO;                                                 
                       if test_put                                      
                       then do;                                         
                          put skip list ('KODE_DØD_ÆGTF check3a');      
                       end;                                             
                       HJ_CPR = PERS1.DCPRN;                            
                       IF PERSON_ALDER_OK(PERS1.HIST_OPD_DETTE_DCIÆN,   
   /*#01*/                                HJ_CPR,'1') !   /*67 ÅR?*/    
                          PERSON_ALDER_OK(PERS1.HIST_OPD_DETTE_DCIÆN,   
   /*#01*/                                HJ_CPR,'4')     /*65 ÅR?*/    
                       THEN                                             
                          C67_ÅRIG = '1';                               
                       ELSE                                             
                          C67_ÅRIG = '0';                               
                       if test_put                                      
                       then do;                                         
                          put skip list ('KODE_DØD_ÆGTF check3b');      
                          put skip list (' P1.HIST_OPD_SIDSTE_CFØREFT ' 
                          !! PERS1.HIST_OPD_SIDSTE_CFØREFT);            
                          put skip list (' P1.HIST_OPD_DETTE_CFØREFT '  
                          !! PERS1.HIST_OPD_DETTE_CFØREFT);             
                          put skip list (' C67_ÅRIG ' !! C67_ÅRIG);     
                       end;                                             
   /*#01*/             IF PERS1.HIST_OPD_SIDSTE_CFØREFT > 0 !           
   /*#01*/              PERS1.HIST_OPD_DETTE_CFØREFT > 0                
                       THEN                                             
                          PERS2.CDØDÆGTF = '2' ;  /* ENKE EFTER FØRTP.*/
                       IF C67_ÅRIG = '1'                                
                       THEN                                             
                          PERS2.CDØDÆGTF = '1' ;  /* ENKE EFTER 67-ÅR */
                    END;                                                
              END;                                                      
           OTHERWISE;                                                   
        END;            /* SELECT */                                    
                                                                        
        if test_put                                                     
        then do;                                                        
           put skip list ('KODE_DØD_ÆGTF check4 med flg. pers:');       
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers1.ccivs ' !! pers1.ccivs);             
           put skip list ('  pers1.CDØDÆGTF: ' !! pers1.CDØDÆGTF);      
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
           put skip list ('  pers2.ccivs ' !! pers2.ccivs);             
           put skip list ('  pers2.CDØDÆGTF: ' !! pers2.CDØDÆGTF);      
           put skip list ('  C67_ÅRIG: ' !! C67_ÅRIG);                  
        end;                                                            
                                                                        
 END KODE_DØD_ÆGTF;                                                     
 /*********************************************************************/
 /*      OPSÆT KODE FOR ÆGTEFÆLLE DØD I 2007 ELLER 2009 AF HENSYN TIL */
 /*      OPSÆTNINGEN AF KODE FOR ENKE EFTER (CENKE) 3 ELLER 4 SENERE  */
 /*      I PROGRAM BH94300.                                           */
 /*      DOG  I K K E  HVIS ÆGTEFÆLLERNE VAR SEPARERET.               */
 /*********************************************************************/
 KODE_DØD_ÆGTF_X:                                                       
        PROC;                                                           
                                                                        
        if pers1.dsorp = 103562368 !                                    
           pers2.dsorp = 103562368 !                                    
           pers1.dsorp = 611621221 !                                    
           pers2.dsorp = 611621221                                      
        then do;                                                        
           test_put = JA;                                               
        end;                                                            
        else do;                                                        
           test_put = NEJ;                                              
        end;                                                            
                                                                        
        if test_put                                                     
        then do;                                                        
           put skip list ('KODE_DØD_ÆGTF_X check1 med flg. pers:');     
           put skip list ('  pers1.dcprn ' !! pers1.dcprn);             
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers2.dcprn ' !! pers2.dcprn);             
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
        end;                                                            
                                                                        
        IF PERS1.HIST_OPD_SIDSTE_CSBSK = '4' !    /*#01*/               
           PERS1.HIST_OPD_DETTE_CSBSK   = '4' !    /*#01*/              
           PERS2.HIST_OPD_SIDSTE_CSBSK = '4' !    /*#01*/               
           PERS2.HIST_OPD_DETTE_CSBSK   = '4'      /*#01*/              
        THEN                                                            
           RETURN; /* HVIS SEPARERET */                                 
                                                                        
        SELECT;                                                         
           WHEN (PERS1.CCIVS = 'E' ! PERS1.CCIVS = 'L')                 
              DO;                                                       
                 if test_put                                            
                 then do;                                               
                    put skip list ('KODE_DØD_ÆGTF_X check2 med pers:'); 
                    put skip list ('  pers1.dsorp ' !! pers1.dsorp);    
                    put skip list ('  pers1.CCIVS ' !! pers1.CCIVS);    
                    put skip list ('  pers1.DRGNÅRTIL ' !!              
                                      pers1.DRGNÅRTIL);                 
                    put skip list ('  pers2.dsorp ' !! pers2.dsorp);    
                    put skip list ('  pers2.ccivs ' !! pers2.ccivs);    
                    put skip list ('  pers2.HIST_OPD_DETTE_DCIÆN ' !!   
                                      pers2.HIST_OPD_DETTE_DCIÆN);      
                 end;                                                   
                 IF PERS2.CCIVS = 'D' &                                 
   /*#01*/         PERS2.HIST_OPD_DETTE_DCIÆN <= PERS1.DRGNÅRTIL        
                 THEN                                                   
                    DO;                                                 
                       if test_put                                      
                       then do;                                         
                          put skip list ('KODE_DØD_ÆGTF_X check2a');    
                       end;                                             
                       HJ_CPR = PERS2.DCPRN;                            
                       /* HVIS DØD SKAL ALDER */                        
                       /* VÆRE PÅ DØDSDAGEN   */                        
   /*#01*/             IF PERSON_ALDER_OK(PERS2.HIST_OPD_DETTE_DCIÆN,   
                                   HJ_CPR,'1') /*67 ÅR?*/ !             
   /*#01*/                PERSON_ALDER_OK(PERS2.HIST_OPD_DETTE_DCIÆN,   
                                   HJ_CPR,'4') /*65 ÅR?*/               
                       THEN                                             
                          C67_ÅRIG = '1';                               
                       ELSE                                             
                          C67_ÅRIG = '0';                               
                       if test_put                                      
                       then do;                                         
                          put skip list ('KODE_DØD_ÆGTF_X check2b');    
                          put skip list (' P1.HIST_OPD_SIDSTE_CFØREFT ' 
                          !! PERS1.HIST_OPD_SIDSTE_CFØREFT);            
                          put skip list (' P1.HIST_OPD_DETTE_CFØREFT '  
                          !! PERS1.HIST_OPD_DETTE_CFØREFT);             
                          put skip list (' P2.HIST_OPD_SIDSTE_CFØREFT ' 
                          !! PERS2.HIST_OPD_SIDSTE_CFØREFT);            
                          put skip list (' P2.HIST_OPD_DETTE_CFØREFT '  
                          !! PERS2.HIST_OPD_DETTE_CFØREFT);             
                          put skip list (' C67_ÅRIG ' !! C67_ÅRIG);     
                       end;                                             
    /*#01*/            IF PERS2.HIST_OPD_SIDSTE_CFØREFT > 0 !           
    /*#01*/               PERS2.HIST_OPD_DETTE_CFØREFT > 0              
                       THEN                                             
                          PERS1.CDØDÆGTF = '2' ;  /* ENKE EFTER FØRTP.*/
                       IF C67_ÅRIG = '1'                                
                       THEN                                             
                          PERS1.CDØDÆGTF = '1' ;  /* ENKE EFTER 67-ÅR */
                    END;                                                
              END;                                                      
           OTHERWISE;                                                   
        END;            /* SELECT */                                    
                                                                        
        if test_put                                                     
        then do;                                                        
           put skip list ('KODE_DØD_ÆGTF_X check4 med flg. pers:');     
           put skip list ('  pers1.dsorp ' !! pers1.dsorp);             
           put skip list ('  pers1.ccivs ' !! pers1.ccivs);             
           put skip list ('  pers1.CDØDÆGTF: ' !! pers1.CDØDÆGTF);      
           put skip list ('  pers2.dsorp ' !! pers2.dsorp);             
           put skip list ('  pers2.ccivs ' !! pers2.ccivs);             
           put skip list ('  pers2.CDØDÆGTF: ' !! pers2.CDØDÆGTF);      
           put skip list ('  C67_ÅRIG: ' !! C67_ÅRIG);                  
        end;                                                            
                                                                        
 END KODE_DØD_ÆGTF_X;                                                   
 /*********************************************************************/
 /* Hent ægtefælle på csrp                                            */
 /*********************************************************************/
 Check_aegtefaelle_csrp: proc;                                          
                                                                        
          CSRP_FUNDET = NEJ;                                            
                                                                        
          EXEC SQL                                                      
            SELECT                                                      
               pnr,                                                     
               civiskod,                                                
               cvisfradto                                               
                                                                        
            INTO                                                        
               :DCLBQ70000T.PNR,                                        
               :DCLBQ70000T.CIVISKOD,                                   
               :DCLBQ70000T.CVISFRADTO                                  
            FROM BQ70000T                                               
            WHERE pnr   = :WS_CSRP_PNR;                                 
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               CSRP_FUNDET = JA;                                        
            END;                                                        
            WHEN(100) DO;                                               
            END;                                                        
            OTHERWISE DO;                                               
               ABENDTXT = '101 SELECT BQ70000T';                        
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END Check_aegtefaelle_csrp;                                            
 /*********************************************************************/
 /* OPEN CURSOR TIL LÆS AF MT   BQ76000T                       RUTINE */
 /*********************************************************************/
 OPEN_MTPERS1: PROC;                                                    
                                                                        
         EXEC SQL OPEN MTPERS1;                                         
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              ABENDTXT = '101 OPEN MTPERS1';                            
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END OPEN_MTPERS1;                                                      
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF MANDTAL                            RUTINE */
 /*********************************************************************/
 FETCH_MTPERS1: PROC;                                                   
                                                                        
         PERS1 = '';                                                    
                                                                        
         EXEC SQL FETCH MTPERS1                                         
                                                                        
         INTO  :PERS1.TIL_EVS_AAR,                                      
               :PERS1.AFVIKLINGS_ID,                                    
               :PERS1.DCPRN,                                            
               :PERS1.PROGRAMNAVN,                                      
               :PERS1.DB2FUNKTION,                                      
               :PERS1.CCIVS,                                            
               :PERS1.CPENS,                                            
               :PERS1.CRGN,                                             
               :PERS1.DSORP,                                            
               :PERS1.CPART,                                            
               :PERS1.CFRÅR,                                            
               :PERS1.CFRÅROPR,                                         
               :PERS1.DRGNÅRFRA,                                        
               :PERS1.DRGNÅRTIL,                                        
               :PERS1.BPENSIND,                                         
               :PERS1.BPENSGR,                                          
               :PERS1.CSTATUS,                                          
               :PERS1.CDØDÆGTF,                                         
               :PERS1.CDUBLET,                                          
               :PERS1.CÆGTF_OK,                                         
               :PERS1.CFØRFORS,                                         
               :PERS1.CFØRCOR,                                          
               :PERS1.CFØRPENS,                                         
               :PERS1.COVF_DHE,                                         
               :PERS1.FØROPL_DCIÆN_GL,                                  
               :PERS1.FØROPL_CCIVS_GL,                                  
               :PERS1.HIST_OPD_SIDSTE_DHENVN,                           
               :PERS1.HIST_OPD_SIDSTE_CSBSK,                            
               :PERS1.HIST_OPD_SIDSTE_CFØREFT,                          
               :PERS1.HIST_OPD_SIDSTE_CSKPLOM,                          
               :PERS1.HIST_OPD_SIDSTE_DCIÆN,                            
               :PERS1.HIST_OPD_DETTE_DHENVN,                            
               :PERS1.HIST_OPD_DETTE_CSBSK,                             
               :PERS1.HIST_OPD_DETTE_CFØREFT,                           
               :PERS1.HIST_OPD_DETTE_CSKPLOM,                           
               :PERS1.HIST_OPD_DETTE_DCIÆN,                             
               :PERS1.HIST_OPD_NAESTE_DHENVN,                           
               :PERS1.HIST_OPD_NAESTE_CSBSK,                            
               :PERS1.HIST_OPD_NAESTE_CFØREFT,                          
               :PERS1.HIST_OPD_NAESTE_CSKPLOM,                          
               :PERS1.HIST_OPD_NAESTE_DCIÆN                             
         ;                                                              
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
                if pers1.dcprn = 103562368 !                            
                   pers1.dcprn = 611621221                              
                then do;                                                
                   put skip list ('FETCH_MTPERS1:');                    
                   put skip list ('  pers1.dcprn ' !! pers1.dcprn);     
                   put skip list ('  pers1.dsorp ' !! pers1.dsorp);     
                   put skip list ('  PERS1.HIST_OPD_DETTE_DHENVN ' !!   
                                     PERS1.HIST_OPD_DETTE_DHENVN);      
                   put skip list ('  PERS1.HIST_OPD_DETTE_DCIÆN ' !!    
                                     PERS1.HIST_OPD_DETTE_DCIÆN);       
                   put skip list ('  PERS1.CCIVS ' !!                   
                                     PERS1.CCIVS);                      
                   put skip list ('  PERS1.DRGNÅRTIL ' !!               
                                     PERS1.DRGNÅRTIL);                  
                end;                                                    
             END;                                                       
           WHEN (100)                                                   
             DO;                                                        
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
               ABENDTXT = '101 FETCH MTPERS1';                          
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
 END FETCH_MTPERS1;                                                     
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF MT   BQ76000T                      RUTINE */
 /*********************************************************************/
 CLOSE_MTPERS1: PROC;                                                   
                                                                        
         EXEC SQL CLOSE MTPERS1;                                        
                                                                        
 END CLOSE_MTPERS1;                                                     
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      LÆSNING AF MT  BQ76000T for person 2                         */
 /*                                                                   */
 /*********************************************************************/
 LÆS_MTPERS2: PROC;                                                     
                                                                        
         MT_FUNDET = NEJ;                                               
                                                                        
         PERS2 = '';                                                    
                                                                        
         EXEC SQL                                                       
            SELECT                                                      
               TIL_EVS_AAR,                                             
               AFVIKLINGS_ID,                                           
               DCPRN,                                                   
               PROGRAMNAVN,                                             
               DB2FUNKTION,                                             
               CCIVS,                                                   
               CPENS,                                                   
               CRGN,                                                    
               DSORP,                                                   
               CPART,                                                   
               CFRÅR,                                                   
               CFRÅROPR,                                                
               DRGNÅRFRA,                                               
               DRGNÅRTIL,                                               
               BPENSIND,                                                
               BPENSGR,                                                 
               CSTATUS,                                                 
               CDØDÆGTF,                                                
               CDUBLET,                                                 
               CÆGTF_OK,                                                
               CFØRFORS,                                                
               CFØRCOR,                                                 
               CFØRPENS,                                                
               COVF_DHE,                                                
               FØROPL_DCIÆN_GL,                                         
               FØROPL_CCIVS_GL,                                         
               HIST_OPD_SIDSTE_DHENVN,                                  
               HIST_OPD_SIDSTE_CSBSK,                                   
               HIST_OPD_SIDSTE_CFØREFT,                                 
               HIST_OPD_SIDSTE_CSKPLOM,                                 
               HIST_OPD_SIDSTE_DCIÆN,                                   
               HIST_OPD_DETTE_DHENVN,                                   
               HIST_OPD_DETTE_CSBSK,                                    
               HIST_OPD_DETTE_CFØREFT,                                  
               HIST_OPD_DETTE_CSKPLOM,                                  
               HIST_OPD_DETTE_DCIÆN,                                    
               HIST_OPD_NAESTE_DHENVN,                                  
               HIST_OPD_NAESTE_CSBSK,                                   
               HIST_OPD_NAESTE_CFØREFT,                                 
               HIST_OPD_NAESTE_CSKPLOM,                                 
               HIST_OPD_NAESTE_DCIÆN                                    
                                                                        
            INTO                                                        
               :PERS2.TIL_EVS_AAR,                                      
               :PERS2.AFVIKLINGS_ID,                                    
               :PERS2.DCPRN,                                            
               :PERS2.PROGRAMNAVN,                                      
               :PERS2.DB2FUNKTION,                                      
               :PERS2.CCIVS,                                            
               :PERS2.CPENS,                                            
               :PERS2.CRGN,                                             
               :PERS2.DSORP,                                            
               :PERS2.CPART,                                            
               :PERS2.CFRÅR,                                            
               :PERS2.CFRÅROPR,                                         
               :PERS2.DRGNÅRFRA,                                        
               :PERS2.DRGNÅRTIL,                                        
               :PERS2.BPENSIND,                                         
               :PERS2.BPENSGR,                                          
               :PERS2.CSTATUS,                                          
               :PERS2.CDØDÆGTF,                                         
               :PERS2.CDUBLET,                                          
               :PERS2.CÆGTF_OK,                                         
               :PERS2.CFØRFORS,                                         
               :PERS2.CFØRCOR,                                          
               :PERS2.CFØRPENS,                                         
               :PERS2.COVF_DHE,                                         
               :PERS2.FØROPL_DCIÆN_GL,                                  
               :PERS2.FØROPL_CCIVS_GL,                                  
               :PERS2.HIST_OPD_SIDSTE_DHENVN,                           
               :PERS2.HIST_OPD_SIDSTE_CSBSK,                            
               :PERS2.HIST_OPD_SIDSTE_CFØREFT,                          
               :PERS2.HIST_OPD_SIDSTE_CSKPLOM,                          
               :PERS2.HIST_OPD_SIDSTE_DCIÆN,                            
               :PERS2.HIST_OPD_DETTE_DHENVN,                            
               :PERS2.HIST_OPD_DETTE_CSBSK,                             
               :PERS2.HIST_OPD_DETTE_CFØREFT,                           
               :PERS2.HIST_OPD_DETTE_CSKPLOM,                           
               :PERS2.HIST_OPD_DETTE_DCIÆN,                             
               :PERS2.HIST_OPD_NAESTE_DHENVN,                           
               :PERS2.HIST_OPD_NAESTE_CSBSK,                            
               :PERS2.HIST_OPD_NAESTE_CFØREFT,                          
               :PERS2.HIST_OPD_NAESTE_CSKPLOM,                          
               :PERS2.HIST_OPD_NAESTE_DCIÆN                             
            FROM BQ76000T                                               
            WHERE TIL_EVS_AAR   = :PERS1.TIL_EVS_AAR                    
            AND   DCPRN         = :PERS1.HIST_OPD_DETTE_DHENVN          
            AND   AFVIKLINGS_ID = :PERS1.AFVIKLINGS_ID;                 
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               MT_FUNDET = JA;                                          
               if pers2.dcprn = 103562368 !                             
                  pers2.dcprn = 611621221                               
               then do;                                                 
                  put skip list ('LÆS_MTPERS2:');                       
                  put skip list ('  pers2.dcprn ' !! pers2.dcprn);      
                  put skip list ('  pers2.dsorp ' !! pers2.dsorp);      
                  put skip list ('  PERS2.HIST_OPD_DETTE_DHENVN ' !!    
                                    PERS2.HIST_OPD_DETTE_DHENVN);       
                  put skip list ('  PERS2.HIST_OPD_DETTE_DCIÆN ' !!     
                                    PERS2.HIST_OPD_DETTE_DCIÆN);        
                  put skip list ('  PERS2.CCIVS ' !!                    
                                    PERS2.CCIVS);                       
               end;                                                     
            END;                                                        
            WHEN(100) DO;                                               
            END;                                                        
            OTHERWISE DO;                                               
               ABENDTXT = '101 SELECT BQ76000T';                        
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END LÆS_MTPERS2;                                                       
 /*********************************************************************/
 /*                                                                   */
 /*      SKRIV PERSON1                                                */
 /*********************************************************************/
 UPDATE_MTPERS1: PROC;                                                  
                                                                        
         DCLBQ76000T = PERS1, by name;                                  
         DCLBQ76000T.PROGRAMNAVN    = WS_PROGRAMNAVN;                   
                                                                        
         /* behold F i db2funktion, hvis rækken var Fiktiv */           
         /* i forvejen.  Skal bruges i senere moduler      */           
                                                                        
         if DCLBQ76000T.DB2FUNKTION = 'F'                               
         THEN DO;                                                       
         END;                                                           
         ELSE DO;                                                       
            DCLBQ76000T.DB2FUNKTION    = 'U';                           
         END;                                                           
                                                                        
        if DCLBQ76000T.dcprn = 103562368 !                              
           DCLBQ76000T.dcprn = 611621221                                
        then do;                                                        
           put skip list ('UPDATE_MTPERS1 med flg. pers:');             
           put skip list ('  DCLBQ76000T.DCPRN ' !! DCLBQ76000T.DCPRN); 
        end;                                                            
                                                                        
         EXEC SQL                                                       
            UPDATE BQ76000T                                             
            SET                                                         
             TIL_EVS_AAR             = :DCLBQ76000T.TIL_EVS_AAR,        
             AFVIKLINGS_ID           = :DCLBQ76000T.AFVIKLINGS_ID,      
             DCPRN                   = :DCLBQ76000T.DCPRN,              
             PROGRAMNAVN             = :DCLBQ76000T.PROGRAMNAVN,        
             DB2FUNKTION             = :DCLBQ76000T.DB2FUNKTION,        
             CCIVS                   = :DCLBQ76000T.CCIVS,              
             CPENS                   = :DCLBQ76000T.CPENS,              
             CRGN                    = :DCLBQ76000T.CRGN,               
             DSORP                   = :DCLBQ76000T.DSORP,              
             CPART                   = :DCLBQ76000T.CPART,              
             CFRÅR                   = :DCLBQ76000T.CFRÅR,              
             CFRÅROPR                = :DCLBQ76000T.CFRÅROPR,           
             DRGNÅRFRA               = :DCLBQ76000T.DRGNÅRFRA,          
             DRGNÅRTIL               = :DCLBQ76000T.DRGNÅRTIL,          
             BPENSIND                = :DCLBQ76000T.BPENSIND,           
             BPENSGR                 = :DCLBQ76000T.BPENSGR,            
             CSTATUS                 = :DCLBQ76000T.CSTATUS,            
             CDØDÆGTF                = :DCLBQ76000T.CDØDÆGTF,           
             CDUBLET                 = :DCLBQ76000T.CDUBLET,            
             CÆGTF_OK                = :DCLBQ76000T.CÆGTF_OK,           
             CFØRFORS                = :DCLBQ76000T.CFØRFORS,           
             CFØRCOR                 = :DCLBQ76000T.CFØRCOR,            
             CFØRPENS                = :DCLBQ76000T.CFØRPENS,           
             COVF_DHE                = :DCLBQ76000T.COVF_DHE,           
             FØROPL_DCIÆN_GL         = :DCLBQ76000T.FØROPL_DCIÆN_GL,    
             FØROPL_CCIVS_GL         = :DCLBQ76000T.FØROPL_CCIVS_GL,    
             HIST_OPD_SIDSTE_DHENVN  =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_DHENVN,      
             HIST_OPD_SIDSTE_CSBSK   =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_CSBSK,       
             HIST_OPD_SIDSTE_CFØREFT =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_CFØREFT,     
             HIST_OPD_SIDSTE_CSKPLOM =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_CSKPLOM,     
             HIST_OPD_SIDSTE_DCIÆN   =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_DCIÆN,       
             HIST_OPD_DETTE_DHENVN   =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_DHENVN,       
             HIST_OPD_DETTE_CSBSK    =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_CSBSK,        
             HIST_OPD_DETTE_CFØREFT  =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_CFØREFT,      
             HIST_OPD_DETTE_CSKPLOM  =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_CSKPLOM,      
             HIST_OPD_DETTE_DCIÆN    =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_DCIÆN,        
             HIST_OPD_NAESTE_DHENVN  =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_DHENVN,       
             HIST_OPD_NAESTE_CSBSK   =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_CSBSK,        
             HIST_OPD_NAESTE_CFØREFT =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_CFØREFT,      
             HIST_OPD_NAESTE_CSKPLOM =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_CSKPLOM,      
             HIST_OPD_NAESTE_DCIÆN   =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_DCIÆN         
                                                                        
                                                                        
            WHERE TIL_EVS_AAR   = :DCLBQ76000T.TIL_EVS_AAR              
            AND   AFVIKLINGS_ID = :DCLBQ76000T.AFVIKLINGS_ID            
            AND   DCPRN         = :DCLBQ76000T.DCPRN;                   
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               ANT_SKR = ANT_SKR + 1;                                   
               ANT_TOT = ANT_TOT + 1;                                   
            END;                                                        
            OTHERWISE DO;                                               
               PUT SKIP LIST ('DCLBQ76000T: ' !! DCLBQ76000T);          
               ABENDTXT = '101 UPDATE BQ76000T';                        
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END UPDATE_MTPERS1;                                                    
 /*********************************************************************/
 /*                                                                   */
 /*      SKRIV PERSON2                                                */
 /*********************************************************************/
 UPDATE_MTPERS2: PROC;                                                  
                                                                        
         DCLBQ76000T = PERS2, by name;                                  
         DCLBQ76000T.PROGRAMNAVN    = WS_PROGRAMNAVN;                   
                                                                        
         if DCLBQ76000T.DB2FUNKTION = 'F'                               
         THEN DO;                                                       
         END;                                                           
         ELSE DO;                                                       
            DCLBQ76000T.DB2FUNKTION    = 'U';                           
         END;                                                           
                                                                        
         if DCLBQ76000T.dcprn = 103562368 !                             
           DCLBQ76000T.dcprn = 611621221                                
        then do;                                                        
           put skip list ('UPDATE_MTPERS2 med flg. pers:');             
           put skip list ('  DCLBQ76000T.DCPRN ' !! DCLBQ76000T.DCPRN); 
        end;                                                            
                                                                        
         EXEC SQL                                                       
            UPDATE BQ76000T                                             
            SET                                                         
             TIL_EVS_AAR             = :DCLBQ76000T.TIL_EVS_AAR,        
             AFVIKLINGS_ID           = :DCLBQ76000T.AFVIKLINGS_ID,      
             DCPRN                   = :DCLBQ76000T.DCPRN,              
             PROGRAMNAVN             = :DCLBQ76000T.PROGRAMNAVN,        
             DB2FUNKTION             = :DCLBQ76000T.DB2FUNKTION,        
             CCIVS                   = :DCLBQ76000T.CCIVS,              
             CPENS                   = :DCLBQ76000T.CPENS,              
             CRGN                    = :DCLBQ76000T.CRGN,               
             DSORP                   = :DCLBQ76000T.DSORP,              
             CPART                   = :DCLBQ76000T.CPART,              
             CFRÅR                   = :DCLBQ76000T.CFRÅR,              
             CFRÅROPR                = :DCLBQ76000T.CFRÅROPR,           
             DRGNÅRFRA               = :DCLBQ76000T.DRGNÅRFRA,          
             DRGNÅRTIL               = :DCLBQ76000T.DRGNÅRTIL,          
             BPENSIND                = :DCLBQ76000T.BPENSIND,           
             BPENSGR                 = :DCLBQ76000T.BPENSGR,            
             CSTATUS                 = :DCLBQ76000T.CSTATUS,            
             CDØDÆGTF                = :DCLBQ76000T.CDØDÆGTF,           
             CDUBLET                 = :DCLBQ76000T.CDUBLET,            
             CÆGTF_OK                = :DCLBQ76000T.CÆGTF_OK,           
             CFØRFORS                = :DCLBQ76000T.CFØRFORS,           
             CFØRCOR                 = :DCLBQ76000T.CFØRCOR,            
             CFØRPENS                = :DCLBQ76000T.CFØRPENS,           
             COVF_DHE                = :DCLBQ76000T.COVF_DHE,           
             FØROPL_DCIÆN_GL         = :DCLBQ76000T.FØROPL_DCIÆN_GL,    
             FØROPL_CCIVS_GL         = :DCLBQ76000T.FØROPL_CCIVS_GL,    
             HIST_OPD_SIDSTE_DHENVN  =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_DHENVN,      
             HIST_OPD_SIDSTE_CSBSK   =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_CSBSK,       
             HIST_OPD_SIDSTE_CFØREFT =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_CFØREFT,     
             HIST_OPD_SIDSTE_CSKPLOM =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_CSKPLOM,     
             HIST_OPD_SIDSTE_DCIÆN   =                                  
                              :DCLBQ76000T.HIST_OPD_SIDSTE_DCIÆN,       
             HIST_OPD_DETTE_DHENVN   =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_DHENVN,       
             HIST_OPD_DETTE_CSBSK    =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_CSBSK,        
             HIST_OPD_DETTE_CFØREFT  =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_CFØREFT,      
             HIST_OPD_DETTE_CSKPLOM  =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_CSKPLOM,      
             HIST_OPD_DETTE_DCIÆN    =                                  
                              :DCLBQ76000T.HIST_OPD_DETTE_DCIÆN,        
             HIST_OPD_NAESTE_DHENVN  =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_DHENVN,       
             HIST_OPD_NAESTE_CSBSK   =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_CSBSK,        
             HIST_OPD_NAESTE_CFØREFT =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_CFØREFT,      
             HIST_OPD_NAESTE_CSKPLOM =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_CSKPLOM,      
             HIST_OPD_NAESTE_DCIÆN   =                                  
                             :DCLBQ76000T.HIST_OPD_NAESTE_DCIÆN         
                                                                        
                                                                        
            WHERE TIL_EVS_AAR   = :DCLBQ76000T.TIL_EVS_AAR              
            AND   AFVIKLINGS_ID = :DCLBQ76000T.AFVIKLINGS_ID            
            AND   DCPRN         = :DCLBQ76000T.DCPRN;                   
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               ANT_SKR = ANT_SKR + 1;                                   
               ANT_TOT = ANT_TOT + 1;                                   
            END;                                                        
            OTHERWISE DO;                                               
               PUT SKIP LIST ('DCLBQ76000T: ' !! DCLBQ76000T);          
               ABENDTXT = '101 UPDATE BQ76000T';                        
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END UPDATE_MTPERS2;                                                    
 /*********************************************************************/
 /*                                                                   */
 /*      UDSKRIV KØRSELSKONTROLLISTE                                  */
 /*                                                                   */
 /*********************************************************************/
 KONTROLLISTE:                                                          
         PROC;                                                          
         SIDELIN.CCA    = ZZIK1;                                        
         CALL ZZ20300(SIDELIN,'01');                                    
         OVERLIN1.CCA   = ZZWS2;                                        
         CALL ZZ20300(OVERLIN1,'01');                                   
         OVERLIN2.CCA   = ZZWS3;                                        
         CALL ZZ20300(OVERLIN2,'01');                                   
         DETLIN1.CCA   = ZZWS2;                                         
         DETLIN1.TEKST  = 'ANTAL LÆSTE PERSONER PÅ MANDTAL BQ76000T';   
         DETLIN1.ANTAL = ANT_PERS1;                                     
         CALL ZZ20300(DETLIN1,'01');                                    
         DETLIN1.CCA   = ZZWS2;                                         
         DETLIN1.TEKST  = 'ANTAL MATCHEDE PERSONER PÅ MANDTAL BQ76000T';
         DETLIN1.ANTAL = ANT_PERS2;                                     
         CALL ZZ20300(DETLIN1,'01');                                    
         DETLIN1.CCA   = ZZWS2;                                         
         DETLIN1.TEKST  = 'ANTAL LÆSTE FØRTIDSPENSIONISTER ' !!         
         /*#01*/          'M.V. I ' !! BH65300M.INDKÅR1;                
         DETLIN1.ANTAL = ANT_PENS_FORRIGE_ÅR;                           
         CALL ZZ20300(DETLIN1,'01');                                    
         DETLIN1.CCA   = ZZWS2;                                         
         DETLIN1.TEKST  = 'ANTAL LÆSTE FØRTIDSPENSIONISTER ' !!         
         /*#01*/          'M.V. I ' !! BH65300M.INDKÅR2;                
         DETLIN1.ANTAL = ANT_PENS_AKT_ÅR;                               
         CALL ZZ20300(DETLIN1,'01');                                    
         DETLIN1.CCA   = ZZWS1;                                         
         DETLIN1.TEKST  = 'ANTAL ÆGTEFÆLLER AJOURFØRTE VEDR. ' !!       
         /*#01*/          BH65300M.INDKÅR1;                             
         DETLIN1.ANTAL  = ANT_AJOUR_FORRIGE_ÅR;                         
         CALL ZZ20300(DETLIN1,'01');                                    
         DETLIN1.CCA   = ZZWS2;                                         
         DETLIN1.TEKST  = 'ANTAL ÆGTEFÆLLER AJOURFØRTE VEDR. ' !!       
         /*#01*/          BH65300M.INDKÅR2;                             
         DETLIN1.ANTAL  = ANT_AJOUR_AKT_ÅR;                             
         CALL ZZ20300(DETLIN1,'01');                                    
         DETLIN1.CCA   = ZZWS2;                                         
         DETLIN1.TEKST  = 'ANTAL SKREVNE PERSONER PÅ MANDTAL BQ76000T'; 
         DETLIN1.ANTAL = ANT_SKR;                                       
         CALL ZZ20300(DETLIN1,'01');                                    
                                                                        
 END KONTROLLISTE;                                                      
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED SQLCODE: ' !! SQLCA.SQLCODE);  
         PUT SKIP LIST ('*****************************************');   
                                                                        
         CALL ZS67000(SQLCA);                                           
                                                                        
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /* HER UDSKRIVES ØVRIGE FEJL                                  RUTINE */
 /*********************************************************************/
 PROGRAM_FEJL: PROC;                                                    
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED PROGRAMFEJL');                 
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END PROGRAM_FEJL;                                                      
 /*********************************************************************/
 /* AFSLUTNING                                                 RUTINE */
 /*********************************************************************/
 AFSLUT: PROC;                                                          
         CALL KONTROLLISTE;                                             
         CALL ZZ20300(' ','99');                                        
         CALL OPDATER_KØRSELSTABEL('SLUT',BH555_PARM.FS_MRK);           
 END AFSLUT;                                                            
                                                                        
 %INCLUDE BH65500M;     /* BEREGN/UNDERSØG EN PERSON'S ALDER */         
 %INCLUDE BH54997M;     /* ER FORGÆNGERE KØRT. STOP HVIS IKKE */        
 %INCLUDE BH54998M;     /* OPDATER KØRSELSTABEL */                      
 END BH55500;                                                           
