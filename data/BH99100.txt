  PROCESS OPT(TIME);                                                    
 BH99100: /* UDTRÆK INDIVIDER TIL FEJLSØGNING */                        
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /*********************************************************************/
         DCL COPYRIGHT   CHAR      (30) STATIC                          
                         INIT ('COPYRIGHT KOMMUNEDATA A/S 2001');       
 /**********************************************************************
 * INPUT  : B.H95000D BEREGNINGSBÅND TIL EVS FORSKUD 2002              *
 *                                                                     *
 * OUTPUT : B.H99100D EJENDOMME MED MASKINELT OPSAT 1/7-NEDSLAGSOPLYS. *
 *                    (CNEDSL1 OG DATO0107) HVOR DER MANUELT ER INDBE- *
 *                    RETTET EVT. ÆNDRING HERTIL AF KOMMUNEN I ENTEN   *
 *                    SLUT 2000 ELLER FORSKUD 2001.                    *
 *          B.H99110D UDTRÆK MED DE EJENDOMME HVOR CNEDSL1 BLEV OPSAT  *
 *                    SOM JA ISTEDET FOR NEJ ELLER OMVENDT PÅ GRUND AF *
 *                    AT DER IKKE BLEV TAGET HENSYN TIL MANUEL INDBE-  *
 *                    RETNING JVF. OVENFOR.                            *
 *                    BÅDE MASKINELT BEREGNEDE OG IKKE BEREGNEDE.      *
 *          BH99101Y  KØRSELSKONTROLLISTE                              *
 *                                                                     *
 * PROGRAMMØR: AAGE RASMUSSEN  NOV 2001                                *
 **********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONNECTED;                  
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL     BH950I FILE RECORD INPUT;                                      
 DCL     BH9910O FILE RECORD OUTPUT;                                    
 DCL     BH9911O FILE RECORD OUTPUT;                                    
 /********************************************************************* 
 *       DECLARE AF UDTRÆK                                            * 
 *********************************************************************/ 
 DCL     BH950_AR        CHAR      (4000) VAR;                          
 DCL     1 BH950         BASED     (ADDR(BH950_AR)),                    
           2 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH90100N;;                                          
 DCL     1 BH991,                                                       
           %INCLUDE BH99110N;                                           
 /********************************************************************* 
 *               DECLARE AF DIV. TÆLLEVÆRKER                          * 
 *********************************************************************/ 
 DCL     1 TV,                        /* TÆLLEVÆRKER TIL TOTALLISTEN */ 
           2 SKRIV       FIXED DEC (7),                                 
           2 SLUT        FIXED DEC (7),                                 
           2 FORSKUD     FIXED DEC (7),                                 
           2 SKRÆND      FIXED DEC (7),                                 
           2 BERJANEJ    FIXED DEC (7),                                 
           2 EJBJANEJ    FIXED DEC (7),                                 
           2 BERNEJJA    FIXED DEC (7),                                 
           2 EJBNEJJA    FIXED DEC (7);                                 
 /********************************************************************* 
 *       DECLARE AF BUILTIN'S                                         * 
 *********************************************************************/ 
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 /********************************************************************* 
 *       DECLARE AF ENTRY'S                                           * 
 *********************************************************************/ 
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH99100L'),                                        
           2 F1          CHAR      (25)      INIT      (' '),           
           2 TEKST2      CHAR      (57)      INIT      (                
           'UDSØG INDIVIDER MED FEJL I 1/7-98 OPSÆTNING    '),          
           2 F2          CHAR      (12)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (61)      INIT      (' ');           
         % INCLUDE ZZ20301M;                                            
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
 EXTERNAL INIT ('NOTEST(ALL,,;)');                                      
 DCL     EOF_BH950       BIT       (1);                                 
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
                                                                        
 DCL     UDDATO          CHAR      (10);                                
                                                                        
 DCL     DATO1           CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
                                                                        
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL ZS61900;                         /* UDSKRIVNING AF SSI */ 
                                                                        
         EOF_BH950 = NEJ;                                               
                                                                        
         ON ERROR                                                       
            CALL PLIDUMP ('SNHOB');                                     
                                                                        
         OPEN FILE (BH950I)  TITLE ('BH95000I');                        
         OPEN FILE (BH9910O) TITLE ('BH99100O');                        
         OPEN FILE (BH9911O) TITLE ('BH99110O');                        
                                                                        
         ON ENDFILE (BH950I)                                            
            EOF_BH950 = JA;                                             
                                                                        
         TV = '';                                                       
                                                                        
         CALL ZZ20390 ('*OPEN','BH99101Y');                             
                                                                        
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         OVERLIN1.DATO  = UDDATO;                                       
                                                                        
         SIDELIN.CCA  = ZZIK1;                                          
         OVERLIN1.CCA = ZZWS2;                                          
         OVERLIN2.CCA = ZZWS3;                                          
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
                                                                        
         READ FILE (BH950I) INTO (BH950_AR);                            
                                                                        
         DO WHILE ( EOF_BH950 = NEJ );                                  
                                                                        
            CALL BEHANDL;                                               
                                                                        
            READ FILE (BH950I) INTO (BH950_AR);                         
                                                                        
         END;                                                           
                                                                        
         CALL AFSLUT;                                                   
 /********************************************************************* 
 *       PERSONER SOM EVT. SKAL UDTRÆKKES                             * 
 *********************************************************************/ 
 BEHANDL:                                                               
 PROC;                                                                  
                                                                        
         IF BH950.SORT_CPR = 99999999999 !   /* OPTÆLL.INDV.  */        
            BH950.ESR.DCPRCIR = 0            /* IKKE EJER I ESR */      
         THEN                                                           
            RETURN;                                                     
                                                                        
        IF BH950.ESR.DCPRCIR > 0 &                                      
          (BH950.ESR.DAFSTÅ > 0 & BH950.ESR.DAFSTÅ < 20020101)          
        THEN                                                            
           RETURN;                                                      
                                                                        
        IF BH950.FEJLNR = 5001 !                                        
           BH950.FEJLNR = 5004 !                                        
           BH950.FEJLNR = 5020                                          
        THEN                                                            
           RETURN;                                                      
                                                                        
         BH991.DCPRN   = BH950.SORT_CPR;                                
         BH991.EKOMNR  = BH950.SORT_KOMNR;                              
         BH991.EEJDNR  = BH950.SORT_EJDNR;                              
         BH991.CEJBEVS = BH950.EVS_FÆLLES.CEJBEVS;                      
                                                                        
         BH991.GL_CNEDSL1 = BH950.EVS_FÆLLES.CNEDSL1;                   
         BH991.NY_CNEDSL1 = BH950.EVS_FÆLLES.CNEDSL1;                   
                                                                        
         BH991.GL_DATO0107 = BH950.EVS_FÆLLES.DATO0107;                 
         BH991.NY_DATO0107 = BH950.EVS_FÆLLES.DATO0107;                 
                                                                        
         /* SKAF DATA FRA EVS UDTRÆKKENE */                             
                                                                        
         IF BH950.EVS_SLUT_EJER.DCPRN > 0                               
         THEN                                                           
            DO;                                                         
               IF (BH950.EVS_SLUT_EJER.CNEDSL1 >= '20' &                
                   BH950.EVS_SLUT_EJER.CNEDSL1 <= '29') !               
                  (BH950.EVS_SLUT_EJER.CNEDSL1 >= '40' &                
                   BH950.EVS_SLUT_EJER.CNEDSL1 <= '49')                 
               THEN                                                     
                  DO;                                                   
                     BH991.NY_CNEDSL1 =                                 
                     BH950.EVS_SLUT_EJER.CNEDSL1;                       
                     IF BH950.EVS_SLUT_EJER.DATO0107 > 0                
                     THEN                                               
                        BH991.NY_DATO0107 =                             
                        BH950.EVS_SLUT_EJER.DATO0107;                   
                     TV.SLUT = TV.SLUT + 1;                             
                     BH991.CFRA = 'S';                                  
                  END;                                                  
            END;                                                        
                                                                        
         IF (BH991.NY_CNEDSL1 >= '20' & BH991.NY_CNEDSL1 <= '29') !     
            (BH991.NY_CNEDSL1 >= '40' & BH991.NY_CNEDSL1 <= '49')       
         THEN;                                                          
         ELSE                                                           
            IF BH950.EVS_FORSKUD.DCPRN > 0                              
            THEN                                                        
               DO;                                                      
                  IF (BH950.EVS_FORSKUD.CNEDSL1 >= '20' &               
                      BH950.EVS_FORSKUD.CNEDSL1 <= '29') !              
                     (BH950.EVS_FORSKUD.CNEDSL1 >= '40' &               
                      BH950.EVS_FORSKUD.CNEDSL1 <= '49')                
                  THEN                                                  
                     DO;                                                
                        BH991.NY_CNEDSL1 =                              
                        BH950.EVS_FORSKUD.CNEDSL1;                      
                        IF BH950.EVS_FORSKUD.DATO0107 > 0               
                        THEN                                            
                           BH991.NY_DATO0107 =                          
                           BH950.EVS_FORSKUD.DATO0107;                  
                        TV.FORSKUD = TV.FORSKUD + 1;                    
                        BH991.CFRA = 'F';                               
                     END;                                               
               END;                                                     
                                                                        
         IF (BH991.NY_CNEDSL1 >= '20' & BH991.NY_CNEDSL1 <= '29') !     
            (BH991.NY_CNEDSL1 >= '40' & BH991.NY_CNEDSL1 <= '49')       
         THEN                                                           
            DO;                                                         
               TV.SKRIV = TV.SKRIV + 1;                                 
               WRITE FILE (BH9910O) FROM (BH950_AR);                    
            END;                                                        
                                                                        
         IF (BH991.NY_CNEDSL1 >= '20' & BH991.NY_CNEDSL1 <= '29') &     
            (BH991.GL_CNEDSL1 >= '30' & BH991.GL_CNEDSL1 <= '50')       
         THEN                                                           
            DO;                                                         
               TV.SKRÆND = TV.SKRÆND + 1;                               
               WRITE FILE (BH9911O) FROM (BH991);                       
               IF BH991.CEJBEVS = '0'                                   
               THEN                                                     
                  TV.BERNEJJA = TV.BERNEJJA + 1;                        
               ELSE                                                     
                  TV.EJBNEJJA = TV.EJBNEJJA + 1;                        
            END;                                                        
                                                                        
         IF (BH991.NY_CNEDSL1 >= '40' & BH991.NY_CNEDSL1 <= '49') &     
            (BH991.GL_CNEDSL1 >= '10' & BH991.GL_CNEDSL1 <= '29')       
         THEN                                                           
            DO;                                                         
               TV.SKRÆND = TV.SKRÆND + 1;                               
               WRITE FILE (BH9911O) FROM (BH991);                       
               IF BH991.CEJBEVS = '0'                                   
               THEN                                                     
                  TV.BERJANEJ = TV.BERJANEJ + 1;                        
               ELSE                                                     
                  TV.EJBJANEJ = TV.EJBJANEJ + 1;                        
            END;                                                        
                                                                        
 END BEHANDL;                                                           
 /********************************************************************* 
 *       TOTALER UDSKRIVES.                                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
 PROC;                                                                  
                                                                        
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SKRIV;                                      
         DETLIN1.TEKST = 'ANTAL MANUEL CNEDSL1              B.H99100D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SLUT;                                       
         DETLIN1.TEKST = '      HERAF FRA EVS SLUT 2000     ';          
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FORSKUD;                                    
         DETLIN1.TEKST = '      HERAF FRA EVS FORSKUD 2001  ';          
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SKRÆND;                                     
         DETLIN1.TEKST = 'ANTAL FORKERT OPSAT               B.H99110D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.BERNEJJA + TV.EJBNEJJA;                     
         DETLIN1.TEKST = '      HERAF ÆNDRET FRA NEJ TIL JA';           
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.BERNEJJA;                                   
         DETLIN1.TEKST = '            HERAF BEREGNET';                  
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.EJBNEJJA;                                   
         DETLIN1.TEKST = '            HERAF IKKE BEREGNET';             
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.BERJANEJ + TV.EJBJANEJ;                     
         DETLIN1.TEKST = '      HERAF ÆNDRET FRA JA TIL NEJ';           
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.BERJANEJ;                                   
         DETLIN1.TEKST = '            HERAF BEREGNET';                  
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.EJBJANEJ;                                   
         DETLIN1.TEKST = '            HERAF IKKE BEREGNET';             
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
  END TOTALLISTE;                                                       
 /********************************************************************* 
 *       AFSLUT PROGRAM                                               * 
 *********************************************************************/ 
 AFSLUT:                                                                
 PROC;                                                                  
                                                                        
         CALL TOTALLISTE;                                               
                                                                        
         CALL ZZ20300((133)' ','99');                                   
                                                                        
         CLOSE FILE (BH950I),                                           
               FILE (BH9910O),                                          
               FILE (BH9911O);                                          
                                                                        
 END AFSLUT;                                                            
                                                                        
 END  BH99100;                                                          
                                                                        
