 PROCESS OPT(TIME);                                                     
 BE86010: /* OPSÆT TIL BEREGN AF EVS 2016 TIL SLUT */           /*RUL*/ 
 PROCEDURE (PTR1_INPUT, PTR2_INPUT, PTR3_INPUT, PTR4_INPUT,             
            PTR5_INPUT) REORDER;                                        
 /*********************************************************************/
 DCL COPYRIGHT CHAR (30) STATIC INIT ('COPYRIGHT KOMMUNEDATA I/S 2008');
 /********************************************************************/ 
 /*      PROGRAMMERET AF AAGE RASMUSSEN, PUS T&S DEC. 2000            */
 /*      ÅRSTILRETTET AF AAGE RASMUSSEN, LSU T&S DEC. 2001            */
 /*      ÅRSTILRETTET AF AAGE RASMUSSEN, LSU T&S NOV. 2002            */
 /*      ÅRSRULLET    AF AAGE RASMUSSEN, LSU T&S NOV. 2003            */
 /*      ÅRSRULLET    AF BO SCHMIDT    , LSU T&S NOV. 2004            */
 /* SLUT05    SUSANNE KROGH VILLUMSEN                  09-11-2005     */
 /*           TILRETTET SLUT 2005                                     */
 /* SLUT06    BO SCHMIDT                               04-10-2006     */
 /*           TILRETTET SLUT 2006                                     */
 /* SLUT07    INGRID FISCHER IFI                       14-11-2007     */
 /*           TILRETTET SLUT 2007                                     */
 /* SLUT08    BO SCHMIDT                               14-11-2008     */
 /*           TILRETTET SLUT 2008                                     */
 /* SLUT09    GERD HOLM-PEDERSEN                       08-10-2009     */
 /*           TILRETTET SLUT 2009                                     */
 /* SLUT10    GERD HOLM-PEDERSEN                       10-10-2010     */
 /*           TILRETTET SLUT 2010                                     */
 /* SLUT11    GERD HOLM-PEDERSEN                       20-10-2011     */
 /*           TILRETTET SLUT 2011                                     */
 /* SLUT12    LARS KAAE HARRITSHØJ                     SEP 2012       */
 /*           TILRETTET SLUT 2012                                     */
 /* SLUT13    JØRGEN SAUGMANN                          OKT 2013       */
 /*           TILRETTET SLUT 2013                                     */
 /* SLUT14    JØRGEN SAUGMANN                          OKT 2014       */
 /*           TILRETTET SLUT 2014                                     */
 /* SLUT15    Z6JNK                                    OKT 2015       */
 /*           Årsrul til EVS SLUT-15. (Søg efter 'RUL')               */
 /* SLUT16    Z8QEB                                    JUN 2016       */
 /*           Årsrul til EVS SLUT-16. (Søg efter 'RUL')               */
 /*           CSTOPÅR Udviddet med år 2014 og 2015                    */
 /*           Efter aftale med JAM                                    */
 /*           Regl 5 fra Workshop taget ud. Det var vist en gl.       */
 /*           nød rettelse                                            */
 /* SLUT16    Lene Maj Jensen QLE                      JUN 2016       */
 /*           Hårdkodet årstal fjernet.  Istedet benyttes INDKÅR1     */
 /*           eller glslutår fra BH65300M                             */
 /* DB2OMLÆG  Tilrettet så det kører med pointere til db2-strukturer  */
 /*           for de fire beregningsbånd db2-tabeller.                */
 /*                                                                   */
 /* SLUT17    Z8QEB                                    OKT 2017       */
 /*           Årsrul til EVS SLUT-17. (Søg efter 'RUL')               */
 /*                                                                   */
 /* SLUT18    Z6EBD                                    SEP 2018       */
 /*           Årsrul til EVS SLUT-18. (Søg efter 'RUL')               */
 /*           KS02-23 2familiehuse                                    */
 /* SLUT19    Z6EBD                                    JUN 2019       */
 /*           Årsrul til EVS SLUT-19. (Søg efter 'RUL')               */
 /*           2familie ændringer fra Forskud 2020                     */
 /* Forskud21 Z6PBR                                    Maj 2020       */
 /*           defect 96 (F2021). Nulstillinger                        */
 /* Slut2020    Per Brunk PBR KS2-45                     Nov 2020     */
 /*             skift fra BH65300M.INDKÅR1 til BH65300M.GLSLUTÅR1     */
 /* Slut2020    Ole Nielsen ONE KS2-34                   Nov 2020     */
 /*             Tilføjet fejlnr 5200 ej nulstilles                    */
 /* Slut2021  Z6SEP                                    MAJ 2021       */
 /*           Nyt felt DATA_ID oprettet efter AFVIKLINGS_ID           */
 /*           Definitionen af BH65300M er fjernet, BH55300M kommer nu */
 /*           fra input til program.                                  */
 /*           Z6EBD variabel vurderingsår              MAJ 2021       */
 /*           Rettelserne er markeret med ##                          */
 /* SLUT2021  Z6PBR                                    Maj 2021       */
 /*           Nye felter i BE78000T, D881                             */
 /*             Per Brunk PBR D1007                     Oktober 2021  */
 /*             Altid fejlnummer = 5001 ved cbenyt = 09               */
 /*           BQ20 -> BQ21                              Oktober 2021  */
 /* SLUT2022  Z6PBR                                                   */
 /*           BQ21 -> BQ22                              Oktober 2021  */
 /* SLUT2022  Z6JJJ                                                   */
 /*           Defect 90                                 Oktober 2022  */
 /* SLUT2022  Z6PBR                                                   */
 /*           (Defect 90) HENT_ADRESSE gav sqlcode -811 Januar 2023   */
 /* SLUT2024  Z6HNK                                                   */
 /*           Årsrul Tabeller BQ -> BE og BH -> BE      Oktober 2023  */
 /*           Z6MBS                                     Okt. 2023     */
 /*           Deaktivering af kontrol på koderne 5197                 */
 /* SLUT2024  Z6JJJ                                                   */
 /*           BE55600M erstatter BE55300M                  Juni 2024  */
 /* Defect 90 Z6ADH                                     06/12/2024    */
 /*********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /*********************************************************************/
 /*      DECLARE AF INPUT                                             */
 /*********************************************************************/
                                                                        
 DCL     PTR1_INPUT                 PTR;                                
 DCL     1 BE75_AREA        BASED     (PTR1_INPUT),                     
           %INCLUDE BE7500TN;;                                          
                                                                        
 DCL     PTR2_INPUT                 PTR;                                
 DCL     1 BE76_AREA        BASED     (PTR2_INPUT),                     
           %INCLUDE BE7600TN;;                                          
                                                                        
 DCL     PTR3_INPUT                 PTR;                                
 DCL     1 BE77_AREA        BASED     (PTR3_INPUT),                     
           %INCLUDE BE7700TN;;                                          
                                                                        
 DCL     PTR4_INPUT                 PTR;                                
 DCL     1 BE78_AREA        BASED     (PTR4_INPUT),                     
           %INCLUDE BE7800TN;;                                          
                                                                        
 DCL     PTR5_INPUT                 PTR;                                
 DCL     1 BE55600M         BASED     (PTR5_INPUT),                     
           %INCLUDE BE55600N;;                                          
                                                                        
  /* Nye til Forskud 2020 kode skal eventuelt flyttes til BH86000 */    
 DCL     ZS67000         ENTRY;                                         
 DCL     ZS30101         ENTRY;                                         
 EXEC SQL INCLUDE SQLCA;                                                
 EXEC SQL INCLUDE BE70000T;                                             
 EXEC SQL INCLUDE BE78000T;                                             
 /*********************************************************************/
 /*      DECLARE AF DIVERSE PARAMETRE TIL BEREGNING AF EVS            */
 /*********************************************************************/
                                                                        
 DCL     1 EVS_BER,                                                     
           %INCLUDE BE24907N;;                                   /*RUL*/
                                                                        
 /*********************************************************************/
 /*      DECLARE AF DIVERSE                                           */
 /*********************************************************************/
                                                                        
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
 DCL     ADRESSE_FUNDET  BIT       (1)     INIT ('0'B);                 
 DCL     I               BIN FIXED (15);                                
 DCL     HJVÆRDI         FIXED     (11);                                
 DCL     HJVÆRDI1        FIXED     (15,3);                              
 DCL     HJVÆRDI2        FIXED     (11);                                
 DCL     HJ_CSTOP_DATO_CH  CHAR    (8) BASED(ADDR(HJ_CSTOP_DATO_NUM));  
 DCL     HJ_CSTOP_DATO_NUM PIC    '(8)9';                               
 DCL     HJ_VEJKOD_CH    CHAR    (4) BASED(ADDR(HJ_VEJKOD_NUM));        
 DCL     HJ_VEJKOD_NUM   PIC    '(4)9';                                 
                                                                        
 DCL     HJ_ANVÆND_DATO  FIXED     (9);                                 
 DCL     GEM_CEJBEVS     CHAR      (1);                                 
 DCL     HJBEGRÆNSET_TP  CHAR      (1);                                 
                                                                        
 /*********************************************************************/
 /*                                                                   */
 /*      DECLARE AF ABEND STRUKTUR m.v.                               */
 /*                                                                   */
 /*********************************************************************/
 DCL     ABENDKODE     FIXED       (2) INIT(5);                         
 DCL     1 ABENDMEDD,                                                   
          2 ABENDMODUL CHAR      (7) INIT ('BE86010'),                  
          2 ABENDFILL1 CHAR      (1) INIT (' '),                        
          2 ABENDMEDNR CHAR      (2) INIT ('**'),                       
          2 ABENDFILL2 CHAR      (1) INIT (' '),                        
          2 ABENDTXT   CHAR      (45);                                  
                                                                        
 DCL     ABENDRTKODE   FIXED     (1) INIT (2);                          
                                                                        
 DCL     ADDR            BUILTIN;                                       
 DCL     SUBSTR          BUILTIN;                                       
 DCL     MULTIPLY        BUILTIN;                                       
 /*********************************************************************/
 /*      P R O C E S S                                                */
 /*********************************************************************/
                                                                        
                                                                        
         IF BE78_AREA.EKOMNR < 999 &                                    
            BE78_AREA.TILEVS_CINVPNR = '0'                              
         THEN                                                           
            DO;                                                         
               /* hvis cstopår ligger før indkomstår    */              
               /* benyttes cstopår                      */              
               IF BE78_AREA.EJENDOM_CSTOPÅR > '2001' &                  
                  BE78_AREA.EJENDOM_CSTOPÅR < BE55600M.INDKÅR1          
               THEN                                                     
                 DO;                                                    
                   HJ_CSTOP_DATO_CH = BE78_AREA.EJENDOM_CSTOPÅR !!      
                                            '1001';                     
                   HJ_ANVÆND_DATO = HJ_CSTOP_DATO_NUM;                  
                 END;                                                   
               ELSE                                                     
                 DO;  /* ellers benyttes gammelt slutår */              
                   HJ_CSTOP_DATO_CH = BE55600M.GLSLUTÅR1 !! '1001';     
                   HJ_ANVÆND_DATO = HJ_CSTOP_DATO_NUM;                  
                 END;                                                   
                                                                        
            END;                                                        
                                                                        
         IF BE78_AREA.EKOMNR < 999 &                                    
            BE78_AREA.VURD_A_CBENYT_AKT ^= '  '                         
         THEN                                                           
            DO;                                                         
               BE78_AREA.EJENDOM_BEJDVÆR =                              
               BE78_AREA.VURD_A_BEJDVÆR_AKT;                            
               BE78_AREA.EJENDOM_BEJDVÆR_SW =                           
               BE78_AREA.VURD_A_BEJDVÆR_A_SW;                           
               BE78_AREA.EJENDOM_BEJBOL1 =                              
               BE78_AREA.VURD_A_BEJBOL1_AKT;                            
               BE78_AREA.EJENDOM_BEJBOL1_SW =                           
               BE78_AREA.VURD_A_BEJBOL1_A_SW;                           
               BE78_AREA.EJENDOM_CEJBOLTYP1 =                           
               BE78_AREA.VURD_A_CEJBOLTYP1_AKT;                         
               BE78_AREA.EJENDOM_BEJBOL2 =                              
               BE78_AREA.VURD_A_BEJBOL2_AKT;                            
               BE78_AREA.EJENDOM_BEJBOL2_SW =                           
               BE78_AREA.VURD_A_BEJBOL2_A_SW;                           
               BE78_AREA.EJENDOM_CEJBOLTYP2 =                           
               BE78_AREA.VURD_A_CEJBOLTYP2_AKT;                         
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      OPSÆTNING AF BEREGNINGSGRUNDLAG FOR AKTUEL EJER              */
 /*********************************************************************/
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (DCLBE78000T.VURD_A_BBERGRL_A_SW = 0)                   
             DO;                                                        
                BE78_AREA.EJERSKAB_BBERGRL =                            
                BE78_AREA.VURD_A_BBERGRL_AKT;                           
                BE78_AREA.EJERSKAB_BBERGRL_SW = 0;                      
                BE78_AREA.EJERSKAB_BBER2FAM =                           
                BE78_AREA.VURD_A_BBER2FAM_AKT;                          
                BE78_AREA.EJERSKAB_BBER2FAM_SW =                        
                BE78_AREA.VURD_A_BBER2FAM_A_SW;                         
                BE78_AREA.EJERSKAB_BEJBOLANV =                          
                BE78_AREA.VURD_A_BEJBOLANV_AKT;                         
                BE78_AREA.EJERSKAB_BEJBOLANV_SW =                       
                BE78_AREA.VURD_A_BEJBOLANV_A_SW;                        
                BE78_AREA.EJERSKAB_CANVEBOL =                           
                BE78_AREA.VURD_A_CANVEBOL_AKT;                          
                BE78_AREA.EJERSKAB_CBERGROP = 'I';                      
                BE78_AREA.EJERSKAB_VURMARK =                            
                BE78_AREA.VURD_A_VURMARK_AKT;                           
                BE78_AREA.EJERSKAB_JUR_KATEGO  =                        
                BE78_AREA.VURD_A_JUR_KATEGO ;                           
                BE78_AREA.EJERSKAB_JUR_UKATEGO =                        
                BE78_AREA.VURD_A_JUR_UKATEGO;                           
                BE78_AREA.EJERSKAB_JUR_VURDATO =                        
                BE78_AREA.VURD_A_VURDATO    ;                           
                BE78_AREA.EJERSKAB_FORSIGT_EVS =                        
                BE78_AREA.VURD_A_FORSIGT_EVS;                           
                BE78_AREA.EJERSKAB_BESKAT      =                        
                BE78_AREA.VURD_A_BESKAT_EVS ;                           
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
             END;                                                       
         END;  /* SELECT */                                             
                                                                        
  /* Forskud 2025 US1641246 ÆA53 JXT/MBS                   16.01.2024 */
  /*    Nye felter BE770: EVSFEJ_COPR_DOVTG EVSFÆG_COPR_DOVTG         */
  /*                      RABATEJERANDEL COPR_RABATEJERANDEL          */
  /* Kode for beregningsgrundlagoprindelse er fjernet fra struktur og   
     derfor fjernes dette statement                                     
         BE78_AREA.EJERSKAB_CBERGRGLOP = ' '; */                        
                                                                        
         GEM_CEJBEVS = BE78_AREA.TILEVS_CEJBEVS;                        
                                                                        
         // D92 hvis fejlnr=5193 må det ikke ændres                     
         IF BE78_AREA.FEJLNR = 5193                                     
         THEN;                                                          
         ELSE DO;                                                       
              /* fejlnummer som opsat i BH84400 til 2 familiehuse */    
              /* de skal ikke ændres                              */    
                                                                        
              /*PUT SKIP LIST('BE78_AREA.FEJLNR =',BE78_AREA.FEJLNR);*/ 
                                                                        
              IF(/*BE78_AREA.FEJLNR = 5185 ! Fjern kontrol på 5185 */   
                 BE78_AREA.FEJLNR = 5186 !                              
                 BE78_AREA.FEJLNR = 5187 !                              
                 BE78_AREA.FEJLNR = 5007) &                             
                 BE78_AREA.EENHEDLBNR > 0                               
              THEN    /*2familie fejlnr indtil videre samme behandling*/
                DO;                                                     
                  CALL OPSÆT_FEJLNR; /*SAMT CEJBEVS OG CBERGRL*/        
                  BE78_AREA.EJENDOM_EJD_FEJLNR = BE78_AREA.FEJLNR;      
                  /*SAMT CEJBEVS OG CBERGRL*/                           
                  CALL OPSÆT_PERSONLIGE_FEJLNR;                         
                END;                                                    
              ELSE    /* normal behandling */                           
                DO;                                                     
                  CALL OPSÆT_FEJLNR; /*SAMT CEJBEVS OG CBERGRL*/        
                  BE78_AREA.EJENDOM_EJD_FEJLNR = BE78_AREA.FEJLNR;      
                  /*SAMT CEJBEVS OG CBERGRL*/                           
                  CALL OPSÆT_PERSONLIGE_FEJLNR;                         
                END;                                                    
         END; // D92                                                    
                                                                        
        /* CEJBEVS lig  C og B skal ikke have nulstillet fejlnummer */  
        /* eller sat værdi tilbage fra GEM_CEJBEVS                  */  
                                                                        
     /*    IF GEM_CEJBEVS = '7' !    7,8,9,C rettelse                   
            GEM_CEJBEVS = '8' !                                         
            GEM_CEJBEVS = '9'                                           
         THEN                                                           
            DO;                                                         
              BE78_AREA.TILEVS_CEJBEVS = GEM_CEJBEVS;                   
                                                                        
              IF BE76_AREA.CCIVS ^= 'D'                                 
              THEN                                                      
                CEJBEVS 7,8 OG 9 SKAL BEVARES  U D E N  FEJLNR.         
               BE78_AREA.FEJLNR = 0;                                    
            END;                                                        
     */                                                                 
                                                                        
         IF BE78_AREA.TILEVS_C5060 = '5060' &                           
         (((BE78_AREA.TILEVS_A_V_CBENYT = '03' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '04' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '23' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '24' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '31' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '33' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '43' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '44' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '49') &                       
            BE78_AREA.FEJLNR = 5001) !                                  
   /*       ((BE78_AREA.TILEVS_A_V_CBENYT = '09' ! Fjernet D1007     */ 
            ((BE78_AREA.TILEVS_A_V_CBENYT = '17' !                      
            BE78_AREA.TILEVS_A_V_CBENYT = '98') &                       
            BE78_AREA.TILEVS_A_V_CVURDOPR = '1' &                       
            BE78_AREA.FEJLNR = 5001) !                                  
           (BE78_AREA.TILEVS_A_V_CBENYT = '45' &                        
            BE78_AREA.FEJLNR = 5006) !                                  
          ((BE78_AREA.TILEVS_A_V_CBENYT = '06' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '07' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '13' !                        
            BE78_AREA.TILEVS_A_V_CBENYT = '34') &                       
            BE78_AREA.FEJLNR = 5008))                                   
         THEN                                                           
            BE78_AREA.FEJLNR = 5060; /* KRAVSPEC. 18-01-05 SLUT 2003 */ 
                                                                        
      /*   IF BE78_AREA.TILEVS_CEJBEVS = '7' !  7,8,9,C pilles ud  IF   
            BE78_AREA.TILEVS_CEJBEVS = '8' !                            
            BE78_AREA.TILEVS_CEJBEVS = '9' !                            
            BE78_AREA.TILEVS_CEJBEVS = 'B' !   KS 02-23                 
            BE78_AREA.TILEVS_CEJBEVS = 'C'     KS 02-23                 
      */                                                                
         IF BE78_AREA.TILEVS_CEJBEVS = 'B'   /* 7,8,9,C pilles ud  IF */
         THEN;                                                          
         ELSE                                                           
            IF BE78_AREA.FEJLNR = 0              /* DENNE EJENDOM KAN */
            THEN                             /* ÅBENBART BEREGNES */    
               BE78_AREA.TILEVS_CEJBEVS = '0';                          
            ELSE                                                        
              IF BE78_AREA.EKOMNR < 999 &                               
                 BE78_AREA.TILEVS_CINVPNR = '0' &                       
                 BE78_AREA.TILEVS_A_EJ_DCPRCIR > 0 &                    
                 BE77_AREA.EVSSEJ_DCPRN > 0 &                           
                 BE77_AREA.EVSSEJ_SID_CSLET < '1' &                     
                 BE77_AREA.EVSSEJ_SID_DAFSTAA = 0 &                     
                 BE77_AREA.EVSSEJ_SID_DFRAFLYT = 0 &                    
                (BE77_AREA.EVSSEJ_SID_CEJBEVS = '0' !                   
                 BE77_AREA.EVSSEJ_SID_CEJBEVS = '4' !                   
                 BE77_AREA.EVSSEJ_SID_CEJBEVS = '5' !                   
                 BE77_AREA.EVSSEJ_SID_CEJBEVS = '6') &                  
                 BE78_AREA.TILEVS_CÆGTOPR < '1'                         
              THEN                           /* KAN MÅSKE BEREGNES */   
                 DO;                                                    
                   IF BE78_AREA.FEJLNR = 5001 !                         
                      BE78_AREA.FEJLNR = 5002 !                         
                      BE78_AREA.FEJLNR = 5003 !                         
                      BE78_AREA.FEJLNR = 5004 !                         
                      BE78_AREA.FEJLNR = 5017 !                         
                      BE78_AREA.FEJLNR = 5020 !                         
                      BE78_AREA.FEJLNR = 5024 !                         
                      BE78_AREA.FEJLNR = 5025 !                         
                      BE78_AREA.FEJLNR = 5059 !                         
                      BE78_AREA.FEJLNR = 5060 !                         
                      BE78_AREA.FEJLNR = 5155 !                         
                      BE78_AREA.FEJLNR = 5164 ! /* SLUT 20*/            
                      BE78_AREA.FEJLNR = 5180 !                         
                      BE78_AREA.FEJLNR = 5181 !                         
                      BE78_AREA.FEJLNR = 5184 !                         
                      /*BQ78_AREA.FEJLNR = 5185 ! Fjern check på 5185   
                                                KS02-23*/               
                      BE78_AREA.FEJLNR = 5186 !   /* KS02-23*/          
                      BE78_AREA.FEJLNR = 5187 !   /* KS02-23*/          
                      BE78_AREA.FEJLNR = 5189 !   /* KS02-34*/          
                      BE78_AREA.FEJLNR = 5195 !   /* KS02-34*/          
                      BE78_AREA.FEJLNR = 5196 !   /* KS02-34*/          
                    /*BQ78_AREA.FEJLNR = 5197 ! Fjern check på 5197     
                                                     KS02-34*/          
                      BE78_AREA.FEJLNR = 5198 !   /* KS02-34*/          
                      BE78_AREA.FEJLNR = 5200 !    /*  SLUT 20 */       
                      BE78_AREA.FEJLNR = 5204 !   /* SLUT 20 D735 */    
                      BE78_AREA.FEJLNR = 5206 !   /* SLUT 20 */         
                      BE78_AREA.EJERSKAB_BBERGRL_SW = -1 !              
                    ((BE78_AREA.EJENDOM_CEJDTYPE = '4' !                
                      BE78_AREA.EJENDOM_CEJDTYPE = '5') &               
                      BE78_AREA.EJERSKAB_BBER2FAM_SW = -1)              
                   THEN;                                                
                   ELSE                                                 
                      DO;                                               
                         IF BE78_AREA.SORT_CITYP = 0                    
                         THEN                                           
                           BE78_AREA.TILEVS_CDATAFRA = ' ';             
                         ELSE                                           
                           DO;                                          
                             IF BE77_AREA.EVSSEJ_SID_CDATAFRA = '1'     
                             THEN                                       
                               BE78_AREA.TILEVS_CDATAFRA = '5';         
                             ELSE                                       
                               BE78_AREA.TILEVS_CDATAFRA = '1';         
                           END;                                         
                         BE78_AREA.TILEVS_CEJBEVS = '0';                
                         BE78_AREA.FEJLNR = 0;                          
                      END;                                              
                 END;                                                   
                                                                        
         IF BE78_AREA.TILEVS_C5060 = '5060' &                           
            BE76_AREA.CCIVS  ^= 'D' &                                   
            BE78_AREA.TILEVS_A_EJ_DCPRCIR > 0 &                         
            BE77_AREA.EVSSEJ_DCPRN > 0 &                                
            BE77_AREA.EVSSÆG_DCPRN = 0 &                                
            BE75_AREA.EJER_DCPRCIR = 0 &                                
            BE75_AREA.ÆGTE_DCPRCIR > 0 &                                
            BE75_AREA.ÆGTE_FEJER = 1 &                                  
            BE75_AREA.ÆGTE_DOVTG >= BE76_AREA.DRGNÅRFRA &               
            BE77_AREA.EVSSEJ_SID_GPCTEJER = 100 &                       
            BE75_AREA.ÆGTE_GANE = 10000                                 
         THEN                                                           
            DO;                                                         
               BE78_AREA.FEJLNR = 5060;                                 
               BE78_AREA.TILEVS_CEJBEVS = '1';                          
            END;                                                        
                                                                        
         IF BE78_AREA.EKOMNR < 999 &                                    
            BE78_AREA.TILEVS_CEJBEVS = '0' &                            
            BE78_AREA.FEJLNR = 0 &                                      
            BE78_AREA.TILEVS_A_EJ_DCPRCIR > 0  &                        
            BE78_AREA.TILEVS_CINVPNR = '0'                              
         THEN                                                           
            DO;                                                         
               CALL UDFØR_KONTROLLER(BE78_AREA.TILEVS_FEJLTAB1,         
                                     BE78_AREA.TILEVS_FEJLTAB2,         
                                     BE78_AREA.TILEVS_FEJLTAB3,         
                                     BE78_AREA.TILEVS_FEJLTAB4,         
                                     BE78_AREA.TILEVS_FEJLTAB5,         
                                     BE78_AREA.TILEVS_FEJLTAB6,         
                                     BE78_AREA.TILEVS_FEJLTAB7,         
                                     BE78_AREA.TILEVS_FEJLTAB8,         
                                     BE78_AREA.TILEVS_FEJLTAB9,         
                                     BE78_AREA.TILEVS_FEJLTAB10,        
                                     BE78_AREA.TILEVS_FEJLTAB11,        
                                     BE78_AREA.TILEVS_FEJLTAB12);       
                                                                        
               BE78_AREA.FEJLNR = BE78_AREA.TILEVS_FEJLTAB1;            
                                                                        
               IF BE78_AREA.FEJLNR > 0                                  
               THEN                                                     
                  BE78_AREA.TILEVS_CEJBEVS = '3';                       
               ELSE                                                     
                  DO;                                                   
                     CALL FLYT_TILEVS_TIL_EVSBERTIL;                    
                     CALL FLYT_EJERSKAB_TIL_EVSBERTIL;                  
                     CALL BEREGN_EVS_KMD_DEL(EVS_BER);                  
                     CALL FLYT_EVSBERFRA_TIL_TILEVS;                    
                     CALL FLYT_EVSBERFRA_TIL_FRAEVS;                    
                  END;                                                  
            END;                                                        
                                                                        
      /* Sæt TILEVS_CEJBEVS tilbage til 7,8,9,C fra gemt_cermbevs.      
         Udskrivning af optællingerne sker i BH86024, sæt BNETTO = 0 */ 
      SELECT (GEM_CEJBEVS);                                             
        WHEN ('7','8','9','C')                                          
         DO;                                                            
           BE55600M.ANTAL789C = 1;                                      
                                                                        
           SELECT (GEM_CEJBEVS);                                        
             WHEN ('7')                                                 
              do;                                                       
                IF BE78_AREA.FEJLNR = 0 THEN                            
                  BE55600M.CEJBEVS7 = 1;                                
                ELSE                                                    
                  BE55600M.CEJBEVS7_FEJL = 1;                           
              end;                                                      
             WHEN ('8')                                                 
              do;                                                       
                IF BE78_AREA.FEJLNR = 0 THEN                            
                  BE55600M.CEJBEVS8 = 1;                                
                ELSE                                                    
                  BE55600M.CEJBEVS8_FEJL = 1;                           
              end;                                                      
             WHEN ('9')                                                 
              do;                                                       
                IF BE78_AREA.FEJLNR = 0 THEN                            
                  BE55600M.CEJBEVS9 = 1;                                
                ELSE                                                    
                  BE55600M.CEJBEVS9_FEJL = 1;                           
              end;                                                      
             WHEN ('C')                                                 
              do;                                                       
                IF BE78_AREA.FEJLNR = 0 THEN                            
                  BE55600M.CEJBEVSC = 1;                                
                ELSE                                                    
                  BE55600M.CEJBEVSC_FEJL = 1;                           
              end;                                                      
             OTHERWISE ;                                                
           END;                                                         
                                                                        
           BE78_AREA.TILEVS_CEJBEVS = GEM_CEJBEVS;                      
           BE78_AREA.RES_BNETTO_EVS_EJERREL = 0;                        
        //   BE78_AREA.FRA_EVS_SLUT_BER_BNETTO_SW = -1;                 
         END;                                                           
        OTHERWISE ;                                                     
      END;                                                              
 /*********************************************************************/
 /* FLYT FELTER FRA EVS_BER.FRA  til  BE78.TIL_EVS                    */
 /*********************************************************************/
 FLYT_EVSBERFRA_TIL_TILEVS: PROC;                                       
                                                                        
      BE78_AREA.TILEVS_CNEDSL2       = '';                              
                                                                        
 END FLYT_EVSBERFRA_TIL_TILEVS;                                         
 /*********************************************************************/
 /* FLYT FELTER FRA EVS_BER.FRA  til  BE78.FRA_EVS                    */
 /*********************************************************************/
 FLYT_EVSBERFRA_TIL_FRAEVS: PROC;                                       
                                                                        
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM1 = EVS_BER.FRA.BGRPROM1;       
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM1_SW = EVS_BER.FRA.BGRPROM1_SW; 
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM2 = EVS_BER.FRA.BGRPROM2;       
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM2_SW = EVS_BER.FRA.BGRPROM2_SW; 
      BE78_AREA.FRA_EVS_SLUT_BER_BNEDSL1 = EVS_BER.FRA.BNEDSL1;         
      BE78_AREA.FRA_EVS_SLUT_BER_BNEDSL1_SW = EVS_BER.FRA.BNEDSL1_SW;   
      BE78_AREA.FRA_EVS_SLUT_BER_BNEDSL2 = EVS_BER.FRA.BNEDSL2;         
      BE78_AREA.FRA_EVS_SLUT_BER_BNEDSL2_SW = EVS_BER.FRA.BNEDSL2_SW;   
      BE78_AREA.FRA_EVS_SLUT_BER_BPENSNED = EVS_BER.FRA.BPENSNED;       
      BE78_AREA.FRA_EVS_SLUT_BER_BPENSNED_SW = EVS_BER.FRA.BPENSNED_SW; 
      BE78_AREA.FRA_EVS_SLUT_BER_BPENSNÆ = EVS_BER.FRA.BPENSNÆ;         
      BE78_AREA.FRA_EVS_SLUT_BER_BPENSNÆ_SW = EVS_BER.FRA.BPENSNÆ_SW;   
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM1 = EVS_BER.FRA.BGRPROM1;       
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM1_SW = EVS_BER.FRA.BGRPROM1_SW; 
      BE78_AREA.FRA_EVS_SLUT_BER_BPROM1 = EVS_BER.FRA.BPROM1;           
      BE78_AREA.FRA_EVS_SLUT_BER_BPROM1_SW = EVS_BER.FRA.BPROM1_SW;     
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM2    = EVS_BER.FRA.BGRPROM2;    
      BE78_AREA.FRA_EVS_SLUT_BER_BGRPROM2_SW = EVS_BER.FRA.BGRPROM2_SW; 
      BE78_AREA.FRA_EVS_SLUT_BER_BPROM2      = EVS_BER.FRA.BPROM2;      
      BE78_AREA.FRA_EVS_SLUT_BER_BPROM2_SW   = EVS_BER.FRA.BPROM2_SW;   
      BE78_AREA.FRA_EVS_SLUT_BER_BSUM1 = EVS_BER.FRA.BSUM1;             
      BE78_AREA.FRA_EVS_SLUT_BER_BSUM1_SW = EVS_BER.FRA.BSUM1_SW;       
      BE78_AREA.FRA_EVS_SLUT_BER_BSUM2 = EVS_BER.FRA.BSUM2;             
      BE78_AREA.FRA_EVS_SLUT_BER_BSUM2_SW = EVS_BER.FRA.BSUM2_SW;       
      BE78_AREA.FRA_EVS_SLUT_BER_BSUM3 = EVS_BER.FRA.BSUM3;             
      BE78_AREA.FRA_EVS_SLUT_BER_BSUM3_SW = EVS_BER.FRA.BSUM3_SW;       
      BE78_AREA.FRA_EVS_SLUT_BER_CNEDSL2 = EVS_BER.FRA.CNEDSL2;         
      BE78_AREA.TILEVS_BTAKS           = EVS_BER.FRA.BTAKS;             
      BE78_AREA.TILEVS_BTAKSRABAT      = EVS_BER.FRA.BTAKSRABAT;        
      BE78_AREA.TILEVS_BTAKSEFTERRABAT = EVS_BER.FRA.BTAKSEFTRABAT;     
                                                                        
 END FLYT_EVSBERFRA_TIL_FRAEVS;                                         
 /*********************************************************************/
 /* Slå sammen til 1 proc                                             */
 /* FLYT FELTER FRA BE78.TIL_EVS  til  EVS_BER.TIL                    */
 /*********************************************************************/
 FLYT_TILEVS_TIL_EVSBERTIL: PROC;                                       
                                                                        
      EVS_BER = '';                                                     
                                                                        
      EVS_BER.TIL.BBER2FAM = BE78_AREA.TILEVS_BBER2FAM;                 
      EVS_BER.TIL.BBER2FAM_SW = BE78_AREA.TILEVS_BBER2FAM_SW;           
      EVS_BER.TIL.BBERGRL = BE78_AREA.TILEVS_BBERGRL;                   
      EVS_BER.TIL.BBERGRL_SW = BE78_AREA.TILEVS_BBERGRL_SW;             
      EVS_BER.TIL.CNEDSL1 = BE78_AREA.TILEVS_CNEDSL1;                   
      EVS_BER.TIL.CPTYPSLUT = BE78_AREA.TILEVS_CPTYPSLUT;               
      EVS_BER.TIL.FELT759 = BE78_AREA.TILEVS_FELT759;                   
      EVS_BER.TIL.FELT760 = BE78_AREA.TILEVS_CFRED;                     
      EVS_BER.TIL.CEJDTYPE_AKT = BE78_AREA.EJERSKAB_CEJDTYPE_AKT;       
      EVS_BER.TIL.CEJBEVS      =  BE78_AREA.TILEVS_CEJBEVS;             
      EVS_BER.TIL.CEJBEVS_ANDEN_ENHED = HENT_CEJBEVS_ANDEN_ENHED;       
      EVS_BER.TIL.GPCTEJER = BE78_AREA.TILEVS_GPCTEJER;                 
      EVS_BER.TIL.BASISRABAT = BE78_AREA.R24_BASISRABAT;                
                                                                        
 END FLYT_TILEVS_TIL_EVSBERTIL;                                         
 /*********************************************************************/
 /* FLYT FELTER FRA BE78.EJERSKAB  til  EVS_BER.TIL                   */
 /*********************************************************************/
 FLYT_EJERSKAB_TIL_EVSBERTIL: PROC;                                     
                                                                        
      EVS_BER.TIL.BBER2FAM = BE78_AREA.EJERSKAB_BBER2FAM;               
      EVS_BER.TIL.BBER2FAM_SW = BE78_AREA.EJERSKAB_BBER2FAM_SW;         
      EVS_BER.TIL.BBERGRL = BE78_AREA.EJERSKAB_BBERGRL;                 
      EVS_BER.TIL.BBERGRL_SW = BE78_AREA.EJERSKAB_BBERGRL_SW;           
      EVS_BER.TIL.CEJDTYPE_AKT = BE78_AREA.EJERSKAB_CEJDTYPE_AKT;       
                                                                        
 END FLYT_EJERSKAB_TIL_EVSBERTIL;                                       
 /********************************************************************/ 
 /* HENT BEREGNINGSKODE PÅ ANDEN ENHED FOR EJER AF 2FAMILIHUS        */ 
 /* FOR PERIODEN (ANGIVET VED SORTDATO)                              */ 
 /********************************************************************/ 
 HENT_CEJBEVS_ANDEN_ENHED:PROC RETURNS(CHAR(1));                        
                                                                        
   DCL HJCEJBEVS_ANDEN_ENHED CHAR(1);                                   
                                                                        
   HJCEJBEVS_ANDEN_ENHED = ' ';                                         
                                                                        
   EXEC SQL                                                             
      SELECT                                                            
          TILEVS_CEJBEVS                                                
        INTO                                                            
          :HJCEJBEVS_ANDEN_ENHED                                        
                                                                        
      FROM BE78000T                                                     
      WHERE TIL_EVS_AAR     = :BE78_AREA.TIL_EVS_AAR                    
        AND   DCPRN         = :BE78_AREA.DCPRN                          
        AND   AFVIKLINGS_ID = :BE78_AREA.AFVIKLINGS_ID                  
        AND   DATA_ID       = :BE78_AREA.DATA_ID                        
        AND   EKOMNR        = :BE78_AREA.EKOMNR                         
        AND   EEJDNR        = :BE78_AREA.EEJDNR                         
        AND   EENHEDLBNR    <> :BE78_AREA.EENHEDLBNR                    
        AND   SORT_DATO     = :BE78_AREA.SORT_DATO;                     
                                                                        
      SELECT(SQLCA.SQLCODE);                                            
         WHEN(0)                                                        
           DO;                                                          
           END;                                                         
         WHEN(100)                                                      
           DO;                                                          
           END;                                                         
         WHEN(-811)                                                     
           DO;                                                          
             PUT SKIP LIST('FOR MANGE RESULTATER');                     
           END;                                                         
         OTHERWISE DO;                                                  
           ABENDTXT = '101 SELECT ANDEN ENHED BE78000T';                
           CALL SQL_FEJL;                                               
         END;                                                           
      END;                                                              
                                                                        
   RETURN(HJCEJBEVS_ANDEN_ENHED);                                       
                                                                        
 END HENT_CEJBEVS_ANDEN_ENHED;                                          
 /*********************************************************************/
 /* HENT ADRESSE TIL KONTROL AF FRAFLYTNING                    RUTINE */
 /*********************************************************************/
 HENT_ADRESSE: PROC;                                                    
                                                                        
  DCLBE70000T = '';                                                     
                                                                        
  EXEC SQL                                                              
     SELECT C.VEJKOD,                                                   
            C.HUSNR,                                                    
            C.HUSBOGSTAADR,                                             
            C.ETAGENR,                                                  
            C.SIDEDOERNR,                                               
            C.ADRFRADTO,                                                
            C.TIL_EVS_AAR                                               
       INTO :DCLBE70000T.VEJKOD,                                        
            :DCLBE70000T.HUSNR,                                         
            :DCLBE70000T.HUSBOGSTAADR,                                  
            :DCLBE70000T.ETAGENR,                                       
            :DCLBE70000T.SIDEDOERNR,                                    
            :DCLBE70000T.ADRFRADTO,                                     
            :DCLBE70000T.TIL_EVS_AAR                                    
       FROM BE78000T A,                                                 
            BE70000T C                                                  
      WHERE A.DCPRN = C.PNR                                             
        AND A.TIL_EVS_AAR = C.TIL_EVS_AAR                               
        AND A.AFVIKLINGS_ID = C.AFVIKLINGS_ID                           
        AND A.DCPRN > 99999999                                          
        AND A.TILEVS_CDATAFRA > '0'                                     
        AND EXISTS (SELECT 'A' FROM BE78000T B                          
                     WHERE B.AFVIKLINGS_ID = A.AFVIKLINGS_ID            
                       AND B.DATA_ID = A.DATA_ID                        
                       AND B.TILEVS_A_EJ_CEJFORH IN ('40', '41')        
                       AND B.TILEVS_CINVPNR > '0'                       
                       AND B.EKOMNR = A.EKOMNR                          
                       AND B.TIL_EVS_AAR = A.TIL_EVS_AAR                
                       AND B.EEJDNR = A.EEJDNR                          
                       AND B.DCPRN <= 99999999)                         
        AND A.DCPRN         = :BE78_AREA.DCPRN                          
        AND A.EKOMNR        = :BE78_AREA.EKOMNR                         
        AND A.EEJDNR        = :BE78_AREA.EEJDNR                         
        AND A.AFVIKLINGS_ID = :BE78_AREA.AFVIKLINGS_ID                  
        AND A.DATA_ID       = :BE78_AREA.DATA_ID                        
        AND A.TIL_EVS_AAR   = :BE78_AREA.TIL_EVS_AAR  /*EBD 15/1-2023*/ 
        AND A.EENHEDLBNR    = :BE78_AREA.EENHEDLBNR   /*PBR 16/1-2023*/ 
        FETCH FIRST 1 ROW ONLY;                       /*PBR 16/1-2023*/ 
                                                                        
    SELECT(SQLCA.SQLCODE);                                              
       WHEN(0) DO;                                                      
          ADRESSE_FUNDET = JA;                                          
       END;                                                             
       WHEN(100) DO;                                                    
          ADRESSE_FUNDET = NEJ;                                         
       END;                                                             
       WHEN(-811) DO;     /* EBD ekstra hack pga nedbrud */             
          ADRESSE_FUNDET = NEJ;                                         
          PUT SKIP LIST ('BE78_AREA.DCPRN',BE78_AREA.DCPRN);            
          PUT SKIP LIST ('BE86010 HACK SQLCODE: ' !! SQLCA.SQLCODE);    
       END;                                                             
       OTHERWISE DO;                                                    
          ABENDTXT = '101 SELECT BE70000T';                             
          CALL SQL_FEJL;                                                
       END;                                                             
    END;                                                                
                                                                        
 END HENT_ADRESSE;                                                      
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED SQLCODE: ' !! SQLCA.SQLCODE);  
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
                                                                        
         CALL ZS67000(SQLCA);                                           
                                                                        
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /* HER UDSKRIVES ØVRIGE FEJL                                  RUTINE */
 /*********************************************************************/
 PROGRAM_FEJL: PROC;                                                    
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED PROGRAMFEJL');                 
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END PROGRAM_FEJL;                                                      
 /*********************************************************************/
                                                                        
         %INCLUDE BE86071M; /* OPSÆT GENERELLE FEJLNR M.V. */           
         %INCLUDE BE86072M; /* OPSÆT PERSONLIGE FEJLNR M.V. */          
         %INCLUDE BE86005M; /* UDFØR DIVERSE KONTROLLER */              
         %INCLUDE BE24907M; /* BEREGN EVS SLUT KMDS DEL */      /*RUL*/ 
                                                                        
 END BE86010;                                                           
