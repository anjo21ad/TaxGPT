  PROCESS OPT(TIME);                                                    
 BH97500: /* DAN EJENDOMS ESR UDTRÆK */                                 
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /**********************************************************************
 *                                                                     *
 * FORMÅL : DAN EJENDOMS ESR UDTRÆK                                    *
 *                                                                     *
 * INPUT  : C.N57010D - UDTRÆK FRA ESR                                 *
 *                                                                     *
 * OUTPUT : B.H97500D - EJENDOMS ESR UDTRÆK                            *
 *          BH97501Y   KØRSELSKONTROLLISTE                            * 
 *                                                                     *
 * PROGRAMMØR: BO SCHMIDT      MARTS     2005                          *
 *                                                                     *
 **********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
                                                                        
         DCL COPYRIGHT   CHAR      (30) STATIC                          
         INIT ('COPYRIGHT KOMMUNEDATA A/S 2004');                       
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
 DCL     SYSPRINT EXTERNAL FILE PRINT;                                  
 DCL     CN570I  FILE RECORD INPUT;     /* ESR UDTRÆK */                
 DCL     BH975O  FILE RECORD OUTPUT;    /* EJENDOMS ESR UDTRÆK */       
 /********************************************************************* 
 *       DECLARE AF ESR UDTRÆK INPUT                                  * 
 *********************************************************************/ 
 DCL     CN570_AR        CHAR      (2000) VAR;                          
 DCL     1 CN570         BASED     (ADDR(CN570_AR)),                    
           4 LÆNGDE BIN FIXED (15),                                     
           %INCLUDE BH31800N;                                           
 /********************************************************************* 
 *       DECLARE AF BUILTIN'S                                         * 
 *********************************************************************/ 
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     SUBSTR          BUILTIN;                                       
 /********************************************************************* 
 *       DECLARE AF ENTRY'S                                           * 
 *********************************************************************/ 
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    LIN_DEB          CHAR      (133);                               
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH97500L'),                                        
           2 F1          CHAR      (25)      INIT      (' '),           
           2 TEKST2      CHAR      (57)      INIT      (                
           'DAN EJENDOMS ESR UDTRÆK                     '),             
           2 F2          CHAR      (12)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZZ',                       
           2 F2          CHAR      (61)      INIT      (' ');           
         % INCLUDE ZZ20301M;                                            
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     EOF_CN570       BIT       (1);                                 
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
                                                                        
 DCL     ANTAL_CN570     BIN FIXED (31) INIT(0);                        
 DCL     ANTAL_BH975     BIN FIXED (31) INIT(0);                        
                                                                        
 DCL     GEM_EKOMNR      DEC FIXED (3);                                 
 DCL     GEM_EEJDNR      DEC FIXED (7);                                 
                                                                        
 DCL     UDDATO          CHAR      (10);                                
 DCL     DATO1           CHAR      (26);                                
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
                                                                        
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
                                                                        
         EOF_CN570 = NEJ;                                               
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
               CALL PLIDUMP  ('SNHOB','MODUL BH97500');                 
            END;                                                        
                                                                        
         ON ENDFILE (CN570I)                                            
            EOF_CN570 = JA;                                             
                                                                        
         OPEN FILE (CN570I) TITLE ('CN57010I'),                         
              FILE (BH975O) TITLE ('BH97500O');                         
                                                                        
         CALL ZZ20390 ('*OPEN','BH97501Y');                             
         DATO1 = '';                                                    
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         OVERLIN1.DATO  = UDDATO;                                       
                                                                        
         SIDELIN.CCA    = ZZIK1;                                        
         OVERLIN1.CCA   = ZZWS2;                                        
         OVERLIN2.CCA   = ZZWS3;                                        
         DETLIN1 = '';                                                  
                                                                        
         GEM_EKOMNR = 0;                                                
         GEM_EEJDNR = 0;                                                
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
                                                                        
         READ FILE (CN570I) INTO (CN570_AR);                            
         IF EOF_CN570 = NEJ                                             
         THEN                                                           
            ANTAL_CN570 = ANTAL_CN570 + 1;                              
                                                                        
         DO WHILE (EOF_CN570 = NEJ );                                   
                                                                        
            IF CN570.EKOMNR = GEM_EKOMNR                                
             & CN570.EEJDNR = GEM_EEJDNR                                
            THEN;                                                       
                                                                        
            ELSE                                                        
            IF CN570.DCPRCIR < 9999999999                               
            THEN                                                        
               DO;                                                      
                 WRITE FILE (BH975O) FROM (CN570_AR);                   
                 ANTAL_BH975 = ANTAL_BH975 + 1;                         
                                                                        
                 GEM_EKOMNR = CN570.EKOMNR;                             
                 GEM_EEJDNR = CN570.EEJDNR;                             
               END;                                                     
                                                                        
            READ FILE (CN570I) INTO (CN570_AR);                         
            IF EOF_CN570 = NEJ                                          
            THEN                                                        
               ANTAL_CN570 = ANTAL_CN570 + 1;                           
         END;                                                           
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
         PROC;                                                          
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = ANTAL_CN570;                                   
         DETLIN1.TEKST = 'ANTAL LÆSTE INDIVIDER PÅ C.H57010D........:'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = ANTAL_BH975;                                   
         DETLIN1.TEKST = 'ANTAL SKREVNE INDIVIDER PÅ B.H97500D......:'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
  END TOTALLISTE;                                                       
 /********************************************************************* 
 *       AFSLUT PROGRAM                                               * 
 *********************************************************************/ 
 AFSLUT: PROC;                                                          
         CALL TOTALLISTE;                                               
         CALL ZZ20300((133)' ','99');                                   
         CLOSE FILE (CN570I),                                           
               FILE (BH975O);                                           
                                                                        
 END AFSLUT;                                                            
 /********************************************************************/ 
                                                                        
 END  BH97500;                                                          
