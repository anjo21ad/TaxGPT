 /*********************************************************************/
 /*      DANNE DATA TIL SLUT CSC VEDR. SUPPLEMENTSLEVERINGEN          */
 /*   SLUT09    GERD HOLM-PEDERSEN                        22/10-2011  */
 /*             KRAV 18-02: OPSÆTNING AF BEREGNINGSGRL. FOR UDL. EJ   */
 /*             HVOR FELT 614 (BBERGRL_015ANV) NU SKAL ANVENDES BÅDE  */
 /*             TIL DANSKE OG UDENLANDSKE EJENDOMME                   */
 /*  SLUT11    GERD HOLM-PEDERSEN                                     */
 /*            TILRETTET SLUT 2011 SAMT                    11/11-2011 */
 /*            KRAV 18-05: OPSÆTNING AF BEREGNINGSGRL. FOR UDL. EJD.  */
 /*            HVOR FELT 615,616,621,622 OG 626 OVERFØRES SOM 614     */
 /*            FELT 616 OG 626 SKAL IKKE OVERFØRES.        27/12-2011 */
 /*  SLUT13    JØRGEN SAUGMANN                                        */
 /*            TILRETTET SLUT 2013 SAMT                    03/02-2014 */
 /*            IMPLEMENTERING AF 2 NYE FLETER TIL REDUSERING AF       */
 /*            EJENDOMSVÆRSKAT FOR PENSIONISTER BOSIDDENDE I UDLANDET */
 /*  SLUT15    JØRGEN SAUGMANN                                        */
 /*            TILRETTET SLUT 2013 SAMT                    28/12-2015 */
 /*  SLUT15    ESBEN BRODERSEN                             22/02-2016 */
 /*  UDVIDET BRUG AF DATO INCLUDE BH65300M #01                        */
 /*  SLUT16     ESBEN BRODERSEN QEB                        10/10-2016 */
 /*             NYE FELTER: BLANDVÆR_015ANV, BLANDVÆR_02ANV,          */
 /*                         BLANDVÆR_AKT                              */
 /*             UDGÅEDE FELTER: BPROM2, BPROM1, BSTIBEGR, BNEDSL1,    */
 /*             BPENSNED, BNEDSL2, BGRPROM2, CSTIBLB, BGRPROM1        */
 /*  SLUT17   ESBEN BRODERSEN                              OKT 2017   */
 /*           UDGÅEDE FELTER: CSCREGISTMP, BGLSUM1, CNULSTIL          */
 /*********************************************************************/
 DAN_DATA_TIL_SLUT: PROC;                                               
                                                                        
      BH971            = '';                                            
      BH971.INDVNR     = 810;                                           
      BH971.INDVLGD    = 472;                                           
      BH971.FELTLGD    = 472;                                           
      BH971.HEADER     = 'EVSGRUND';                                    
      BH971.DINDKAAR   = BH65300M.SLUTÅR; /*#01*/                       
      BH971.DCPRN      = BH960.SORT_CPR;                                
      BH971.EKOMNR     = BH960.SORT_KOMNR;                              
      BH971.EEJDNR     = BH960.SORT_EJDNR;                              
      BH971.ELBNR      = BH960.UDSKRLBNR;                               
      BH971.CSLET      = ' ';                                           
      BH971.CLANDEKODE = BH960.EJENDOM.CLANDEKODE;                      
      BH971.CSKPLOMF  = BH960.TIL_EVS.CSKPLOMF;                         
      BH971.CEJBEVS   = BH960.TIL_EVS.CEJBEVS;                          
      BH971.BOBEHAKOD = ' ';                                            
      BH971.MANPENSSTI_I = -1;                                          
      BH971.MANPENSSTI = 0;                                             
      IF BH971.EKOMNR = 999    /*SLUT09 18-02 OG SLUT11 FRA*/           
      THEN                                                              
        DO;                                                             
           BH971.BBERGRL_015ANV_I  = BH960.EJERSKAB.UDL_614_SW;         
           BH971.BBERGRL_015ANV    = BH960.EJERSKAB.UDL_614;            
           BH971.BBERGRL_02ANV_I   = BH960.EJERSKAB.UDL_615_SW;         
           BH971.BBERGRL_02ANV     = BH960.EJERSKAB.UDL_615;            
           BH971.BBERGRL_AKT_I     = -1;                                
           BH971.BBERGRL_AKT       = 0;                                 
                                                                        
           BH971.BBER2FAM_015ANV_I = BH960.EJERSKAB.UDL_621_SW;         
           BH971.BBER2FAM_015ANV   = BH960.EJERSKAB.UDL_621;            
           BH971.BBER2FAM_02ANV_I  = BH960.EJERSKAB.UDL_622_SW;         
           BH971.BBER2FAM_02ANV    = BH960.EJERSKAB.UDL_622;            
           BH971.BBER2FAM_AKT_I    = -1;                                
           BH971.BBER2FAM_AKT      = 0;                                 
        END;                                                            
      ELSE                                                              
        DO;                    /*SLUT09 OG SLUT11 TIL*/                 
           BH971.BBERGRL_015ANV_I = BH960.VURD_015ANV.BBERGRL_015ANV_SW;
           BH971.BBERGRL_015ANV   = BH960.VURD_015ANV.BBERGRL_015ANV;   
           BH971.BBERGRL_02ANV_I  = BH960.VURD_02ANV.BBERGRL_02ANV_SW;  
           BH971.BBERGRL_02ANV    = BH960.VURD_02ANV.BBERGRL_02ANV;     
           BH971.BBERGRL_AKT_I    = BH960.VURD_AKT.BBERGRL_AKT_SW;      
           BH971.BBERGRL_AKT      = BH960.VURD_AKT.BBERGRL_AKT;         
                                                                        
           BH971.BBER2FAM_015ANV_I =                                    
                                   BH960.VURD_015ANV.BBER2FAM_015ANV_SW;
           BH971.BBER2FAM_015ANV  = BH960.VURD_015ANV.BBER2FAM_015ANV;  
           BH971.BBER2FAM_02ANV_I = BH960.VURD_02ANV.BBER2FAM_02ANV_SW; 
           BH971.BBER2FAM_02ANV   = BH960.VURD_02ANV.BBER2FAM_02ANV;    
           BH971.BBER2FAM_AKT_I   = BH960.VURD_AKT.BBER2FAM_AKT_SW;     
           BH971.BBER2FAM_AKT     = BH960.VURD_AKT.BBER2FAM_AKT;        
        END;                                                            
                                                                        
         BH971.EJDBELIG = BH960.EJENDOM.EJDBELIG;                       
                                                                        
         /* Rettelse til defect 154 fra slut 2015 QEB */                
         IF BH960.EJERSKAB.CEJDTYPE_AKT > '0'                           
         THEN                                                           
           BH971.CEJDTYPE = BH960.EJERSKAB.CEJDTYPE_AKT;                
         ELSE                                                           
           BH971.CEJDTYPE = BH960.EJENDOM.CEJDTYPE;                     
                                                                        
                                                                        
         BH971.CÆGTOPR  = BH960.TIL_EVS.CÆGTOPR;                        
                                                                        
         IF BH960.TIL_EVS.DOVTG > 0                                     
         THEN                                                           
            BH971.DOVTG =                                               
            FIX09_TIL_DB2_DATO(BH960.TIL_EVS.DOVTG);                    
         ELSE                                                           
            BH971.DOVTG = (10)' ';                                      
                                                                        
         IF BH960.TIL_EVS.DAFSTAA > BH960.MT.DRGNÅRTIL                  
         THEN                                                           
            BH971.DAFSTAA = (10)' ';                                    
         ELSE                                                           
            IF BH960.TIL_EVS.DAFSTAA > 0                                
            THEN                                                        
               BH971.DAFSTAA =                                          
               FIX09_TIL_DB2_DATO(BH960.TIL_EVS.DAFSTAA);               
            ELSE                                                        
               BH971.DAFSTAA = (10)' ';                                 
                                                                        
         BH971.GPCTEJER_I = BH960.TIL_EVS.GPCTEJER_SW;                  
         BH971.GPCTEJER = BH960.TIL_EVS.GPCTEJER;                       
                                                                        
         BH971.FDAGUDLE = 0;                                            
         BH971.GPCTUDLE = 0;                                            
         BH971.FUDL100  = BH960.TIL_EVS.FUDL100;    /* 18-02 SLUT09 */  
         BH971.GPCTERHV = 0;                                            
         BH971.FDAGERHV = 0;                                            
         BH971.FERHVFLER = BH960.TIL_EVS.FERHVFLER;                     
         BH971.CENKE     = BH960.TIL_EVS.CENKE;                         
         BH971.CPTYPSLUT = BH960.TIL_EVS.CPTYPSLUT;                     
         BH971.CPTYPGL   = BH960.TIL_EVS.CPTYPGL;                       
         BH971.FELT759   = BH960.TIL_EVS.FELT759;                       
         BH971.FELT760 = BH960.TIL_EVS.CFRED;                           
         BH971.BEVSGL_I = BH960.TIL_EVS.BEVSGL_SW;                      
         BH971.BEVSGL   = BH960.TIL_EVS.BEVSGL;                         
         BH971.BPENSNEDGL_I = BH960.TIL_EVS.BPENSNEDGL_SW;              
         BH971.BPENSNEDGL = BH960.TIL_EVS.BPENSNEDGL;                   
                                                                        
         IF BH960.TIL_EVS.DINDFLYT > 0                                  
         THEN                                                           
            BH971.DINDFLYT =                                            
            FIX09_TIL_DB2_DATO(BH960.TIL_EVS.DINDFLYT);                 
                                                                        
         IF BH960.TIL_EVS.DFRAFLYT > 0                                  
         THEN                                                           
            BH971.DFRAFLYT =                                            
            FIX09_TIL_DB2_DATO(BH960.TIL_EVS.DFRAFLYT);                 
                                                                        
         BH971.FUBEBOELIG = 0;                                          
         BH971.BFASTSTIGBGR_I = BH960.TIL_EVS.BFASTSTIGBGR_SW;          
         BH971.BFASTSTIGBGR   = BH960.TIL_EVS.BFASTSTIGBGR;             
         BH971.CINDFLYT = ' ';                                          
         BH971.CBERGRGLOP   = BH960.EJERSKAB.CBERGRGLOP;                
         BH971.BMANEVSSTI_I = -1;                                       
         BH971.BMANEVSSTI    = 0;                                       
         BH971.BEVSMAN_I     = -1;                                      
         BH971.BEVSMAN       = 0;                                       
         BH971.BMANNEDSL_I   = -1;                                      
         BH971.BMANNEDSL     = 0;                                       
         BH971.CEKSEMP       = ' ';                                     
         BH971.MANNEDSLSTI_I = -1;                                      
         BH971.MANNEDSLSTI   = 0;                                       
         BH971.BUDLSKC_I     = -1;                                      
         BH971.BUDLSKC       = 0;                                       
         BH971.BEJBOL1_AKT_I = BH960.VURD_AKT.BEJBOL1_AKT_SW;           
         BH971.BEJBOL1_AKT   = BH960.VURD_AKT.BEJBOL1_AKT;              
         BH971.BEJBOL2_AKT_I = BH960.VURD_AKT.BEJBOL2_AKT_SW;           
         BH971.BEJBOL2_AKT   = BH960.VURD_AKT.BEJBOL2_AKT;              
         BH971.DAFSTAAFOR = BH960.TIL_EVS.DAFSTAAFOR;                   
         BH971.BEJBOL1_02ANV_I = BH960.VURD_02ANV.BEJBOL1_02ANV_SW;     
         BH971.BEJBOL1_02ANV = BH960.VURD_02ANV.BEJBOL1_02ANV;          
         BH971.BEJBOL2_02ANV_I = BH960.VURD_02ANV.BEJBOL2_02ANV_SW;     
         BH971.BEJBOL2_02ANV = BH960.VURD_02ANV.BEJBOL2_02ANV;          
         BH971.CBENYT = BH960.VURD_AKT.CBENYT_AKT;                      
         BH971.CBERGRL  = BH960.EJENDOM.CBERGRL;                        
         BH971.CELØNCOR = BH960.TIL_EVS.CELØNCOR;                       
         BH971.GPCTEJERFOR = BH960.TIL_EVS.GPCTEJERFOR;                 
         BH971.CERHV = BH960.TIL_EVS.CERHV;                             
         BH971.CVURDOPR  = BH960.AKT_VURD.CVURDOPR;                     
         BH971.COMBYG    = BH960.EJENDOM.COMBYG;                        
                                                                        
         /* 3 Nye felter slut 2016 til overførsel af landbrugs opl #01*/
         IF BH971.CEJDTYPE = '9' &                                      
            BH971.EKOMNR ^= 999                                         
         THEN                                                           
           DO;                                                          
             BH971.BLANDVÆR_015ANV_I =                                  
                             BH960.VURD_015ANV.BEJDVÆR_015ANV_SW;       
             BH971.BLANDVÆR_015ANV   = BH960.VURD_015ANV.BEJDVÆR_015ANV;
             BH971.BLANDVÆR_02ANV_I  =                                  
                             BH960.VURD_02ANV.BEJDVÆR_02ANV_SW;         
             BH971.BLANDVÆR_02ANV    = BH960.VURD_02ANV.BEJDVÆR_02ANV;  
             BH971.BLANDVÆR_AKT_I    = BH960.VURD_AKT.BEJDVÆR_AKT_SW;   
             BH971.BLANDVÆR_AKT      = BH960.VURD_AKT.BEJDVÆR_AKT;      
           END;                                                         
         ELSE                                                           
           DO;                                                          
             BH971.BLANDVÆR_015ANV_I = -1;                              
             BH971.BLANDVÆR_015ANV   = 0;                               
             BH971.BLANDVÆR_02ANV_I  = -1;                              
             BH971.BLANDVÆR_02ANV    = 0;                               
             BH971.BLANDVÆR_AKT_I    = -1;                              
             BH971.BLANDVÆR_AKT      = 0;                               
           END;                                                         
                                                                        
         BH971.BBERGRL_I = BH960.EJERSKAB.BBERGRL_SW;                   
         BH971.BBERGRL   = BH960.EJERSKAB.BBERGRL;                      
         BH971.CBERGROP  = BH960.EJERSKAB.CBERGROP;                     
                                                                        
         IF BH960.UDSKRLBNR = 1                                         
         THEN                                                           
            DO;                                                         
              BH971.BFORSKAT_I = BH960.TIL_EVS.BFORSKAT_SW;             
              BH971.BFORSKAT = BH960.TIL_EVS.BFORSKAT;                  
              BH971.CFORSKAT = BH960.TIL_EVS.CFORSKAT;                  
            END;                                                        
         ELSE                                                           
            DO;                                                         
              BH971.BFORSKAT_I = -1;                                    
              BH971.BFORSKAT = 0;                                       
              BH971.CFORSKAT = '2';                                     
            END;                                                        
                                                                        
         BH971.CUDLMAN = BH960.TIL_EVS.CUDLMAN;                         
         BH971.BBER2FAM_I = BH960.EJERSKAB.BBER2FAM_SW;                 
         BH971.BBER2FAM    = BH960.EJERSKAB.BBER2FAM;                   
                                                                        
         IF BH960.FEJLNR > 0                                            
         THEN                                                           
            DO;                                                         
               HJ_FEJLNR = BH960.FEJLNR;                                
               BH971.FEJLNR = HJ_FEJLNR;                                
            END;                                                        
         ELSE                                                           
            BH971.FEJLNR = ' ';                                         
                                                                        
         BH971.BEJBOL1_015ANV_I =                                       
                       BH960.VURD_015ANV.BEJBOL1_015ANV_SW;             
         BH971.BEJBOL1_015ANV    =                                      
                       BH960.VURD_015ANV.BEJBOL1_015ANV;                
         BH971.BEJBOL2_015ANV_I =                                       
                       BH960.VURD_015ANV.BEJBOL2_015ANV_SW;             
         BH971.BEJBOL2_015ANV    =                                      
                       BH960.VURD_015ANV.BEJBOL2_015ANV;                
                                                                        
         IF BH960.TIL_EVS.EKOMNR_GL > 0                                 
         THEN                                                           
            DO;                                                         
               HJ_PIC3 = BH960.TIL_EVS.EKOMNR_GL;                       
               BH971.EKOMNR_GL = HJ_CHAR3;                              
               HJ_PIC7 = BH960.TIL_EVS.EEJDNR_GL;                       
               BH971.EEJDNR_GL = HJ_PIC7;                               
            END;                                                        
         ELSE                                                           
            DO;                                                         
               BH971.EKOMNR_GL = '   ';                                 
               BH971.EEJDNR_GL = (7)' ';                                
            END;                                                        
                                                                        
         BH971.CSKPLOMFGL = BH960.TIL_EVS.CSKPLOMFGL;                   
                                                                        
         BH971.DFRAGLD = BQ_UD.PERSON.DFRAGLD; /* OPSAT AF DATAMODUL */ 
                                                                        
         BH971.CNEDSL1 = BH960.TIL_EVS.CNEDSL1;                         
         BH971.FLEJL = BH960.VURD_AKT.FLEJL_AKT;                        
         BH971.DOVTGFOR = BH960.TIL_EVS.DOVTGFOR;                       
         BH971.CDATAFRA = BH960.TIL_EVS.CDATAFRA;                       
         BH971.CUDLHEL   = BH960.TIL_EVS.CUDLHEL;                       
         BH971.CUDLDEL   = BH960.TIL_EVS.CUDLDEL;                       
                                                                        
         BH971.BEJDVPUSKTP_I = -1;                                      
         BH971.BEJDVPUSKTP   = 0;                                       
         BH971.BEJDVÆPUSKP_I = -1;                                      
         BH971.BEJDVÆPUSKP   = 0;                                       
                                                                        
         TV.SKREVET = TV.SKREVET + 1;                                   
                                                                        
         WRITE FILE (BH9710O) FROM (BH971);                             
                                                                        
 END DAN_DATA_TIL_SLUT;                                                 
