 PROCESS OPT(TIME);                                                     
 BH84200:/* BEHANDL SOMMERHUSE A.H.T. OPSÆT KODE FOR HELÅRSBEBOELSE */  
         /* BEHANDL SOMMERHUSE A.H.T. BEREGNING SOM HELÅRSBEBOELSE  */  
         PROCEDURE (EXECPARM) OPTIONS (MAIN) REORDER;                   
 /********************************************************************/ 
         DCL COPYRIGHT   CHAR      (30) STATIC                          
         INIT ('COPYRIGHT KMD A/S 2004');                               
 /********************************************************************* 
 *                                                                    * 
 * FORMÅL : PROGRAMMETS FORMÅL ER AT OPSÆTTE KODE FOR HELÅRSBEBOELSE  * 
 *          HVIS AKTUEL EJER ER TILMELDT EJENDOMMENS ADRESSE JVF.     * 
 *          P-DATA OG  E N T E N  HAR DISPENSATION TIL HELÅRSBEBOELSE * 
 *          IFLG. BBR-REGISTRET  E L L E R  ER PENSIONIST, EFTERLØNS- * 
 *          MODTAGER, FØRTIDS-/INVALIDE-PENSIONIST, ENKE EFTER EN AF  * 
 *          DISSE SAMT HAR EJET EJENDOMMEN I MINDST 1 ÅR JÆVNFØR      * 
 *          DATO0107 PR. 31/12 I AKTUELT ÅR FOR SLUT- ELLER FORSKUDS- * 
 *          BEREGNINGEN AF EVS.                                       * 
 *                                                                    * 
 * INPUT  : BQ75000T  ESR (KUN BK 08,28 ELLER 48)                     * 
 *          BQ76000T  MANDTALT                                        * 
 *          BQ78000T  RESULTAT                                        * 
 *                                                                    * 
 * OUTPUT : BQ75000T  BEHANDLET ESR-UDTRÆK                            * 
 *          BQ78000T  BEHANDLET RESULTAT                              * 
 *          BH84201Y   KONTROLLISTE                                   * 
 *                                                                    * 
 * PROGRAMMØR:    AAGE RASMUSSEN   AUG  1999                          * 
 * ÅRSTILRETTET:  AAGE RASMUSSEN  AAR JUL  2000                       * 
 * ÅRSTILRETTET:  AAGE RASMUSSEN  AAR JAN  2001                       * 
 * ÅRSTILRETTET:  AAGE RASMUSSEN  AAR AUG  2001 - FORSKUD 2002        * 
 *       RETTET:  AAGE RASMUSSEN  AAR DEC  2001 - SLUT 2001           * 
 * ÅRSTILRETTET:  ESBEN BRODERSEN ESB AUG  2002 - FORSKUD 2003        * 
 *       RETTET:  AAGE RASMUSSEN  AAR DEC  2002 - SLUT 2002           * 
 * ÅRSTILRETTET:  BO SCHMIDT      BOB AUG  2003 - FORSKUD 2004        * 
 * ÅRSTILRETTET:  BO SCHMIDT      BOB AUG  2004 - FORSKUD 2005        * 
 *       RETTET:  AAGE RASMUSSEN  AAR OKT  2004 - SLUT 2004           * 
 * FORSKUD06      SUSANNE KROGH VILLUMSEN           02-06-2005        * 
 *                TILRETTET FORSKUD 2006                              * 
 * SLUT05         SUSANNE KROGH VILLUMSEN           08-11-2005        * 
 *                TILRETTET SLUT 2005                                 * 
 * FORSKUD07      BO SCHMIDT                        14-05-2006        * 
 *                TILRETTET FORSKUD 2007                              * 
 * SLUT06         BO SCHMIDT                        04-10-2006        * 
 *                TILRETTET SLUT 2006                                 * 
 * FORSKUD08      BO SCHMIDT                        23-05-2007        * 
 *                TILRETTET FORSKUD 2008                              * 
 * SLUT07         BO SCHMIDT                        19-11-2007        * 
 *                TILRETTET SLUT 2007                                 * 
 * FORSKUD09      BO SCHMIDT                        23-06-2008        * 
 *                TILRETTET FORSKUD 2009                              * 
 * SLUT08         BO SCHMIDT                        19-11-2008        * 
 *                TILRETTET SLUT 2008                                 * 
 * FORSKUD10      GERD HOLM-PEDERSEN                20-04-2009        * 
 *                TILRETTET FORSKUD 2010, RUL                         * 
 * SLUT09         GERD HOLM-PEDERSEN                13-10-2009        * 
 *                TILRETTET SLUT 2009                                 * 
 * FORSKUD11      GERD HOLM-PEDERSEN                08-05-2009        * 
 *                TILRETTET FORSKUD 2011, RUL                         * 
 * SLUT10         GERD HOLM-PEDERSEN                08-10-2010        * 
 *                TILRETTET SLUT 2010                                 * 
 * FORSKUD12      GERD HOLM-PEDERSEN                08-04-2011        * 
 *                TILRETTET FORSKUD 2012, RUL                         * 
 *                SAMT ÆNDRET TÆLLERNE FKUN OG NOGET TEKST TIL AT     * 
 *                VÆRE ÅRSUAFHÆNGIGE.                                 * 
 *                FKUN2011 -> FKUN_SIDSTE_HELÅR                       * 
 *                FKUN2012 -> FKUN_AKT_HELÅR                          * 
 * SLUT11         GERD HOLM-PEDERSEN                22-09-2011        * 
 *                TILRETTET SLUT 2011                                 * 
 * FORSKUD13      LARS KAAE HARRITSHØJ              30-05-2012        * 
 *                TILRETTET FORSKUD 2013, RUL                         * 
 *                BH90000N => BH90100N                                * 
 *                ÆNDRINGER FORETAGET I BH90100N                      * 
 * SLUT12         LARS KAAE HARRITSHØJ                SEP 2012        * 
 *                TILRETTET SLUT 2012                                 * 
 *                BH90100N => BH90000N                                * 
 * FORSKUD14      LARS KAAE HARRITSHØJ                Maj 2013        * 
 *                TILRETTET FORSKUD 2014, RUL                         * 
 *                BH90000N => BH90100N                                * 
 * SLUT13         JØRGEN SAUGMANN                     Okt 2013        * 
 *                TILRETTET SLUT 2013                                 * 
 *                BH90100N => BH90000N                                * 
 * FORSKUD15      JØRGEN SAUGMANN                     Jun 2014        * 
 *                BH90000N -> BH90100N                                * 
 * SLUT14         JØRGEN SAUGMANN                     Okt 2014        * 
 *                TILRETTET SLUT 2014                                 * 
 *                BH90100N => BH90000N                                * 
 * FORSKUD16      JØRGEN SAUGMANN                     Jun 2015        * 
 *                BH90000N -> BH90100N                                * 
 * SLUT15         Z6JNK                               Okt 2014        * 
 *                TILRETTET SLUT 2015                                 * 
 *                BH90100N => BH90000N   (søg efter 'RUL')            * 
 * SLUT15         ESBEN BRODERSEN Z8QEB               MAR 2016        * 
 *                UDVIDET BRUG AF BH65300M #01                        * 
 *                KS18-01 KODE FRA SLUT 2012 GJORT AKTIV #02          * 
 * FORSKUD17      ESBEN BRODERSEN                     Jun 2017        * 
 *                BH90000N -> BH90100N                                * 
 *                KS30-01 og KS32-01 - FORSKUD 2017                   * 
 *                Input fil ændret fra B.H94110D til B.H94810D        * 
 *                BH941 -> BH948                                      * 
 * SLUT16         Lene Maj Jensen                     Sep 2016        * 
 *                BH90100N -> BH90000N                                * 
 * DB2OMLÆG    Z6QLE                                      01.03.2017  * 
 *             Omlægning af beregningsbånd til DB2                    * 
 *             Sammenlægning af BH94200 og BH94400                    * 
 *             Z8QEB                                                  * 
 *             BH84200M taget ud                                      * 
 * FORSKUD18   Esben Brodersen QEB                                    * 
 *             #L121 En pensionists personlige ret til at benytte     * 
 *             en fritidsbolig, herunder en lokalplanlagt             * 
 *             fritidsbolig, til helårsbeboelse,                      * 
 *             når pensionisten har ejet ejendommen i 1 år            * 
 *             tidligere 8 år                                         * 
 * SLUT17      Esben Brodersen QEB                      OKT           * 
 *             KS02-39-01 Tilretning af felt 705                      * 
 *             CEANV lig 521 og 522 lagt ind                          * 
 *             Planlov 2017 overgang den 15-06-2017     NOV           * 
 *             fra 8 til 1 år for at gælde som helårsbolig            * 
 * FORSKUD19   Esben Brodersen QEB                                    * 
 *             Defect 5.1                                             * 
 *             kriteriet for ændring af ejedomstypen udviddes         * 
 *             med TILEVS_CSKPLOMF = '8' for begrænset skattepligtige * 
 *             pensionister CPTYPFOR/CPTYPSLUT = '4'                  * 
 *             Defect 5.2                                             * 
 *             Felt 733 afståelses dato skal indgå i bestemmelse af   * 
 *             om et sommerhus har været ejet i mere end et år og     * 
 *             muligvis anvendes som helårs bolig.                    * 
 *             Til undersøgelse af om en ejer har ejet sit sommerhus  * 
 *             i et år eller mere spørges nu på TILEVS_A_EJ_DOVTG_GL  * 
 *             Som starts dato for kunne taget højde for køb og salg  * 
 *             i løbet af et år, denne rettelse blev rullet tilbage   * 
 *             da den måske ville give problemer omkringe ægtefæller  * 
 * SLUT18      Esben Brodersen EBD                       SEP          * 
 *             2-Familie KS02-23                                      * 
 *             Feltet EENHEDLBNR er tilføjet som en del af nøgle      * 
 *             efter ejendomnummeret.                                 * 
 * FORSKUD2021 PER BRUNK PBR                               23.03.2020 * 
 *********************************************************************/ 
                                                                        
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
                                                                        
 /*********************************************************************/
 /*      PARAMETER TIL ANGIVELSE AF OM DET ER PRODUKTION ELLER        */
 /*      TESTKØRSEL AF HENSYN TIL MASKINEL AFSTEMNING                 */
 /*********************************************************************/
                                                                        
 DCL     EXECPARM        CHAR      (6) VAR;                             
                                                                        
 DCL     EX_PARM         CHAR      (4);                                 
                                                                        
         EX_PARM = EXECPARM;                                            
                                                                        
 /********************************************************************* 
 *                       DECLARE AF REGISTRE                          * 
 *********************************************************************/ 
                                                                        
 DCL     BH842I FILE RECORD INPUT;     /* PARAMETERINPUT */             
 DCL     SYSPRINT EXTERNAL FILE PRINT;                                  
                                                                        
 /*********************************************************************/
 /*      DECLARE AF INPUT                                             */
 /*********************************************************************/
 DCL     1 BH842_PARM,                                                  
           %INCLUDE BH54900N;                                           
 /********************************************************************* 
 *               DECLARE AF DIV. TÆLLEVÆRKER                          * 
 *********************************************************************/ 
 DCL     1 STAT_SIDSTE_ÅR(100:999), /* TÆLLEVÆRKER TIL STATISTIK  */    
           2 CLIN          PIC       '9'  INIT (0),                     
           2 PLIN(20),                                                  
             3 A379        FIXED DEC (7), /* BBRF379 = A          */    
             3 B379        FIXED DEC (7), /* BBRF379 = B          */    
             3 C379        FIXED DEC (7), /* BBRF379 = C          */    
             3 D379        FIXED DEC (7), /* BBRF379 = D          */    
             3 U379        FIXED DEC (7), /* BBRF379 = BLANK      */    
             3 IALT        FIXED DEC (7);                               
 DCL     1 STAT_AKT_ÅR(100:999),   /* TÆLLEVÆRKER TIL STATISTIK   */    
           2 CLIN          PIC       '9'  INIT (0),                     
           2 PLIN(14),                                                  
             3 A379        FIXED DEC (7), /* BBRF379 = A          */    
             3 B379        FIXED DEC (7), /* BBRF379 = B          */    
             3 C379        FIXED DEC (7), /* BBRF379 = C          */    
             3 D379        FIXED DEC (7), /* BBRF379 = D          */    
             3 U379        FIXED DEC (7), /* BBRF379 = BLANK      */    
             3 IALT        FIXED DEC (7);                               
                                                                        
 DCL     1 TV,                   /* TÆLLEVÆRKER TIL TOTALLISTEN */      
           2 LÆSTE_IALT       FIXED DEC (9),                            
           2 SKREVNE         FIXED DEC (9),                             
           2 FL_EJER         FIXED DEC (9),                             
           2 FKUN_SIDSTE_ÅR  FIXED DEC (9),                             
           2 FKUN_AKT_ÅR     FIXED DEC (9),                             
           2 FBEGGE          FIXED DEC (9),                             
           2 LÆS_BH942   FIXED DEC (9),                                 
           2 FSOM_UBOP   FIXED DEC (9),                                 
           2 FSOM_MBOP   FIXED DEC (9),                                 
           2 FSEJDTYP3Æ  FIXED DEC (9),                                 
           2 FSEJDTYP8Æ  FIXED DEC (9),                                 
           2 FFEJDTYP3Æ  FIXED DEC (9),                                 
           2 FFEJDTYP8Æ  FIXED DEC (9),                                 
           2 ANT_COMM        FIXED DEC (7),                             
           2 ANT_UPD         FIXED DEC (7),                             
           2 SELECT_MT       FIXED DEC (7),                             
           2 F_SIDSTE_HELÅR FIXED DEC (9),     /* AKTUELT SLUTÅR     */ 
           2 F_AKT_HELÅR FIXED DEC (9),        /* AKTUELT FORSKUDSÅR */ 
           2 ÆNDRET_CHELÅR_REGL FIXED DEC (9);                          
                                                                        
 /*********************************************************************/
 /*     DECLARE AF DB2-variabler                                      */
 /*********************************************************************/
  EXEC SQL INCLUDE SQLCA;                                               
 DCL    SQLKODE         FIXED     (5);                                  
 DCL    SQLCODE_CH      CHAR      (5);                                  
 DCL    SQLCODE_PIC     PIC       'SSSS9' DEF SQLCODE_CH;               
                                                                        
 /***************************************************************       
 /*      DECLARE AF ABEND-RUTINE                                        
 /**************************************************************/       
 DCL     ABENDKODE     FIXED       (2) INIT(5);                         
 DCL     1 ABENDMEDD,                                                   
          2 ABENDMODUL CHAR      (7) INIT ('BH84200'),                  
          2 ABENDFILL1 CHAR      (1) INIT (' '),                        
          2 ABENDMEDNR CHAR      (2) INIT ('**'),                       
          2 ABENDFILL2 CHAR      (1) INIT (' '),                        
          2 ABENDTXT   CHAR      (45);                                  
                                                                        
 DCL     ABENDRTKODE   FIXED     (1) INIT (2);                          
 /********************************************************************* 
 *               DECLARE AF DIV. FÆLLESMACROER (EVS SLUT/FORSKUD)     * 
 *********************************************************************/ 
                                                                        
 DCL     1 BH65300M,                                                    
           %INCLUDE BH65300M;                                           
                                                                        
 /********************************************************************* 
 *       DECLARE AF HJÆLPEFELTER TIL MASKINEL AFSTEMNING              * 
 *********************************************************************/ 
                                                                        
 DCL     OPTALT          FIXED     (7)       INIT      (0);             
 DCL     SWFEJL          CHAR      (1)       INIT      (' ');           
                                                                        
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     PUTSKIP                BIT(1)   INIT ('0'B);                   
                                                                        
 DCL     WS_FORSKUD_SLUT_TXT    CHAR(16) INIT (' ');                    
                                                                        
 DCL     WS_TIL_EVS_AAR                 BIN FIXED (15);                 
                                                                        
 DCL     WS_TIL_EVS_AAR_GL              BIN FIXED (15);                 
 DCL     WS_SLUT_AFVIKLINGS_ID          CHAR(16) INIT (' ');            
                                                                        
 DCL     WS_PROGRAMNAVN         CHAR(8)  INIT ('BH84200');              
                                                                        
 DCL     EOF_BH842             BIT       (1)     INIT ('0'B);           
 DCL     ESR_FUNDET            BIT       (1)     INIT ('0'B);           
 DCL     MT_FUNDET             BIT       (1)     INIT ('0'B);           
 DCL     JA                    BIT       (1)     INIT ('1'B);           
 DCL     NEJ                   BIT       (1)     INIT ('0'B);           
                                                                        
 DCL     CHELÅR_DATA_FUNDET       BIT       (1);                        
                                                                        
                                                                        
 DCL     CHELÅRBBR       CHAR      (1);   /* HELÅRSSOMMERHUS JVF. BBR?*/
 DCL     CHELÅRESR       CHAR      (1);   /* HELÅRSSOMMERHUS JVF. ESR?*/
                                                                        
                                                                        
 /* Til planlov slut 2017 */                                            
 /*afslutnings dato for bestemmelse af CHELÅR for Slutåret*/            
  DCL     CHELÅR_SLUT_DATO   DEC FIXED(09);                             
 /*afslutnings dato for bestemmelse af CHELÅR for Forskudsåret */       
 DCL     CHELÅR_FORSK_DATO  DEC FIXED(09);                              
 /*Antal år som et fritidshus skal være beboet for at gælde som helårs  
 /* bolig */                                                            
 DCL CHELÅR_ANTAL_ÅR               BIN FIXED(15);                       
 DCL HJ_PIC1                       PIC '9';                             
 /* DATO_CHELÅR er et hjælpe felt til overførsel af    */               
 /* datoen som skal bruges til at bestemme CHELÅR hvis */               
 /* der har været delvist salg eller køb endvidere     */               
 /* tages højde for afståelses dato ved fuldt salg     */               
 DCL DATO_CHELÅR            DEC FIXED(09);                              
 /* Struktur til at gemme oplysninger fra tidligere læst ejerskaber  */ 
 /* eller ejerperiode                                                */ 
 DCL     GEM_DCPRN           DEC FIXED(11) INIT (0);                    
 DCL     GEM_EKOMNR          DEC FIXED(03) INIT (0);                    
 DCL     GEM_EEJDNR          DEC FIXED(07) INIT (0);                    
 DCL     GEM_EENHEDLBNR      BIN FIXED(15) INIT (0);                    
 DCL     GEM_DOVTG_GL        DEC FIXED(09) INIT (0);                    
 DCL     GEM_CHELÅR_ANTAL_ÅR BIN FIXED(15) INIT (0);                    
 DCL     GEM_DATO_CHELÅR     DEC FIXED(09) INIT (0);                    
                                                                        
 DCL     I               BIN FIXED (15);                                
 DCL     INDX            BIN FIXED (31);                                
 DCL     HJ_CPR          PIC       '(10)9';                             
                                                                        
 DCL     DATO1           CHAR      (26);                                
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DAG         CHAR      (02);                                
                                                                        
 DCL     1 GEMEJD,                                                      
           2 EKOMNR       FIXED   (3),  /* KOM.NR. BELIG.             */
           2 EEJDNR       FIXED   (7),  /* EJENDOMSNR.                */
           2 EENHEDLBNR   BIN FIXED(15),                                
           2 C_SÆLGER     CHAR    (1),  /* ER PERSONEN EN SÆLGER      */
           2 CHELÅR       CHAR    (1);  /* HELÅRS. JVF. BBR/ESR       */
                                                                        
 /********************************************************************* 
 *       DECLARE AF ENTRY OG BUILTIN                                  * 
 *********************************************************************/ 
                                                                        
 DCL     PLIDUMP         BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     LOW             BUILTIN;                                       
 DCL     HIGH            BUILTIN;                                       
 DCL     ZS30101         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS67000         ENTRY;                                         
                                                                        
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
         EXTERNAL INIT ('NOTEST(ALL,,;)');                              
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER til BEHANDL og STATISTIK              */
 /*********************************************************************/
                                                                        
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
                                                                        
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH84200L'),                                        
           2 F1          CHAR      (25)      INIT      (' '),           
           2 TEKST2      CHAR      (57)      INIT      (                
           'BEHANDLING AF EVT. HELÅRSBEBOEDE SOMMERHUSE   '),           
           2 F2          CHAR      (12)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO,                                                      
             3 DAG         CHAR      (02),                              
             3 F1          CHAR      (01) INIT ('.'),                   
             3 MD          CHAR      (02),                              
             3 F2          CHAR      (01) INIT ('.'),                   
             3 ÅR          CHAR      (04);                              
                                                                        
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN0,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (41),                                
           2 CPUÅR       PIC       '99',                                
           2 TEKST2      CHAR      (11),                                
           2 START       PIC       '999999',                            
           2 TEKST3      CHAR      (9),                                 
           2 SLUT        PIC       '999999',                            
           2 TEKST4      CHAR      (57);                                
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (61)      INIT      (' ');           
                                                                        
 DCL    1 STAT_SIDELIN,                                                 
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 STAT_OVLIN1,                                                 
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BH84200L'),                                        
           2 F1          CHAR      (25)      INIT      (' '),           
           2 TEKST2      CHAR      (57)      INIT      (                
           'STATISTIK M.V. VEDR. HELÅRSBEBOELSE I SOMMERHUSE'),         
           2 F2          CHAR      (09)      INIT      (' '),           
           2 TEKST3      CHAR      (14)      INIT      (                
           'UDSKREVET DEN '),                                           
           2 DATO,                                                      
             3 DAG         CHAR      (02),                              
             3 F1          CHAR      (01) INIT ('.'),                   
             3 MD          CHAR      (02),                              
             3 F2          CHAR      (01) INIT ('.'),                   
             3 ÅR          CHAR      (04);                              
 DCL     1 STAT_OVLIN2,                                                 
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 STAT_OVLIN3,                                                 
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (11),                                
           2 KOMNR       PIC      'ZZZ',                                
           2 FYLD        CHAR       (6)      INIT ((6)' '),             
           2 TEKST1      CHAR     (088),                                
           2 TEKST2      CHAR      (14)      INIT                       
           ('UDSKREVET DEN '),                                          
           2 DATO,                                                      
             3 DAG         CHAR      (02),                              
             3 F1          CHAR      (01) INIT ('.'),                   
             3 MD          CHAR      (02),                              
             3 F2          CHAR      (01) INIT ('.'),                   
             3 ÅR          CHAR      (04);                              
 DCL     1 STAT_OVLIN4,                                                 
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR     (132);                                
 DCL     1 STAT_DETLIN0,                                                
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (41),                                
           2 CPUÅR       PIC       '99',                                
           2 TEKST2      CHAR      (11),                                
           2 START       PIC       '999999',                            
           2 TEKST3      CHAR      (9),                                 
           2 SLUT        PIC       '999999',                            
           2 TEKST4      CHAR      (57);                                
 DCL     1 STAT_DETLIN1,                                                
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (80),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZZ',                       
           2 F2          CHAR      (41)      INIT      (' ');           
 DCL     1 STAT_DETLIN2,                                                
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (33),                                
           2 RCKOD       CHAR      (01)      INIT      (' '),           
           2 F1          CHAR      (19)      INIT      (' '),           
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (68)      INIT      (' ');           
 DCL     1 STAT_DETLIN3,                                                
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (10)      INIT      (' '),           
           2 TEKST2      CHAR      (07)      INIT      ('BELØB: '),     
           2 ANTAL2      PIC       'ZZZZ.ZZZ.ZZZ.ZZ9',                  
           2 F3          CHAR      (28)      INIT      (' ');           
 DCL     1 STAT_DETLIN4,                                                
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (30),                                
           2 F1          CHAR      (5)       INIT      (' '),           
           2 ANTAL1      PIC       'ZZZ.ZZZ',                           
           2 F2          CHAR      (5)       INIT      (' '),           
           2 F3          CHAR      (5)       INIT      (' '),           
           2 ANTAL2      PIC       'ZZZ.ZZZ',                           
           2 F4          CHAR      (5)       INIT      (' '),           
           2 F5          CHAR      (5)       INIT      (' '),           
           2 ANTAL3      PIC       'ZZZ.ZZZ',                           
           2 F6          CHAR      (5)       INIT      (' '),           
           2 F7          CHAR      (5)       INIT      (' '),           
           2 ANTAL4      PIC       'ZZZ.ZZZ',                           
           2 F8          CHAR      (5)       INIT      (' '),           
           2 F9          CHAR      (5)       INIT      (' '),           
           2 ANTAL5      PIC       'ZZZ.ZZZ',                           
           2 F10         CHAR      (5)       INIT      (' '),           
           2 F11         CHAR      (5)       INIT      (' '),           
           2 ANTAL6      PIC       'ZZZ.ZZZ',                           
           2 F12         CHAR      (5)       INIT      (' ');           
                                                                        
         % INCLUDE ZZ20301M;                                            
 /*********************************************************************/
 /* M A C R O E R der SKAL ligge før koden grundet declare af cursors */
 /*********************************************************************/
 %INCLUDE BH54999M; /* CHECK OM OMKØRSEL, OG UDFØR EVT OPRYDNING */     
                                                                        
 /*********************************************************************/
 /* Declare af CURSORS                                                */
 /*********************************************************************/
                                                                        
        /* TIL UNDERSØGELSE AF HELÅRSBOLIG */                           
                                                                        
                                                                        
         EXEC SQL DECLARE ESRCURS CURSOR WITH HOLD FOR                  
              SELECT                                                    
               T75.TIL_EVS_AAR,                                         
               T75.AFVIKLINGS_ID,                                       
               T75.DCPRN,                                               
               T75.EKOMNR,                                              
               T75.EEJDNR,                                              
               T75.EENHEDLBNR,                                          
               T75.EGENNR,                                              
               T75.PROGRAMNAVN,                                         
               T75.DB2FUNKTION,                                         
               T75.OPL_BBRF379,                                         
               T75.OPL_BBRF380,                                         
               T78.TIL_EVS_AAR,                                         
               T78.AFVIKLINGS_ID,                                       
               T78.DCPRN,                                               
               T78.EKOMNR,                                              
               T78.EEJDNR,                                              
               T78.EENHEDLBNR,                                          
               T78.EGENNR,                                              
               T78.PROGRAMNAVN,                                         
               T78.DB2FUNKTION,                                         
               T78.EJERSKAB_CEJDTYPE,                                   
               T78.EJERSKAB_CEJDTYPE_AKT,                               
               T78.SORT_HELÅR,                                          
               T78.SORT_SALG,                                           
               T78.TILEVS_A_EJ_BOPÆLSKODE,                              
               T78.TILEVS_A_EJ_DAFSTÅ,                                  
               T78.TILEVS_A_EJ_DRGNÅRFRA,                               
               T78.TILEVS_A_EJ_DRGNÅRTIL,                               
               T78.TILEVS_A_EJ_FEJER,                                   
               T78.TILEVS_C_SÆLGER,                                     
               T78.TILEVS_CHELÅR,                                       
               T78.TILEVS_CHELÅR_FOR,                                   
               T78.TILEVS_CHELÅR_ORD,                                   
               T78.TILEVS_CPTYPFOR,                                     
               T78.TILEVS_CPTYPSLUT,                                    
               T78.TILEVS_DAFSTAA,                                      
               T78.TILEVS_DATO0107,                                     
               T78.TILEVS_A_EJ_DOVTG_GL, /*QEB NOV 2017*/               
               T78.TILEVS_CSKPLOMF       /*QEB JUN 2018*/               
                                                                        
          FROM BQ75000T T75, BQ78000T T78                               
          WHERE T75.TIL_EVS_AAR = :WS_TIL_EVS_AAR                       
          AND   T75.AFVIKLINGS_ID = :WS_FORSKUD_SLUT_TXT                
          AND   T75.TIL_EVS_AAR = T78.TIL_EVS_AAR                       
          AND   T75.AFVIKLINGS_ID = T78.AFVIKLINGS_ID                   
          AND   T75.EKOMNR = T78.EKOMNR                                 
          AND   T75.EEJDNR = T78.EEJDNR                                 
          AND   T75.EENHEDLBNR = T78.EENHEDLBNR                         
          AND   T75.EGENNR = T78.EGENNR                                 
          AND   T75.DCPRN  = T78.DCPRN                                  
          AND (T78.VURD_A_CBENYT_AKT in ('08','28','48') OR             
              (T78.VURD_A_CBENYT_AKT = '25' AND                         
               T78.VURD_A_CEJDTYPE_AKT = '8' AND                        
               (T75.OPL_CEANV = '510' OR T75.OPL_CEANV = '520' OR       
                T75.OPL_CEANV = '521' OR T75.OPL_CEANV = '522')))       
         ORDER BY T78.DCPRN, T78.EKOMNR, T78.EEJDNR, T78.EENHEDLBNR,    
                  T78.SORT_DATO DESC;                                   
                                                                        
         /* TIL OVERFØRSEL AF CHELÅR KODE TIL SAMLEVENDE */             
                                                                        
         EXEC SQL DECLARE CHELÅR_CUR CURSOR WITH HOLD FOR               
              SELECT                                                    
               T75.TIL_EVS_AAR,                                         
               T75.AFVIKLINGS_ID,                                       
               T75.DCPRN,                                               
               T75.EKOMNR,                                              
               T75.EEJDNR,                                              
               T75.EENHEDLBNR,                                          
               T75.EGENNR,                                              
               T75.PROGRAMNAVN,                                         
               T75.DB2FUNKTION,                                         
               T75.OPL_BBRF379,                                         
               T75.OPL_BBRF380,                                         
               T78.TIL_EVS_AAR,                                         
               T78.AFVIKLINGS_ID,                                       
               T78.DCPRN,                                               
               T78.EKOMNR,                                              
               T78.EEJDNR,                                              
               T78.EENHEDLBNR,                                          
               T78.EGENNR,                                              
               T78.PROGRAMNAVN,                                         
               T78.DB2FUNKTION,                                         
               T78.EJERSKAB_CEJDTYPE,                                   
               T78.EJERSKAB_CEJDTYPE_AKT,                               
               T78.SORT_HELÅR,                                          
               T78.SORT_SALG,                                           
               T78.TILEVS_A_EJ_BOPÆLSKODE,                              
               T78.TILEVS_A_EJ_DAFSTÅ,                                  
               T78.TILEVS_A_EJ_DRGNÅRFRA,                               
               T78.TILEVS_A_EJ_DRGNÅRTIL,                               
               T78.TILEVS_A_EJ_FEJER,                                   
               T78.TILEVS_C_SÆLGER,                                     
               T78.TILEVS_CHELÅR,                                       
               T78.TILEVS_CHELÅR_FOR,                                   
               T78.TILEVS_CHELÅR_ORD,                                   
               T78.TILEVS_CPTYPFOR,                                     
               T78.TILEVS_CPTYPSLUT,                                    
               T78.TILEVS_DAFSTAA,                                      
               T78.TILEVS_DATO0107,                                     
               T78.TILEVS_CSKPLOMF       /*QEB JUN 2018*/               
          FROM BQ75000T T75, BQ78000T T78                               
          WHERE T75.TIL_EVS_AAR   = :WS_TIL_EVS_AAR                     
          AND   T75.AFVIKLINGS_ID = :WS_FORSKUD_SLUT_TXT                
          AND   T75.TIL_EVS_AAR   = T78.TIL_EVS_AAR                     
          AND   T75.AFVIKLINGS_ID = T78.AFVIKLINGS_ID                   
          AND   T75.EKOMNR = T78.EKOMNR                                 
          AND   T75.EEJDNR = T78.EEJDNR                                 
          AND   T75.EENHEDLBNR = T78.EENHEDLBNR                         
          AND   T75.EGENNR = T78.EGENNR                                 
          AND   T75.DCPRN  = T78.DCPRN                                  
          AND (T78.VURD_A_CBENYT_AKT in ('08','28','48') OR             
              (T78.VURD_A_CBENYT_AKT = '25' AND                         
               (T75.OPL_CEANV = '510' OR T75.OPL_CEANV = '520' OR       
                T75.OPL_CEANV = '521' OR T75.OPL_CEANV = '522')))       
          ORDER BY T78.EKOMNR , T78.EEJDNR, T78.EENHEDLBNR,             
                   T78.SORT_SALG, T78.SORT_HELÅR DESC;                  
                                                                        
                                                                        
 /********************************************************************* 
 *       ON CONDITIONS                                                * 
 *********************************************************************/ 
         PUT SKIP LIST ('START ' !! WS_PROGRAMNAVN);                    
                                                                        
         EOF_BH842 = NEJ;                                               
                                                                        
         ON ERROR                                                       
            BEGIN;                                                      
                ON ERROR SYSTEM;                                        
                PUT SKIP LIST ('PROGRAMFEJL');                          
                CALL PLIDUMP  ('SNHOB','PROGRAM BH84200L');             
            END;                                                        
                                                                        
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
                                                                        
         CALL ZZ20390 ('*OPEN','BH84201Y');                             
                                                                        
         CALL ZS38100(DATO1);                                           
         OVERLIN1.DATO = DATO2, BY NAME;                                
         SIDELIN.CCA   = ZZIK1;                                         
         OVERLIN1.CCA  = ZZWS2;                                         
         OVERLIN2.CCA  = ZZWS3;                                         
         STAT_SIDELIN.CCA = ZZIK1;                                      
         STAT_OVLIN1.DATO = DATO2, BY NAME;                             
         STAT_OVLIN1.CCA  = ZZWS2;                                      
         STAT_OVLIN2.CCA  = ZZWS3;                                      
         STAT_OVLIN3.CCA  = ZZWS1;                                      
                                                                        
         TV = 0;                                                        
                                                                        
         /* initiering af felter til statistik */                       
         DO INDX = 100 TO 999;                                          
            STAT_SIDSTE_ÅR(INDX).CLIN = 0;                              
            DO I = 1 TO 20;                                             
               STAT_SIDSTE_ÅR(INDX).PLIN(I).A379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).B379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).C379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).D379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).U379 = 0;                   
               STAT_SIDSTE_ÅR(INDX).PLIN(I).IALT = 0;                   
            END;                                                        
         END;                                                           
         STAT_SIDSTE_ÅR(100).CLIN = 1;                                  
         DO INDX = 100 TO 999;                                          
            STAT_AKT_ÅR(INDX).CLIN = 0;                                 
            DO I = 1 TO 14;                                             
               STAT_AKT_ÅR(INDX).PLIN(I).A379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).B379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).C379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).D379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).U379 = 0;                      
               STAT_AKT_ÅR(INDX).PLIN(I).IALT = 0;                      
            END;                                                        
         END;                                                           
         STAT_AKT_ÅR(100).CLIN = 1;                                     
                                                                        
         OPEN FILE (BH842I)  TITLE ('BH84200P');                        
         ON ENDFILE (BH842I)                                            
         BEGIN;                                                         
            EOF_BH842 = JA;                                             
         END;                                                           
                                                                        
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
         if PUTSKIP = '1'B                                              
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('hovedstyring');                             
            put skip list ('*******************');                      
         end;                                                           
                                                                        
         READ FILE (BH842I) INTO (BH842_PARM);                          
                                                                        
         SELECT (BH842_PARM.FS_MRK);                                    
            WHEN ('S')                                                  
              DO;                                                       
                 PUT SKIP LIST ('Dette er en EVS SLUT kørsel');         
              END;                                                      
            WHEN ('F')                                                  
              DO;                                                       
                 PUT SKIP LIST ('Dette er en EVS FORSKUD kørsel');      
              END;                                                      
            WHEN ('U')                                                  
              DO;                                                       
                 PUT SKIP LIST ('Dette er en EVS SUPPLEMENT kørsel');   
              END;                                                      
            OTHERWISE                                                   
              DO;                                                       
                 ABENDTXT = '101 Parameter skal være S,F,U';            
                 CALL PROGRAM_FEJL;                                     
              END;                                                      
         END;                                                           
                                                                        
         IF EOF_BH842 = NEJ                                             
         THEN DO;                                                       
            SELECT (BH842_PARM.FS_MRK);                                 
               WHEN ('F')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH842_PARM.FORSKUD_TXT;      
                     WS_TIL_EVS_AAR = BH65300M.FORSKÅR;                 
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH842_PARM.SLUT_TXT;       
                  END;                                                  
               WHEN ('S')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH842_PARM.SLUT_TXT;         
                     WS_TIL_EVS_AAR = BH65300M.SLUTÅR;                  
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH842_PARM.SLUT_TXT;       
                  END;                                                  
               WHEN ('U')                                               
                  DO;                                                   
                     WS_FORSKUD_SLUT_TXT = BH842_PARM.SUPPL_TXT;        
                     WS_TIL_EVS_AAR = BH65300M.SLUTÅR;                  
                     /* N.B.  til_evs_aar_GL Tages ALTID fra SLUT */    
                     WS_TIL_EVS_AAR_GL = BH65300M.SLUTÅR - 1;           
                     /* afviklings-id til læs gammelt år altid SLUT */  
                     WS_SLUT_AFVIKLINGS_ID = BH842_PARM.SLUT_TXT;       
                  END;                                                  
               OTHERWISE                                                
                  DO;                                                   
                     ABENDTXT = '101 PARAMETERFEJL';                    
                     CALL PROGRAM_FEJL;                                 
                  END;                                                  
            END; /* select */                                           
         END;                                                           
                                                                        
         /********************************************************/     
         /*  CHECK OM FORGÆNGERE ER KØRT                         */     
         /********************************************************/     
         if PUTSKIP = '1'B                                              
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('Check Sekvens');                            
            put skip list ('*******************');                      
         end;                                                           
                                                                        
         /* QEB QEB 2018-03-07 HACK*/                                   
         /*CALL CHECK_SEKVENS (BH842_PARM.FS_MRK); /* BH54997M */       
                                                                        
         /********************************************************/     
         /*  NU STARTER CHECK AF OMKØRSEL                        */     
         /********************************************************/     
         if PUTSKIP = '1'B                                              
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('Check_om_omkØrsel');                        
            put skip list ('*******************');                      
         end;                                                           
                                                                        
         /*QEB 2018-03-07 HACK*/                                        
         /*CALL CHECK_OM_OMKØRSEL; /* kode ligger i macro BH54999M */   
         DER_SKAL_KØRES_OM = NEJ;                                       
                                                                        
                                                                        
         IF DER_SKAL_KØRES_OM                                           
         THEN DO;                                                       
            PUT SKIP LIST ('Omkørsel af ' !! WS_PROGRAMNAVN);           
            CALL RYD_OP_FØR_OMKØRSEL;                                   
         END;                                                           
         ELSE DO;                                                       
            PUT SKIP LIST ('Normal kørsel af ' !! WS_PROGRAMNAVN);      
         END;                                                           
                                                                        
                                                                        
         /********************************************************/     
         /*  NU STARTER NORMALT FLOW                             */     
         /********************************************************/     
         if PUTSKIP = '1'B                                              
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('opdater_kØrselstabel START');               
            put skip list ('*******************');                      
         end;                                                           
         CALL OPDATER_KØRSELSTABEL('START',BH842_PARM.FS_MRK);          
                                                                        
         /*Opsætning af CHELÅR_REGL og CHELÅR_DATO ??*/                 
                                                                        
                                                                        
         CALL OPEN_ESRCURS;                                             
         CALL FETCH_ESR_RES;                                            
                                                                        
         DO WHILE (ESR_FUNDET);                                         
            CALL SELECT_MT;                                             
            CALL BEHANDL;                                               
            CALL FETCH_ESR_RES;                                         
         END;                                                           
                                                                        
         IF ANT_COMM > 0                                                
         THEN DO;                                                       
            EXEC SQL COMMIT;                                            
            Put skip list ('Commit efter ' !! TV.LÆSTE_IALT !!          
                           ' læsninger på ESR.  Ialt ' !! ANT_UPD !!    
                           ' opdateringer');                            
         END;                                                           
                                                                        
         CALL CLOSE_ESRCURS;                                            
                                                                        
         /* Her starter overførsel af CHELÅR plus ændring af */         
         /* ejendomstype felt 705                            */         
         /* fra gl BH94400 */                                           
                                                                        
         CALL OPEN_CHELÅR_CUR;                                          
         CALL FETCH_CHELÅR_CUR;                                         
         GEMEJD.EKOMNR     = DCLBQ78000T.EKOMNR;                        
         GEMEJD.EEJDNR     = DCLBQ78000T.EEJDNR;                        
         GEMEJD.EENHEDLBNR = DCLBQ78000T.EENHEDLBNR;                    
         GEMEJD.C_SÆLGER   = DCLBQ78000T.TILEVS_C_SÆLGER;               
         GEMEJD.CHELÅR     = DCLBQ78000T.TILEVS_CHELÅR;                 
                                                                        
         DO WHILE (CHELÅR_DATA_FUNDET);                                 
           TV.LÆS_BH942 = TV.LÆS_BH942 + 1;                             
           CALL SELECT_MT;                                              
           IF GEMEJD.EKOMNR     ^= DCLBQ78000T.EKOMNR !                 
              GEMEJD.EEJDNR     ^= DCLBQ78000T.EEJDNR !                 
              GEMEJD.EENHEDLBNR ^= DCLBQ78000T.EENHEDLBNR !             
              GEMEJD.C_SÆLGER   ^= DCLBQ78000T.TILEVS_C_SÆLGER          
           THEN                                                         
             DO;                                                        
               GEMEJD.EKOMNR   = DCLBQ78000T.EKOMNR;                    
               GEMEJD.EEJDNR   = DCLBQ78000T.EEJDNR;                    
               GEMEJD.EENHEDLBNR = DCLBQ78000T.EENHEDLBNR;              
               GEMEJD.C_SÆLGER = DCLBQ78000T.TILEVS_C_SÆLGER;           
               GEMEJD.CHELÅR   = DCLBQ78000T.TILEVS_CHELÅR;             
             END;                                                       
           ELSE                                                         
             CALL BEHANDL_CHELÅR_OVFØRSEL;                              
                                                                        
           CALL OPDATER_CHELÅR_EJENDOMSTYPE;                            
           CALL UPDATE_RESULTAT_CHELÅR;                                 
           CALL KONTROL_OPTÆL;                                          
           CALL FETCH_CHELÅR_CUR;                                       
         END;                                                           
                                                                        
         CALL CLOSE_CHELÅR_CUR;                                         
                                                                        
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /********************************************************************* 
 *       PERSONER SOM EVT. SKAL BEHANDLES/BEREGNES                    * 
 *********************************************************************/ 
 BEHANDL: PROC;                                                         
                                                                        
                                                                        
         /* INITIER HJÆLPEFELTER */                                     
         DCLBQ78000T.TILEVS_C_SÆLGER   = '0';                           
         DCLBQ78000T.TILEVS_CHELÅR     = '0';                           
         DCLBQ78000T.TILEVS_CHELÅR_FOR = '0';                           
         DCLBQ78000T.TILEVS_CHELÅR_ORD = '0';                           
         CHELÅRBBR        = '0';                                        
         CHELÅRESR        = '0';                                        
                                                                        
         /*Planlov for slut 2017                               */       
         /* i filen løsningen ligger reglerne i BH94100L       */       
         /* og BH94200L                                        */       
         /* flyttet op for at få felterne opsat enes med fil   */       
         /* løsning                                            */       
                                                                        
         IF DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ  >  0 &                      
            DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ  <  20170615                 
         THEN                                                           
           DO;                                                          
             CHELÅR_ANTAL_ÅR = 8;                                       
             DATO_CHELÅR = DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ;              
           END;                                                         
         ELSE                                                           
           DO;                                                          
             CHELÅR_ANTAL_ÅR = 1;                                       
             IF DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ  >=  20170615            
             THEN                                                       
               DATO_CHELÅR = DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ;            
             ELSE /*ikke afstået */                                     
               DATO_CHELÅR = 99991231;                                  
           END;                                                         
                                                                        
         /* UNDSØG OM DER SKAL OVERFØRES CHELÅR_REGL*/                  
         /* OG DATO_CHELÅR FRA FORGÅENDE RECORD     */                  
                                                                        
         IF GEM_DCPRN   = DCLBQ78000T.DCPRN  &                          
            GEM_EKOMNR  = DCLBQ78000T.EKOMNR &                          
            GEM_EEJDNR  = DCLBQ78000T.EEJDNR &                          
            GEM_EENHEDLBNR = DCLBQ78000T.EENHEDLBNR                     
         THEN                                                           
           DO; /*SAMME EJERFORHOLD*/                                    
             IF GEM_DOVTG_GL = DCLBQ78000T.TILEVS_A_EJ_DOVTG_GL &       
                DCLBQ78000T.TILEVS_A_EJ_DOVTG_GL > 0                    
             THEN                                                       
               DO;                                                      
                 /* DET ER KUN VÆRDIEN 1 SOM OVERFØRES */               
                 IF GEM_CHELÅR_ANTAL_ÅR = 1                             
                 THEN                                                   
                   DO;                                                  
                     CHELÅR_ANTAL_ÅR    = GEM_CHELÅR_ANTAL_ÅR;          
                     IF GEM_DATO_CHELÅR > DATO_CHELÅR                   
                     THEN                                               
                       DATO_CHELÅR = GEM_DATO_CHELÅR;                   
                       TV.ÆNDRET_CHELÅR_REGL =                          
                                   TV.ÆNDRET_CHELÅR_REGL + 1;           
                   END;                                                 
                 ELSE                                                   
                   DO;                                                  
                     IF GEM_DATO_CHELÅR > DATO_CHELÅR                   
                     THEN                                               
                       DATO_CHELÅR = GEM_DATO_CHELÅR;                   
                   END;                                                 
               END;                                                     
             ELSE                                                       
               DO;  /* NY EJER PERIODE- NY DOVTG_GL */                  
                  GEM_DCPRN      = DCLBQ78000T.DCPRN;                   
                  GEM_EKOMNR     = DCLBQ78000T.EKOMNR;                  
                  GEM_EEJDNR     = DCLBQ78000T.EEJDNR;                  
                  GEM_EENHEDLBNR = DCLBQ78000T.EENHEDLBNR;              
                  GEM_DOVTG_GL   = DCLBQ78000T.TILEVS_A_EJ_DOVTG_GL;    
                  GEM_CHELÅR_ANTAL_ÅR = CHELÅR_ANTAL_ÅR;                
                  GEM_DATO_CHELÅR  = DATO_CHELÅR;                       
               END;                                                     
           END; /*SAMME EJERFORHOLD*/                                   
         ELSE                                                           
           DO;  /* NYT  EJERFORHOLD */                                  
              GEM_DCPRN    = DCLBQ78000T.DCPRN;                         
              GEM_EKOMNR   = DCLBQ78000T.EKOMNR;                        
              GEM_EEJDNR   = DCLBQ78000T.EEJDNR;                        
              GEM_EENHEDLBNR = DCLBQ78000T.EENHEDLBNR;                  
              GEM_DOVTG_GL = DCLBQ78000T.TILEVS_A_EJ_DOVTG_GL;          
              GEM_CHELÅR_ANTAL_ÅR = CHELÅR_ANTAL_ÅR;                    
              GEM_DATO_CHELÅR     = DATO_CHELÅR;                        
           END;                                                         
                                                                        
                                                                        
                                                                        
         /*#01 TAG HENSYN TIL AFSTÅELSES DATO FOR CHELÅR*/              
         IF DATO_CHELÅR > 0                                             
         THEN                                                           
           DO;                                                          
             /* DATO TIL BESTMMELSE AF CHELÅR FOR EVS SLUT*/            
             IF DATO_CHELÅR >= HJ_DATO1                                 
             THEN                                                       
               CHELÅR_SLUT_DATO = HJ_DATO1;                             
             ELSE                                                       
               CHELÅR_SLUT_DATO = DATO_CHELÅR;                          
                                                                        
             /* DATO TIL BESTMMELSE AF CHELÅR FOR EVS FORSKUD*/         
             IF DATO_CHELÅR >= HJ_DATO2                                 
             THEN                                                       
               CHELÅR_FORSK_DATO = HJ_DATO2;                            
             ELSE                                                       
               CHELÅR_FORSK_DATO = DATO_CHELÅR;                         
           END;                                                         
         ELSE /* HVIS DATO_CHELÅR IKKE ER BLEVET SAT */                 
           DO;                                                          
             CHELÅR_SLUT_DATO  = HJ_DATO1;                              
             CHELÅR_FORSK_DATO = HJ_DATO2;                              
           END;                                                         
                                                                        
         /* Nye felter 2018-03-12 på BQ78000T */                        
         HJ_PIC1 = CHELÅR_ANTAL_ÅR;                                     
         DCLBQ78000T.TILEVS_CHELÅR_REGL = HJ_PIC1;                      
         DCLBQ78000T.TILEVS_DATO_CHELÅR = DATO_CHELÅR;                  
                                                                        
         /* slut på planlov 2017 */                                     
                                                                        
         IF (DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ > 0 &                       
             DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ <                           
                           DCLBQ78000T.TILEVS_A_EJ_DRGNÅRFRA)           
         THEN                                                           
            DO;                                                         
               /*        SALG FØR INDKOMSTÅRET SPRINGES OVER         */ 
               CALL SKRIV_UDTRÆK;                                       
               RETURN;                                                  
            END;                                                        
                                                                        
         IF MT_FUNDET                                                   
         THEN DO;                                                       
            IF (DCLBQ78000T.TILEVS_DAFSTAA > 0 &                        
                DCLBQ78000T.TILEVS_DAFSTAA < DCLBQ76000T.DRGNÅRFRA)     
            THEN                                                        
               DO;                                                      
                  /*   SALG FØR INDKOMSTÅRET SPRINGES OVER    */        
                  CALL SKRIV_UDTRÆK;                                    
                  RETURN;                                               
               END;                                                     
         END;                                                           
                                                                        
         IF DCLBQ78000T.TILEVS_A_EJ_BOPÆLSKODE > '0'                    
         THEN;                                                          
         ELSE                                                           
            DO;                                                         
               /* EJEREN BOR IKKE PÅ ADRESSEN JVF. P-DATA */            
               /* D.V.S. INGEN BEHANDLING!                */            
               CALL SKRIV_UDTRÆK;                                       
               RETURN;                                                  
            END;                                                        
                                                                        
                                                                        
                                                                        
         /*************************************************************/
         /* HEREFTER BLIVER FØLGENDE 4 KODER EVT. OPSAT.              */
         /*                                                           */
         /* C_SÆLGER : 0 BETYDER PERSONEN ER IKKE EN SÆLGER           */
         /*          : 1 BETYDER PERSONEN ER EN SÆLGER                */
         /*                                                           */
         /* CHELÅR:                                                   */
         /* 0 BETYDER OPFYLDER IKKE KRAV TIL 2% BEREGNING             */
         /* 1 KUN SIDSTE_ÅR OPFYLDER KRAV MEN IKKE JVF. BBR           */
         /* 2 KUN SIDSTE_ÅR OPFYLDER KRAV MEN KUN JVF. BBR            */
         /* 3 KUN SIDSTE_ÅR OPFYLDER KRAV BÅDE JVF. BBR OG 8 ÅRS      */
         /* 4 KUN AKT_ÅR OPFYLDER KRAV MEN IKKE JVF. BBR              */
         /* 5 KUN AKT_ÅR OPFYLDER KRAV MEN KUN JVF. BBR               */
         /* 6 KUN AKT_ÅR OPFYLDER KRAV BÅDE JVF. BBR OG 8 ÅRS         */
         /* 7 SIDSTE_ÅR+AKT_ÅR OPFYLDER KRAV MEN IKKE JVF. BBR        */
         /* 8 SIDSTE_ÅR+AKT_ÅR OPFYLDER KRAV MEN KUN JVF. BBR         */
         /* 9 SIDSTE_ÅR+AKT_ÅR OPFYLDER KRAV JVF BBR OG/ELLER 8 ÅRS   */
         /*                                                           */
         /* CHELÅR_ORD                                                */
         /* OG                                                        */
         /* CHELÅR_FOR : 0 BETYDER OPFYLDER IKKE EFTERFØLGENDE KRAV:  */
         /* 0 BETYDER OPFYLDER IKKE EFTERFØLGENDE KRAV:               */
         /* 1 OPFYLDER MINDST 1 AF BETINGELSERNE 67 ÅR                */
         /* 2 OPFYLDER MINDST 1 AF BETINGELSERNE 60-66 ÅR             */
         /* 3 OPFYLDER MINDST 1 AF BETINGELSERNE < 60 ÅR              */
         /* 4 DISPENSATION OVERFØRT FRA ANDEN EJER (OPSÆT-            */
         /*   TES EVT. I BH64400-SAMKØRING AF ALLE EJERE).            */
         /*                                                           */
         /*************************************************************/
                                                                        
         CALL TEST_BBROPLYS;                                            
                                                                        
         CALL OPSÆT_CHELÅR; /* OPFYLDES BBR OG/ELLER 1 ÅR'S REGEL */    
                                                                        
         CALL SKRIV_UDTRÆK;                                             
                                                                        
 END BEHANDL;                                                           
 /*********************************************************************/
 /*      OPSÆT EVT. 2 PCT BEREGNINGSKODE P.G.A. BBRF379 OG BBRF380    */
 /*********************************************************************/
 TEST_BBROPLYS:PROC;                                                    
                                                                        
         IF DCLBQ75000T.OPL_BBRF379 < 'A' /* HVIS INGEN DISPENSATION  */
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF DCLBQ75000T.OPL_BBRF380 > '0000' & /* HVIS UDLØBET DISP  */ 
            DCLBQ75000T.OPL_BBRF380 < INDKÅR1 /* FØR AKTUELT INDKÅR  */ 
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF DCLBQ75000T.OPL_BBRF380 = INDKÅR1 /* HVIS GÆLDER KUN TIL */ 
         THEN                           /* OG MED AKTUELT INDKOMSTÅR */ 
            CHELÅRBBR = '1';                                            
                                                                        
         IF DCLBQ75000T.OPL_BBRF380 <= '0000' ! /* HVIS GÆLDER */       
                                                /* 'BEGGE' ÅR     */    
            DCLBQ75000T.OPL_BBRF380 > INDKÅR1                           
         THEN                                                           
            CHELÅRBBR = '3';                                            
                                                                        
                                                                        
 END TEST_BBROPLYS;                                                     
                                                                        
 /**********************************************************************
 *   FØRST OPSÆTTES CHELÅR_ORD OG CHELÅR_FOR OG DEREFTER               *
 *   UNDERSØGES OM PERSONEN HAR EJET EJENDOMMEN I MINDST ET ÅR         *
 *   PR. 31.12 I AKTUELT INDKOMSTÅR OG SAMTIDIG OPFYLDER EN            *
 *   AF BETINGELSERNE FOR HELÅRSBEBOELSE.                              *
 *   CHELÅR OPSÆTTES UDFRA 1 ÅRS REGLEN OG/ELLER DISP. JVF. BBR.       *
 **********************************************************************/
 OPSÆT_CHELÅR: PROC;                                                    
                                                                        
         /* FØRST LAVES OPSÆTNING FOR AKTUELT SLUTÅR */                 
                                                                        
         IF DCLBQ78000T.TILEVS_CPTYPSLUT = '3' !                        
           (DCLBQ78000T.TILEVS_CPTYPSLUT = '4' &                        
            DCLBQ78000T.TILEVS_CSKPLOMF  = '8')                         
         THEN                                                           
            DCLBQ78000T.TILEVS_CHELÅR_ORD = '1';   /*Alderspensionist*/ 
         ELSE                                      /*i aktuelt slutår*/ 
            IF DCLBQ78000T.TILEVS_CPTYPSLUT = '2'                       
            THEN                                                        
               DCLBQ78000T.TILEVS_CHELÅR_ORD = '2';/* FØRTPENS/EFTLØN */
                                                                        
         /* SÅ LAVES EVT. OPSÆTNING FOR AKTUELT FORSKUDSÅR */           
                                                                        
         DCLBQ78000T.TILEVS_CHELÅR_FOR = '0';                           
                                                                        
         IF DCLBQ78000T.TILEVS_CPTYPFOR = '3' !                         
           (DCLBQ78000T.TILEVS_CPTYPFOR = '4' &                         
            DCLBQ78000T.TILEVS_CSKPLOMF  = '8')                         
         THEN                                                           
            DCLBQ78000T.TILEVS_CHELÅR_FOR = '1';  /* Alderspensionist*/ 
         ELSE                                     /*i   forskudsåret*/  
            IF DCLBQ78000T.TILEVS_CPTYPFOR = '2'                        
            THEN                                                        
               DCLBQ78000T.TILEVS_CHELÅR_FOR = '2'; /* FØRPENS/EFTLØN */
                                                                        
         /* FØRST UNDERSØGES AKTUELT INDKOMSTÅR */                      
         /* ÆNDRET TIL PLANLOV SLUT 2017 QEB    */                      
         IF TEST_EJET_ANTAL_ÅR_OK(DCLBQ78000T.TILEVS_DATO0107,          
                                 CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)  &   
            DCLBQ78000T.TILEVS_CHELÅR_ORD > '0'                         
         THEN                                                           
           CHELÅRESR = '1';      /* 1 ÅR OK I SLUT*/                    
         ELSE                                                           
           CHELÅRESR = '0';      /* 1 ÅR IKKE OK I SLUT */              
                                                                        
         /* SÅ UNDERSØGES AKTUELT FORSKUDSÅR */                         
         /* ÆNDRET TIL PLANLOV SLUT 2017 QEB    */                      
         IF TEST_EJET_ANTAL_ÅR_OK(DCLBQ78000T.TILEVS_DATO0107,          
                                  CHELÅR_FORSK_DATO,CHELÅR_ANTAL_ÅR) &  
            DCLBQ78000T.TILEVS_CHELÅR_FOR > '0'                         
         THEN                                                           
            DO;                                                         
              IF CHELÅRESR = '0'                                        
              THEN                                                      
                CHELÅRESR = '2';   /* 1 ÅR OK KUN I FORSKUD */          
              ELSE                                                      
                CHELÅRESR = '3';   /* 1 ÅR OK BÅDE I SLUT OG FORSKUD*/  
            END;                                                        
                                                                        
                                                                        
         /* SÅ OPSÆTTES DCLBQ78000T.TILEVS_CHELÅR        */             
         /* P.G.A. AF OM BBR OG/ELLER 1 ÅRS */                          
         /* REGEL GIVER DISPENSATION.       */                          
                                                                        
         SELECT;                                                        
           WHEN (CHELÅRBBR = '0' & CHELÅRESR = '1')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '1';                          
             END;                                                       
           WHEN (CHELÅRBBR = '0' & CHELÅRESR = '2')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '4';                          
             END;                                                       
           WHEN (CHELÅRBBR = '0' & CHELÅRESR = '3')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '7';                          
             END;                                                       
           WHEN (CHELÅRBBR = '1' & CHELÅRESR = '0')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '2';                          
             END;                                                       
           WHEN (CHELÅRBBR = '1' & CHELÅRESR = '1')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '3';                          
             END;                                                       
           WHEN (CHELÅRBBR = '1' & CHELÅRESR = '2')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '9';                          
             END;                                                       
           WHEN (CHELÅRBBR = '1' & CHELÅRESR = '3')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '9';                          
             END;                                                       
           WHEN (CHELÅRBBR = '2' & CHELÅRESR = '0')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '5';                          
             END;                                                       
           WHEN (CHELÅRBBR = '2' & CHELÅRESR = '1')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '9';                          
             END;                                                       
           WHEN (CHELÅRBBR = '2' & CHELÅRESR = '2')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '6';                          
             END;                                                       
           WHEN (CHELÅRBBR = '2' & CHELÅRESR = '3')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '9';                          
             END;                                                       
           WHEN (CHELÅRBBR = '3' & CHELÅRESR = '0')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '8';                          
             END;                                                       
           WHEN (CHELÅRBBR = '3' & CHELÅRESR = '1')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '9';                          
             END;                                                       
           WHEN (CHELÅRBBR = '3' & CHELÅRESR = '2')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '9';                          
             END;                                                       
           WHEN (CHELÅRBBR = '3' & CHELÅRESR = '3')                     
             DO;                                                        
               DCLBQ78000T.TILEVS_CHELÅR= '9';                          
             END;                                                       
           OTHERWISE                                                    
               DCLBQ78000T.TILEVS_CHELÅR= '0';                          
         END;                                                           
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR > '0' &                           
            DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ > 0 &                        
           (DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ >=                           
                           DCLBQ78000T.TILEVS_A_EJ_DRGNÅRFRA &          
            DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ <=                           
                           DCLBQ78000T.TILEVS_A_EJ_DRGNÅRTIL)           
         THEN                                                           
            /* HVIS EJEREN HAR SOLGT    */                              
            /* EJENDOMMEN I INDKOMSTÅRET */                             
            DCLBQ78000T.TILEVS_C_SÆLGER = '1';                          
         ELSE                                                           
            DCLBQ78000T.TILEVS_C_SÆLGER = '0';                          
                                                                        
 END OPSÆT_CHELÅR;                                                      
 /********************************************************************* 
 *       HER SKRIVES UDTRÆK EFTER EVT. BEHANDLING.                    * 
 *       A L L E  LÆSTE INDIVIDER SKRIVES IDET EVT. AFLUSNING AF IKKE * 
 *       BEHANDLEDE INDIVIDER UDELUKKENDE SKAL SKE I FORBINDELSE MED  * 
 *       BEREGNING AF EVS TIL SLUT ELLER FORSKUD.                     * 
 *********************************************************************/ 
 SKRIV_UDTRÆK:                                                          
         PROC;                                                          
                                                                        
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR > '0' &                           
            DCLBQ78000T.TILEVS_A_EJ_FEJER > 1                           
         THEN                                                           
            TV.FL_EJER = TV.FL_EJER + 1;                                
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR >= '1' &                          
            DCLBQ78000T.TILEVS_CHELÅR <= '3'                            
         THEN                                                           
            TV.FKUN_SIDSTE_ÅR = TV.FKUN_SIDSTE_ÅR + 1;                  
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR >= '4' &                          
            DCLBQ78000T.TILEVS_CHELÅR <= '6'                            
         THEN                                                           
            TV.FKUN_AKT_ÅR = TV.FKUN_AKT_ÅR + 1;                        
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR >= '7' &                          
            DCLBQ78000T.TILEVS_CHELÅR <= '9'                            
         THEN                                                           
            TV.FBEGGE = TV.FBEGGE + 1;                                  
                                                                        
         /* flyttet til efter optælling QEB 2017-11-20*/                
         /* U skal også med 2017-12-13 */                               
         IF BH842_PARM.FS_MRK = 'S' !                                   
            BH842_PARM.FS_MRK = 'U'                                     
         THEN                                                           
            CALL TILPAS_SLUT_CHELÅR;                                    
                                                                        
                                                                        
         DCLBQ78000T.SORT_SALG  = DCLBQ78000T.TILEVS_C_SÆLGER;          
         DCLBQ78000T.SORT_HELÅR = DCLBQ78000T.TILEVS_CHELÅR;            
                                                                        
         /* flyttet op her var tidligere i BH94400L QEB */              
         IF DCLBQ75000T.OPL_BBRF380 = '0001'         /*#GEH */          
         THEN                                                           
            DCLBQ75000T.OPL_BBRF380 = '0000';                           
                                                                        
         CALL UPDATE_RESULTAT;                                          
                                                                        
         TV.SKREVNE = TV.SKREVNE + 1;                                   
                                                                        
 END SKRIV_UDTRÆK;                                                      
                                                                        
 /********************************************************************* 
 *       Koden fra BH94400 er indlagt her                             * 
 *       Opdatering af sommerhuse som helårsbeboelse                  * 
 *       Der er ænderet i reglsættet til Forskud 2019 så              * 
 *       CHELÅR kun ændres på dem som pensionist med                  * 
 *       fuld skattepligt i Danmark, det medfører at                  * 
 *       ejendomstypen kun ændres for disse                           * 
 *********************************************************************/ 
 BEHANDL_CHELÅR_OVFØRSEL: PROC;                                         
                                                                        
                                                                        
         IF DCLBQ78000T.TILEVS_A_EJ_BOPÆLSKODE > '0' &                  
            DCLBQ78000T.TILEVS_CHELÅR < GEMEJD.CHELÅR                   
         THEN                                                           
            DO;                                                         
               /* FØRST UNDERSØGES SIDSTE ÅR OG DER OVERFØRES   */      
               /* KUN HVIS PERSONEN ER '65/67 ÅRIG' M.V.   */           
                                                                        
              IF  DCLBQ78000T.TILEVS_CPTYPSLUT = '3' !                  
                 (DCLBQ78000T.TILEVS_CPTYPSLUT = '4' &                  
                  DCLBQ78000T.TILEVS_CSKPLOMF  = '8')                   
              THEN                                                      
                DO;                                                     
                  /* overførelse af CHELÅR kode */                      
                  DCLBQ78000T.TILEVS_CHELÅR = GEMEJD.CHELÅR;            
                                                                        
                  SELECT (DCLBQ78000T.TILEVS_CHELÅR);                   
                    WHEN ('1','2','3','7','8','9')                      
                      DO;                                               
                        DCLBQ78000T.TILEVS_CHELÅR_ORD = '4';            
                      END;                                              
                    OTHERWISE;                                          
                  END; /*SELECT*/                                       
                END;                                                    
                /* OG SÅ UNDERSØGES AKT ÅR OG DER OVERFØRES   */        
                /* KUN HVIS PERSONEN ER '65/67 ÅRIG' M.V.   */          
                                                                        
              IF  DCLBQ78000T.TILEVS_CPTYPFOR = '3' !                   
                 (DCLBQ78000T.TILEVS_CPTYPFOR = '4' &                   
                  DCLBQ78000T.TILEVS_CSKPLOMF  = '8')                   
              THEN                                                      
                DO;                                                     
                  /* overførelse af CHELÅR kode */                      
                  DCLBQ78000T.TILEVS_CHELÅR = GEMEJD.CHELÅR;            
                                                                        
                  SELECT (DCLBQ78000T.TILEVS_CHELÅR);                   
                    WHEN ('4','5','6','7','8','9')                      
                      DO;                                               
                        DCLBQ78000T.TILEVS_CHELÅR_FOR = '4';            
                      END;                                              
                    OTHERWISE;                                          
                  END; /*SELECT*/                                       
                END;                                                    
            END;                                                        
                                                                        
 END BEHANDL_CHELÅR_OVFØRSEL;                                           
 /*********************************************************************/
 OPDATER_CHELÅR_EJENDOMSTYPE:PROC;                                      
                                                                        
         /* Helårs beboelse for SLUTÅR*/                                
         IF (DCLBQ78000T.TILEVS_CHELÅR >= '1' &                         
             DCLBQ78000T.TILEVS_CHELÅR <= '3') !                        
                  (DCLBQ78000T.TILEVS_CHELÅR >= '7' &                   
                   DCLBQ78000T.TILEVS_CHELÅR <= '9')                    
               THEN                                                     
                  DO;                                                   
                     TV.F_SIDSTE_HELÅR = TV.F_SIDSTE_HELÅR + 1;         
                     IF DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT = '3'         
                     THEN                                               
                        DO;                                             
                           DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT = '1';     
                           TV.FSEJDTYP3Æ = TV.FSEJDTYP3Æ + 1;           
                        END;                                            
                     ELSE                                               
                        DO;                                             
                           DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT = '7';     
                           TV.FSEJDTYP8Æ = TV.FSEJDTYP8Æ + 1;           
                        END;                                            
                  END;                                                  
                                                                        
         /* Helårs beboelse for FORSKUDÅR*/                             
         IF (DCLBQ78000T.TILEVS_CHELÅR >= '4' &                         
             DCLBQ78000T.TILEVS_CHELÅR <= '9')                          
         THEN                                                           
            DO;                                                         
               TV.F_AKT_HELÅR = TV.F_AKT_HELÅR + 1;                     
               IF DCLBQ78000T.EJERSKAB_CEJDTYPE = '3'                   
               THEN                                                     
                  DO;                                                   
                     DCLBQ78000T.EJERSKAB_CEJDTYPE = '1';               
                     TV.FFEJDTYP3Æ = TV.FFEJDTYP3Æ + 1;                 
                  END;                                                  
               ELSE                                                     
                  DO;                                                   
                     DCLBQ78000T.EJERSKAB_CEJDTYPE = '7';               
                     TV.FFEJDTYP8Æ = TV.FFEJDTYP8Æ + 1;                 
                  END;                                                  
            END;                                                        
                                                                        
 END OPDATER_CHELÅR_EJENDOMSTYPE;                                       
 /********************************************************************* 
 *       OPTÆL INDIVIDER TIL STATISTIK                                * 
 *********************************************************************/ 
 KONTROL_OPTÆL:PROC;                                                    
                                                                        
         IF (DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ > 0 &                       
             DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ <                           
             DCLBQ78000T.TILEVS_A_EJ_DRGNÅRFRA)                         
         THEN                                                           
            RETURN;                     /* SALG FØR INDKOMSTÅRET */     
                                        /* SPRINGES OVER         */     
                                                                        
         INDX = DCLBQ75000T.EKOMNR;                                     
         STAT_SIDSTE_ÅR(INDX).CLIN = 1;                                 
         STAT_AKT_ÅR(INDX).CLIN = 1;                                    
                                                                        
         IF DCLBQ78000T.TILEVS_A_EJ_BOPÆLSKODE > '0'                    
         THEN;                                                          
         ELSE                                                           
            DO;                                                         
               TV.FSOM_UBOP = TV.FSOM_UBOP + 1;                         
               /* OPTÆL INDIVIDER UDEN BOPÆLSKODE  */                   
               /* MEN MED DISP. IFLG. BBR F379     */                   
               IF (DCLBQ75000T.OPL_BBRF379 >= 'A' &                     
                   DCLBQ75000T.OPL_BBRF379 <= 'D') &                    
                  (DCLBQ75000T.OPL_BBRF380 <= '0000' !                  
                   DCLBQ75000T.OPL_BBRF380 >= BH65300M.INDKÅR1)         
               THEN                                                     
                  CALL OPTÆL_EJ_BOPÆL;                                  
               RETURN;                                                  
            END;                                                        
                                                                        
         TV.FSOM_MBOP = TV.FSOM_MBOP + 1;                               
                                                                        
         /* FØRST OPTÆLLES VEDR. SIDSTE ÅR */                           
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR_ORD = '1'                         
         THEN                                                           
            CALL OPTÆL_SIDSTE_ÅR_67;                                    
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR_ORD = '4'                         
         THEN                                                           
            CALL OPTÆL_SIDSTE_ÅR_OVF;                                   
                                                                        
         /* SÅ OPTÆLLES VEDR. AKTUELT ÅR   */                           
         /* MEN IKKE SÆLGERE       */                                   
                                                                        
         IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'                           
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR_FOR = '1'                         
         THEN                                                           
            CALL OPTÆL_AKT_ÅR_67;                                       
                                                                        
         IF DCLBQ78000T.TILEVS_CHELÅR_FOR = '4'                         
         THEN                                                           
            CALL OPTÆL_AKT_ÅR_OVF;                                      
                                                                        
 END KONTROL_OPTÆL;                                                     
 /*********************************************************************/
 OPTÆL_SIDSTE_ÅR_67: PROC;                                              
                                                                        
         /* OPTÆL HVIS EJER'S PERSONTYPE ER */                          
         /* OPSAT SOM 65/67-ÅRIG M.V.       */                          
         /* D.V.S. IKKE HELÅRSBEREGNING     */                          
                                                                        
         STAT_SIDSTE_ÅR(INDX).PLIN(1).IALT =                            
         STAT_SIDSTE_ÅR(INDX).PLIN(1).IALT + 1;                         
         STAT_SIDSTE_ÅR(100).PLIN(1).IALT =                             
         STAT_SIDSTE_ÅR(100).PLIN(1).IALT + 1;                          
                                                                        
                                                                        
         /* Der tages ikke højde for delsalg/køb i optællingerne */     
         /* alle optælles efter 1 års regl                       */     
         CHELÅR_ANTAL_ÅR         = 1;                                   
         CHELÅR_SLUT_DATO = HJ_DATO1;                                   
                                                                        
                                                                        
         IF TEST_EJET_ANTAL_ÅR_OK(DCLBQ78000T.TILEVS_DATO0107,          
                                 CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)  &   
                                 DCLBQ78000T.TILEVS_C_SÆLGER < '1'      
         THEN                                                           
           DO;                                                          
              STAT_SIDSTE_ÅR(INDX).PLIN(2).IALT =                       
              STAT_SIDSTE_ÅR(INDX).PLIN(2).IALT + 1;                    
              STAT_SIDSTE_ÅR(100).PLIN(2).IALT =                        
              STAT_SIDSTE_ÅR(100).PLIN(2).IALT + 1;                     
           END;                                                         
                                                                        
         IF DCLBQ78000T.TILEVS_C_SÆLGER = '1' &                         
           (TEST_EJET_ANTAL_ÅR_OK(DCLBQ78000T.TILEVS_DATO0107,          
                                 CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)  !   
           ((DCLBQ75000T.OPL_BBRF379 >= 'A' &                           
             DCLBQ75000T.OPL_BBRF379 <= 'D') &                          
            (DCLBQ75000T.OPL_BBRF380 <= '0000' !                        
             DCLBQ75000T.OPL_BBRF380 >= BH65300M.INDKÅR1)))             
         THEN                                                           
           DO;                                                          
              STAT_SIDSTE_ÅR(INDX).PLIN(4).IALT =                       
              STAT_SIDSTE_ÅR(INDX).PLIN(4).IALT + 1;                    
              STAT_SIDSTE_ÅR(100).PLIN(4).IALT =                        
              STAT_SIDSTE_ÅR(100).PLIN(4).IALT + 1;                     
           END;                                                         
                                                                        
         IF (DCLBQ75000T.OPL_BBRF379 >= 'A' &                           
             DCLBQ75000T.OPL_BBRF379 <= 'D') &                          
            (DCLBQ75000T.OPL_BBRF380 <= '0000' !                        
             DCLBQ75000T.OPL_BBRF380 >= BH65300M.INDKÅR1)               
         THEN                                                           
            DO;                                                         
               SELECT (DCLBQ75000T.OPL_BBRF379);                        
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).A379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).A379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).A379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).A379 + 1;             
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).A379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).A379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).A379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).A379 + 1;        
                        END;                                            
                      ELSE                                              
                        IF TEST_EJET_ANTAL_ÅR_OK(                       
                                 DCLBQ78000T.TILEVS_DATO0107,           
                                 CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)      
                        THEN                                            
                          DO;                                           
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).A379 =       
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).A379 + 1;    
                              STAT_SIDSTE_ÅR(100).PLIN(2).A379 =        
                              STAT_SIDSTE_ÅR(100).PLIN(2).A379 + 1;     
                          END;                                          
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).B379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).B379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).B379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).B379 + 1;             
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).B379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).B379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).B379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).B379 + 1;        
                        END;                                            
                      ELSE                                              
                        IF TEST_EJET_ANTAL_ÅR_OK(                       
                                 DCLBQ78000T.TILEVS_DATO0107,           
                                 CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)      
                         THEN                                           
                           DO;                                          
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).B379 =       
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).B379 + 1;    
                              STAT_SIDSTE_ÅR(100).PLIN(2).B379 =        
                              STAT_SIDSTE_ÅR(100).PLIN(2).B379 + 1;     
                           END;                                         
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).C379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).C379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).C379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).C379 + 1;             
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).C379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).C379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).C379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).C379 + 1;        
                        END;                                            
                      ELSE                                              
                         IF TEST_EJET_ANTAL_ÅR_OK(                      
                                 DCLBQ78000T.TILEVS_DATO0107,           
                                 CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)      
                         THEN                                           
                           DO;                                          
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).C379 =       
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).C379 + 1;    
                              STAT_SIDSTE_ÅR(100).PLIN(2).C379 =        
                              STAT_SIDSTE_ÅR(100).PLIN(2).C379 + 1;     
                           END;                                         
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).D379 =               
                      STAT_SIDSTE_ÅR(INDX).PLIN(1).D379 + 1;            
                      STAT_SIDSTE_ÅR(100).PLIN(1).D379 =                
                      STAT_SIDSTE_ÅR(100).PLIN(1).D379 + 1;             
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).D379 =          
                           STAT_SIDSTE_ÅR(INDX).PLIN(4).D379 + 1;       
                           STAT_SIDSTE_ÅR(100).PLIN(4).D379 =           
                           STAT_SIDSTE_ÅR(100).PLIN(4).D379 + 1;        
                        END;                                            
                      ELSE                                              
                         IF TEST_EJET_ANTAL_ÅR_OK(                      
                                 DCLBQ78000T.TILEVS_DATO0107,           
                                 CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)      
                         THEN                                           
                           DO;                                          
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).D379 =       
                              STAT_SIDSTE_ÅR(INDX).PLIN(2).D379 + 1;    
                              STAT_SIDSTE_ÅR(100).PLIN(2).D379 =        
                              STAT_SIDSTE_ÅR(100).PLIN(2).D379 + 1;     
                           END;                                         
                   END;                                                 
                 OTHERWISE;                                             
               END;  /* SELECT (DCLBQ75000T.OPL_BBRF379) */             
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_SIDSTE_ÅR(INDX).PLIN(1).U379 =                      
               STAT_SIDSTE_ÅR(INDX).PLIN(1).U379 + 1;                   
               STAT_SIDSTE_ÅR(100).PLIN(1).U379 =                       
               STAT_SIDSTE_ÅR(100).PLIN(1).U379 + 1;                    
               IF TEST_EJET_ANTAL_ÅR_OK(                                
                                DCLBQ78000T.TILEVS_DATO0107,            
                                CHELÅR_SLUT_DATO,CHELÅR_ANTAL_ÅR)       
               THEN                                                     
                 DO;                                                    
                    IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'                
                    THEN                                                
                      DO;                                               
                         STAT_SIDSTE_ÅR(INDX).PLIN(4).U379 =            
                         STAT_SIDSTE_ÅR(INDX).PLIN(4).U379 + 1;         
                         STAT_SIDSTE_ÅR(100).PLIN(4).U379 =             
                         STAT_SIDSTE_ÅR(100).PLIN(4).U379 + 1;          
                      END;                                              
                    ELSE                                                
                      DO;                                               
                         STAT_SIDSTE_ÅR(INDX).PLIN(2).U379 =            
                         STAT_SIDSTE_ÅR(INDX).PLIN(2).U379 + 1;         
                         STAT_SIDSTE_ÅR(100).PLIN(2).U379 =             
                         STAT_SIDSTE_ÅR(100).PLIN(2).U379 + 1;          
                      END;                                              
                 END;                                                   
            END;                                                        
                                                                        
 END OPTÆL_SIDSTE_ÅR_67;                                                
 /*********************************************************************/
 OPTÆL_SIDSTE_ÅR_OVF: PROC;                                             
                                                                        
         STAT_SIDSTE_ÅR(INDX).PLIN(13).IALT =                           
         STAT_SIDSTE_ÅR(INDX).PLIN(13).IALT + 1;                        
         STAT_SIDSTE_ÅR(100).PLIN(13).IALT =                            
         STAT_SIDSTE_ÅR(100).PLIN(13).IALT + 1;                         
         IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'                           
         THEN                                                           
           DO;                                                          
              STAT_SIDSTE_ÅR(INDX).PLIN(14).IALT =                      
              STAT_SIDSTE_ÅR(INDX).PLIN(14).IALT + 1;                   
              STAT_SIDSTE_ÅR(100).PLIN(14).IALT =                       
              STAT_SIDSTE_ÅR(100).PLIN(14).IALT + 1;                    
           END;                                                         
                                                                        
         IF DCLBQ75000T.OPL_BBRF380  = '    ' !                         
            DCLBQ75000T.OPL_BBRF380  = '0000' !                         
            DCLBQ75000T.OPL_BBRF380 >= BH65300M.INDKÅR1                 
         THEN                                                           
            DO;                                                         
               SELECT (DCLBQ75000T.OPL_BBRF379);                        
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).A379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).A379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).A379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).A379 + 1;            
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).A379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).A379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).A379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).A379 + 1;       
                        END;                                            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).B379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).B379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).B379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).B379 + 1;            
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).B379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).B379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).B379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).B379 + 1;       
                        END;                                            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).C379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).C379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).C379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).C379 + 1;            
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).C379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).C379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).C379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).C379 + 1;       
                        END;                                            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).D379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).D379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).D379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).D379 + 1;            
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).D379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).D379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).D379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).D379 + 1;       
                        END;                                            
                   END;                                                 
                 OTHERWISE                                              
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(13).U379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(13).U379 + 1;            
                      IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'              
                      THEN                                              
                        DO;                                             
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 =         
                           STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 + 1;      
                           STAT_SIDSTE_ÅR(100).PLIN(14).U379 =          
                           STAT_SIDSTE_ÅR(100).PLIN(14).U379 + 1;       
                        END;                                            
                   END;                                                 
               END;                                                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 =                     
               STAT_SIDSTE_ÅR(INDX).PLIN(13).U379 + 1;                  
               STAT_SIDSTE_ÅR(100).PLIN(13).U379 =                      
               STAT_SIDSTE_ÅR(100).PLIN(13).U379 + 1;                   
               IF DCLBQ78000T.TILEVS_C_SÆLGER = '1'                     
               THEN                                                     
                 DO;                                                    
                    STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 =                
                    STAT_SIDSTE_ÅR(INDX).PLIN(14).U379 + 1;             
                    STAT_SIDSTE_ÅR(100).PLIN(14).U379 =                 
                    STAT_SIDSTE_ÅR(100).PLIN(14).U379 + 1;              
                 END;                                                   
            END;                                                        
                                                                        
 END OPTÆL_SIDSTE_ÅR_OVF;                                               
 /*********************************************************************/
 OPTÆL_AKT_ÅR_67:                                                       
         PROC;                                                          
                                                                        
         STAT_AKT_ÅR(INDX).PLIN(1).IALT =                               
         STAT_AKT_ÅR(INDX).PLIN(1).IALT + 1;                            
         STAT_AKT_ÅR(100).PLIN(1).IALT =                                
         STAT_AKT_ÅR(100).PLIN(1).IALT + 1;                             
                                                                        
        /* Der tages ikke højde for delsalg/køb i optællingerne */      
         /* alle optælles efter 1 års regl                       */     
         CHELÅR_ANTAL_ÅR         = 1;                                   
         CHELÅR_FORSK_DATO = HJ_DATO2;                                  
                                                                        
         IF TEST_EJET_ANTAL_ÅR_OK(DCLBQ78000T.TILEVS_DATO0107,          
                                  CHELÅR_FORSK_DATO,CHELÅR_ANTAL_ÅR)    
         THEN                                                           
           DO;                                                          
              STAT_AKT_ÅR(INDX).PLIN(2).IALT =                          
              STAT_AKT_ÅR(INDX).PLIN(2).IALT + 1;                       
              STAT_AKT_ÅR(100).PLIN(2).IALT =                           
              STAT_AKT_ÅR(100).PLIN(2).IALT + 1;                        
           END;                                                         
                                                                        
         IF (DCLBQ75000T.OPL_BBRF379 >= 'A' &                           
             DCLBQ75000T.OPL_BBRF379 <= 'D') &                          
            (DCLBQ75000T.OPL_BBRF380 <= '0000' !                        
             DCLBQ75000T.OPL_BBRF380 >= BH65300M.INDKÅR2)               
         THEN                                                           
            DO;                                                         
               SELECT (DCLBQ75000T.OPL_BBRF379);                        
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).A379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).A379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).A379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).A379 + 1;                
                      IF TEST_EJET_ANTAL_ÅR_OK(                         
                                  DCLBQ78000T.TILEVS_DATO0107,          
                                  CHELÅR_FORSK_DATO,CHELÅR_ANTAL_ÅR)    
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).A379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).A379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).A379 =              
                           STAT_AKT_ÅR(100).PLIN(2).A379 + 1;           
                        END;                                            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).B379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).B379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).B379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).B379 + 1;                
                      IF TEST_EJET_ANTAL_ÅR_OK(                         
                                  DCLBQ78000T.TILEVS_DATO0107,          
                                  CHELÅR_FORSK_DATO,CHELÅR_ANTAL_ÅR)    
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).B379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).B379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).B379 =              
                           STAT_AKT_ÅR(100).PLIN(2).B379 + 1;           
                        END;                                            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).C379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).C379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).C379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).C379 + 1;                
                      IF TEST_EJET_ANTAL_ÅR_OK(                         
                                  DCLBQ78000T.TILEVS_DATO0107,          
                                  CHELÅR_FORSK_DATO,CHELÅR_ANTAL_ÅR)    
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).C379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).C379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).C379 =              
                           STAT_AKT_ÅR(100).PLIN(2).C379 + 1;           
                        END;                                            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(1).D379 =                  
                      STAT_AKT_ÅR(INDX).PLIN(1).D379 + 1;               
                      STAT_AKT_ÅR(100).PLIN(1).D379 =                   
                      STAT_AKT_ÅR(100).PLIN(1).D379 + 1;                
                      IF TEST_EJET_ANTAL_ÅR_OK(                         
                                  DCLBQ78000T.TILEVS_DATO0107,          
                                  CHELÅR_FORSK_DATO,CHELÅR_ANTAL_ÅR)    
                      THEN                                              
                        DO;                                             
                           STAT_AKT_ÅR(INDX).PLIN(2).D379 =             
                           STAT_AKT_ÅR(INDX).PLIN(2).D379 + 1;          
                           STAT_AKT_ÅR(100).PLIN(2).D379 =              
                           STAT_AKT_ÅR(100).PLIN(2).D379 + 1;           
                        END;                                            
                   END;                                                 
                 OTHERWISE;                                             
               END;  /* SELECT (DCLBQ75000T.OPL_BBRF379) */             
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_AKT_ÅR(INDX).PLIN(1).U379 =                         
               STAT_AKT_ÅR(INDX).PLIN(1).U379 + 1;                      
               STAT_AKT_ÅR(100).PLIN(1).U379 =                          
               STAT_AKT_ÅR(100).PLIN(1).U379 + 1;                       
               IF TEST_EJET_ANTAL_ÅR_OK(                                
                              DCLBQ78000T.TILEVS_DATO0107,              
                               CHELÅR_FORSK_DATO,CHELÅR_ANTAL_ÅR)       
               THEN                                                     
                 DO;                                                    
                    STAT_AKT_ÅR(INDX).PLIN(2).U379 =                    
                    STAT_AKT_ÅR(INDX).PLIN(2).U379 + 1;                 
                    STAT_AKT_ÅR(100).PLIN(2).U379 =                     
                    STAT_AKT_ÅR(100).PLIN(2).U379 + 1;                  
                 END;                                                   
            END;                                                        
                                                                        
 END OPTÆL_AKT_ÅR_67;                                                   
 /*********************************************************************/
 OPTÆL_AKT_ÅR_OVF:                                                      
         PROC;                                                          
                                                                        
         STAT_AKT_ÅR(INDX).PLIN(13).IALT =                              
         STAT_AKT_ÅR(INDX).PLIN(13).IALT + 1;                           
         STAT_AKT_ÅR(100).PLIN(13).IALT =                               
         STAT_AKT_ÅR(100).PLIN(13).IALT + 1;                            
                                                                        
         IF DCLBQ75000T.OPL_BBRF380  = '    ' !                         
            DCLBQ75000T.OPL_BBRF380  = '0000' !                         
            DCLBQ75000T.OPL_BBRF380 >= BH65300M.INDKÅR2                 
         THEN                                                           
            DO;                                                         
               SELECT (DCLBQ75000T.OPL_BBRF379);                        
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).A379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).A379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).A379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).A379 + 1;               
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).B379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).B379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).B379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).B379 + 1;               
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).C379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).C379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).C379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).C379 + 1;               
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).D379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).D379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).D379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).D379 + 1;               
                   END;                                                 
                 OTHERWISE                                              
                   DO;                                                  
                      STAT_AKT_ÅR(INDX).PLIN(13).U379 =                 
                      STAT_AKT_ÅR(INDX).PLIN(13).U379 + 1;              
                      STAT_AKT_ÅR(100).PLIN(13).U379 =                  
                      STAT_AKT_ÅR(100).PLIN(13).U379 + 1;               
                   END;                                                 
               END;                                                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_AKT_ÅR(INDX).PLIN(13).U379 =                        
               STAT_AKT_ÅR(INDX).PLIN(13).U379 + 1;                     
               STAT_AKT_ÅR(100).PLIN(13).U379 =                         
               STAT_AKT_ÅR(100).PLIN(13).U379 + 1;                      
            END;                                                        
                                                                        
 END OPTÆL_AKT_ÅR_OVF;                                                  
 /*********************************************************************/
 OPTÆL_EJ_BOPÆL:                                                        
         PROC;                                                          
                                                                        
         IF DCLBQ78000T.TILEVS_A_EJ_FEJER < 2                           
         THEN                                                           
            DO;                                                         
               SELECT (DCLBQ75000T.OPL_BBRF379);                        
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).A379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).A379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).A379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).A379 + 1;            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).B379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).B379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).B379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).B379 + 1;            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).C379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).C379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).C379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).C379 + 1;            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).D379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(19).D379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(19).D379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(19).D379 + 1;            
                   END;                                                 
                 OTHERWISE;                                             
               END;                                                     
            END;                                                        
         ELSE                                                           
            DO;                                                         
               /* FLERE END 1 EJER */                                   
               SELECT (DCLBQ75000T.OPL_BBRF379);                        
                 WHEN ('A')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).A379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).A379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).A379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).A379 + 1;            
                   END;                                                 
                 WHEN ('B')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).B379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).B379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).B379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).B379 + 1;            
                   END;                                                 
                 WHEN ('C')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).C379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).C379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).C379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).C379 + 1;            
                   END;                                                 
                 WHEN ('D')                                             
                   DO;                                                  
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).D379 =              
                      STAT_SIDSTE_ÅR(INDX).PLIN(20).D379 + 1;           
                      STAT_SIDSTE_ÅR(100).PLIN(20).D379 =               
                      STAT_SIDSTE_ÅR(100).PLIN(20).D379 + 1;            
                   END;                                                 
                 OTHERWISE;                                             
               END;                                                     
            END;                                                        
                                                                        
 END OPTÆL_EJ_BOPÆL;                                                    
 /********************************************************************* 
 *       KØRSLEN VEDR. BEREGNING TIL SLUT                             * 
 *       DERFOR TILPASSES CHELÅR-KODEN.                               * 
 *********************************************************************/ 
 TILPAS_SLUT_CHELÅR:                                                    
         PROC;                                                          
                                                                        
         SELECT (DCLBQ78000T.TILEVS_CHELÅR);                            
           WHEN ('4','5','6')                                           
             DO;                                                        
                DCLBQ78000T.TILEVS_CHELÅR = '0';                        
             END;                                                       
           WHEN ('7')                                                   
             DO;                                                        
                DCLBQ78000T.TILEVS_CHELÅR = '1';                        
             END;                                                       
           WHEN ('8')                                                   
             DO;                                                        
                DCLBQ78000T.TILEVS_CHELÅR = '2';                        
             END;                                                       
           WHEN ('9')                                                   
             DO;                                                        
                DCLBQ78000T.TILEVS_CHELÅR = '3';                        
             END;                                                       
           OTHERWISE;                                                   
         END;                                                           
                                                                        
 END TILPAS_SLUT_CHELÅR;                                                
 /********************************************************************* 
 *       LÆS ESR og RESULTAT   BQ75000T og BQ78000T                     
 *********************************************************************/ 
 FETCH_ESR_RES:                                                         
 PROC;                                                                  
                                                                        
         /* if PUTSKIP = '1'B                                           
         then do;                                                       
            put skip list ('*******************');                      
            put skip list ('FETCH_ESR_RES');                            
            put skip list ('*******************');                      
         end; */                                                        
                                                                        
         ESR_FUNDET = '0'B;                                             
                                                                        
         DCLBQ75000T = '';                                              
         DCLBQ78000T = ''; /*qeb 2017-11-27*/                           
                                                                        
                                                                        
         EXEC SQL FETCH ESRCURS                                         
                                                                        
         INTO  :DCLBQ75000T.TIL_EVS_AAR,                                
               :DCLBQ75000T.AFVIKLINGS_ID,                              
               :DCLBQ75000T.DCPRN,                                      
               :DCLBQ75000T.EKOMNR,                                     
               :DCLBQ75000T.EEJDNR,                                     
               :DCLBQ75000T.EENHEDLBNR,                                 
               :DCLBQ75000T.EGENNR,                                     
               :DCLBQ75000T.PROGRAMNAVN,                                
               :DCLBQ75000T.DB2FUNKTION,                                
               :DCLBQ75000T.OPL_BBRF379,                                
               :DCLBQ75000T.OPL_BBRF380,                                
               :DCLBQ78000T.TIL_EVS_AAR,                                
               :DCLBQ78000T.AFVIKLINGS_ID,                              
               :DCLBQ78000T.DCPRN,                                      
               :DCLBQ78000T.EKOMNR,                                     
               :DCLBQ78000T.EEJDNR,                                     
               :DCLBQ78000T.EENHEDLBNR,                                 
               :DCLBQ78000T.EGENNR,                                     
               :DCLBQ78000T.PROGRAMNAVN,                                
               :DCLBQ78000T.DB2FUNKTION,                                
               :DCLBQ78000T.EJERSKAB_CEJDTYPE,                          
               :DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT,                      
               :DCLBQ78000T.SORT_HELÅR,                                 
               :DCLBQ78000T.SORT_SALG,                                  
               :DCLBQ78000T.TILEVS_A_EJ_BOPÆLSKODE,                     
               :DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ,                         
               :DCLBQ78000T.TILEVS_A_EJ_DRGNÅRFRA,                      
               :DCLBQ78000T.TILEVS_A_EJ_DRGNÅRTIL,                      
               :DCLBQ78000T.TILEVS_A_EJ_FEJER,                          
               :DCLBQ78000T.TILEVS_C_SÆLGER,                            
               :DCLBQ78000T.TILEVS_CHELÅR,                              
               :DCLBQ78000T.TILEVS_CHELÅR_FOR,                          
               :DCLBQ78000T.TILEVS_CHELÅR_ORD,                          
               :DCLBQ78000T.TILEVS_CPTYPFOR,                            
               :DCLBQ78000T.TILEVS_CPTYPSLUT,                           
               :DCLBQ78000T.TILEVS_DAFSTAA,                             
               :DCLBQ78000T.TILEVS_DATO0107,                            
               :DCLBQ78000T.TILEVS_A_EJ_DOVTG_GL,    /*QEB NOV 2017*/   
               :DCLBQ78000T.TILEVS_CSKPLOMF          /*QEB JUN 2018*/   
                                                                        
         ;                                                              
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               ESR_FUNDET = '1'B;                                       
               TV.LÆSTE_IALT = TV.LÆSTE_IALT + 1;                       
               ANT_COMM = ANT_COMM + 1;                                 
             END;                                                       
           WHEN (100)                                                   
             DO;                                                        
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
               ABENDTXT = '101 FETCH ESRCURS';                          
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
                                                                        
         IF ANT_COMM > 9999                                             
         THEN DO;                                                       
            EXEC SQL COMMIT;                                            
            Put skip list ('Commit efter ' !! TV.LÆSTE_IALT !!          
                           ' læsninger på ESR/RES.  Ialt ' !! ANT_UPD !!
                           ' opdateringer');                            
            ANT_COMM = 0;                                               
         END;                                                           
                                                                        
 END FETCH_ESR_RES;                                                     
                                                                        
 /*********************************************************************/
 /* UPDATE række på RESULTAT BQ78                              RUTINE */
 /*********************************************************************/
 UPDATE_RESULTAT: PROC;                                                 
                                                                        
                                                                        
         DCLBQ78000T.PROGRAMNAVN    = WS_PROGRAMNAVN;                   
         DCLBQ78000T.DB2FUNKTION    = 'U';                              
         DCLBQ78000T.TIL_EVS_AAR    = WS_TIL_EVS_AAR;                   
         DCLBQ78000T.AFVIKLINGS_ID  = WS_FORSKUD_SLUT_TXT;              
                                                                        
         EXEC SQL                                                       
          UPDATE BQ78000T                                               
          SET                                                           
           PROGRAMNAVN = :DCLBQ78000T.PROGRAMNAVN,                      
           DB2FUNKTION = :DCLBQ78000T.DB2FUNKTION,                      
           EJERSKAB_CEJDTYPE = :DCLBQ78000T.EJERSKAB_CEJDTYPE,          
           EJERSKAB_CEJDTYPE_AKT = :DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT,  
           SORT_HELÅR = :DCLBQ78000T.SORT_HELÅR,                        
           SORT_SALG = :DCLBQ78000T.SORT_SALG,                          
           TILEVS_A_EJ_BOPÆLSKODE = :DCLBQ78000T.TILEVS_A_EJ_BOPÆLSKODE,
           TILEVS_A_EJ_DAFSTÅ = :DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ,        
           TILEVS_A_EJ_DRGNÅRFRA = :DCLBQ78000T.TILEVS_A_EJ_DRGNÅRFRA,  
           TILEVS_A_EJ_DRGNÅRTIL = :DCLBQ78000T.TILEVS_A_EJ_DRGNÅRTIL,  
           TILEVS_A_EJ_FEJER = :DCLBQ78000T.TILEVS_A_EJ_FEJER,          
           TILEVS_C_SÆLGER = :DCLBQ78000T.TILEVS_C_SÆLGER,              
           TILEVS_CHELÅR = :DCLBQ78000T.TILEVS_CHELÅR,                  
           TILEVS_CHELÅR_REGL  = :DCLBQ78000T.TILEVS_CHELÅR_REGL,       
           TILEVS_CHELÅR_FOR = :DCLBQ78000T.TILEVS_CHELÅR_FOR,          
           TILEVS_CHELÅR_ORD = :DCLBQ78000T.TILEVS_CHELÅR_ORD,          
           TILEVS_DATO_CHELÅR = :DCLBQ78000T.TILEVS_DATO_CHELÅR,        
           TILEVS_CPTYPFOR = :DCLBQ78000T.TILEVS_CPTYPFOR,              
           TILEVS_CPTYPSLUT = :DCLBQ78000T.TILEVS_CPTYPSLUT,            
           TILEVS_DAFSTAA = :DCLBQ78000T.TILEVS_DAFSTAA,                
           TILEVS_DATO0107 = :DCLBQ78000T.TILEVS_DATO0107               
                                                                        
            WHERE TIL_EVS_AAR     = :DCLBQ78000T.TIL_EVS_AAR            
            AND   DCPRN           = :DCLBQ78000T.DCPRN                  
            AND   EKOMNR          = :DCLBQ78000T.EKOMNR                 
            AND   EEJDNR          = :DCLBQ78000T.EEJDNR                 
            AND   EENHEDLBNR      = :DCLBQ78000T.EENHEDLBNR             
            AND   EGENNR          = :DCLBQ78000T.EGENNR                 
            AND   AFVIKLINGS_ID   = :DCLBQ78000T.AFVIKLINGS_ID;         
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               ANT_UPD = ANT_UPD + 1;                                   
            END;                                                        
            OTHERWISE DO;                                               
               ABENDTXT = '101 UPDATE BQ78000T';                        
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END UPDATE_RESULTAT;                                                   
 /*********************************************************************/
 /* OPEN CURSOR TIL LÆS AF ESR-OPLYSNINGER                     RUTINE */
 /*********************************************************************/
 OPEN_ESRCURS: PROC;                                                    
                                                                        
         EXEC SQL OPEN ESRCURS;                                         
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              ABENDTXT = '101 OPEN ESRCURS';                            
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END OPEN_ESRCURS;                                                      
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF ESR                                RUTINE */
 /*********************************************************************/
 CLOSE_ESRCURS: PROC;                                                   
                                                                        
         EXEC SQL CLOSE ESRCURS;                                        
                                                                        
 END CLOSE_ESRCURS;                                                     
 /*********************************************************************/
 /*  LÆS DATA TIL OVERFØRSEL CHELÅR OG JUSTERING AF CEJDTYPE          */
 /*********************************************************************/
 FETCH_CHELÅR_CUR: PROC;                                                
                                                                        
                                                                        
         CHELÅR_DATA_FUNDET = '0'B;                                     
                                                                        
         DCLBQ75000T = '';                                              
         DCLBQ78000T = '';  /*qeb 2017-11-27*/                          
                                                                        
                                                                        
         EXEC SQL FETCH CHELÅR_CUR                                      
                                                                        
         INTO  :DCLBQ75000T.TIL_EVS_AAR,                                
               :DCLBQ75000T.AFVIKLINGS_ID,                              
               :DCLBQ75000T.DCPRN,                                      
               :DCLBQ75000T.EKOMNR,                                     
               :DCLBQ75000T.EEJDNR,                                     
               :DCLBQ75000T.EENHEDLBNR,                                 
               :DCLBQ75000T.EGENNR,                                     
               :DCLBQ75000T.PROGRAMNAVN,                                
               :DCLBQ75000T.DB2FUNKTION,                                
               :DCLBQ75000T.OPL_BBRF379,                                
               :DCLBQ75000T.OPL_BBRF380,                                
               :DCLBQ78000T.TIL_EVS_AAR,                                
               :DCLBQ78000T.AFVIKLINGS_ID,                              
               :DCLBQ78000T.DCPRN,                                      
               :DCLBQ78000T.EKOMNR,                                     
               :DCLBQ78000T.EEJDNR,                                     
               :DCLBQ78000T.EENHEDLBNR,                                 
               :DCLBQ78000T.EGENNR,                                     
               :DCLBQ78000T.PROGRAMNAVN,                                
               :DCLBQ78000T.DB2FUNKTION,                                
               :DCLBQ78000T.EJERSKAB_CEJDTYPE,                          
               :DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT,                      
               :DCLBQ78000T.SORT_HELÅR,                                 
               :DCLBQ78000T.SORT_SALG,                                  
               :DCLBQ78000T.TILEVS_A_EJ_BOPÆLSKODE,                     
               :DCLBQ78000T.TILEVS_A_EJ_DAFSTÅ,                         
               :DCLBQ78000T.TILEVS_A_EJ_DRGNÅRFRA,                      
               :DCLBQ78000T.TILEVS_A_EJ_DRGNÅRTIL,                      
               :DCLBQ78000T.TILEVS_A_EJ_FEJER,                          
               :DCLBQ78000T.TILEVS_C_SÆLGER,                            
               :DCLBQ78000T.TILEVS_CHELÅR,                              
               :DCLBQ78000T.TILEVS_CHELÅR_FOR,                          
               :DCLBQ78000T.TILEVS_CHELÅR_ORD,                          
               :DCLBQ78000T.TILEVS_CPTYPFOR,                            
               :DCLBQ78000T.TILEVS_CPTYPSLUT,                           
               :DCLBQ78000T.TILEVS_DAFSTAA,                             
               :DCLBQ78000T.TILEVS_DATO0107,                            
               :DCLBQ78000T.TILEVS_CSKPLOMF         /*QEB JUN 2018*/    
                                                                        
         ;                                                              
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0)                                                     
             DO;                                                        
               CHELÅR_DATA_FUNDET = '1'B;                               
               TV.LÆSTE_IALT = TV.LÆSTE_IALT + 1;                       
               ANT_COMM = ANT_COMM + 1;                                 
             END;                                                       
           WHEN (100)                                                   
             DO;                                                        
             END;                                                       
           OTHERWISE                                                    
             DO;                                                        
               ABENDTXT = '101 FETCH CHELÅR_CUR';                       
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
                                                                        
         IF ANT_COMM > 9999                                             
         THEN DO;                                                       
            EXEC SQL COMMIT;                                            
            Put skip list ('Commit efter ' !! TV.LÆSTE_IALT !!          
                           ' læsninger på ESR/RES.  Ialt ' !! ANT_UPD !!
                           ' opdateringer');                            
            ANT_COMM = 0;                                               
         END;                                                           
                                                                        
 END FETCH_CHELÅR_CUR;                                                  
 /*********************************************************************/
 /* UPDATE række på RESULTAT BQ78                              RUTINE */
 /*********************************************************************/
 UPDATE_RESULTAT_CHELÅR: PROC;                                          
                                                                        
         DCLBQ78000T.PROGRAMNAVN    = WS_PROGRAMNAVN;                   
         DCLBQ78000T.DB2FUNKTION    = 'U';                              
         DCLBQ78000T.TIL_EVS_AAR    = WS_TIL_EVS_AAR;                   
         DCLBQ78000T.AFVIKLINGS_ID  = WS_FORSKUD_SLUT_TXT;              
                                                                        
         EXEC SQL                                                       
          UPDATE BQ78000T                                               
          SET                                                           
           PROGRAMNAVN = :DCLBQ78000T.PROGRAMNAVN,                      
           DB2FUNKTION = :DCLBQ78000T.DB2FUNKTION,                      
           EJERSKAB_CEJDTYPE     = :DCLBQ78000T.EJERSKAB_CEJDTYPE,      
           EJERSKAB_CEJDTYPE_AKT = :DCLBQ78000T.EJERSKAB_CEJDTYPE_AKT,  
           TILEVS_CHELÅR         = :DCLBQ78000T.TILEVS_CHELÅR,          
           TILEVS_CHELÅR_ORD     = :DCLBQ78000T.TILEVS_CHELÅR_ORD,      
           TILEVS_CHELÅR_FOR     = :DCLBQ78000T.TILEVS_CHELÅR_FOR       
                                                                        
           WHERE TIL_EVS_AAR     = :DCLBQ78000T.TIL_EVS_AAR             
             AND AFVIKLINGS_ID   = :DCLBQ78000T.AFVIKLINGS_ID           
             AND DCPRN           = :DCLBQ78000T.DCPRN                   
             AND EKOMNR          = :DCLBQ78000T.EKOMNR                  
             AND EEJDNR          = :DCLBQ78000T.EEJDNR                  
             AND EENHEDLBNR      = :DCLBQ78000T.EENHEDLBNR              
             AND EGENNR          = :DCLBQ78000T.EGENNR;                 
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               ANT_UPD = ANT_UPD + 1;                                   
            END;                                                        
            OTHERWISE DO;                                               
               ABENDTXT = '101 UPDATE BQ78000T';                        
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END UPDATE_RESULTAT_CHELÅR;                                            
 /*********************************************************************/
 /* OPEN CURSOR TIL LÆS AF ESR-OPLYSNINGER                     RUTINE */
 /*********************************************************************/
 OPEN_CHELÅR_CUR: PROC;                                                 
                                                                        
         EXEC SQL OPEN CHELÅR_CUR;                                      
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              ABENDTXT = '101 OPEN CHELÅR_CUR';                         
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END OPEN_CHELÅR_CUR;                                                   
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF ESR                                RUTINE */
 /*********************************************************************/
 CLOSE_CHELÅR_CUR: PROC;                                                
                                                                        
         EXEC SQL CLOSE CHELÅR_CUR;                                     
                                                                        
 END CLOSE_CHELÅR_CUR;                                                  
 /*********************************************************************/
 /* LÆS AF MT-OPLYSNINGER                                      RUTINE */
 /*********************************************************************/
 SELECT_MT: PROC;                                                       
                                                                        
         MT_FUNDET = NEJ;                                               
                                                                        
         DCLBQ76000T = '';                                              
         DCLBQ76000T.TIL_EVS_AAR    = DCLBQ75000T.TIL_EVS_AAR;          
         DCLBQ76000T.AFVIKLINGS_ID  = DCLBQ75000T.AFVIKLINGS_ID;        
         DCLBQ76000T.DCPRN          = DCLBQ75000T.DCPRN;                
         DCLBQ76000T.EKOMNR         = DCLBQ75000T.EKOMNR;               
         DCLBQ76000T.EEJDNR         = DCLBQ75000T.EEJDNR;               
         DCLBQ76000T.EENHEDLBNR     = DCLBQ75000T.EENHEDLBNR;           
         DCLBQ76000T.EGENNR         = DCLBQ75000T.EGENNR;               
                                                                        
                                                                        
         EXEC SQL                                                       
            SELECT                                                      
               DRGNÅRFRA                                                
            INTO                                                        
               :DCLBQ76000T.DRGNÅRFRA                                   
            FROM BQ76000T                                               
            WHERE TIL_EVS_AAR   = :DCLBQ76000T.TIL_EVS_AAR              
            AND   AFVIKLINGS_ID = :DCLBQ76000T.AFVIKLINGS_ID            
            AND   DCPRN         = :DCLBQ76000T.DCPRN                    
            AND   EKOMNR        = :DCLBQ76000T.EKOMNR                   
            AND   EEJDNR        = :DCLBQ76000T.EEJDNR                   
            AND   EENHEDLBNR    = :DCLBQ76000T.EENHEDLBNR               
            AND   EGENNR        = :DCLBQ76000T.EGENNR;                  
                                                                        
         SELECT(SQLCA.SQLCODE);                                         
            WHEN(0) DO;                                                 
               MT_FUNDET = '1'B;                                        
               TV.SELECT_MT = TV.SELECT_MT + 1;                         
            END;                                                        
            WHEN(100) DO;                                               
            END;                                                        
            OTHERWISE DO;                                               
               ABENDTXT = '101 SELECT BQ76000T';                        
               CALL SQL_FEJL;                                           
            END;                                                        
         END;                                                           
                                                                        
 END SELECT_MT;                                                         
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE:                                                            
         PROC;                                                          
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
         DETLIN0.CCA = ZZWS2;                                           
         DETLIN0.TEKST1 = 'DENNE BEREGNING ER UDFØRT FOR INDKOMSTÅR=';  
         DETLIN0.CPUÅR = BH65300M.SLUTÅR;                               
         DETLIN0.TEKST2 = ' MED START=';                                
         DETLIN0.START = ÅR0101;                                        
         DETLIN0.TEKST3 = ' OG SLUT=';                                  
         DETLIN0.SLUT  = ÅR1231;                                        
         DETLIN0.TEKST4 = ' ';                                          
         CALL ZZ20300 (DETLIN0,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆSTE_IALT;                                 
         DETLIN1.TEKST = 'ANTAL LÆSTE PÅ ESR/RESULTAT TABEL';           
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SKREVNE;                                    
         DETLIN1.TEKST = 'ANTAL UPDATES PÅ RESULTAT TABEL ';            
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FL_EJER;                                    
         DETLIN1.TEKST = 'HERAF 2%-BEREGNING MED FLERE END 1 EJER    '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FKUN_SIDSTE_ÅR;                             
  /*#01*/DETLIN1.TEKST = 'BEREGNET MED 2% KUN I ' !!                    
                         BH65300M.INDKÅR1 !!                            
                         '           ANTAL:';                           
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FKUN_AKT_ÅR;                                
  /*#01*/DETLIN1.TEKST = 'BEREGNET MED 2% KUN I ' !!                    
                          BH65300M.INDKÅR1 !!                           
                         '           ANTAL:';                           
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FBEGGE;                                     
  /*#01*/DETLIN1.TEKST = 'BEREGNET MED 2% BÅDE I '  !!                  
                         BH65300M.INDKÅR1 !! ' OG ' !!                  
                         BH65300M.INDKÅR2 !! ' ANTAL:';                 
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         /*Planlov slut 2017*/                                          
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.ÆNDRET_CHELÅR_REGL;                         
  /*#01*/DETLIN1.TEKST = 'ANTAL ÅR FOR HELÅRS BEBOELSE ÆNDRET '  !!     
                         'FRA 8 TIL 1 ';                                
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
                                                                        
         /* her starter listen for statistik */                         
         CALL ZZ20300(STAT_SIDELIN,'01');                               
         CALL ZZ20300(STAT_OVLIN1,'01');                                
         CALL ZZ20300(STAT_OVLIN2,'01');                                
         STAT_DETLIN0.CCA = ZZWS2;                                      
         STAT_DETLIN0.TEKST1 =                                          
                          'DENNE BEREGNING ER UDFØRT FOR INDKOMSTÅR=';  
         STAT_DETLIN0.CPUÅR = SLUTÅR;                                   
         STAT_DETLIN0.TEKST2 = ' MED START=';                           
         STAT_DETLIN0.START = ÅR0101;                                   
         STAT_DETLIN0.TEKST3 = ' OG SLUT=';                             
         STAT_DETLIN0.SLUT  = ÅR1231;                                   
         STAT_DETLIN0.TEKST4 = ' ';                                     
         CALL ZZ20300 (STAT_DETLIN0,'01');                              
         STAT_DETLIN1.CCA = ZZWS2;                                      
         STAT_DETLIN1.ANTAL = TV.LÆS_BH942;                             
         STAT_DETLIN1.TEKST = 'ANTAL LÆSTE PÅ UDTRÆK FRA ESR B.H94201D';
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS2;                                      
         STAT_DETLIN1.ANTAL = TV.FSOM_UBOP;                             
         STAT_DETLIN1.TEKST = 'ANTAL SOMMERHUSE UDEN HELÅRSBEBOELSE';   
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS1;                                      
         STAT_DETLIN1.ANTAL = TV.FSOM_MBOP;                             
         STAT_DETLIN1.TEKST = 'ANTAL SOMMERHUSE MED HELÅRSBEBOELSE';    
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS1;                                      
         STAT_DETLIN1.ANTAL = TV.F_SIDSTE_HELÅR;                        
         STAT_DETLIN1.TEKST =                                           
                     '      HERAF MED HELÅRSBEREGNING I SLUTÅR';        
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS1;                                      
         STAT_DETLIN1.ANTAL = TV.FSEJDTYP3Æ;                            
         STAT_DETLIN1.TEKST =                                           
                          '            HERAF EJDTYPE 3 ÆNDRET TIL 1';   
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS1;                                      
         STAT_DETLIN1.ANTAL = TV.FSEJDTYP8Æ;                            
         STAT_DETLIN1.TEKST =                                           
                     '            HERAF EJDTYPE 8 ÆNDRET TIL 7';        
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS1;                                      
         STAT_DETLIN1.ANTAL = TV.F_AKT_HELÅR;                           
         STAT_DETLIN1.TEKST =                                           
                       '      HERAF MED HELÅRSBEREGNING I FORSKUDSÅR';  
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS1;                                      
         STAT_DETLIN1.ANTAL = TV.FFEJDTYP3Æ;                            
         STAT_DETLIN1.TEKST =                                           
                       '            HERAF EJDTYPE 3 ÆNDRET TIL 1';      
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
         STAT_DETLIN1.CCA = ZZWS1;                                      
         STAT_DETLIN1.ANTAL = TV.FFEJDTYP8Æ;                            
         STAT_DETLIN1.TEKST =                                           
                      '            HERAF EJDTYPE 8 ÆNDRET TIL 7';       
         CALL ZZ20300 (STAT_DETLIN1,'01');                              
                                                                        
  END TOTALLISTE;                                                       
 /********************************************************************* 
 *       SKRIV STATISTIK VEDR. SIDSTE ÅR                              * 
 *********************************************************************/ 
 STATISTIK_SIDSTE_ÅR:                                                   
         PROC;                                                          
         CALL ZZ20300(STAT_SIDELIN,'01');                               
         IF INDX = 100                                                  
         THEN                                                           
            DO;                                                         
               STAT_OVLIN3.TEKST = 'LANDSTOTAL';                        
               STAT_OVLIN3.KOMNR = 0;                                   
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_OVLIN3.TEKST = 'KOMMUNENR.';                        
               STAT_OVLIN3.KOMNR = INDX;                                
            END;                                                        
         STAT_OVLIN3.TEKST1 =                                           
            'STATISTIK OVER ANTAL PERSONER MED MULIGHED FOR ' !!        
            'DISPENSATION TIL HELÅRSBEBOELSE';                          
         STAT_OVLIN3.DATO = DATO2, BY NAME;                             
         CALL ZZ20300(STAT_OVLIN3,'01');                                
         STAT_OVLIN4.CCA = ZZWS3;                                       
         STAT_OVLIN4.TEKST1 =                                           
         '                    (2 PCT BEREGNING) I SOMMER' !!            
         'HUSE (BK 08, 28 ELLER 48) I INDKOMSTÅR ' !!                   
         BH65300M.INDKÅR1 !! '.';                                       
         CALL ZZ20300(STAT_OVLIN4,'01');                                
         STAT_OVLIN4.CCA = ZZWS1;                                       
  /*#01*/STAT_OVLIN4.TEKST1 = 'PERSONER MED BOPÆLSKODE       HERAF ' !! 
        'BBR F379=A  HERAF BBR F379=B ' !!                              
        ' HERAF BBR F379=C HERAF BBR F379=D HERAF BBR F379 ' !!         
        'ALT ANTAL';                                                    
         CALL ZZ20300(STAT_OVLIN4,'01');                                
         STAT_OVLIN4.CCA = ZZWS2;                                       
  /*#01*/STAT_OVLIN4.TEKST1 = 'ALDER = STATUS I ' !! BH65300M.INDKÅR1 !!
                         '         OG F380 >= ' !! BH65300M.INDKÅR1 !!  
                         '   OG F380 >= ' !! BH65300M.INDKÅR1 !!        
                         '   OG F380 >= ' !! BH65300M.INDKÅR1 !!        
                         '   OG F380 >= ' !! BH65300M.INDKÅR1 !!        
                         '    = BLANK';                                 
         CALL ZZ20300(STAT_OVLIN4,'01');                                
                                                                        
         STAT_DETLIN4.CCA = ZZWS1;                                      
         STAT_DETLIN4.TEKST = '65/67-ÅRIGE M.V.              ';         
         STAT_DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(1).A379;       
         STAT_DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(1).B379;       
         STAT_DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(1).C379;       
         STAT_DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(1).D379;       
         STAT_DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(1).U379;       
         STAT_DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(1).IALT;       
         CALL ZZ20300(STAT_DETLIN4,'01');                               
         STAT_DETLIN4.CCA = ZZWS1;                                      
         STAT_DETLIN4.TEKST = 'HERAF 1 ÅRS EJERE EXCL SÆLGER ';         
         STAT_DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(2).A379;       
         STAT_DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(2).B379;       
         STAT_DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(2).C379;       
         STAT_DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(2).D379;       
         STAT_DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(2).U379;       
         STAT_DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(2).IALT;       
         CALL ZZ20300(STAT_DETLIN4,'01');                               
         STAT_DETLIN4.CCA = ZZWS3;                                      
         STAT_DETLIN4.TEKST = 'HERAF SÆLGERE MED DISP.       ';         
         STAT_DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(4).A379;       
         STAT_DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(4).B379;       
         STAT_DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(4).C379;       
         STAT_DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(4).D379;       
         STAT_DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(4).U379;       
         STAT_DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(4).IALT;       
         CALL ZZ20300(STAT_DETLIN4,'01');                               
                                                                        
         STAT_DETLIN4.CCA = ZZWS1;                                      
         STAT_DETLIN4.TEKST = 'OVERFØRT FRA OVENSTÅENDE      ';         
         STAT_DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(13).A379;      
         STAT_DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(13).B379;      
         STAT_DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(13).C379;      
         STAT_DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(13).D379;      
         STAT_DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(13).U379;      
         STAT_DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(13).IALT;      
         CALL ZZ20300(STAT_DETLIN4,'01');                               
         STAT_DETLIN4.CCA = ZZWS3;                                      
         STAT_DETLIN4.TEKST = 'HERAF SÆLGERE MED DISP.       ';         
         STAT_DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(14).A379;      
         STAT_DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(14).B379;      
         STAT_DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(14).C379;      
         STAT_DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(14).D379;      
         STAT_DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(14).U379;      
         STAT_DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(14).IALT;      
         CALL ZZ20300(STAT_DETLIN4,'01');                               
                                                                        
         STAT_OVLIN4.CCA = ZZWS2;                                       
         STAT_OVLIN4.TEKST1 =                                           
            'ANTAL PERSONER UDEN BOPÆLSKODE  M E N  MED BBR' !!         
            'F379 FORSKELLIG FRA BLANK:';                               
         CALL ZZ20300(STAT_OVLIN4,'01');                                
                                                                        
         STAT_DETLIN4.CCA = ZZWS1;                                      
         STAT_DETLIN4.TEKST = 'EEN-EJERE                     ';         
         STAT_DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(19).A379;      
         STAT_DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(19).B379;      
         STAT_DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(19).C379;      
         STAT_DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(19).D379;      
         STAT_DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(19).U379;      
         STAT_DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(19).IALT;      
         CALL ZZ20300(STAT_DETLIN4,'01');                               
         STAT_DETLIN4.CCA = ZZWK1;                                      
         STAT_DETLIN4.TEKST = 'FLER-EJERE                    ';         
         STAT_DETLIN4.ANTAL1 = STAT_SIDSTE_ÅR(INDX).PLIN(20).A379;      
         STAT_DETLIN4.ANTAL2 = STAT_SIDSTE_ÅR(INDX).PLIN(20).B379;      
         STAT_DETLIN4.ANTAL3 = STAT_SIDSTE_ÅR(INDX).PLIN(20).C379;      
         STAT_DETLIN4.ANTAL4 = STAT_SIDSTE_ÅR(INDX).PLIN(20).D379;      
         STAT_DETLIN4.ANTAL5 = STAT_SIDSTE_ÅR(INDX).PLIN(20).U379;      
         STAT_DETLIN4.ANTAL6 = STAT_SIDSTE_ÅR(INDX).PLIN(20).IALT;      
         CALL ZZ20300(STAT_DETLIN4,'01');                               
                                                                        
  END STATISTIK_SIDSTE_ÅR;                                              
 /********************************************************************* 
 *       SKRIV STATISTIK VEDR. AKTUELT ÅR                               
 *********************************************************************/ 
 STATISTIK_AKT_ÅR:                                                      
         PROC;                                                          
         CALL ZZ20300(STAT_SIDELIN,'01');                               
         IF INDX = 100                                                  
         THEN                                                           
            DO;                                                         
               STAT_OVLIN3.TEKST = 'LANDSTOTAL';                        
               STAT_OVLIN3.KOMNR = 0;                                   
            END;                                                        
         ELSE                                                           
            DO;                                                         
               STAT_OVLIN3.TEKST = 'KOMMUNENR.';                        
               STAT_OVLIN3.KOMNR = INDX;                                
            END;                                                        
         STAT_OVLIN3.TEKST1 =                                           
                  'STATISTIK OVER ANTAL PERSONER MED MULIGHED '         
                   !!    'FOR DISPENSATION TIL HELÅRSBEBOELSE';         
         STAT_OVLIN3.DATO = DATO2, BY NAME;                             
         CALL ZZ20300(STAT_OVLIN3,'01');                                
         STAT_OVLIN4.CCA = ZZWS3;                                       
  /*#01*/STAT_OVLIN4.TEKST1 =                                           
         '        (2 PCT BEREGNING) I SOMMERHUSE ' !!                   
         '(BK 08, 28 ELLER 48) I INDKOMSTÅR ' !! BH65300M.INDKÅR1 !!    
         '.';                                                           
         CALL ZZ20300(STAT_OVLIN4,'01');                                
         STAT_OVLIN4.CCA = ZZWS1;                                       
         STAT_OVLIN4.TEKST1 = 'PERSONER MED BOPÆLSKODE    ' !!          
         '  HERAF BBR F379=A ' !!                                       
         ' HERAF BBR  F379=B  HERAF BBR F379=C ' !!                     
         ' HERAF BBR F379=D   HERAF BBR F379 '   !!                     
         'ALT ANTAL';                                                   
         CALL ZZ20300(STAT_OVLIN4,'01');                                
         STAT_OVLIN4.CCA = ZZWS2;                                       
  /*#01*/STAT_OVLIN4.TEKST1 = 'ALDER = STATUS I ' !! BH65300M.INDKÅR2 !!
                         '        OG F380 >= ' !! BH65300M.INDKÅR2 !!   
                         '   OG F380 >= ' !! BH65300M.INDKÅR2 !!        
                         '    OG F380 >= ' !! BH65300M.INDKÅR2 !!       
                         '    OG F380 >= ' !! BH65300M.INDKÅR2 !!       
                         '      = BLANK';                               
         CALL ZZ20300(STAT_OVLIN4,'01');                                
                                                                        
         STAT_DETLIN4.CCA = ZZWS1;                                      
         STAT_DETLIN4.TEKST = '65/67-ÅRIGE M.V.              ';         
         STAT_DETLIN4.ANTAL1 = STAT_AKT_ÅR(INDX).PLIN(1).A379;          
         STAT_DETLIN4.ANTAL2 = STAT_AKT_ÅR(INDX).PLIN(1).B379;          
         STAT_DETLIN4.ANTAL3 = STAT_AKT_ÅR(INDX).PLIN(1).C379;          
         STAT_DETLIN4.ANTAL4 = STAT_AKT_ÅR(INDX).PLIN(1).D379;          
         STAT_DETLIN4.ANTAL5 = STAT_AKT_ÅR(INDX).PLIN(1).U379;          
         STAT_DETLIN4.ANTAL6 = STAT_AKT_ÅR(INDX).PLIN(1).IALT;          
         CALL ZZ20300(STAT_DETLIN4,'01');                               
         STAT_DETLIN4.CCA = ZZWS3;                                      
         STAT_DETLIN4.TEKST = 'HERAF 1 ÅRS EJERE             ';         
         STAT_DETLIN4.ANTAL1 = STAT_AKT_ÅR(INDX).PLIN(2).A379;          
         STAT_DETLIN4.ANTAL2 = STAT_AKT_ÅR(INDX).PLIN(2).B379;          
         STAT_DETLIN4.ANTAL3 = STAT_AKT_ÅR(INDX).PLIN(2).C379;          
         STAT_DETLIN4.ANTAL4 = STAT_AKT_ÅR(INDX).PLIN(2).D379;          
         STAT_DETLIN4.ANTAL5 = STAT_AKT_ÅR(INDX).PLIN(2).U379;          
         STAT_DETLIN4.ANTAL6 = STAT_AKT_ÅR(INDX).PLIN(2).IALT;          
         CALL ZZ20300(STAT_DETLIN4,'01');                               
                                                                        
         STAT_DETLIN4.CCA = ZZWK1;                                      
         STAT_DETLIN4.TEKST = 'OVERFØRT FRA OVENSTÅENDE      ';         
         STAT_DETLIN4.ANTAL1 = STAT_AKT_ÅR(INDX).PLIN(13).A379;         
         STAT_DETLIN4.ANTAL2 = STAT_AKT_ÅR(INDX).PLIN(13).B379;         
         STAT_DETLIN4.ANTAL3 = STAT_AKT_ÅR(INDX).PLIN(13).C379;         
         STAT_DETLIN4.ANTAL4 = STAT_AKT_ÅR(INDX).PLIN(13).D379;         
         STAT_DETLIN4.ANTAL5 = STAT_AKT_ÅR(INDX).PLIN(13).U379;         
         STAT_DETLIN4.ANTAL6 = STAT_AKT_ÅR(INDX).PLIN(13).IALT;         
         CALL ZZ20300(STAT_DETLIN4,'01');                               
                                                                        
  END STATISTIK_AKT_ÅR;                                                 
 /********************************************************************* 
 *       AFSLUT PROGRAM                                               * 
 * SKRIV LISTE FRA BH94200L og BH94400L                               * 
 *********************************************************************/ 
 AFSLUT: PROC;                                                          
                                                                        
         CALL TOTALLISTE;                                               
         DO INDX = 100 TO 100;                                          
            IF STAT_SIDSTE_ÅR(INDX).CLIN = 1                            
            THEN                                                        
               CALL STATISTIK_SIDSTE_ÅR;                                
         END;                                                           
         DO INDX = 100 TO 100;                                          
            IF STAT_AKT_ÅR(INDX).CLIN = 1                               
            THEN                                                        
               CALL STATISTIK_AKT_ÅR;                                   
         END;                                                           
                                                                        
         CALL ZZ20300((133)' ','99');                                   
         CLOSE FILE (BH842I);                                           
                                                                        
         CALL OPDATER_KØRSELSTABEL('SLUT',BH842_PARM.FS_MRK);           
                                                                        
 END AFSLUT;                                                            
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED SQLCODE: ' !! SQLCA.SQLCODE);  
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
                                                                        
         CALL ZS67000(SQLCA);                                           
                                                                        
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END SQL_FEJL;                                                          
 /*********************************************************************/
 /* HER UDSKRIVES ØVRIGE FEJL                                  RUTINE */
 /*********************************************************************/
 PROGRAM_FEJL: PROC;                                                    
                                                                        
         PUT SKIP LIST ('*****************************************');   
         PUT SKIP LIST ('DER ABENDES MED PROGRAMFEJL');                 
         PUT SKIP LIST ('ABENDTXT:                ' !! ABENDTXT);       
         PUT SKIP LIST ('*****************************************');   
         CALL ZS30101(ABENDKODE,ABENDMEDD,ABENDRTKODE);                 
                                                                        
 END PROGRAM_FEJL;                                                      
                                                                        
 %INCLUDE BH54998M;     /* OPDATER KØRSELSTABEL */                      
 %INCLUDE BH94200M;     /* UNDERSØG OM EJENDOM EJET I MINDST 1 ÅR */    
 END  BH84200;                                                          
