  PROCESS OPT(TIME);                                                    
 BH95007: /* BEREGN EJENDOMSVÆRDISKAT FOR ÅR 2013 TIL FORSKUD         */
 PROCEDURE (BH950_AR);                                                  
 /*********************************************************************/
                                                                        
 DCL COPYRIGHT CHAR (30) STATIC INIT ('COPYRIGHT KOMMUNEDATA I/S 2003');
                                                                        
 /**********************************************************************
 * PROGRAMMET UDFØRER BEREGNING AF EJENDOMSVÆRDISKAT P.G.A. OPLYS-     *
 * NINGERNE VEDR. DEN AKTUELLE EJENDOM/PERSON.                         *
 *                                                                     *
 * NB.: PROGRAMMET BRUGES I EJENDOMSVÆRDISKATTESYSTEMET(EVS) TIL       *
 *      BEREGNING AF EVS-2014 TIL BRUG VED TEST AF C-VERSION BT41610M  *
 *                                                                     *
 *  PROGRAMMERET AF AAGE RASMUSSEN   PUS T&S    AUG    2000            *
 *  RETTET       AF AAGE RASMUSSEN   LSU T&S    AUG    2001            *
 *  RETTET       AF AAGE RASMUSSEN   LSU T&S    AUG    2002            *
 *  RETTET       AF AAGE RASMUSSEN   LSU T&S    JULI   2003            *
 *  RETTET       AF BO SCHMIDT       LSU T&S    JULI   2004            *
 *  RETTET       AF SUSANNE KROGH VILLUMSEN     JULI   2005            *
 *  RETTET       AF BO SCHMIDT                  JULI   2006            *
 *  RETTET       AF BO SCHMIDT                  JULI   2007            *
 *  RETTET       AF BO SCHMIDT                  JULI   2008            *
 *  RETTET       AF GERD HOLM-PEDERSEN          JULI   2009            *
 *  RETTET       AF GERD HOLM-PEDERSEN          JULI   2010            *
 *  RETTET       AF GERD HOLM-PEDERSEN          MAJ    2011   RUL      *
 *  RETTET       AF ESBEN BRODERSEN             JUNI   2012   RUL      *
 *  RETTET       AF ESBEN BRODERSEN             JUNI   2013   RUL      *
 *  RETTET       AF JØRGEN SAUGMANN             JUNI   2014   RUL      *
 *  RETTET       AF JØRGEN SAUGMANN             JUNI   2015   RUL      *
 *                   ESBEN BRODERSEN             MAR    2016           *
 *                  BH65300M DATO MACRO LAGT IND             #01       *
 *  BETINGELSE RETTET EFTER WORKSHOP MED SKAT                #02       *
 **********************************************************************/
         DEFAULT RANGE (*) STATIC;                                      
                                                                        
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
         EXTERNAL INIT ('NOTEST(ALL,,;)');                              
 /*********************************************************************/
 /*      DECLARE AF DIVERSE PARAMETRE TIL DETTE MODUL                 */
 /*********************************************************************/
                                                                        
 DCL     1 BH950_AR,                                                    
           %INCLUDE BH95007N; /* HJÆLPESTRUK FOR BR58610N */            
                                                                        
 DCL     1 BH65300M,                                                    
           %INCLUDE BH65300M;        /*#01*/                            
                                                                        
 /********************************************************************* 
 *       DECLARE AF ENTRY OG BUILTIN                                  * 
 *********************************************************************/ 
                                                                        
 DCL     ADDR            BUILTIN;                                       
 DCL     DIVIDE          BUILTIN;                                       
 DCL     MULTIPLY        BUILTIN;                                       
 /********************************************************************* 
 *       DECLARE AF DIV. HJÆLPEFELTER                                 * 
 *********************************************************************/ 
                                                                        
 DCL     I               BIN FIXED (15);                                
                                                                        
 DCL     HJVÆRDI1        FIXED     (13,3);                              
 DCL     HJVÆRDI2        FIXED     (13,3);                              
 DCL     HJVÆRDI3        FIXED     (13,0);                              
 DCL     HJVÆRDI4        FIXED     (15,1);                              
 DCL     HJDAGE          FIXED     (3);                                 
 DCL     HJPCT           FIXED     (5,4);                               
                                                                        
 DCL     FRADATO         PIC       '(8)9';                              
 DCL     1 FRA           BASED(ADDR(FRADATO)),                          
         2 AAR           PIC       '9999',                              
         2 MD            PIC       '99',                                
         2 DG            PIC       '99';                                
                                                                        
 DCL     TILDATO         PIC       '(8)9';                              
 DCL     1 TIL           BASED(ADDR(TILDATO)),                          
         2 AAR           PIC       '9999',                              
         2 MD            PIC       '99',                                
         2 DG            PIC       '99';                                
 /*********************************************************************/
 /*      PROCESS                                                      */
 /*********************************************************************/
                                                                        
         /* INITIER DIVERSE FELTER INDEN BEREGNING */                   
                                                                        
         DO I = 1 TO 18;                                                
            BH950_AR.FEJLTAB(I) = 0;                                    
         END;                                                           
                                                                        
         BH950_AR.BGLSUM = 0;                                           
         BH950_AR.BGLSUM_SW = -1;                                       
         BH950_AR.CNEDSL2 = '0';                                        
         BH950_AR.BGRPROM1 = 0;                                         
         BH950_AR.BGRPROM2 = 0;                                         
         BH950_AR.BSTITIL = 0;                                          
         BH950_AR.CSTIBLB = ' ';                                        
         BH950_AR.FDAGEJ = 0;                                           
         BH950_AR.FDAGEJEJ = 0;                                         
         BH950_AR.BPROM1 = 0;                                           
         BH950_AR.BPROM2 = 0;                                           
         BH950_AR.BNEDSL1 = 0;                                          
         BH950_AR.BNEDSL2 = 0;                                          
         BH950_AR.BPENSNED = 0;                                         
         BH950_AR.BSUM2 = 0;                                            
         BH950_AR.BSUM1 = 0;                                            
         BH950_AR.BSTIBGR = 0;                                          
         BH950_AR.BNETTO = 0;                                           
         BH950_AR.BPENSRED = 0;                                         
         BH950_AR.BBRUTTO = 0;                                          
         BH950_AR.BEJERED = 0;                                          
         BH950_AR.BUDLERED = 0;                                         
         BH950_AR.BERHVRED = 0;                                         
         BH950_AR.BUBEBOLRED = 0;                                       
         BH950_AR.B100 = 0;                                             
         BH950_AR.BEJERAN = 0;                                          
                                                                        
         /* KONTROLLER DIVERSE FELTER INDEN BEREGNING */                
                                                                        
         CALL UDFØR_KONTROLLER;                                         
                                                                        
 /*********************************************************************/
 /* RETURKODE SÆTTES LIG 0 HVIS INGEN FEJL FOREKOMMER (BEREGNING OK)  */
 /* RETURKODE SÆTTES LIG FEJLNR FOR FØRSTE FEJLTAB(I) > 0             */
 /*********************************************************************/
                                                                        
         BH950_AR.RETURKODE = 0; /* BEREGNING OK */                     
                                                                        
         DO I = 1 TO 18;                                                
            IF BH950_AR.FEJLTAB(I) > 0                                  
            THEN                                                        
               DO;                                                      
                  /* DATA TIL BEREGNING ER IKKE OK   */                 
                  /* SÆT RETURKODE LIG FØRSTE FEJL */                   
                  BH950_AR.RETURKODE = BH950_AR.FEJLTAB(I);             
                  I = 18;                                               
               END;                                                     
         END;                                                           
                                                                        
         IF BH950_AR.RETURKODE = 0                                      
         THEN                                                           
            CALL BEREGN_EVS;                                            
                                                                        
 /*********************************************************************/
 /* FØLGENDE KONTROLLER UDFØRES VED HVERT KALD AF PROGRAMMET          */
 /* FOR AT SIKRE KORREKT BEREGNING AF EJENDOMSVÆRDISKATTEN            */
 /*                                                                   */
 /*TAB FEJL FEJL                                                      */
 /* NR   NR TEKST                                                     */
 /* ----------------------------------------------------------------- */
 /*  1 5032 KODE FOR EJENDOMSTYPE FORKERT                             */
 /*  2 5034 BEREGNINGSGRUNDLAG ER STØRRE END 99999999                 */
 /*  3 5035 KODE FOR 2 PROMILLE NEDSLAG FORKERT                       */
 /*  4 5036 EJENDOMMEN OVERTAGET EFTER 31/12-2011                     */
 /*  5 5037 EJENDOMMEN SOLGT FØR 1/1-2011 ELLER FØR OVERTAGELSESDAG   */
 /*  6 5038 PROCENT FOR EJET DEL ER STØRRE END 100,00                 */
 /*  7 5039 KODE FOR PENSIONIST-NEDSLAG FORKERT                       */
 /*  8 5040 PENSIONIST GRÆNSEBELØB MANGLER                            */
 /*  9 5048 ANTAL DAGE UDLEJET ER STØRRE END ANTAL DAGE EJET          */
 /* 10 5049 ANTAL DAGE UDLEJET MANGLER                                */
 /* 11 5050 PROCENT FOR UDLEJET DEL AF EJENDOM ER STØRRE END 100,00   */
 /* 12 5051 ANTAL DAGE ERHVERV ER STØRRE END ANTAL DAGE EJET          */
 /* 13 5052 PROCENT FOR ERHVERVSDEL AF EJENDOM MANGLER                */
 /* 14 5053 PROCENT FOR ERHVERVSDEL MÅ IKKE VÆRE OVER 99,99           */
 /* 15 5160 ANTAL DAGE UBEBOELIG ER STØRRE END ANTAL DAGE EJET        */
 /* 16 5056 NEGATIV UDENLANDSK EJENDOMSVÆRDISKAT                      */
 /* 17 5060 B100 BEREGNET NEGATIV                                     */
 /*                                                                   */
 /* FEJLTAB(NR) OPSÆTTES LIG SAMTLIGE FUNDNE FEJLNUMRE                */
 /* RETURKODE SÆTTES LIG FØRST FUNDNE FEJLNUMMER                      */
 /*                                                                   */
 /*********************************************************************/
 UDFØR_KONTROLLER:                                                      
 PROC;                                                                  
                                                                        
         IF BH950_AR.CEJDTYPE = '1' !                                   
            BH950_AR.CEJDTYPE = '3' !                                   
            BH950_AR.CEJDTYPE = '4' !                                   
            BH950_AR.CEJDTYPE = '5' !                                   
            BH950_AR.CEJDTYPE = '7' !                                   
            BH950_AR.CEJDTYPE = '8' !                                   
            BH950_AR.CEJDTYPE = '9'                                     
         THEN;                                                          
         ELSE                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(2) = 5032;                              
            END;                                                        
                                                                        
         IF BH950_AR.BBERGRL > 99999999                                 
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(3) = 5034;                              
            END;                                                        
                                                                        
         IF BH950_AR.CNEDSL1 < '10' ! BH950_AR.CNEDSL1 > '50'           
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(4) = 5035;                              
            END;                                                        
                                                                        
         IF BH950_AR.STARTDATO > BH65300M.FORSKÅR1231  /*#01*/          
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(5) = 5036;                              
            END;                                                        
                                                                        
         IF BH950_AR.SLUTDATO ^= 0 &                                    
           (BH950_AR.SLUTDATO < BH65300M.FORSKÅR0101 ! /*#01*/          
            BH950_AR.SLUTDATO < BH950_AR.STARTDATO)                     
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(6) = 5037;                              
            END;                                                        
                                                                        
         IF BH950_AR.FEJLTAB(5) = 0 &                                   
            BH950_AR.FEJLTAB(6) = 0                                     
         THEN                                                           
            DO;                                                         
               /* UNDERSØG OM EJEREN HAR HANDLET I INDKOMSTAARET */     
               IF (BH950_AR.STARTDATO > BH65300M.FORSKÅR0101 ! /*#01*/  
                   BH950_AR.SLUTDATO >= BH65300M.FORSKÅR0101)  /*#01*/  
               THEN                                                     
                  CALL BEREGN_DAGE_EJET;                                
               ELSE                                                     
                  BH950_AR.FDAGEJ = 360;                                
            END;                                                        
                                                                        
         IF BH950_AR.GPCTEJER ^= 0                                      
         THEN                                                           
            DO;                                                         
               IF BH950_AR.GPCTEJER > 10000                             
               THEN                                                     
                  DO;                                                   
                     BH950_AR.FEJLTAB(7) = 5038;                        
                  END;                                                  
            END;                                                        
         ELSE                                                           
            BH950_AR.GPCTEJER = 10000;                                  
                                                                        
         /* KONTROLLER DIVERSE PENSIONIST-FELTER */                     
         IF BH950_AR.CPENSNED1 > '0' &                                  
            BH950_AR.CPENSNED1 > '2'                                    
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(8) = 5039;                              
            END;                                                        
         ELSE                                                           
            DO;                                                         
               IF BH950_AR.CPENSNED1 = '1' !                            
                  BH950_AR.CPENSNED1 = '2'                              
               THEN                                                     
                  DO;                                                   
                     IF BH950_AR.BPENSIND ^= 0 &                        
                        BH950_AR.BPENSGR = 0                            
                     THEN                                               
                        DO;                                             
                           BH950_AR.FEJLTAB(9) = 5040;                  
                        END;                                            
                  END;                                                  
            END;                                                        
                                                                        
         IF BH950_AR.FDAGUDLE > BH950_AR.FDAGEJ                         
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(10) = 5048;                             
            END;                                                        
                                                                        
         IF BH950_AR.GPCTUDLE ^= 0                                      
         THEN                                                           
            DO;                                                         
               IF BH950_AR.FDAGUDLE = 0                                 
               THEN                                                     
                  DO;                                                   
                     BH950_AR.FEJLTAB(11) = 5049;                       
                  END;                                                  
               IF BH950_AR.GPCTUDLE > 10000                             
               THEN                                                     
                  DO;                                                   
                     BH950_AR.FEJLTAB(12) = 5050;                       
                  END;                                                  
            END;                                                        
                                                                        
         IF (BH950_AR.FDAGERHV = 0 & BH950_AR.GPCTERHV > 0) &           
             BH950_AR.FDAGEJ < 360                                      
         THEN                                                           
            BH950_AR.FDAGERHV = BH950_AR.FDAGEJ;                        
                                                                        
         IF BH950_AR.FDAGERHV ^= 0                                      
         THEN                                                           
            DO;                                                         
               IF BH950_AR.FDAGERHV > BH950_AR.FDAGEJ                   
               THEN                                                     
                  DO;                                                   
                     BH950_AR.FEJLTAB(13) = 5051;                       
                  END;                                                  
               IF BH950_AR.GPCTERHV = 0                                 
               THEN                                                     
                  DO;                                                   
                     BH950_AR.FEJLTAB(14) = 5052;                       
                  END;                                                  
            END;                                                        
                                                                        
         IF BH950_AR.GPCTERHV > 09999                                   
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(15) = 5053;                             
            END;                                                        
                                                                        
         IF BH950_AR.FUBEBOELIG > BH950_AR.FDAGEJ                       
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(16) = 5160;                             
            END;                                                        
                                                                        
         IF BH950_AR.BUDLSKC < 0                                        
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(17) = 5056;                             
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      BEREGN ANTAL DAGE EJET I INDKOMSTÅRET                        */
 /*      MÅNEDER BEREGNES SOM VÆRENDE PÅ 30 DAGE                      */
 /*      D.V.S. ET  H E L T  ÅR ER PÅ 360 DAGE                        */
 /*********************************************************************/
 BEREGN_DAGE_EJET:                                                      
 PROC;                                                                  
                                                                        
         FRADATO = BH950_AR.STARTDATO;                                  
         IF FRADATO < BH65300M.FORSKÅR0101          /*#01*/             
         THEN                                                           
            FRADATO = FORSKÅR0101;                  /*#01*/             
                                                                        
         TILDATO = BH950_AR.SLUTDATO;                                   
         IF TILDATO > BH65300M.FORSKÅR1231 !        /*#01*/             
            TILDATO = 0                                                 
         THEN                                                           
            TILDATO = BH65300M.FORSKÅR1231;         /*#01*/             
                                                                        
         IF FRADATO > TILDATO                                           
         THEN                                                           
            FRADATO = TILDATO;                                          
                                                                        
         BH950_AR.FDAGEJ = (((TIL.MD - 1) * 30) + TIL.DG) -             
                        (((FRA.MD - 1) * 30) + FRA.DG);                 
                                                                        
         IF BH950_AR.FDAGEJ = 0                                         
         THEN                                                           
            BH950_AR.FDAGEJ = 1;                                        
            /* KØB OG SALG SAMME DATO */                                
                                                                        
         IF BH950_AR.STARTKODE = '1' &                                  
            BH950_AR.FDAGEJ > 1                                         
         THEN                                                           
            BH950_AR.FDAGEJ = BH950_AR.FDAGEJ - 1;                      
                                                                        
         BH950_AR.FDAGEJEJ = 360 - BH950_AR.FDAGEJ;                     
                                                                        
 END BEREGN_DAGE_EJET;                                                  
                                                                        
 END UDFØR_KONTROLLER;                                                  
 /*********************************************************************/
 /*      BEREGNING AF EJENDOMSVÆRDISKAT                               */
 /*********************************************************************/
 BEREGN_EVS:                                                            
 PROC;                                                                  
                                                                        
         IF BH950_AR.CNEDSL1 >= '10' &                                  
            BH950_AR.CNEDSL1 < '30'                                     
         THEN                                                           
            DO;                                                         
               /* DAN KODE FOR 4 PROMILLE NEDSLAG (TIDL. STDFRADRAG.) */
               SELECT;                                                  
                 WHEN (BH950_AR.CFRED = '1')                            
                    BH950_AR.CNEDSL2 = '3';                             
                 WHEN (BH950_AR.CEJDTYPE = '4')                         
                    BH950_AR.CNEDSL2 = '5';                             
                 WHEN (BH950_AR.CEJDTYPE = '5')                         
                    BH950_AR.CNEDSL2 = '4';                             
                 WHEN (BH950_AR.CEJDTYPE = '7' !                        
                       BH950_AR.CEJDTYPE = '8')                         
                    BH950_AR.CNEDSL2 = '2';                             
                 OTHERWISE                                              
                    BH950_AR.CNEDSL2 = '1';                             
               END;                                                     
            END;                                                        
                                                                        
         IF BH950_AR.BBERGRL > 3040000    /* SKAL EVT. RETTES TIL DEN */
         THEN                             /* RIGTIGE GRÆNSEVÆRDI FOR  */
            DO;                           /* AKTUELT FORSKUDSÅR       */
               BH950_AR.BGRPROM1 = 3040000;                             
               BH950_AR.BGRPROM2 = BH950_AR.BBERGRL - 3040000;          
            END;                                                        
         ELSE                                                           
            BH950_AR.BGRPROM1 = BH950_AR.BBERGRL;                       
                                                                        
         IF ((BH950_AR.CPTYPSLUT < '3' &             /* JSA003 */       
              BH950_AR.CPTYPFOR  > '2') !                               
             (BH950_AR.CPTYPSLUT > '2' &                                
              BH950_AR.CPTYPFOR  < '3')) &                              
              BH950_AR.BEVSGL_SW = 0 &                                  
              BH950_AR.BPENSNEDGL_SW = 0                                
         THEN                                                           
            CALL BEREGN_BGLSUM;                                         
         ELSE                                                           
            DO;                                                         
               IF BH950_AR.BEVSGL_SW = 0                                
               THEN                                                     
                  DO;                                                   
                     BH950_AR.BGLSUM = BH950_AR.BEVSGL;                 
                     BH950_AR.BGLSUM_SW = 0;                            
                  END;                                                  
            END;                                                        
                                                                        
         IF BH950_AR.BGLSUM_SW = -1                                     
         THEN;                                                          
         ELSE                                                           
            DO;                                                         
               /* BEREGN HVOR MEGET EJENDOMSVÆRDISKATTEN */             
               /* MAKSIMALT MÅ STIGE TIL                 */             
               SELECT (BH950_AR.CPTYPFOR);                              
                 WHEN ('1')                                             
                   DO;                                                  
                      /* BEHANDLING AF ALMINDELIGE SKATTEYDERE */       
                      CALL BEREGN_MAX_STIGNING_2400;                    
                   END;                                                 
                 WHEN ('2','3','4')                                     
                   DO;                                                  
                      /* BEHANDLING AF EFTERLØNNERE/FØRTIDSPENS. */     
                      /* ELLER PENSIONISTER */                          
                      CALL BEREGN_MAX_STIGNING_500;                     
                   END;                                                 
                 OTHERWISE;                                             
               END; /* SELECT */                                        
               IF BH950_AR.BSTITIL < 0                                  
               THEN                                                     
                  BH950_AR.BSTITIL = 0;                                 
            END;                                                        
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT 10 PROMILLE */                     
         BH950_AR.BPROM1 = MULTIPLY(BH950_AR.BGRPROM1,0.010,11,2);      
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT 30 PROMILLE */                     
         IF BH950_AR.BGRPROM2 > 0                                       
         THEN                                                           
            BH950_AR.BPROM2 = MULTIPLY(BH950_AR.BGRPROM2,0.030,11,2);   
                                                                        
         IF BH950_AR.CNEDSL1 >= '10' & BH950_AR.CNEDSL1 <= '29'         
         THEN                                                           
            DO;                                                         
               /* BEREGN 2 PROMILLE NEDSLAG - EJENDOM EJET 1/7-98 */    
               HJVÆRDI1 =                                               
               (MULTIPLY(BH950_AR.BBERGRL,0.002,11,3)) + 0.005;         
               BH950_AR.BNEDSL1 = HJVÆRDI1;                             
               /* BEREGN 4 PROMILLE NEDSLAG - EJENDOM EJET 1/7-98 */    
               SELECT (BH950_AR.CNEDSL2);                               
                 WHEN ('1')                                             
                   DO;                                                  
                      /* BEREGN 4 PROMILLE NEDSLAG */                   
                      HJVÆRDI1 =                                        
                      (MULTIPLY(BH950_AR.BBERGRL,0.004,11,3)) + 0.005;  
                      /* NEDSLAGET KAN MAX. VÆRE 1200,00 KR. */         
                      IF HJVÆRDI1 < 1200.000                            
                      THEN                                              
                         BH950_AR.BNEDSL2 = HJVÆRDI1;                   
                      ELSE                                              
                         BH950_AR.BNEDSL2 = 1200.00;                    
                   END;                                                 
                 WHEN ('4')                                             
                   DO;                                                  
                      /* BEREGN 4 PROMILLE NEDSLAG - 2-FAM-HUS */       
                      /* MED  K U N  1 EJERBOLIGVÆRDI          */       
                      HJVÆRDI1 =                                        
                      (MULTIPLY(BH950_AR.BBER2FAM,0.004,11,3)) + 0.005; 
                      /* NEDSLAGET KAN MAX. VÆRE 2400,00 KR. */         
                      IF HJVÆRDI1 < 2400.000                            
                      THEN                                              
                         BH950_AR.BNEDSL2 = HJVÆRDI1;                   
                      ELSE                                              
                         BH950_AR.BNEDSL2 = 2400.00;                    
                   END;                                                 
                 WHEN ('5')                                             
                   DO;                                                  
                      /* BEREGN 4 PROMILLE NEDSLAG - 2-FAM-HUS */       
                      /* MED 2 EJERBOLIGVÆRDIER                */       
                      HJVÆRDI1 =                                        
                      (MULTIPLY(BH950_AR.BBER2FAM,0.004,11,3)) + 0.005; 
                      /* NEDSLAGET KAN MAX. VÆRE 1200,00 KR. */         
                      IF HJVÆRDI1 < 1200.000                            
                      THEN                                              
                         BH950_AR.BNEDSL2 = HJVÆRDI1;                   
                      ELSE                                              
                         BH950_AR.BNEDSL2 = 1200.00;                    
                   END;                                                 
                 OTHERWISE; /* INTET NEDSLAG */                         
               END;                                                     
            END;                                                        
                                                                        
         /* BEREGN 4 PROMILLE NEDSLAG FOR PERSONER MED */               
         /* STATUS SOM 67-ÅRIGE M.V.                   */               
         IF BH950_AR.CPTYPFOR = '3' !                                   
            BH950_AR.CPTYPFOR = '4'                                     
   /*      & BH950_AR.BEJSKATDK   > 0                                   
           & BH950_AR.BEJSKATDKÆF > 0) #02 */                           
         THEN DO;                                                       
            SELECT (BH950_AR.CPENSNED1);                                
               WHEN ('1') DO;                                           
               /* HELÅRSBOLIG */                                        
                  HJVÆRDI1 =                                            
                        (MULTIPLY(BH950_AR.BBERGRL,0.004,11,3)) + 0.005;
               /* NEDSLAGET KAN MAX. VÆRE 6000,00 KR. */                
                  IF HJVÆRDI1 < 6000.000                                
                  THEN                                                  
                     BH950_AR.BPENSNED = HJVÆRDI1;                      
                  ELSE                                                  
                     BH950_AR.BPENSNED = 6000.00;                       
               END;                                                     
               WHEN ('2') DO;                                           
               /* FRITIDSBOLIG */                                       
                  HJVÆRDI1 =                                            
                        (MULTIPLY(BH950_AR.BBERGRL,0.004,11,3)) + 0.005;
               /* NEDSLAGET KAN MAX. VÆRE 2000,00 KR. */                
                  IF HJVÆRDI1 < 2000.000                                
                  THEN                                                  
                     BH950_AR.BPENSNED = HJVÆRDI1;                      
                  ELSE                                                  
                     BH950_AR.BPENSNED = 2000.00;                       
               END;                                                     
               OTHERWISE;                                               
            END; /* SELECT */                                           
         END;  /* IF */                                                 
         ELSE DO;                                                       
            BH950_AR.BPENSNED = 0;                                      
         END;                                                           
                                                                        
         /* BEREGN SUM AF EJENDOMSVÆRDISKAT */                          
         /* I N D E N  STIGNINGSBEGRÆNSNING */                          
                                                                        
         BH950_AR.BSUM2 = (BH950_AR.BPROM1 + BH950_AR.BPROM2) -         
                          (BH950_AR.BNEDSL1 +                           
                           BH950_AR.BNEDSL2);                           
                                                                        
         /* REGULER EVT. BNEDSL2 HVIS SUM2 BLIVER NEGATIV */            
                                                                        
         IF BH950_AR.BSUM2 < 0 &                                        
            BH950_AR.BNEDSL2 > 0                                        
         THEN                                                           
            DO;                                                         
               BH950_AR.BNEDSL2 = BH950_AR.BNEDSL2 + BH950_AR.BSUM2;    
               BH950_AR.BSUM2 = 0;                                      
            END;                                                        
                                                                        
         /* REGULER EVT. BPENSNED SÅ BSUM1 IKKE BLIVER NEGATIV */       
                                                                        
         IF BH950_AR.BPENSNED > BH950_AR.BSUM2                          
         THEN                                                           
            BH950_AR.BPENSNED = BH950_AR.BSUM2;                         
                                                                        
         BH950_AR.BSUM1 = (BH950_AR.BPROM1 + BH950_AR.BPROM2) -         
                          (BH950_AR.BNEDSL1 +                           
                           BH950_AR.BNEDSL2 +                           
                           BH950_AR.BPENSNED);                          
                                                                        
         BH950_AR.BSUM3 = BH950_AR.BSUM1;                               
                                                                        
         IF BH950_AR.BFASTSTIGBGR > 0                                   
         THEN                                                           
            BH950_AR.BSUM1 = BH950_AR.BSUM1 - BH950_AR.BFASTSTIGBGR;    
                                                                        
         IF BH950_AR.BSUM1 < 0                                          
         THEN                                                           
            BH950_AR.BSUM1 = 0;                                         
                                                                        
         /* BEREGN FRADRAGSBELØB VEDR. STIGNINGSBEGRÆNSNING */          
                                                                        
         IF BH950_AR.BSTITIL >= BH950_AR.BSUM1                          
         THEN                                                           
            DO;                                                         
               BH950_AR.BSTITIL = 0;                                    
               BH950_AR.CSTIBLB = '0';                                  
            END;                                                        
         ELSE                                                           
            IF BH950_AR.CSTIBLB > '0'                                   
            THEN                                                        
               BH950_AR.BSTIBGR = BH950_AR.BSUM1 - BH950_AR.BSTITIL;    
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT         */                         
         /*  E F T E R  STIGNINGSBEGRÆNSNING */                         
                                                                        
         BH950_AR.BNETTO = BH950_AR.BSUM1 - BH950_AR.BSTIBGR;           
                                                                        
         IF BH950_AR.BNETTO < 0                                         
         THEN                                                           
            BH950_AR.BNETTO = 0;                                        
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT          */                        
         /*  E F T E R  STIGNINGSBEGRÆNSNING */                         
                                                                        
         IF BH950_AR.BPENSNED > 0                                       
         THEN                                                           
            DO;                                                         
               /* BEREGN EVT. REDUKTION AF 67-ÅRS NEDSLAG */            
               /* JVF. SOCIALINDKOMST                     */            
               HJVÆRDI2 = BH950_AR.BPENSIND - BH950_AR.BPENSGR;         
               HJVÆRDI1 =                                               
               (MULTIPLY(HJVÆRDI2,0.05,11,3)) + 0.005;                  
               IF HJVÆRDI1 < 0.000                                      
               THEN                                                     
                  BH950_AR.BPENSRED = 0.000;                            
               ELSE                                                     
                  DO;                                                   
                     IF HJVÆRDI1 <= BH950_AR.BPENSNED                   
                     THEN                                               
                        BH950_AR.BPENSRED = HJVÆRDI1;                   
                     ELSE                                               
                        BH950_AR.BPENSRED = BH950_AR.BPENSNED;          
                  END;                                                  
            END;                                                        
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT   E F T E R  */                    
         /* EVT. REDUKTION AF 67-ÅRS NEDSLAG      */                    
                                                                        
         BH950_AR.BBRUTTO = BH950_AR.BNETTO + BH950_AR.BPENSRED;        
                                                                        
         IF BH950_AR.FDAGEJEJ > 0                                       
         THEN                                                           
            DO;                                                         
               /* BEREGN REDUKTIONSBELØB FOR EJERPERIODE */             
               HJDAGE = BH950_AR.FDAGEJEJ;                              
               /* OBS.: HJDAGE BRUGES FOR AT SIKRE KORREKT UDREGNING  */
               /*       AF DIV. DAGE REDUKTION, DA DET GÅR GALT HVIS  */
               /*       DAGENE INDGÅR DECLARED BIN FIXED (15).        */
               HJVÆRDI3 = BH950_AR.BBRUTTO * 1000;                      
               HJVÆRDI4 = (MULTIPLY((DIVIDE(HJVÆRDI3,360,13,4)),        
                            HJDAGE,14,2));                              
               BH950_AR.BEJERED =                                       
               (DIVIDE(HJVÆRDI4,1000,14,3)) + 0.005;                    
            END;                                                        
                                                                        
         IF BH950_AR.FDAGUDLE > 0                                       
         THEN                                                           
            DO;                                                         
               /* BEREGN REDUKTIONSBELØB FOR UDLEJE */                  
               HJDAGE = BH950_AR.FDAGUDLE;                              
               HJVÆRDI3 = BH950_AR.BBRUTTO * 1000;                      
               IF BH950_AR.GPCTUDLE > 0                                 
               THEN                                                     
                  DO;                                                   
                     HJPCT = BH950_AR.GPCTUDLE / 10000;                 
                     HJVÆRDI3 = (MULTIPLY                               
                                 (HJVÆRDI3,HJPCT,13,4));                
                  END;                                                  
               HJVÆRDI4 = (MULTIPLY((DIVIDE(HJVÆRDI3,360,13,4)),        
                            HJDAGE,14,2));                              
               BH950_AR.BUDLERED =                                      
               (DIVIDE(HJVÆRDI4,1000,14,3)) + 0.005;                    
            END;                                                        
                                                                        
         IF BH950_AR.GPCTERHV > 0                                       
         THEN                                                           
            DO;                                                         
               /* BEREGN REDUKTIONSBELØB FOR ERHVERSMÆSSIG DEL */       
               HJPCT = BH950_AR.GPCTERHV / 10000;                       
               IF BH950_AR.FDAGERHV = 0                                 
               THEN                                                     
                  BH950_AR.BERHVRED =                                   
                  (MULTIPLY(BH950_AR.BBRUTTO,HJPCT,11,4)) + 0.005;      
               ELSE                                                     
                  DO;                                                   
                     HJDAGE = BH950_AR.FDAGERHV;                        
                     HJVÆRDI3 = BH950_AR.BBRUTTO * 1000;                
                     HJVÆRDI3 = (MULTIPLY(HJVÆRDI3,HJPCT,13,4));        
                     HJVÆRDI4 =                                         
                     (MULTIPLY((DIVIDE(HJVÆRDI3,360,13,4)),             
                      HJDAGE,14,2));                                    
                     BH950_AR.BERHVRED =                                
                     (DIVIDE(HJVÆRDI4,1000,14,3)) + 0.005;              
                  END;                                                  
            END;                                                        
                                                                        
         IF BH950_AR.FUBEBOELIG > 0                                     
         THEN                                                           
            DO;                                                         
               /* BEREGN REDUKTIONSBELØB FOR UBEBOELIG */               
               HJDAGE = BH950_AR.FUBEBOELIG;                            
               /* OBS.: HJDAGE BRUGES FOR AT SIKRE KORREKT UDREGNING  */
               /*       AF DIV. DAGE REDUKTION, DA DET GÅR GALT HVIS  */
               /*       DAGENE INDGÅR DECLARED BIN FIXED (15).        */
               HJVÆRDI3 = BH950_AR.BBRUTTO * 1000;                      
               HJVÆRDI4 = (MULTIPLY((DIVIDE(HJVÆRDI3,360,13,4)),        
                            HJDAGE,14,2));                              
               BH950_AR.BUBEBOLRED =                                    
               (DIVIDE(HJVÆRDI4,1000,14,3)) + 0.005;                    
            END;                                                        
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT TIL BETALING - 100% */             
                                                                        
         BH950_AR.B100 = BH950_AR.BBRUTTO -                             
                        (BH950_AR.BEJERED +                             
                         BH950_AR.BUDLERED +                            
                         BH950_AR.BERHVRED +                            
                         BH950_AR.BUBEBOLRED);                          
                                                                        
         IF BH950_AR.B100 < 0                                           
         THEN                                                           
            DO;                                                         
               BH950_AR.FEJLTAB(18) = 5060;                             
               BH950_AR.B100 = 0;                                       
            END;                                                        
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT TIL BETALING - 100% */             
         /* EFTER FRADRAG AF UDENLANDSK EJD.VÆRDISKAT     */            
                                                                        
         IF BH950_AR.BUDLSKC > 0                                        
         THEN                                                           
            BH950_AR.B100 = BH950_AR.B100 - BH950_AR.BUDLSKC;           
                                                                        
         IF BH950_AR.B100 < 0                                           
         THEN                                                           
            BH950_AR.B100 = 0;                                          
                                                                        
         /* BEREGN EJENDOMSVÆRDISKAT - EJERANDEL */                     
                                                                        
         IF BH950_AR.GPCTEJER < 10000                                   
         THEN                                                           
            DO;                                                         
               HJPCT = BH950_AR.GPCTEJER / 10000;                       
               BH950_AR.BEJERAN = MULTIPLY(BH950_AR.B100,HJPCT,11,4);   
            END;                                                        
                                                                        
 /*********************************************************************/
 /* BEREGN FAKTISK SAMMENLIGNINGSGRUNDLAG TIL STIGNINGSBEGRÆNSNING    */
 /* D.V.S. HVOR DER ER TAGET HØJDE FOR EVT. ÆNDRING AF PERSONTYPE FRA */
 /* AKTUELT SLUTÅR (CPTYPSLUT) TIL FORSKUDSÅR (CPTYPFOR).             */
 /*********************************************************************/
 BEREGN_BGLSUM:                                                         
 PROC;                                                                  
                                                                        
         IF BH950_AR.CPTYPSLUT < '3' &            /* JSA004 */          
            BH950_AR.CPTYPFOR  = '3'                                    
         THEN                                                           
            DO;                                                         
               IF BH950_AR.BPENSNEDGL > BH950_AR.BEVSGL                 
               THEN                                                     
                  BH950_AR.BPENSNEDGL = BH950_AR.BEVSGL;                
               BH950_AR.BGLSUM = BH950_AR.BEVSGL -                      
                                      BH950_AR.BPENSNEDGL;              
               BH950_AR.BGLSUM_SW = 0;                                  
            END;                                                        
         ELSE                                                           
            IF BH950_AR.CPTYPSLUT = '3' &                               
               BH950_AR.CPTYPFOR  < '3'                                 
            THEN                                                        
               DO;                                                      
                  BH950_AR.BGLSUM = BH950_AR.BEVSGL +                   
                                             BH950_AR.BPENSNEDGL;       
                  BH950_AR.BGLSUM_SW = 0;                               
               END;                                                     
                                                                        
 END BEREGN_BGLSUM;                                                     
                                                                        
 /*********************************************************************/
 /* BEREGN HVOR MEGET EJENDOMSVÆRDISKATTEN MÅ STIGE TIL FOR           */
 /* PERSONER MED STATUS SOM PENSIONISTER ELLER FØRTIDSPENSIONISTER    */
 /* OG/ELLER EFTERLØNSMODTAGERE                                       */
 /*********************************************************************/
 BEREGN_MAX_STIGNING_500:                                               
 PROC;                                                                  
                                                                        
         IF BH950_AR.BGLSUM <= 7000.00                                  
         THEN                                                           
            DO;                                                         
               BH950_AR.BSTITIL = BH950_AR.BGLSUM + 500.00;             
               BH950_AR.CSTIBLB = '1';                                  
            END;                                                        
         ELSE                                                           
            DO;                                                         
               BH950_AR.BSTITIL = BH950_AR.BGLSUM +                     
               (MULTIPLY(BH950_AR.BGLSUM,0.2,11,2) - 900);              
               BH950_AR.CSTIBLB = '2';                                  
            END;                                                        
                                                                        
 END BEREGN_MAX_STIGNING_500;                                           
                                                                        
 /*********************************************************************/
 /*      BEREGN HVOR MEGET EJENDOMSVÆRDISKATTEN MÅ STIGE TIL FOR      */
 /*      ALMINDELIGE PERSONER                                         */
 /*********************************************************************/
 BEREGN_MAX_STIGNING_2400:                                              
 PROC;                                                                  
                                                                        
         IF BH950_AR.BGLSUM <= 12000.00                                 
         THEN                                                           
            DO;                                                         
               BH950_AR.BSTITIL = BH950_AR.BGLSUM + 2400.00;            
               BH950_AR.CSTIBLB = '3';                                  
            END;                                                        
         ELSE                                                           
            DO;                                                         
               BH950_AR.BSTITIL = BH950_AR.BGLSUM +                     
               (MULTIPLY(BH950_AR.BGLSUM,0.2,11,2));                    
               BH950_AR.CSTIBLB = '4';                                  
            END;                                                        
                                                                        
 END BEREGN_MAX_STIGNING_2400;                                          
                                                                        
                                                                        
 END BEREGN_EVS;                                                        
                                                                        
                                                                        
 END BH95007;                                                           
