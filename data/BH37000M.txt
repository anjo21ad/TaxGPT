 /**********************************************************************
 * PROJEKT:     EVS SLUT 2001                                          *
 * PROGRAMNAVN: BH37000M.                                              *
 * PROGRAMTYPE: MAKRO.                                                 *
 * FUNKTION:    SQL UDTRÆK FRA EVS SLUT 2001                           *
 * PROGRAMMØR:  ESBEN BRODERSEN       ESB, PUS/T&S BRØNDBY 11.07.2001. *
 **********************************************************************/
 /*********************************************************************/
 /* DECLARE CURSOR_1 TIL LÆS AF PERSONTABEL BQ01200T           RUTINE */
 /*********************************************************************/
 DECLARE_CURSOR_1:PROC;                                                 
                                                                        
         EXEC SQL DECLARE CURSOR_1 CURSOR FOR                           
                                                                        
         SELECT T1.DCPRN,                                               
                T1.DINDKAAR,                                            
                T1.EKOMNR,                                              
                T1.EEJDNR                                               
                                                                        
         FROM   BQ01200T T1, BQ01100T T2                                
         WHERE  T1.DINDKAAR = 2001                                      
         AND    T1.DINDKAAR = T2.DINDKAAR                               
         AND    T1.EKOMNR   = T2.EKOMNR                                 
         AND    T1.EEJDNR   = T2.EEJDNR                                 
         AND    T1.DCPRN    = :DCLCPRNR                                 
         AND    T1.EKOMNR   = :UDTRÆK_SLUT.EKOMNR                       
         AND    T1.EEJDNR   = :UDTRÆK_SLUT.EEJDNR                       
                                                                        
         ORDER BY T1.DCPRN,                                             
                  T1.DINDKAAR,                                          
                  T1.EKOMNR,                                            
                  T1.EEJDNR;                                            
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
           DO;                                                          
             FEJLTEKST = 'DECLARE_CURSOR_1';                            
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
 END DECLARE_CURSOR_1;                                                  
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF PERSONTABEL BQ01200T               RUTINE */
 /*********************************************************************/
 FETCH_CURSOR_1:PROC;                                                   
                                                                        
         EXEC SQL FETCH CURSOR_1                                        
                                                                        
         INTO :PERSON.DCPRN,                                            
              :PERSON.DINDKAAR,                                         
              :PERSON.EKOMNR,                                           
              :PERSON.EEJDNR;                                           
                                                                        
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0);                                                    
                                                                        
           WHEN (100);                                                  
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST  = 'FETCH PERSONEJDOPL';                       
               PUT SKIP LIST('SQLKODE',SQLCODE);                        
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
 END FETCH_CURSOR_1;                                                    
 /*********************************************************************/
 /* DECLARE CURSOR_2 TIL LÆS AF PERSONTABEL BQ01200T           RUTINE */
 /*********************************************************************/
 DECLARE_CURSOR_2:PROC;                                                 
                                                                        
         EXEC SQL DECLARE CURSOR_2 CURSOR FOR                           
                                                                        
         SELECT T1.DCPRN,                                               
                T1.DINDKAAR,                                            
                T1.EKOMNR,                                              
                T1.EEJDNR                                               
                                                                        
         FROM   BQ01200T T1, BQ01100T T2                                
         WHERE  T1.DINDKAAR = 2001                                      
         AND    T1.DINDKAAR = T2.DINDKAAR                               
         AND    T1.EKOMNR   = T2.EKOMNR                                 
         AND    T1.EEJDNR   = T2.EEJDNR                                 
         AND    T1.DCPRN    = :DCLCPRNR                                 
         AND    T1.EKOMNR   = 999                                       
                                                                        
         ORDER BY T1.DCPRN,                                             
                  T1.DINDKAAR,                                          
                  T1.EKOMNR,                                            
                  T1.EEJDNR;                                            
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
           DO;                                                          
             FEJLTEKST = 'DECLARE_CURSOR_2';                            
             CALL SQL_FEJL;                                             
           END;                                                         
                                                                        
 END DECLARE_CURSOR_2;                                                  
 /*********************************************************************/
 /* FETCH CURSOR TIL LÆS AF PERSONTABEL BQ01200T               RUTINE */
 /*********************************************************************/
 FETCH_CURSOR_2:PROC;                                                   
                                                                        
         EXEC SQL FETCH CURSOR_2                                        
                                                                        
         INTO :PERSON.DCPRN,                                            
              :PERSON.DINDKAAR,                                         
              :PERSON.EKOMNR,                                           
              :PERSON.EEJDNR;                                           
                                                                        
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0);                                                    
      /*     DO;                                                        
               ANT_TABEL = ANT_TABEL + 1;                               
             END;                       */                              
                                                                        
           WHEN (100);                                                  
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST  = 'FETCH PERSONEJDOPL';                       
               PUT SKIP LIST('SQLKODE',SQLCODE);                        
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* SELECT*/                                               
                                                                        
 END FETCH_CURSOR_2;                                                    
