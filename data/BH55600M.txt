 /*********************************************************************/
 /* BH55300M BRUGES VED BEREGNING AF EVS (EJENDOMSVÆRDISKAT) TIL      */
 /*          SLUT, BOLIGYDELSE OG FORSKUD BL.A. VED BEREGNING AF PER- */
 /*          SONERS ALDER OG HVOR MANGE ÅR EN EJENDOM ER EJET (8 ÅRS  */
 /*          REGEL FOR HELÅRS-SOMMERHUSE).                            */
 /*                                                                   */
 /*          OPSÆTNINGERNE SKER VED OPSLAG PÅ AFVIKLINGSTABELLEN      */
 /*          (BQ85100T).                                              */
 /*                                                                   */
 /*          DENNE INCLUDE ER OPRETTET SOM EN KOPI AF BH55300M.       */
 /*                                                                   */
 /* PROGRAMMØR: STEEN PEDERSEN/SEP, FEBRUAR 2021                      */
 /*********************************************************************/
 /* RETTELSESLOG:                                                     */
 /*  FORSKUD25 BH55600M erstatter BH55300M                            */
 /*********************************************************************/
                                                                        
      /* STRUKTUR MED DIV. FELT DEFINITIONER */                         
         %INCLUDE BH55600N;                                             
                                                                        
      /* HENT ÅBEN RÆKKE PÅ AFVIKLINGSTABELLEN (BQ72100T) */            
   DCL BH55650  ENTRY;                                                  
   DCL PARMPTR  PTR;                                                    
   DCL 1 BH55650N,                                                      
         %INCLUDE BH55650N;                                             
   DCL ÅR_PIC   PIC  '9999',                                            
       ÅR_CHAR  CHAR (04) BASED (ADDR (ÅR_PIC));                        
                                                                        
         BH55650N = '';                                                 
         PARMPTR = ADDR (BH55650N);                                     
                                                                        
         CALL BH55650 (PARMPTR);                                        
                                                                        
         BH55600M.TIL_EVS_AAR   = BH55650N.TIL_EVS_AAR;                 
         BH55600M.AFVIKLINGS_ID = BH55650N.AFVIKLINGS_ID;               
         BH55600M.DATA_ID       = BH55650N.DATA_ID;                     
                                                                        
      /* FORRIGE SLUTÅR */                                              
         IF BH55650N.AFVIKLINGS_ID = 'OPRET_EVS_FORSK'                  
         THEN ÅR_PIC = BH55650N.TIL_EVS_AAR - 3;                        
         ELSE ÅR_PIC = BH55650N.TIL_EVS_AAR - 2;                        
         BH55600M.FORRIGESLUTÅR   = ÅR_PIC;                             
         BH55600M.FORRIGESLUTÅR1  = ÅR_CHAR;                            
                                                                        
      /* GL. SLUTÅR */                                                  
         IF BH55650N.AFVIKLINGS_ID = 'OPRET_EVS_FORSK'                  
         THEN ÅR_PIC = BH55650N.TIL_EVS_AAR - 2;                        
         ELSE ÅR_PIC = BH55650N.TIL_EVS_AAR - 1;                        
         BH55600M.GLSLUTÅR   = ÅR_PIC;                                  
         BH55600M.GLSLUTÅR1  = ÅR_CHAR;                                 
                                                                        
      /* AKTUELT SLUTÅR */                                              
         IF BH55650N.AFVIKLINGS_ID = 'OPRET_EVS_FORSK'                  
         THEN ÅR_PIC = BH55650N.TIL_EVS_AAR - 1;                        
         ELSE ÅR_PIC = BH55650N.TIL_EVS_AAR;                            
         BH55600M.SLUTÅR     = ÅR_PIC;                                  
         BH55600M.INDKÅR1    = ÅR_CHAR;                                 
                                                                        
      /* FORSKUDSÅR */                                                  
         IF BH55650N.AFVIKLINGS_ID = 'OPRET_EVS_FORSK'                  
         THEN ÅR_PIC = BH55650N.TIL_EVS_AAR;                            
         ELSE ÅR_PIC = BH55650N.TIL_EVS_AAR + 1;                        
         BH55600M.FORSKÅR    = ÅR_PIC;                                  
         BH55600M.INDKÅR2    = ÅR_CHAR;                                 
                                                                        
      /* AFLEDTE DATOER FOR FORRIGE SLUTÅR */                           
                                                                        
         BH55600M.FORRIGE0101   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0101);          
         BH55600M.FORRIGE0201   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0201);          
         BH55600M.FORRIGE0301   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0301);          
         BH55600M.FORRIGE0401   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0401);          
         BH55600M.FORRIGE0501   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0501);          
         BH55600M.FORRIGE0601   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0601);          
         BH55600M.FORRIGE0701   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0701);          
         BH55600M.FORRIGE0801   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0801);          
         BH55600M.FORRIGE0901   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,0901);          
         BH55600M.FORRIGE1001   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,1001);          
         BH55600M.FORRIGE1101   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,1101);          
         BH55600M.FORRIGE1201   =                                       
                  OPSÆT_YYYYMMDD(BH55600M.FORRIGESLUTÅR,1201);          
                                                                        
      /* AFLEDTE DATOER FOR GL. SLUTÅR */                               
                                                                        
         BH55600M.GLÅR0101 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0101);    
         BH55600M.GLÅR0201 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0201);    
         BH55600M.GLÅR0301 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0301);    
         BH55600M.GLÅR0401 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0401);    
         BH55600M.GLÅR0501 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0501);    
         BH55600M.GLÅR0601 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0601);    
         BH55600M.GLÅR0701 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0701);    
         BH55600M.GLÅR0801 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0801);    
         BH55600M.GLÅR0901 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0901);    
         BH55600M.GLÅR1001 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,1001);    
         BH55600M.GLÅR1101 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,1101);    
         BH55600M.GLÅR1201 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,1201);    
                                                                        
         BH55600M.GLÅR0131 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0131);    
         BH55600M.GLÅR0229 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0229);    
         BH55600M.GLÅR0331 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0331);    
         BH55600M.GLÅR0430 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0430);    
         BH55600M.GLÅR0531 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0531);    
         BH55600M.GLÅR0630 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0630);    
         BH55600M.GLÅR0731 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0731);    
         BH55600M.GLÅR0831 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0831);    
         BH55600M.GLÅR0930 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,0930);    
         BH55600M.GLÅR1031 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,1031);    
         BH55600M.GLÅR1130 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,1130);    
         BH55600M.GLÅR1231 = OPSÆT_YYYYMMDD(BH55600M.GLSLUTÅR,1231);    
                                                                        
       /* AFLEDTE DATOER FOR AKTUELT SLUTÅR */                          
                                                                        
         BH55600M.ÅR0101 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0101);        
         BH55600M.ÅR0201 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0201);        
         BH55600M.ÅR0301 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0301);        
         BH55600M.ÅR0401 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0401);        
         BH55600M.ÅR0501 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0501);        
         BH55600M.ÅR0601 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0601);        
         BH55600M.ÅR0701 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0701);        
         BH55600M.ÅR0801 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0801);        
         BH55600M.ÅR0901 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0901);        
         BH55600M.ÅR1001 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,1001);        
         BH55600M.ÅR1101 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,1101);        
         BH55600M.ÅR1201 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,1201);        
                                                                        
         BH55600M.ÅR0131 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0131);        
         BH55600M.ÅR0229 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0229);        
         BH55600M.ÅR0331 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0331);        
         BH55600M.ÅR0430 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0430);        
         BH55600M.ÅR0531 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0531);        
         BH55600M.ÅR0630 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0630);        
         BH55600M.ÅR0731 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0731);        
         BH55600M.ÅR0831 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0831);        
         BH55600M.ÅR0930 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,0930);        
         BH55600M.ÅR1031 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,1031);        
         BH55600M.ÅR1130 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,1130);        
         BH55600M.ÅR1231 = OPSÆT_YYYYMMDD(BH55600M.SLUTÅR,1231);        
                                                                        
       /* AFLEDTE DATOER FOR FORSKUDSÅR */                              
                                                                        
         BH55600M.FORSKÅR0101 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0101);  
         BH55600M.FORSKÅR0201 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0201);  
         BH55600M.FORSKÅR0301 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0301);  
         BH55600M.FORSKÅR0401 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0401);  
         BH55600M.FORSKÅR0501 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0501);  
         BH55600M.FORSKÅR0601 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0601);  
         BH55600M.FORSKÅR0701 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0701);  
         BH55600M.FORSKÅR0801 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0801);  
         BH55600M.FORSKÅR0901 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0901);  
         BH55600M.FORSKÅR1001 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,1001);  
         BH55600M.FORSKÅR1101 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,1101);  
         BH55600M.FORSKÅR1201 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,1201);  
                                                                        
         BH55600M.FORSKÅR0131 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0131);  
         BH55600M.FORSKÅR0229 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0229);  
         BH55600M.FORSKÅR0331 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0331);  
         BH55600M.FORSKÅR0430 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0430);  
         BH55600M.FORSKÅR0531 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0531);  
         BH55600M.FORSKÅR0630 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0630);  
         BH55600M.FORSKÅR0731 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0731);  
         BH55600M.FORSKÅR0831 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0831);  
         BH55600M.FORSKÅR0930 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,0930);  
         BH55600M.FORSKÅR1031 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,1031);  
         BH55600M.FORSKÅR1130 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,1130);  
         BH55600M.FORSKÅR1231 = OPSÆT_YYYYMMDD(BH55600M.FORSKÅR,1231);  
                                                                        
         BH55600M.HJ_DATO1   = BH55600M.ÅR0101 +                        
                               10000;                /* ÅR0101 + 1 ÅR */
         BH55600M.HJ_DATO2   = BH55600M.ÅR0101 +                        
                               20000;                /* ÅR0101 + 2 ÅR */
                                                                        
 OPSÆT_YYYYMMDD: PROC (YYYY,MMDD) RETURNS (FIXED(9));                   
                                                                        
   DCL YYYY     BIN FIXED (15);                                         
   DCL MMDD     BIN FIXED (15);                                         
   DCL YYYYMMDD FIXED (9);                                              
                                                                        
   /* Regl for skudår*/                                                 
   IF MMDD = 0229                                                       
   THEN                                                                 
     DO;                                                                
       IF MOD(YYYY,4) > 0                                               
       THEN                                                             
         MMDD = 0228;                                                   
     END;                                                               
                                                                        
   YYYYMMDD = 0;                                                        
   YYYYMMDD = (YYYY * 10000) + MMDD;                                    
                                                                        
   RETURN (YYYYMMDD);                                                   
                                                                        
 END OPSÆT_YYYYMMDD;                                                    
