 PROCESS OPT(TIME);                                                     
 BH93610: /* OPSÆT TIL BEREGN AF EVS 2014 TIL SLUT */   /*SLUT14*/      
 PROCEDURE (BH945_AR) REORDER;                                          
 /*********************************************************************/
 DCL COPYRIGHT CHAR (30) STATIC INIT ('COPYRIGHT KOMMUNEDATA I/S 2008');
 /********************************************************************/ 
 /*      PROGRAMMERET AF AAGE RASMUSSEN, PUS T&S DEC. 2000            */
 /*      ÅRSTILRETTET AF AAGE RASMUSSEN, LSU T&S DEC. 2001            */
 /*      ÅRSTILRETTET AF AAGE RASMUSSEN, LSU T&S NOV. 2002            */
 /*      ÅRSRULLET    AF AAGE RASMUSSEN, LSU T&S NOV. 2003            */
 /*      ÅRSRULLET    AF BO SCHMIDT    , LSU T&S NOV. 2004            */
 /* SLUT05    SUSANNE KROGH VILLUMSEN                  09-11-2005     */
 /*           TILRETTET SLUT 2005                                     */
 /* SLUT06    BO SCHMIDT                               04-10-2006     */
 /*           TILRETTET SLUT 2006                                     */
 /* SLUT07    INGRID FISCHER IFI                       14-11-2007     */
 /*           TILRETTET SLUT 2007                                     */
 /* SLUT08    BO SCHMIDT                               14-11-2008     */
 /*           TILRETTET SLUT 2008                                     */
 /* SLUT09    GERD HOLM-PEDERSEN                       08-10-2009     */
 /*           TILRETTET SLUT 2009                                     */
 /* SLUT10    GERD HOLM-PEDERSEN                       10-10-2010     */
 /*           TILRETTET SLUT 2010                                     */
 /* SLUT11    GERD HOLM-PEDERSEN                       20-10-2011     */
 /*           TILRETTET SLUT 2011                                     */
 /* SLUT12    LARS KAAE HARRITSHØJ                     SEP 2012       */
 /*           TILRETTET SLUT 2012                                     */
 /* SLUT13    JØRGEN SAUGMANN                          OKT 2013       */
 /*           TILRETTET SLUT 2013                                     */
 /* SLUT14    JØRGEN SAUGMANN                          OKT 2014       */
 /*           TILRETTET SLUT 2014                                     */
 /* OPRETTET SOM KOPI AF BH96010                       NOV 2014       */
 /* #2014 ER TILRETTET + PROGRAMNAVN                                  */
 /*           YDELIGERE TEST INDLAGT I OPSÆT_02ANV_ØVR MAR 2015 #SAU01*/
 /********************************************************************/ 
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /*********************************************************************/
 /*      DECLARE AF INPUT                                             */
 /*********************************************************************/
                                                                        
 DCL     BH945_AR        CHAR      (6000) VAR;                          
                                                                        
 DCL     1 BH945         BASED     (ADDR(BH945_AR)),                    
           3 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BH90000N;;                                          
                                                                        
 /*********************************************************************/
 /*      DECLARE AF DIVERSE PARAMETRE TIL BEREGNING AF EVS 2007       */
 /*********************************************************************/
                                                                        
 DCL     1 EVS_BER,                                                     
           %INCLUDE BQ14907N;;                             /*SLUT14*/   
                                                                        
 /*********************************************************************/
 /*      DECLARE AF DIVERSE                                           */
 /*********************************************************************/
                                                                        
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
 DCL     I               BIN FIXED (15);                                
 DCL     HJVÆRDI         FIXED     (11);                                
 DCL     HJVÆRDI1        FIXED     (15,3);                              
 DCL     HJVÆRDI2        FIXED     (11);                                
                                                                        
 DCL     HJ_ANVÆND_DATO  FIXED     (9);                                 
                                                                        
 DCL     GEM_CEJBEVS     CHAR      (1);                                 
 DCL     TFLAG           BIT(1)            INIT('0'B);                  
                                                                        
 DCL     1 BH65300M,                                                    
           %INCLUDE BH90800M;/*KOPI AF BH65300M #2014*/                 
                                                                        
 DCL     ADDR            BUILTIN;                                       
 DCL     SUBSTR          BUILTIN;                                       
 DCL     MULTIPLY        BUILTIN;                                       
 /*********************************************************************/
 /*      P R O C E S S                                                */
 /*********************************************************************/
                                                                        
         IF BH945.SORT_KOMNR < 999 &                                    
            BH945.TIL_EVS.CINVPNR = '0'                                 
         THEN                                                           
            DO;                                                         
                                                                        
               SELECT (BH945.EJENDOM.CSTOPÅR);                          
                 WHEN ('2012')                         /*SLUT14*/       
                    HJ_ANVÆND_DATO = 20121001;         /*SLUT14*/       
                 WHEN ('2011')                         /*SLUT13*/       
                    HJ_ANVÆND_DATO = 20111001;         /*SLUT13*/       
                 WHEN ('2010')                         /*SLUT12*/       
                    HJ_ANVÆND_DATO = 20101001;         /*SLUT12*/       
                 WHEN ('2009')                         /*SLUT11*/       
                    HJ_ANVÆND_DATO = 20091001;         /*SLUT11*/       
                 WHEN ('2008')                                          
                    HJ_ANVÆND_DATO = 20081001;                          
                 WHEN ('2007')                                          
                    HJ_ANVÆND_DATO = 20071001;                          
                 WHEN ('2006')                                          
                    HJ_ANVÆND_DATO = 20061001;                          
                 WHEN ('2005')                                          
                    HJ_ANVÆND_DATO = 20051001;                          
                 WHEN ('2004')                                          
                    HJ_ANVÆND_DATO = 20041001;                          
                 WHEN ('2003')                                          
                    HJ_ANVÆND_DATO = 20031001;                          
                 WHEN ('2002')                                          
                    HJ_ANVÆND_DATO = 20020101;                          
                 OTHERWISE                                              
                    HJ_ANVÆND_DATO = 20121001;         /*SLUT14*/       
               END;                                                     
                                                                        
                                                                        
               SELECT;                                                  
                                                                        
                 WHEN ((BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'N'))   
                    DO;                                                 
                       CALL OPSÆT_015ANV_NY;  /* NYE EJERE */           
                    END;                                                
                                                                        
                 WHEN ((BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'G'))   
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
                                                                        
                 WHEN (BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &        
                       BH945.VURD_01OM.CBENYT_01OM ^= '  ' &            
                       BH945.TIL_EVS.DATO0107 > HJ_ANVÆND_DATO)         
                    DO;                                                 
                       CALL OPSÆT_015ANV_NY;  /* NYE EJERE */           
                    END;                                                
                                                                        
                 WHEN ((BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ') &          
                        BH945.TIL_EVS.DATO0107 > 0  &                   
                        BH945.TIL_EVS.DATO0107 <= HJ_ANVÆND_DATO)       
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
                                                                        
                 WHEN (BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &        
                       BH945.VURD_01OM.CBENYT_01OM ^= '  ' &            
                       BH945.TIL_EVS.BFASTSTIGBGR_SW = 0)               
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
                                                                        
                 WHEN ( BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &       
                        BH945.VURD_01OM.CBENYT_01OM ^= '  ' &           
                        BH945.AKT_EJER.DOVTG_GL > HJ_ANVÆND_DATO)       
                    DO;                                                 
                       CALL OPSÆT_015ANV_NY;  /* NYE EJERE */           
                    END;                                                
                                                                        
                 OTHERWISE                                              
                    DO;                                                 
                       CALL OPSÆT_015ANV_ØVR;  /* ØVRIGE EJERE */       
                    END;                                                
                                                                        
               END; /* SELECT */                                        
                                                                        
                                                                        
               SELECT;                                                  
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'N'))   
                    DO;                                                 
                       CALL OPSÆT_02ANV_NY;  /* NYE EJERE */            
                    END;                                                
                                                                        
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
                       (BH945.EVS_SLUT_EJER.DCPRN > 0 &                 
                        BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &        
                        BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS < '9' &      
                        BH945.EVS_SLUT_EJER.SIDSTE.CBERGRGLOP = 'G'))   
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
                                                                        
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
                        BH945.TIL_EVS.DATO0107 > HJ_ANVÆND_DATO)        
                    DO;                                                 
                       CALL OPSÆT_02ANV_NY;  /* NYE EJERE */            
                    END;                                                
                                                                        
                 WHEN ((BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ') &          
                        BH945.TIL_EVS.DATO0107 > 0  &                   
                        BH945.TIL_EVS.DATO0107 <= HJ_ANVÆND_DATO)       
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
                                                                        
                 WHEN (BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &        
                       BH945.VURD_02OM.CBENYT_02OM ^= '  ' &            
                       BH945.TIL_EVS.BFASTSTIGBGR_SW = 0)               
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
                                                                        
                 WHEN ( BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &       
                        BH945.VURD_02OM.CBENYT_02OM ^= '  ' &           
                        BH945.AKT_EJER.DOVTG_GL > HJ_ANVÆND_DATO)       
                    DO;                                                 
                       CALL OPSÆT_02ANV_NY;  /* NYE EJERE */            
                    END;                                                
                                                                        
                 OTHERWISE                                              
                    DO;                                                 
                       CALL OPSÆT_02ANV_ØVR;  /* ØVRIGE EJERE */        
                    END;                                                
                                                                        
               END; /* SELECT */                                        
                                                                        
            END;                                                        
                                                                        
         IF BH945.SORT_KOMNR < 999 &                                    
            BH945.VURD_AKT.CBENYT_AKT ^= '  '                           
         THEN                                                           
            DO;                                                         
               BH945.EJENDOM.BEJDVÆR =                                  
               BH945.VURD_AKT.BEJDVÆR_AKT;                              
               BH945.EJENDOM.BEJDVÆR_SW =                               
               BH945.VURD_AKT.BEJDVÆR_AKT_SW;                           
               BH945.EJENDOM.BEJBOL1 =                                  
               BH945.VURD_AKT.BEJBOL1_AKT;                              
               BH945.EJENDOM.BEJBOL1_SW =                               
               BH945.VURD_AKT.BEJBOL1_AKT_SW;                           
               BH945.EJENDOM.CEJBOLTYP1 =                               
               BH945.VURD_AKT.CEJBOLTYP1_AKT;                           
               BH945.EJENDOM.BEJBOL2 =                                  
               BH945.VURD_AKT.BEJBOL2_AKT;                              
               BH945.EJENDOM.BEJBOL2_SW =                               
               BH945.VURD_AKT.BEJBOL2_AKT_SW;                           
               BH945.EJENDOM.CEJBOLTYP2 =                               
               BH945.VURD_AKT.CEJBOLTYP2_AKT;                           
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      OPSÆTNING AF BEREGNINGSGRUNDLAG FOR AKTUEL EJER              */
 /*********************************************************************/
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_AKT.BBERGRL_AKT_SW = 0 &                    
                 BH945.VURD_02ANV.BBERGRL_02ANV_SW = 0 &                
                 BH945.VURD_015ANV.BBERGRL_015ANV_SW = 0)               
             DO;                                                        
                                                                        
                SELECT;                                                 
                                                                        
                  WHEN ((BH945.VURD_AKT.BBERGRL_AKT <=                  
                         BH945.VURD_02ANV.BBERGRL_02ANV) &              
                        (BH945.VURD_AKT.BBERGRL_AKT <=                  
                         BH945.VURD_015ANV.BBERGRL_015ANV))             
                    DO;                                                 
                       BH945.EJERSKAB.BBERGRL =                         
                       BH945.VURD_AKT.BBERGRL_AKT;                      
                       BH945.EJERSKAB.BBERGRL_SW = 0;                   
                       BH945.EJERSKAB.BBER2FAM =                        
                       BH945.VURD_AKT.BBER2FAM_AKT;                     
                       BH945.EJERSKAB.BBER2FAM_SW =                     
                       BH945.VURD_AKT.BBER2FAM_AKT_SW;                  
                       BH945.EJERSKAB.BEJBOLANV =                       
                       BH945.VURD_AKT.BEJBOLANV_AKT;                    
                       BH945.EJERSKAB.BEJBOLANV_SW =                    
                       BH945.VURD_AKT.BEJBOLANV_AKT_SW;                 
                       BH945.EJERSKAB.CANVEBOL =                        
                       BH945.VURD_AKT.CANVEBOL_AKT;                     
                       BH945.EJERSKAB.CBERGROP = 'I';                   
                    END;                                                
                                                                        
                  WHEN ((BH945.VURD_02ANV.BBERGRL_02ANV <               
                         BH945.VURD_AKT.BBERGRL_AKT) &                  
                        (BH945.VURD_02ANV.BBERGRL_02ANV <=              
                         BH945.VURD_015ANV.BBERGRL_015ANV))             
                    DO;                                                 
                       BH945.EJERSKAB.BBERGRL =                         
                       BH945.VURD_02ANV.BBERGRL_02ANV;                  
                       BH945.EJERSKAB.BBERGRL_SW = 0;                   
                       BH945.EJERSKAB.BBER2FAM =                        
                       BH945.VURD_02ANV.BBER2FAM_02ANV;                 
                       BH945.EJERSKAB.BBER2FAM_SW =                     
                       BH945.VURD_02ANV.BBER2FAM_02ANV_SW;              
                       BH945.EJERSKAB.BEJBOLANV =                       
                       BH945.VURD_02ANV.BEJBOLANV_02ANV;                
                       BH945.EJERSKAB.BEJBOLANV_SW =                    
                       BH945.VURD_02ANV.BEJBOLANV_02ANV_SW;             
                       BH945.EJERSKAB.CANVEBOL =                        
                       BH945.VURD_02ANV.CANVEBOL_02ANV;                 
                       BH945.EJERSKAB.CBERGROP = 'N';                   
                    END;                                                
                                                                        
                  OTHERWISE                                             
                    DO;                                                 
                       BH945.EJERSKAB.BBERGRL =                         
                       BH945.VURD_015ANV.BBERGRL_015ANV;                
                       BH945.EJERSKAB.BBERGRL_SW = 0;                   
                       BH945.EJERSKAB.BBER2FAM =                        
                       BH945.VURD_015ANV.BBER2FAM_015ANV;               
                       BH945.EJERSKAB.BBER2FAM_SW =                     
                       BH945.VURD_015ANV.BBER2FAM_015ANV_SW;            
                       BH945.EJERSKAB.BEJBOLANV =                       
                       BH945.VURD_015ANV.BEJBOLANV_015ANV;              
                       BH945.EJERSKAB.BEJBOLANV_SW =                    
                       BH945.VURD_015ANV.BEJBOLANV_015ANV_SW;           
                       BH945.EJERSKAB.CANVEBOL =                        
                       BH945.VURD_015ANV.CANVEBOL_015ANV;               
                       BH945.EJERSKAB.CBERGROP = 'G';                   
                  END;                                                  
                END; /* SELECT */                                       
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END;  /* SELECT */                                             
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_015ANV.NY_GL = 'N' &                        
                 BH945.VURD_02ANV.NY_GL = 'N')                          
             DO;                                                        
               BH945.EJERSKAB.CBERGRGLOP = 'N';                         
             END;                                                       
                                                                        
           WHEN (BH945.VURD_015ANV.NY_GL = 'G' &                        
                 BH945.VURD_02ANV.NY_GL = 'G')                          
             DO;                                                        
               BH945.EJERSKAB.CBERGRGLOP = 'G';                         
             END;                                                       
                                                                        
           WHEN (BH945.VURD_015ANV.NY_GL = 'N' &                        
                 BH945.VURD_02ANV.NY_GL = ' ')                          
             DO;                                                        
               BH945.EJERSKAB.CBERGRGLOP = 'N';                         
             END;                                                       
                                                                        
           WHEN (BH945.VURD_015ANV.NY_GL = 'G' &                        
                 BH945.VURD_02ANV.NY_GL = ' ')                          
             DO;                                                        
               BH945.EJERSKAB.CBERGRGLOP = 'G';                         
             END;                                                       
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               BH945.EJERSKAB.CBERGRGLOP = ' ';                         
             END;                                                       
                                                                        
         END; /* SELECT */                                              
                                                                        
         GEM_CEJBEVS = BH945.TIL_EVS.CEJBEVS;  /* KS 18-05-04  2003 */  
                                                                        
         CALL OPSÆT_FEJLNR; /*SAMT CEJBEVS OG CBERGRL*/                 
                                                                        
         BH945.EJENDOM.EJD_FEJLNR = BH945.FEJLNR;                       
                                                                        
         CALL OPSÆT_PERSONLIGE_FEJLNR; /*SAMT CEJBEVS OG CBERGRL*/      
                                                                        
         IF GEM_CEJBEVS = '7' !                /* KS 18-05-04  2003 */  
            GEM_CEJBEVS = '8' !                                         
            GEM_CEJBEVS = '9'                                           
         THEN                                                           
            DO;                                                         
              BH945.TIL_EVS.CEJBEVS = GEM_CEJBEVS;                      
                                                                        
              IF BH945.MT.CCIVS ^= 'D'                                  
              THEN                                                      
               /* CEJBEVS 7,8 OG 9 SKAL BEVARES  U D E N  FEJLNR. */    
               BH945.FEJLNR = 0;                                        
            END;                                                        
                                                                        
         IF BH945.TIL_EVS.C5060 = '5060' &                              
         (((BH945.AKT_VURD.CBENYT = '03' !                              
            BH945.AKT_VURD.CBENYT = '04' !                              
            BH945.AKT_VURD.CBENYT = '23' !                              
            BH945.AKT_VURD.CBENYT = '24' !                              
            BH945.AKT_VURD.CBENYT = '31' !                              
            BH945.AKT_VURD.CBENYT = '33' !                              
            BH945.AKT_VURD.CBENYT = '43' !                              
            BH945.AKT_VURD.CBENYT = '44' !                              
            BH945.AKT_VURD.CBENYT = '49') &                             
            BH945.FEJLNR = 5001) !                                      
          ((BH945.AKT_VURD.CBENYT = '09' !                              
            BH945.AKT_VURD.CBENYT = '17' !                              
            BH945.AKT_VURD.CBENYT = '98') &                             
            BH945.AKT_VURD.CVURDOPR = '1' &                             
            BH945.FEJLNR = 5001) !                                      
           (BH945.AKT_VURD.CBENYT = '45' &                              
            BH945.FEJLNR = 5006) !                                      
          ((BH945.AKT_VURD.CBENYT = '06' !                              
            BH945.AKT_VURD.CBENYT = '07' !                              
            BH945.AKT_VURD.CBENYT = '13' !                              
            BH945.AKT_VURD.CBENYT = '34') &                             
            BH945.FEJLNR = 5008))                                       
         THEN                                                           
            BH945.FEJLNR = 5060; /* KRAVSPEC. 18-01-05 SLUT 2003 */     
                                                                        
         IF BH945.TIL_EVS.CEJBEVS = '7' !                               
            BH945.TIL_EVS.CEJBEVS = '8' !                               
            BH945.TIL_EVS.CEJBEVS = '9'                                 
         THEN;                                                          
         ELSE                                                           
            IF BH945.FEJLNR = 0              /* DENNE EJENDOM KAN */    
            THEN                             /* ÅBENBART BEREGNES */    
               BH945.TIL_EVS.CEJBEVS = '0';                             
            ELSE                                                        
              IF BH945.SORT_KOMNR < 999 &                               
                 BH945.CINVPNR = '0' &                                  
                 BH945.AKT_EJER.DCPRCIR > 0 &                           
                 BH945.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BH945.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &               
                 BH945.EVS_SLUT_EJER.SIDSTE.DAFSTAA = 0 &               
                 BH945.EVS_SLUT_EJER.SIDSTE.DFRAFLYT = 0 &              
                (BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !             
                 BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !             
                 BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !             
                 BH945.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6') &            
                 BH945.TIL_EVS.CÆGTOPR < '1'                            
              THEN                           /* KAN MÅSKE BEREGNES */   
                 DO;                                                    
                   IF BH945.FEJLNR = 5001 !                             
                      BH945.FEJLNR = 5002 !                             
                      BH945.FEJLNR = 5003 !                             
                      BH945.FEJLNR = 5004 !                             
                      BH945.FEJLNR = 5017 !                             
                      BH945.FEJLNR = 5020 !                             
                      BH945.FEJLNR = 5024 !                             
                      BH945.FEJLNR = 5025 !                             
                      BH945.FEJLNR = 5059 !                             
                      BH945.FEJLNR = 5060 !                             
                      BH945.FEJLNR = 5155 !                             
                      BH945.FEJLNR = 5180 !                             
                      BH945.FEJLNR = 5181 !                             
                      BH945.EJERSKAB.BBERGRL_SW = -1 !                  
                    ((BH945.EJENDOM.CEJDTYPE = '4' !                    
                      BH945.EJENDOM.CEJDTYPE = '5') &                   
                      BH945.EJERSKAB.BBER2FAM_SW = -1)                  
                   THEN;                                                
                   ELSE                                                 
                      DO;                                               
                         BH945.TIL_EVS.CDATAFRA = '1';                  
                         BH945.TIL_EVS.CEJBEVS = '0';                   
                         BH945.FEJLNR = 0;                              
                      END;                                              
                 END;                                                   
                                                                        
         IF BH945.TIL_EVS.C5060 = '5060' &                              
            BH945.MT.CCIVS  ^= 'D' &                                    
            BH945.AKT_EJER.DCPRCIR > 0 &                                
            BH945.EVS_SLUT_EJER.DCPRN > 0 &                             
            BH945.EVS_SLUT_ÆGTF.DCPRN = 0 &                             
            BH945.ESR.EJER.DCPRCIR = 0 &                                
            BH945.ESR.ÆGTF.DCPRCIR > 0 &                                
            BH945.ESR.ÆGTF.FEJER = 1 &                                  
            BH945.ESR.ÆGTF.DOVTG >= BH945.MT.DRGNÅRFRA &                
            BH945.EVS_SLUT_EJER.SIDSTE.GPCTEJER = 100 &                 
            BH945.ESR.ÆGTF.GANE = 10000                                 
         THEN                                                           
            DO;                                                         
               BH945.FEJLNR = 5060;              /* SLUT05 */           
               BH945.TIL_EVS.CEJBEVS = '1';                             
            END;                                                        
                                                                        
         IF BH945.SORT_KOMNR < 999 &                                    
            BH945.TIL_EVS.CEJBEVS = '0' &                               
            BH945.AKT_EJER.DCPRCIR > 0  &                               
            BH945.CINVPNR = '0'                                         
         THEN                                                           
            DO;                                                         
               CALL UDFØR_KONTROLLER(BH945.FEJLTAB);                    
                                                                        
               BH945.FEJLNR = BH945.FEJLTAB(1);                         
                                                                        
               IF BH945.FEJLNR > 0                                      
               THEN                                                     
                  BH945.TIL_EVS.CEJBEVS = '3';                          
               ELSE                                                     
                  DO;                                                   
                     EVS_BER = '';                                      
                     EVS_BER.TIL = BH945.TIL_EVS, BY NAME;              
                     EVS_BER.TIL.FELT760 = BH945.TIL_EVS.CFRED;         
                     EVS_BER.TIL.CEJDTYPE_AKT =                         
                     BH945.EJERSKAB.CEJDTYPE_AKT;                       
                     EVS_BER.TIL = BH945.EJERSKAB, BY NAME;             
                     IF BH945.TIL_EVS.CPTYPSLUT = '4'    /* #02  */     
                     THEN                                               
                        EVS_BER.TIL.CPTYPSLUT = '9';                    
                     CALL BEREGN_EVS_KMD_DEL(EVS_BER);                  
                     BH945.TIL_EVS = EVS_BER.FRA, BY NAME;              
                     BH945.FRA_EVS_BER = EVS_BER.FRA, BY NAME;          
                  END;                                                  
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2002 FOR 'NYE EJERE'                 */
 /*********************************************************************/
 OPSÆT_02ANV_NY:                                                        
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02OMNY);                      
                BH945.VURD_02ANV.NY_GL = 'N'; /* OMBEREGN NY EJER */    
             END;                                                       
                                                                        
           WHEN (BH945.VURD_02.CBENYT_02 ^= '  ')                       
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02);                          
                BH945.VURD_02ANV.NY_GL = ' '; /* ÅRSVURDERING */        
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_02ANV_NY;                                                    
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2002 FOR 'ØVRIGE EJERE'              */
 /*********************************************************************/
 OPSÆT_02ANV_ØVR:                                                       
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_02OM.CBENYT_02OM ^= '  ')                   
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02OM);                        
                                                                        
                IF BH945.VURD_02OMNY.CBENYT_02OMNY ^= '  ' &            
                   BH945.VURD_02OM.CBENYT_02OM ^= '  '                  
                THEN                                                    
                   BH945.VURD_02ANV.NY_GL = 'G';/*OMBEREGN ØVR EJERE*/  
                ELSE                                                    
                   BH945.VURD_02ANV.NY_GL = ' ';                        
             END;                                                       
                                                                        
           WHEN (BH945.VURD_02.CBENYT_02 ^= '  ')                       
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_02ANV,                        
                               BH945.VURD_02);                          
                BH945.VURD_02ANV.NY_GL = ' '; /* ÅRSVURDERING */        
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_02ANV_ØVR;                                                   
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2001+5% FOR 'NYE EJERE'              */
 /*********************************************************************/
 OPSÆT_015ANV_NY:                                                       
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_01OMNY);                      
                BH945.VURD_015ANV.NY_GL = 'N'; /* OMBEREGN NY EJER */   
             END;                                                       
                                                                        
           WHEN (BH945.VURD_015PCT.CBENYT_015PCT ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_015PCT);                      
                BH945.VURD_015ANV.NY_GL = ' '; /* ÅRSVURDERING */       
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_015ANV_NY;                                                   
                                                                        
 /*********************************************************************/
 /*      VÆLG BEREGNINGSGRUNDLAG 2001+5% FOR 'ØVRIGE EJERE'           */
 /*********************************************************************/
 OPSÆT_015ANV_ØVR:                                                      
 PROC;                                                                  
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BH945.VURD_01OM.CBENYT_01OM ^= '  ')                   
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_01OM);                        
                IF BH945.VURD_01OMNY.CBENYT_01OMNY ^= '  ' &            
                   BH945.VURD_01OM.CBENYT_01OM ^= '  '                  
                THEN                                                    
                   BH945.VURD_015ANV.NY_GL = 'G';/*OMBEREGN ØVR EJERE*/ 
                ELSE                                                    
                   BH945.VURD_015ANV.NY_GL = ' ';                       
             END;                                                       
                                                                        
           WHEN (BH945.VURD_015PCT.CBENYT_015PCT ^= '  ')               
             DO;                                                        
                CALL FLYT_VURD(BH945.VURD_015ANV,                       
                               BH945.VURD_015PCT);                      
                BH945.VURD_015ANV.NY_GL = ' '; /* ÅRSVURDERING */       
             END;                                                       
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
 END OPSÆT_015ANV_ØVR;                                                  
                                                                        
 /*********************************************************************/
 /* FLYT VALGTE VURDERING TIL ANVENDT VURDERING                       */
 /*********************************************************************/
 FLYT_VURD:                                                             
 PROC(TIL,FRA);                                                         
                                                                        
 DCL     1 FRA,                                                         
  3 CBENYT           CHAR  (2),    /* BENYTTELSESKODE                 */
  3 FLEJL            FIXED (5),    /* ANTAL LEJLIGHEDER               */
  3 BEJDVÆR          FIXED (11),   /* EJENDOMSVÆRDI                   */
  3 BEJDVÆR_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJERL           CHAR  (1),    /* KODE UDLEJET EJERLEJLIGHED      */
  3 BEJBOL1          FIXED (11),   /* EJERBOLIG 1-VÆRDI               */
  3 BEJBOL1_SW      BIN FIXED (15) UNAL,      /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP1       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOL2          FIXED (11),   /* EJERBOLIG 2-VÆRDI               */
  3 BEJBOL2_SW      BIN FIXED (15) UNAL,      /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP2       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOLANV        FIXED (11),   /* EJERBOLIG ?-VÆRDI ANVENDT       */
  3 BEJBOLANV_SW      BIN FIXED (15) UNAL,    /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CANVEBOL         CHAR  (1),    /* ANVENDT EJERBOLIG               */
  3 BOPÆLSKODE       CHAR  (1),    /* BOPÆLSKODE                      */
  3 CEJDTYPE         CHAR  (1),    /* KODE FOR EJENDOMSTYPE           */
  3 CBERGRL          CHAR  (1),    /* KODE FOR BEREGNINGSGRUNDLAG     */
  3 BBERGRL          FIXED (11),   /* BEREGN.GRUNDLAG                 */
  3 BBERGRL_SW      BIN FIXED(15)UNAL,        /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 BBER2FAM         FIXED (11),   /* EJD.VÆRDI 2 FAM.                */
  3 BBER2FAM_SW     BIN FIXED(15)UNAL;        /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                                                        
 DCL     1 TIL,                                                         
  3 NY_GL            CHAR  (1),    /* ER EVT. OMBEREGN FOR NY ELL. ØVR*/
  3 CBENYT           CHAR  (2),    /* BENYTTELSESKODE                 */
  3 FLEJL            FIXED (5),    /* ANTAL LEJLIGHEDER               */
  3 BEJDVÆR          FIXED (11),   /* EJENDOMSVÆRDI                   */
  3 BEJDVÆR_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJERL           CHAR  (1),    /* KODE UDLEJET EJERLEJLIGHED      */
  3 BEJBOL1          FIXED (11),   /* EJERBOLIG 1-VÆRDI               */
  3 BEJBOL1_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP1       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOL2          FIXED (11),   /* EJERBOLIG 2-VÆRDI               */
  3 BEJBOL2_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CEJBOLTYP2       CHAR  (1),    /* EJERBOLIGTYP(FELT 450)          */
  3 BEJBOLANV        FIXED (11),   /* EJERBOLIG ?-VÆRDI ANVENDT       */
  3 BEJBOLANV_SW BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 CANVEBOL         CHAR  (1),    /* ANVENDT EJERBOLIG               */
  3 BOPÆLSKODE       CHAR  (1),    /* BOPÆLSKODE                      */
  3 CEJDTYPE         CHAR  (1),    /* KODE FOR EJENDOMSTYPE           */
  3 CBERGRL          CHAR  (1),    /* KODE FOR BEREGNINGSGRUNDLAG     */
  3 BBERGRL          FIXED (11),   /* BEREGN.GRUNDLAG                 */
  3 BBERGRL_SW   BIN FIXED (15) UNAL,         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
  3 BBER2FAM         FIXED (11),   /* EJD.VÆRDI 2 FAM.                */
  3 BBER2FAM_SW  BIN FIXED (15) UNAL;         /* 0=BETYD. BELØB       */
                                              /* (OGSÅ HVIS=0)        */
                                              /* -1=IKKE BETYD.(=NULL)*/
                                                                        
         TIL = FRA, BY NAME;                                            
         TIL.NY_GL = ' ';                                               
                                                                        
 END FLYT_VURD;                                                         
                                                                        
         %INCLUDE BH96071M; /* OPSÆT GENERELLE FEJLNR M.V. */           
         %INCLUDE BH96072M; /* OPSÆT PERSONLIGE FEJLNR M.V. */          
         %INCLUDE BH96005M; /* UDFØR DIVERSE KONTROLLER */              
         %INCLUDE BQ14907M; /* BEREGN EVS SLUT KMDS DEL */ /*SLUT14*/   
                                                                        
 END BH93610;                                                           
