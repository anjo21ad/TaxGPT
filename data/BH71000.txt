 BH71000: PROC OPTIONS (MAIN) REORDER;                                  
 /*******************************************************************   
 *                                                                  *   
 *    GENERERER 3 MAKROER TIL AT FLYTTE DATA FRA TABEL TIL STRUKTUR *   
 *                                                                  *   
 *    PROGRAMØR : HANS ERIK KJELDSEN T&S LSU             2005       *   
 *    HUSK AT RETTE WHERE  T1.TIL_ÅR  > 2008 (GAMMELT SLUT ÅR)      *   
 *                                                                  *   
 * *SLUT007*    INGRID FISCHER        IFI,    PKF ÅRHUS    14.11.2007. *
 *              PROGRAMMET ER TILRETTET TIL SLUT 2007                  *
 * *#SLUT09*    GERD HOLM-PEDERSEN    GEH/PKF              14.10.2009*  
 *              PROGRAMMET ER TILRETTET TIL SLUT 2009                *  
 *******************************************************************/   
 /*********************************************************************/
 /*   DECLARE AF FILER                                                */
 /*********************************************************************/
 DCL     UDFIL1          FILE RECORD OUTPUT;                            
 DCL     UDFIL2          FILE RECORD OUTPUT;                            
 DCL     UDFIL3          FILE RECORD OUTPUT;                            
 DCL     UDFIL4          FILE RECORD OUTPUT;                            
 /*********************************************************************/
 /*   DECLARE AF FELTER                                               */
 /*********************************************************************/
 DCL     (ADDR, INDEX, LOW, SUBSTR, CEIL, MIN, VERIFY, HIGH ) BUILTIN;  
 DCL     (NULL) BUILTIN;                                                
 DCL     UD              CHAR      (80) INIT (' ');                     
 DCL     I1              bin   FIXED     (15) INIT (0);                 
 DCL     I2              bin   FIXED     (15) INIT (0);                 
 DCL     I3              bin   FIXED     (15) INIT (0);                 
 DCL     I4              bin   FIXED     (15) INIT (0);                 
 DCL     J               bin   FIXED     (15) INIT (0);                 
 DCL     K               bin   FIXED     (15) INIT (0);                 
 DCL     DAP             CHAR      (01) INIT ('''');                    
 DCL     FEJLTEKST      CHAR (20)        INIT(' ');                     
 DCL     FELTNAVN       CHAR (16)        INIT(' ');                     
 DCL     LÆNGDE_PIC    PIC '999999999999';                              
 DCL     LÆNGDE_CHAR   CHAR (12) DEF LÆNGDE_PIC;                        
 DCL     LÆNGDE_C2     CHAR (2);                                        
 DCL     DECIMAL_PIC   PIC '999999999999';                              
 DCL     DECIMAL_CHAR  CHAR (12) DEF DECIMAL_PIC;                       
 DCL     DECIMAL_C1    CHAR (1);                                        
 DCL     FELTKODE_PIC   PIC 'ZZZZZZZZZZZ9';                             
 DCL     FELTKODE_CHAR  CHAR (12) DEF FELTKODE_PIC;                     
 DCL     FELTKODE_C4    CHAR (4);                                       
 DCL     ABENDMEDD      CHAR (56)        INIT(' ');                     
 DCL     OPSAML1(2000)     CHAR      (80);                              
 DCL     OPSAML2(2000)     CHAR      (80);                              
 DCL     OPSAML3(2000)     CHAR      (80);                              
 DCL     OPSAML4(2000)     CHAR      (80);                              
 DCL     DIGIT          CHAR (10) INIT('0123456789');                   
 DCL     SQLKODE         PIC '9999';                                    
         OPSAML1(*) = ' ';                                              
         OPSAML2(*) = ' ';                                              
         OPSAML3(*) = ' ';                                              
         OPSAML4(*) = ' ';                                              
 DCL     ZS67000  ENTRY;                                                
                                                                        
 DCL     1 EVS_FELTKODE,                /* EVS FELTKODETABEL          */
         %INCLUDE BQ50000N;                                             
 /**********************************************************************
 * DECLARE AF DB2 TABELLER                                             *
 **********************************************************************/
                                                                        
         EXEC SQL INCLUDE SQLCA;        /* SQL KOMMUNIKATIONSAREAL    */
         EXEC SQL INCLUDE BQ50000T;     /* EVS EJENDOMSTABEL          */
 /*********************************************************************/
 /*                                                                   */
 /*   INITIERINGER                                                    */
 /*                                                                   */
 /*********************************************************************/
         CALL DAN_TOP1;                                                 
         CALL DAN_TOP2;                                                 
         CALL DAN_TOP3;                                                 
         CALL DAN_TOP4;                                                 
 /*********************************************************************/
 /*                                                                   */
 /*   PROGRAM                                                         */
 /*                                                                   */
 /*********************************************************************/
         CALL DECLARE_FELTKODE_CUR;                                     
                                                                        
         EXEC SQL OPEN FELTKODE_CUR;                                    
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'SQLFEJL: OPEN FELTKODE_CUR';                 
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
         CALL FETCH_FELTKODE_CUR;                                       
                                                                        
                                                                        
            DO WHILE(SQLCODE = 0);                                      
               IF EVS_FELTKODE.FELTKODETYPE = 2                         
               THEN                                                     
                  DO;                                                   
                     CALL DANLINIE1;                                    
                  END;                                                  
               IF EVS_FELTKODE.FELTKODETYPE = 3                         
               THEN                                                     
                  DO;                                                   
                     CALL DANLINIE2;                                    
                  END;                                                  
               IF EVS_FELTKODE.FELTKODETYPE = 4                         
               THEN                                                     
                  DO;                                                   
                     CALL DANLINIE3;                                    
                  END;                                                  
               CALL FETCH_FELTKODE_CUR;                                 
            END;                                                        
         CALL DAN_BUND1;                                                
         CALL DAN_BUND2;                                                
         CALL DAN_BUND3;                                                
         CALL DAN_BUND4;                                                
         CALL SKRIV_FIL1;                                               
         CALL SKRIV_FIL2;                                               
         CALL SKRIV_FIL3;                                               
         CALL SKRIV_FIL4;                                               
 /*********************************************************************/
 /*                                                                   */
 /*   PROCEDURER                                                      */
 /*                                                                   */
 /*********************************************************************/
 DAN_TOP1: PROC;                                                        
         OPSAML1(1) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML1(2) = ' /* PROCEDURE DANNET AF BH71000       '          
                   !! '                                */';             
         OPSAML1(3) = ' /* FLYTNING AF DATA FRA STRUKTUR TIL '          
                   !! 'EJENDOMSTABEL                   */';             
         OPSAML1(4) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML1(5) = ' FLYT_EJD_FEL_TIL: PROC;              '          
                   !! '                                  ';             
         OPSAML1(6) = '                                      '          
                   !! '                                  ';             
         I1 = 6;                                                        
 END DAN_TOP1;                                                          
 DAN_TOP2: PROC;                                                        
         OPSAML2(1) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML2(2) = ' /* PROCEDURE DANNET AF BH71000       '          
                   !! '                                */';             
         OPSAML2(3) = ' /* FLYTNING AF DATA FRA STRUKTUR TIL '          
                   !! 'EJERSKABSTABEL                  */';             
         OPSAML2(4) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML2(5) = ' FLYT_ESK_FEL_TIL: PROC;              '          
                   !! '                                  ';             
         OPSAML2(6) = '                                      '          
                   !! '                                  ';             
         I2 = 6;                                                        
 END DAN_TOP2;                                                          
 DAN_TOP3: PROC;                                                        
         OPSAML3(1) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML3(2) = ' /* PROCEDURE DANNET AF BH71000       '          
                   !! '                                */';             
         OPSAML3(3) = ' /* FLYTNING AF DATA FRA STRUKTUR TIL '          
                   !! 'RESULTATTABEL                   */';             
         OPSAML3(4) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML3(5) = ' FLYT_RES_FEL_TIL: PROC;              '          
                   !! '                                  ';             
         OPSAML3(6) = '                                      '          
                   !! '                                  ';             
         I3 = 6;                                                        
 END DAN_TOP3;                                                          
 DAN_TOP4: PROC;                                                        
         OPSAML4(1) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML4(2) = ' /* PROCEDURE DANNET AF BH71000       '          
                   !! '                                */';             
         OPSAML4(3) = ' /* SLETNING AF DATA I EJENDOMSTABEL U'          
                   !! 'DFRA DATA I STRUKTUR            */';             
         OPSAML4(4) = ' /************************************'          
                   !! '*********************************/';             
         OPSAML4(5) = ' SLET_EJD_FEL: PROC;              '              
                   !! '                                  ';             
         OPSAML4(6) = '                                      '          
                   !! '                                  ';             
         I4 = 6;                                                        
 END DAN_TOP4;                                                          
 DANLINIE1: PROC;                                                       
         I1 = I1 + 1;                                                   
         FELTKODE_PIC = EVS_FELTKODE.FELTKODE;                          
         FELTKODE_C4 = SUBSTR(FELTKODE_CHAR,9,4);                       
         K = INDEX(EVS_FELTKODE.DATANAVN,' ');                          
         IF EVS_FELTKODE.FORMAT = 'CHAR'                                
         THEN                                                           
            DO;                                                         
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '       IF EJENDOMTAB.'                    
                           !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)       
                           !! ' > ' !!DAP !!' ' !!DAP;                  
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '       THEN          ';                   
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '          DO;        ';                   
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '             EVS_EJD_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '             EVS_EJD_FELT.INDHOLD_C = '   
                          !! 'EJENDOMTAB.'                              
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!';'; 
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '             EVS_EJD_FELT.INDHOLD_D = '   
                          !! '0;';                                      
               /*SLET_EJD_FELT*/                                        
               I4 = I4 + 1;                                             
               OPSAML4(I4) = '       IF EJENDOMTAB.'                    
                           !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)       
                           !! ' > ' !!DAP !!' ' !!DAP;                  
               I4 = I4 + 1;                                             
               OPSAML4(I4) = '       THEN          ';                   
               I4 = I4 + 1;                                             
               OPSAML4(I4) = '          DO;        ';                   
               I4 = I4 + 1;                                             
               OPSAML4(I4) = '             EVS_EJD_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
            END;                                                        
         ELSE                                                           
            DO;                                                         
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '       IF EJENDOMTAB.'                    
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)        
                          !! ' > 0';                                    
               IF EVS_FELTKODE.INDK = 1                                 
               THEN                                                     
                  DO;                                                   
                     I1 = I1 + 1;                                       
                        OPSAML1(I1) = '        ! INDK_EJEND.'           
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)        
                          !! '_I = 0';                                  
                  END;                                                  
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '       THEN          ';                   
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '          DO;        ';                   
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '             EVS_EJD_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '             EVS_EJD_FELT.INDHOLD_D = '   
                          !! 'EJENDOMTAB.'                              
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!';'; 
               I1 = I1 + 1;                                             
               OPSAML1(I1) = '             EVS_EJD_FELT.INDHOLD_C = '   
                          !! DAP !!' ' !!DAP !! ';';                    
               /*SLET_EJD_FELT*/                                        
               IF EVS_FELTKODE.INDK = 1                                 
               THEN                                                     
                  DO;                                                   
                     I4 = I4 + 1;                                       
                        OPSAML4(I4) = '       IF INDK_EJEND.'           
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)        
                          !! '_I = -1';                                 
                  END;                                                  
               ELSE                                                     
                  DO;                                                   
                     I4 = I4 + 1;                                       
                     OPSAML4(I4) = '       IF EJENDOMTAB.'              
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)        
                          !! ' = 0';                                    
                  END;                                                  
               I4 = I4 + 1;                                             
               OPSAML4(I4) = '       THEN          ';                   
               I4 = I4 + 1;                                             
               OPSAML4(I4) = '          DO;        ';                   
               I4 = I4 + 1;                                             
               OPSAML4(I4) = '             EVS_EJD_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
            END;                                                        
         I1 = I1 + 1;                                                   
         OPSAML1(I1) = '             CALL SKRIV_EVS_EJD_FELT;';         
         I1 = I1 + 1;                                                   
         OPSAML1(I1) = '          END;       ';                         
         /*SLET_EJD_FELT*/                                              
         I4 = I4 + 1;                                                   
         OPSAML4(I4) = '             CALL SLET_EVS_EJD_FELT;';          
         I4 = I4 + 1;                                                   
         OPSAML4(I4) = '          END;       ';                         
 END DANLINIE1;                                                         
 DANLINIE2: PROC;                                                       
         I2 = I2 + 1;                                                   
         FELTKODE_PIC = EVS_FELTKODE.FELTKODE;                          
         FELTKODE_C4 = SUBSTR(FELTKODE_CHAR,9,4);                       
         K = INDEX(EVS_FELTKODE.DATANAVN,' ');                          
         IF EVS_FELTKODE.FORMAT = 'CHAR'                                
         THEN                                                           
            DO;                                                         
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '       IF PERSONTAB.'                     
                           !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)       
                           !! ' > ' !!DAP !!' ' !!DAP;                  
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '       THEN          ';                   
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '          DO;        ';                   
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '             EVS_ESK_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '             EVS_ESK_FELT.INDHOLD_C = '   
                          !! 'PERSONTAB.'                               
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!';'; 
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '             EVS_ESK_FELT.INDHOLD_D = '   
                          !! '0;';                                      
            END;                                                        
         ELSE                                                           
            DO;                                                         
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '       IF PERSONTAB.'                     
                           !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)       
                           !! ' > 0';                                   
               IF EVS_FELTKODE.INDK = 1                                 
               THEN                                                     
                  DO;                                                   
                     I2 = I2 + 1;                                       
                     OPSAML2(I2) = '        ! INDK_EJERSK.'             
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!'_I' 
                          !! ' = 0';                                    
                  END;                                                  
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '       THEN          ';                   
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '          DO;        ';                   
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '             EVS_ESK_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '             EVS_ESK_FELT.INDHOLD_D = '   
                          !! 'PERSONTAB.'                               
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!';'; 
               I2 = I2 + 1;                                             
               OPSAML2(I2) = '             EVS_ESK_FELT.INDHOLD_C = '   
                          !! DAP !!' ' !!DAP !! ';';                    
            END;                                                        
         I2 = I2 + 1;                                                   
         OPSAML2(I2) = '             CALL SKRIV_EVS_ESK_FELT;';         
         I2 = I2 + 1;                                                   
         OPSAML2(I2) = '          END;       ';                         
 END DANLINIE2;                                                         
 DANLINIE3: PROC;                                                       
         I3 = I3 + 1;                                                   
         FELTKODE_PIC = EVS_FELTKODE.FELTKODE;                          
         FELTKODE_C4 = SUBSTR(FELTKODE_CHAR,9,4);                       
         K = INDEX(EVS_FELTKODE.DATANAVN,' ');                          
         IF EVS_FELTKODE.FORMAT = 'CHAR'                                
         THEN                                                           
            DO;                                                         
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '       IF RESULTATTAB.'                   
                           !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)       
                           !! ' > ' !!DAP !!' ' !!DAP;                  
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '       THEN          ';                   
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '          DO;        ';                   
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '             EVS_RES_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '             EVS_RES_FELT.INDHOLD_C = '   
                          !! 'RESULTATTAB.'                             
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!';'; 
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '             EVS_RES_FELT.INDHOLD_D = '   
                          !! '0;';                                      
            END;                                                        
         ELSE                                                           
            DO;                                                         
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '       IF RESULTATTAB.'                   
                           !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1)       
                           !! ' > 0';                                   
               IF EVS_FELTKODE.INDK = 1                                 
               THEN                                                     
                  DO;                                                   
                     I3 = I3 + 1;                                       
                     OPSAML3(I3) = '        ! INDK_EVS_RES.'            
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!'_I' 
                          !! ' = 0';                                    
                  END;                                                  
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '       THEN          ';                   
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '          DO;        ';                   
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '             EVS_RES_FELT.FELTKODE  = '   
                           !! FELTKODE_C4 !!';';                        
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '             EVS_RES_FELT.INDHOLD_D = '   
                          !! 'RESULTATTAB.'                             
                          !! SUBSTR(EVS_FELTKODE.DATANAVN,1,K-1) !!';'; 
               I3 = I3 + 1;                                             
               OPSAML3(I3) = '             EVS_RES_FELT.INDHOLD_C = '   
                          !! DAP !!' ' !!DAP !! ';';                    
            END;                                                        
         I3 = I3 + 1;                                                   
         OPSAML3(I3) = '             CALL SKRIV_EVS_RES_FELT;';         
         I3 = I3 + 1;                                                   
         OPSAML3(I3) = '          END;       ';                         
 END DANLINIE3;                                                         
 DAN_BUND1: PROC;                                                       
         I1 = I1 + 1;                                                   
         OPSAML1(I1) = '                                      '         
                    !! '                                  ';            
         I1 = I1 + 1;                                                   
         OPSAML1(I1) = ' END FLYT_EJD_FEL_TIL;              '           
                    !! '                                  ';            
 END DAN_BUND1;                                                         
 DAN_BUND2: PROC;                                                       
         I2 = I2 + 1;                                                   
         OPSAML2(I2) = '                                      '         
                    !! '                                  ';            
         I2 = I2 + 1;                                                   
         OPSAML2(I2) = ' END FLYT_ESK_FEL_TIL;              '           
                    !! '                                  ';            
 END DAN_BUND2;                                                         
 DAN_BUND3: PROC;                                                       
         I3 = I3 + 1;                                                   
         OPSAML3(I3) = '                                      '         
                    !! '                                  ';            
         I3 = I3 + 1;                                                   
         OPSAML3(I3) = ' END FLYT_RES_FEL_TIL;                  '       
                    !! '                                  ';            
 END DAN_BUND3;                                                         
 DAN_BUND4: PROC;                                                       
         I4 = I4 + 1;                                                   
         OPSAML4(I4) = '                                      '         
                    !! '                                  ';            
         I4 = I4 + 1;                                                   
         OPSAML4(I4) = ' END SLET_EJD_FEL;                    '         
                    !! '                                  ';            
 END DAN_BUND4;                                                         
 SKRIV_FIL1: PROC;                                                      
         OPEN FILE  (UDFIL1)  TITLE ('BH71001O');                       
         PUT SKIP LIST('I1',I1);                                        
         DO J = 1 TO I1;                                                
            UD = OPSAML1(J);                                            
            WRITE FILE(UDFIL1) FROM (UD);                               
         END;                                                           
         CLOSE FILE (UDFIL1);                                           
 END SKRIV_FIL1;                                                        
 SKRIV_FIL2: PROC;                                                      
         OPEN FILE  (UDFIL2)  TITLE ('BH71002O');                       
         PUT SKIP LIST('I2',I2);                                        
         DO J = 1 TO I2;                                                
            UD = OPSAML2(J);                                            
            WRITE FILE(UDFIL2) FROM (UD);                               
         END;                                                           
         CLOSE FILE (UDFIL2);                                           
 END SKRIV_FIL2;                                                        
 SKRIV_FIL3: PROC;                                                      
         OPEN FILE  (UDFIL3)  TITLE ('BH71003O');                       
         PUT SKIP LIST('I3',I3);                                        
         DO J = 1 TO I3;                                                
            UD = OPSAML3(J);                                            
            WRITE FILE(UDFIL3) FROM (UD);                               
         END;                                                           
         CLOSE FILE (UDFIL3);                                           
 END SKRIV_FIL3;                                                        
 SKRIV_FIL4: PROC;                                                      
         OPEN FILE  (UDFIL4)  TITLE ('BH71004O');                       
         PUT SKIP LIST('I4',I4);                                        
         DO J = 1 TO I4;                                                
            UD = OPSAML4(J);                                            
            WRITE FILE(UDFIL4) FROM (UD);                               
         END;                                                           
         CLOSE FILE (UDFIL4);                                           
 END SKRIV_FIL4;                                                        
 /*********************************************************************/
 /* DECLARE CURSOR TIL EVS OVERSIGT FOR EN PERSON                     */
 /* FUNKTION 8                                                        */
 /*********************************************************************/
 DECLARE_FELTKODE_CUR: PROC;                                            
                                                                        
         EXEC SQL                                                       
                                                                        
              DECLARE FELTKODE_CUR CURSOR FOR                           
                                                                        
              SELECT T1.FELTKODE,                                       
                     T1.FELTKODETYPE,                                   
                     T1.DATANAVN,                                       
                     T1.FORMAT,                                         
                     T1.INDK,                                           
                     T1.LÆNGDE,                                         
                     T1.DECIMAL,                                        
                     T1.FRA_ÅR,                                         
                     T1.TIL_ÅR,                                         
                     T1.CSCNAVN,                                        
                     T1.SLUTNR                                          
                                                                        
              FROM   BQ50000T T1                                        
                                                                        
              WHERE  T1.TIL_ÅR  > 2008           /*#SLUT09*/            
                                                                        
              ORDER BY T1.FELTKODE                                      
              FOR FETCH ONLY                                            
         ;                                                              
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'SQLFEJL: DECLARE FELTKODE_CUR';              
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END DECLARE_FELTKODE_CUR;                                              
 /*********************************************************************/
 /* FETCH CURSOR TIL EVS OVERSIGT FOR EN PERSON                       */
 /* FUNKTION 8                                                        */
 /*********************************************************************/
 FETCH_FELTKODE_CUR: PROC;                                              
                                                                        
         EVS_FELTKODE = '';                                             
                                                                        
         EXEC SQL                                                       
                                                                        
              FETCH FELTKODE_CUR                                        
                                                                        
              INTO  :EVS_FELTKODE.FELTKODE     ,                        
                    :EVS_FELTKODE.FELTKODETYPE ,                        
                    :EVS_FELTKODE.DATANAVN     ,                        
                    :EVS_FELTKODE.FORMAT       ,                        
                    :EVS_FELTKODE.INDK         ,                        
                    :EVS_FELTKODE.LÆNGDE       ,                        
                    :EVS_FELTKODE.DECIMAL      ,                        
                    :EVS_FELTKODE.FRA_ÅR       ,                        
                    :EVS_FELTKODE.TIL_ÅR       ,                        
                    :EVS_FELTKODE.CSCNAVN      ,                        
                    :EVS_FELTKODE.SLUTNR       ;                        
                                                                        
         SQLKODE = SQLCA.SQLCODE;                                       
                                                                        
         SELECT (SQLCA.SQLCODE);                                        
                                                                        
           WHEN (0);                                                    
                                                                        
           WHEN (100);                                                  
                                                                        
           OTHERWISE                                                    
             DO;                                                        
               FEJLTEKST = 'SQLFEJL: FETCH FELTKODE_CUR';               
               CALL SQL_FEJL;                                           
             END;                                                       
                                                                        
         END; /* END-SELECT */                                          
                                                                        
 END FETCH_FELTKODE_CUR;                                                
 /*********************************************************************/
 /* CLOSE CURSOR TIL LÆS AF PERSONTABEL BN00600T               RUTINE */
 /*********************************************************************/
 CLOSE_FELTKODE_CUR: PROC;                                              
                                                                        
         EXEC SQL CLOSE FELTKODE_CUR;                                   
                                                                        
         IF SQLCA.SQLCODE ^= 0                                          
         THEN                                                           
            DO;                                                         
              FEJLTEKST = 'CLOSE FELTKODE_CUR';                         
              CALL SQL_FEJL;                                            
            END;                                                        
                                                                        
 END CLOSE_FELTKODE_CUR;                                                
 /*********************************************************************/
 /* HER UDSKRIVES SQL FEJL                                     RUTINE */
 /*********************************************************************/
 SQL_FEJL: PROC;                                                        
         SQLKODE = SQLCA.SQLCODE;                                       
         CALL ZS67000(SQLCA);                                           
                                                                        
         ABENDMEDD = 'BH71000 ** 250 ' !! FEJLTEKST !! SQLKODE;         
                                                                        
         PUT SKIP LIST(5, ABENDMEDD, 2);                                
                                                                        
 END SQL_FEJL;                                                          
 END BH71000;                                                           
