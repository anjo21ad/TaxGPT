 BE55650:                                                               
       PROC (PARMPTR) REORDER;                                          
                                                                        
 DCL   COPYRIGHT  CHAR   (30) STATIC                                    
                  INIT ('Copyright KMD A/S 2021');                      
                                                                        
 /*-------------------------------------------------------------------- 
  Henter info fra åbne række på Afvikling                               
                                                                        
  Formål:     Henter den åbne række på Afvikling (BE72100T) og          
              returnerer værdierne.                                     
                                                                        
  Input:      -                                                         
                                                                        
  Output:     Værdier fra den åbne række på Afvikling (BE72100T)        
                                                                        
  Kald:       ZS67000 - DB2 logning                                     
                                                                        
  Programmør: Steen Pedersen / SEP - februar 2021                       
                                                                        
 ---------------------------------------------------------------------- 
  Rettelseslog:                                                         
  Forskud 2025 rullet kopi af BE55350                    JJJ 18.06.2024 
 --------------------------------------------------------------------*/ 
                                                                        
 /*-------------------------------------------------------------------- 
       Standard include                                                 
 --------------------------------------------------------------------*/ 
       %INCLUDE ZM2ENVB;                                                
       %INCLUDE ZM2BATA;              // Standard-rutiner               
       %INCLUDE ZM2DCLA;                                                
                                                                        
       ZM2APPL    = 'BEVS';                                             
       ZM2PROGRAM = 'BE55650';                                          
                                                                        
 /*-------------------------------------------------------------------- 
       Declare af kommunikationsareal                                   
 --------------------------------------------------------------------*/ 
 DCL   PARMPTR              PTR;                                        
                                                                        
 DCL   1 PARM BASED (PARMPTR),                                          
         %INCLUDE BE55650N;                                             
 /*-------------------------------------------------------------------- 
       DB2                                                              
 --------------------------------------------------------------------*/ 
       EXEC SQL INCLUDE SQLCA;        // SQL Kommunikationsareal        
       EXEC SQL INCLUDE BE72100T;     // Afviklingstabel                
                                                                        
 /*-------------------------------------------------------------------  
       ENTRY definitioner                                               
 -------------------------------------------------------------------*/  
 DCL   ZS67000       ENTRY;           // DB2 logning                    
                                                                        
 /*-------------------------------------------------------------------- 
       Declare af variable                                              
 --------------------------------------------------------------------*/ 
                                                                        
 /*-------------------------------------------------------------------- 
       Hovedprogram                                                     
 --------------------------------------------------------------------*/ 
 // Hent åben række på Afvikling (BE72100T)                             
 CALL HENT_AFVIKLING;                                                   
                                                                        
 // Afslut progrsmmet                                                   
 RETURN;                                                                
                                                                        
 /*-------------------------------------------------------------------- 
       Hent åben række på Afvikling                                     
 --------------------------------------------------------------------*/ 
 HENT_AFVIKLING: PROC;                                                  
                                                                        
       DCLBE72100T = '';                                                
       EXEC SQL                                                         
          SELECT                                                        
             TIL_EVS_AAR,                                               
             AFVIKLINGS_ID,                                             
             DATA_ID,                                                   
             OPRET_TMS,                                                 
             OPRET_AF,                                                  
             AFSLUT_TMS,                                                
             AFSLUT_AF,                                                 
             KOERNR,                                                    
             KOERDTO                                                    
          INTO                                                          
             :DCLBE72100T.TIL_EVS_AAR,                                  
             :DCLBE72100T.AFVIKLINGS_ID,                                
             :DCLBE72100T.DATA_ID,                                      
             :DCLBE72100T.OPRET_TMS,                                    
             :DCLBE72100T.OPRET_AF,                                     
             :DCLBE72100T.AFSLUT_TMS,                                   
             :DCLBE72100T.AFSLUT_AF,                                    
             :DCLBE72100T.KOERNR,                                       
             :DCLBE72100T.KOERDTO                                       
          FROM BE72100T                                                 
          WHERE AFSLUT_TMS = '9999-12-31-23.59.59.999999';              
                                                                        
       SELECT (SQLCA.SQLCODE);                                          
          WHEN (0) DO;                                                  
             // De fundne værdier returneres                            
             PARM.TIL_EVS_AAR   = DCLBE72100T.TIL_EVS_AAR;              
             PARM.AFVIKLINGS_ID = DCLBE72100T.AFVIKLINGS_ID;            
             PARM.DATA_ID       = DCLBE72100T.DATA_ID;                  
             PARM.OPRET_TMS     = DCLBE72100T.OPRET_TMS;                
             PARM.OPRET_AF      = DCLBE72100T.OPRET_AF;                 
             PARM.AFSLUT_TMS    = DCLBE72100T.AFSLUT_TMS;               
             PARM.AFSLUT_AF     = DCLBE72100T.AFSLUT_AF;                
             PARM.KOERNR        = DCLBE72100T.KOERNR;                   
             PARM.KOERDTO       = DCLBE72100T.KOERDTO;                  
          END;                                                          
          WHEN (100) DO;                                                
             CALL SQL_FEJL ('001',                                      
                            'Der er ikke fundet en åben afvikling');    
          END;                                                          
          OTHER DO;                                                     
             CALL SQL_FEJL ('002',                                      
                            'Fejl ved opslag på BE72100T (Afvikling)'); 
          END;                                                          
       END;                                                             
                                                                        
 END HENT_AFVIKLING;                                                    
                                                                        
 /*-------------------------------------------------------------------- 
       SQL Fejl                                                         
 --------------------------------------------------------------------*/ 
 SQL_FEJL: PROC (CC, TXT);                                              
 DCL   CC            CHAR (03);                                         
 DCL   TXT           CHAR (41);                                         
                                                                        
       PUT SKIP LIST ('*****************************************');     
       PUT SKIP LIST ('DER ABENDES MED SQLCODE: ' !! SQLCA.SQLCODE);    
       PUT SKIP LIST ('ABENDTXT:                ' !! TXT);              
       PUT SKIP LIST ('*****************************************');     
                                                                        
       CALL ZS67000(SQLCA);                                             
                                                                        
       CALL ZM2ABEND(CC, TXT);                                          
                                                                        
 END SQL_FEJL;                                                          
                                                                        
 END BE55650;                                                           
