 BE90000:   /* DAN 1. UDGAVE AF BEREGNINGSBÅND TIL EVS SLUT */          
         PROCEDURE OPTIONS (MAIN) REORDER;                              
 /*********************************************************************/
         DCL COPYRIGHT CHAR (30) STATIC INIT ('COPYRIGHT KMD A/S 2013');
 /********************************************************************* 
 *                                                                    * 
 * FORMÅL: SAMSORTEREDE UDTRÆK FRA ESR, SLUT OG FORSKUD EVS-TABELLER  * 
 *         BRUGES TIL DANNELSE AF 1. UDGAVE AF BEREGNINGSBÅNDET TIL   * 
 *         EVS SLUT 2018.                                         RUL * 
 *                                                                    * 
 * INPUT:  B.H61200D  UDTRÆK FRA ESR, EVS SLUT OG EVS FORSKUD         * 
 *                                                                    * 
 * OUTPUT: B.H90000D  BEREGNINGSBÅND                                  * 
 *         B.H90010D  BEREGNINGSBÅND - FRASORTEREDE DUBLETTER         * 
 *         BE90001Y   KONTROLLISTE                                    * 
 *                                                                    * 
 * PROGRAMMØR:   AAGE RASMUSSEN PUS T&S DEC 2000                      * 
 *--------------------------------------------------------------------* 
 * RETTELSER   :                                                      * 
 * SLUT05        SUSANNE KROGH VILLUMSEN               09/11-2005     * 
 *               TILRETTET SLUT 2005                                  * 
 *               BE901.ESR.STAMOPL.VURDOPL0 ÆNDRES TIL                * 
 *               BE901.ESR.STAMOPL.VURDOPLNY                          * 
 *               BBERGRL_02_SW ÆNDRES TIL BBERGRL_02ANV_SW            * 
 *               BBER2FAM_02_SW ÆNDRES TIL BBER2FAM_02ANV_SW          * 
 * SLUT06        BO SCHMIDT                            04/10-2006     * 
 *               TILRETTET SLUT 2006                                  * 
 * SLUT07        INGRID FISCHER                        14/11-2007     * 
 *               TILRETTET SLUT 2007                                  * 
 * SLUT08        BO SCHMIDT                            14/11-2008     * 
 *               TILRETTET SLUT 2008                                  * 
 * SLUT09        GERD HOLM-PEDERSEN                    06/10-2009     * 
 *               TILRETTET SLUT 2009                                  * 
 * DEF384        GERD HOLM-PEDERSEN                    03/12-09       * 
 *               HVIS LANDEKODE = FR OG DER IKKE ER NOGEN             * 
 *               OVERTAGELELSESDATO SKAL DER TESTES PÅ CSUPPL I       * 
 *               SLUTS FØRSTE RÆKKE. NÅR CSUPPL=4 ER DET IKKE FRA     * 
 *               OPRETTELSEN MEN SENERE                               * 
 * SLUT10        GERD HOLM-PEDERSEN                    11/10-2010     * 
 *               TILRETTET SLUT 2009                                  * 
 * SLUT11        GERD HOLM-PEDERSEN                    11/10-2011     * 
 *               TILRETTET SLUT 2011                                  * 
 * SLUT12        LARS KAAE HARRITSHØJ                  OKT 2012       * 
 *               TILRETTET SLUT 2012                                  * 
 *               OMCOMPILERET P.G.A.                                  * 
 *               NYT FELT CEANV I STRUKTUR BE32200N (BE32202N)        * 
 *               KRAV 18-01 - BENYTTELSESKODE 25                      * 
 *               FLYTTER INFORMATIONEN I CEANV IMELLEM BH6121 OG      * 
 *               BE900                                                * 
 * SLUT13        JØRGEN SAUGMANN                       OKT 2013       * 
 * SLUT14        JØRGEN SAUGMANN                       OKT 2014       * 
 *               2013 -> 2014                                         * 
 * SLUT15        Z6JNK                                      OKT 2015  * 
 *               Årsrullet: 2014 -> 2015.  Søg efter  'RUL'           * 
 * SLUT16        LENE MAJ JENSEN Z6QLE                21/06-2016      * 
 *               TILRETNING AF CHECK PÅ OM INDENLANDSK EJENDOM        * 
 *               SKAL VIDEREFØRES PÅ GRUNDLAG AF SLUT                 * 
 *               indkomstår sættes til BH55300M.INDKÅR1 og            * 
 *               sidste indkomstår sættes til BH55300M.GLSLUTÅR1      * 
 * SLUT17        ESBEN BRODERSEN Z8QEB                07/09-2017      * 
 *               KUN KOMMENTAR RETTELSE INDTIL VIDERE                 * 
 * SLUT18        ESBEN BRODERSEN Z6EBD                06/09-2018      * 
 *               KUN KOMMENTAR RETTELSE INDTIL VIDERE                 * 
 *               UDVIDDET NØGLE MED EENHEDLBNR TIL 2 FAMILIE BOLIG    * 
 * SLUT19        ESBEN BRODERSEN Z6EBD                25/10-2018      * 
 *               CDATAFRA = 7 SAT IND I REGL2 FOR VIDERFØRSEL FRA SLUT* 
 *               FELT 158 = B og C ER SAT IND I REGL 3                * 
 * SLUT20        Per Brunk PBR                        22/10-2020      * 
 * SLUT20        Per Brunk PBR                        24/11-2020      * 
 *               D617 CDATAFRA = blank (regel 3)                      * 
 *               Medtage CEJBEVS = B og C                             * 
 * Slut 2020:    Elena Flygenring EFL                 marts 2021      * 
 *             - struktur BH65300M erstattes med BH55300M             * 
 *             - struktur BE90000N erstattes med BE90021N             * 
 *             - kompileringsfejl rettet: dcl af BH612_AR ændret      * 
 *               fra char(3000) var til char (4000) var               * 
 * Slut 2021:    Per Brunk PBR                        juni 2021       * 
 *               Defect 897: BFENR og VUREJENDOMID                    * 
 *               Per Brunk PBR                        November 2021   * 
 *               Defect 1081: Manglende vejkode mm.                   * 
 * SLUT 2022   Per Brunk - BE90022N -> BE90023N        oktober 2022   * 
 * SLUT 2024   Per Jensen PEN Ændret struktur BE30000N   Okt 2023     * 
 *             Indicator variable fjernet for felter som ikke         * 
 *             længere er inkluderetr i input/output                  * 
 * SLUT 2024   US1549418 JXT 706: CÆGTOPR                01-11-2023   * 
 * SLUT 2024   JJJJ: BE55600M erstatter BE55300M         21-06-2024   * 
  *********************************************************************/
         DEFAULT RANGE (*) STATIC UNALIGNED CONN;                       
 /********************************************************************* 
 *       DECLARE AF REGISTRE                                          * 
 *********************************************************************/ 
 DCL     BE612I FILE RECORD INPUT;      /* ESR OG EVS UDTRÆK         */ 
 DCL     BE900O FILE RECORD OUTPUT;     /* BEREGNINGSBÅND            */ 
 DCL     BE9001O FILE RECORD OUTPUT;    /* BEREGNINGSBÅND - DUBLETTER*/ 
 DCL     SYSPRINT FILE EXTERNAL PRINT;                                  
 /********************************************************************* 
 *       DECLARE AF UDTRÆK FRA ESR                                    * 
 *********************************************************************/ 
 DCL     BE612_AR        CHAR      (4000) VAR;                          
                                                                        
 DCL     1 BE6121        BASED     (ADDR(BE612_AR)),                    
           3 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BE32400N;;                                          
                                                                        
 DCL     1 BE6122        BASED     (ADDR(BE612_AR)),                    
           3 LÆNGDE      BIN FIXED (15),                                
           %INCLUDE BE31700N;;                                          
                                                                        
 DCL     1 BE612_ID1,                                                   
           2 DCPRCIR     PIC       '(10)9',                             
           2 EKOMNR      PIC       '(3)9',                              
           2 EEJDNR      PIC       '(7)9',                              
           2 EENHEDLBNR  BIN FIXED (15);                                
                                                                        
 DCL     BE612_ID        CHAR      (22)   BASED(ADDR(BE612_ID1));       
                                                                        
 DCL     1 GEM,                                                         
           2 EVS_UDTRÆK,                                                
             %INCLUDE BE31700N;;                                        
 /********************************************************************* 
 *       DECLARE AF UDTRÆK (BEREGNINGSBÅND)                           * 
 *********************************************************************/ 
 DCL     1 BE900,                                                       
           %INCLUDE BE90024N;;                                          
 DCL     1 BE90099,                                                     
           %INCLUDE BE90099N;               /* OPTÆLLINGSINDIVID      */
 /********************************************************************* 
 *               DECLARE AF DIV. TÆLLEVÆRKER                          * 
 *********************************************************************/ 
 DCL     1 TV,                   /* TÆLLEVÆRKER TIL TOTALLISTEN */      
           2 LÆS_BE612        FIXED DEC (7),                            
           2 LÆS_EVS          FIXED DEC (7),                            
           2 LÆS_EVS_F        FIXED DEC (7),                            
           2 LÆS_EVS_S        FIXED DEC (7),                            
           2 FESR_MATCH       FIXED DEC (7),                            
           2 FOVF_SALG        FIXED DEC (7),                            
           2 LÆS_ESR          FIXED DEC (7),                            
           2 OFF_CPR          FIXED DEC (7),                            
           2 OFF_EJ_CPR       FIXED DEC (7),                            
           2 OVERSPR_CPR      FIXED DEC (7),                            
           2 OVERSPR_SE       FIXED DEC (7),                            
           2 OVERSPR_EVSHDL   FIXED DEC (7),                            
           2 SLETSLUT_EJERHDL FIXED DEC (7),                            
           2 SLETSLUT_ÆGTFHDL FIXED DEC (7),                            
           2 SLET_FORSKUD_HDL FIXED DEC (7),                            
           2 TO_EJER          FIXED DEC (7),                            
           2 EJ_SKR           FIXED DEC (7),                            
           2 TO_EJER_NUL      FIXED DEC (7),                            
           2 FL_EJER_NUL      FIXED DEC (7),                            
           2 GANE_JUSTER      FIXED DEC (7),                            
           2 SAMME_EJER       FIXED DEC (7),                            
           2 KUN_ÆGTF         FIXED DEC (7),                            
           2 EJER_SLETTET     FIXED DEC (7),                            
           2 EJER_OPRET       FIXED DEC (7),                            
           2 ÆGTF_OPRET       FIXED DEC (7),                            
           2 ÆGTFOPR_FEJL     FIXED DEC (7),                            
           2 FRASORTERET      FIXED DEC (7),                            
           2 EJER_FRA_SLUT    FIXED DEC (7),                            
           2 SOLGT_I_SLUT     FIXED DEC (7),                            
           2 EJET_I_SLUT      FIXED DEC (7),                            
           2 RET_EFTERLEV     FIXED DEC (7),                            
           2 OPR_EFTERLEV     FIXED DEC (7),                            
           2 OPR_SLUT_EJER    FIXED DEC (7),                            
           2 SKREVET          FIXED DEC (7),                            
           2 FEVS             FIXED DEC (7),                            
           2 FØVREVS          FIXED DEC (7),                            
           2 FUDLANDSK        FIXED DEC (7),                            
           2 FEVSOPRET        FIXED DEC (7),                            
           2 FL_EJER          FIXED DEC (7),                            
           2 FORSKEL1         FIXED DEC (7),                            
           2 FORSKEL2         FIXED DEC (7),                            
           2 FORSKEL3         FIXED DEC (7),                            
           2 PGF4A            FIXED DEC (7),                            
           2 PGF4B            FIXED DEC (7),                            
           2 D617             FIXED DEC (7);                            
 /********************************************************************* 
 *       DECLARE AF DIV. FÆLLESMACROER (ESKEMA/BOY/FORSKUD)           * 
 *********************************************************************/ 
 DCL     1 BE55600M,                                                    
           %INCLUDE BE55600M;                                           
 DCL     1 BE60101M      ALIGNED,                                       
           %INCLUDE BE60101M;                                           
 /********************************************************************* 
 *       DECLARE AF BUILTIN'S                                         * 
 *********************************************************************/ 
 DCL     STG             BUILTIN;                                       
 DCL     ADDR            BUILTIN;                                       
 DCL     VERIFY          BUILTIN;                                       
 DCL     PLIDUMP         BUILTIN;                                       
 /********************************************************************* 
 *       DECLARE AF ENTRY'S                                           * 
 *********************************************************************/ 
 DCL     ZS61900         ENTRY;                                         
 DCL     ZS38100         ENTRY OPTIONS (INTER ASM);   /* TIMESTAMP    */
 /*********************************************************************/
 /*      DECLARE AF PRINTLINIER                                       */
 /*********************************************************************/
 DCL    1 SIDELIN,                                                      
          2 CCA          CHAR      (01),                                
          2 FILLER       CHAR      (132)     INIT      (' ');           
 DCL     1 OVERLIN1,                                                    
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (17)      INIT      (                
           'PROGRAM: BE90000L'),                                        
           2 F1          CHAR      (25)      INIT      (' '),           
           2 TEKST2      CHAR      (69)      INIT      (' '),           
           2 TEKST3      CHAR      (11)      INIT      (                
           'UDSKREVET:'),                                               
           2 DATO        CHAR      (10);                                
 DCL     1 OVERLIN2,                                                    
           2 CCA         CHAR      (01),                                
           2 F1          CHAR      (46)      INIT      (' '),           
           2 TEKST1      CHAR      (86)      INIT                       
           ('          KØRSELSKONTROLLISTE');                           
 DCL     1 DETLIN0,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST1      CHAR      (41),                                
           2 CPUÅR       PIC       '99',                                
           2 TEKST2      CHAR      (11),                                
           2 START       PIC       '999999',                            
           2 TEKST3      CHAR      (9),                                 
           2 SLUT        PIC       '999999',                            
           2 TEKST4      CHAR      (57);                                
 DCL     1 DETLIN1,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (60),                                
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZZ',                       
           2 F2          CHAR      (61)      INIT      (' ');           
 DCL     1 DETLIN2,                                                     
           2 CCA         CHAR      (01),                                
           2 TEKST       CHAR      (33),                                
           2 RCKOD       CHAR      (01)      INIT      (' '),           
           2 F1          CHAR      (19)      INIT      (' '),           
           2 ANTAL       PIC       'ZZZ.ZZZ.ZZ9',                       
           2 F2          CHAR      (68)      INIT      (' ');           
         % INCLUDE ZZ20301M;                                            
 /********************************************************************* 
 *               DECLARE AF DIV. HJÆLPEFELTER                         * 
 *********************************************************************/ 
 DCL     PLIXOPT         CHAR      (40)      VAR STATIC                 
 EXTERNAL INIT ('NOTEST(ALL,,;)');                                      
 DCL     (I,J,K,N)       BIN FIXED (15)    INIT (0);                    
 DCL     EOF_BE612       BIT       (1);                                 
 DCL     JA              BIT       (1)     INIT ('1'B);                 
 DCL     NEJ             BIT       (1)     INIT ('0'B);                 
 DCL     HJ_CPR          PIC       '(10)9';                             
 DCL     CRETUR          CHAR      (1);                                 
 DCL     MATCH_CPRNR     FIXED     (11) INIT (0);                       
 DCL     MATCH_KOMNR     FIXED     (3)  INIT (0);                       
 DCL     MATCH_EJDNR     FIXED     (7)  INIT (0);                       
 DCL     MATCH_ENHEDLBNR BIN FIXED (15) INIT (0);                       
 DCL     HJKOMNR         PIC       '999';     /* HJÆLPEFELT TIL KOMNR */
 DCL     HJCRCKO         PIC       '9';       /* HJÆLPEFELT TIL RCKODE*/
 DCL     PUTKOM          FIXED     (3);                                 
 DCL     PUTEJD          FIXED     (7);                                 
 DCL     PUTBENYT        CHAR      (2);                                 
 DCL     EJENDOM_VIDERE  BIT       (1);                                 
                                                                        
 DCL     UDDATO          CHAR      (10);                                
                                                                        
 DCL     DATO1           CHAR      (26);                                
                                                                        
 DCL     1 DATO2         DEF DATO1,                                     
           2 ÅR          CHAR      (04),                                
           2 F1          CHAR      (01),                                
           2 MD          CHAR      (02),                                
           2 F2          CHAR      (01),                                
           2 DG          CHAR      (02);                                
 /********************************************************************* 
 *       HOUSEKEEPING                                                 * 
 *********************************************************************/ 
         CALL ZS61900;                          /* UDSKRIVNING AF SSI */
         EOF_BE612 = NEJ;                                               
         ON ERROR                                                       
            CALL PLIDUMP ('SNHOB');                                     
         OPEN FILE (BE612I)  TITLE ('BE61200I');                        
         OPEN FILE (BE900O)  TITLE ('BE90000O');                        
         OPEN FILE (BE9001O) TITLE ('BE90010O');                        
                                                                        
         ON ENDFILE (BE612I)                                            
            EOF_BE612 = JA;                                             
                                                                        
         CALL ZZ20390 ('*OPEN','BE90001Y');                             
                                                                        
         CALL ZS38100(DATO1);                                           
         UDDATO = DATO2.DG !! '/' !! DATO2.MD !!                        
                  '-' !! DATO2.ÅR;                                      
         OVERLIN1.DATO  = UDDATO;                                       
                                                                        
         OVERLIN1.TEKST2 =                                              
         '1. UDGAVE AF BEREGNINGSBÅND TIL EVS SLUT ' !!                 
                          BE55600M.INDKÅR1;                             
                                                                        
         SIDELIN.CCA    = ZZIK1;                                        
         OVERLIN1.CCA   = ZZWS2;                                        
         OVERLIN2.CCA   = ZZWS3;                                        
                                                                        
         TV  = 0;                                                       
         GEM = '';                                                      
                                                                        
 /********************************************************************* 
 *       HOVEDSTYRING                                                 * 
 *********************************************************************/ 
                                                                        
         CALL LÆS_BE612;                                                
                                                                        
         DO WHILE ( EOF_BE612 = NEJ );                                  
            CALL BEHANDL;                                               
            CALL LÆS_BE612;                                             
         END;                                                           
                                                                        
         CALL AFSLUT;                                                   
                                                                        
 /********************************************************************* 
 *       LÆS UDTRÆK FRA ESR OG EVS - SAMSORTERET (B.H61200D)          * 
 *********************************************************************/ 
 LÆS_BE612: PROC;                                                       
                                                                        
         READ FILE (BE612I) INTO (BE612_AR);                            
                                                                        
         IF EOF_BE612 = NEJ                                             
         THEN                                                           
            DO;                                                         
               BE612_ID1.DCPRCIR    = BE6121.SORTCPR;                   
               BE612_ID1.EKOMNR     = BE6121.EKOMNR;                    
               BE612_ID1.EEJDNR     = BE6121.EEJDNR;                    
               BE612_ID1.EENHEDLBNR = BE6121.EENHEDLBNR;                
                                                                        
               TV.LÆS_BE612 = TV.LÆS_BE612 + 1;                         
                                                                        
               IF BE6121.SORTCITYP > 0                                  
               THEN                                                     
                  TV.LÆS_ESR = TV.LÆS_ESR + 1;                          
               ELSE                                                     
                  DO;                                                   
                     TV.LÆS_EVS = TV.LÆS_EVS + 1;                       
                     SELECT;                                            
                       WHEN (BE6122.EVS_FORSK_EJER.DCPRN > 0 &          
                             BE6122.EVS_SLUT_EJER.DCPRN  = 0 &          
                             BE6122.EVS_SLUT_ÆGTF.DCPRN  = 0)           
                             TV.LÆS_EVS_F = TV.LÆS_EVS_F + 1;           
                       WHEN (BE6122.EVS_FORSK_EJER.DCPRN = 0)           
                             TV.LÆS_EVS_S = TV.LÆS_EVS_S + 1;           
                       OTHERWISE;                                       
                     END;                                               
                  END;                                                  
            END;                                                        
 END LÆS_BE612;                                                         
 /********************************************************************* 
 *       PERSONER SOM EVT. SKAL BEHANDLES/BEREGNES                    * 
 *********************************************************************/ 
 BEHANDL: PROC;                                                         
                                                                        
         IF GEM.EVS_UDTRÆK.DCPRNUM > 0 &                                
           (BE6121.SORTCPR > GEM.EVS_UDTRÆK.DCPRNUM  !                  
            (BE6121.SORTCPR = GEM.EVS_UDTRÆK.DCPRNUM  &                 
             BE6121.EKOMNR  > GEM.EVS_UDTRÆK.EKOMNUM) !                 
            (BE6121.SORTCPR = GEM.EVS_UDTRÆK.DCPRNUM  &                 
             BE6121.EKOMNR  = GEM.EVS_UDTRÆK.EKOMNUM  &                 
             BE6121.EEJDNR  > GEM.EVS_UDTRÆK.EEJDNUM) !                 
            (BE6121.SORTCPR = GEM.EVS_UDTRÆK.DCPRNUM  &                 
             BE6121.EKOMNR  = GEM.EVS_UDTRÆK.EKOMNUM  &                 
             BE6121.EEJDNR  = GEM.EVS_UDTRÆK.EEJDNUM  &                 
             BE6121.EENHEDLBNR > GEM.EVS_UDTRÆK.EENHEDLBNUM))           
         THEN                                                           
            DO;                                                         
               IF MATCH_CPRNR     = GEM.EVS_UDTRÆK.DCPRNUM &            
                  MATCH_KOMNR     = GEM.EVS_UDTRÆK.EKOMNUM &            
                  MATCH_EJDNR     = GEM.EVS_UDTRÆK.EEJDNUM &            
                  MATCH_ENHEDLBNR = GEM.EVS_UDTRÆK.EENHEDLBNUM          
               THEN;                                                    
               ELSE                                                     
                  IF  GEM.EVS_UDTRÆK.DCPRNUM > MATCH_CPRNR  !           
                     (GEM.EVS_UDTRÆK.DCPRNUM = MATCH_CPRNR  &           
                      GEM.EVS_UDTRÆK.EKOMNUM > MATCH_KOMNR) !           
                     (GEM.EVS_UDTRÆK.DCPRNUM = MATCH_CPRNR  &           
                      GEM.EVS_UDTRÆK.EKOMNUM = MATCH_KOMNR  &           
                      GEM.EVS_UDTRÆK.EEJDNUM > MATCH_EJDNR) !           
                     (GEM.EVS_UDTRÆK.DCPRNUM = MATCH_CPRNR  &           
                      GEM.EVS_UDTRÆK.EKOMNUM = MATCH_KOMNR  &           
                      GEM.EVS_UDTRÆK.EEJDNUM = MATCH_EJDNR  &           
                      GEM.EVS_UDTRÆK.EENHEDLBNUM > MATCH_ENHEDLBNR)     
                  THEN                                                  
                     DO;                                                
                        CALL BEHANDL_EVS_TILGANG;                       
                        GEM = '';                                       
                     END;                                               
            END;                                                        
                                                                        
         IF BE6121.SORTCITYP = 0          /* INDIVID MED DATA FRA EVS */
         THEN                                                           
            DO;                                                         
               CALL BEHANDL_EVS_UDTRÆK;                                 
               RETURN;                                                  
            END;                                                        
                                                                        
         BE60101M = '';                                                 
         BE900 = '';                                                    
         BE900.ESR = BE6121, BY NAME;                                   
                                                                        
         IF GEM.EVS_UDTRÆK.DCPRNUM = BE900.ESR.SORTCPR &                
            GEM.EVS_UDTRÆK.EKOMNUM = BE900.ESR.EKOMNR  &                
            GEM.EVS_UDTRÆK.EEJDNUM = BE900.ESR.EEJDNR  &                
            GEM.EVS_UDTRÆK.EENHEDLBNUM = BE900.ESR.EENHEDLBNR           
         THEN                                                           
            DO; /* Tilføj EVS udtræk */                                 
               TV.FESR_MATCH = TV.FESR_MATCH + 1;                       
               MATCH_CPRNR = GEM.EVS_UDTRÆK.DCPRNUM;                    
               MATCH_KOMNR = GEM.EVS_UDTRÆK.EKOMNUM;                    
               MATCH_EJDNR = GEM.EVS_UDTRÆK.EEJDNUM;                    
               MATCH_ENHEDLBNR = GEM.EVS_UDTRÆK.EENHEDLBNUM;            
               BE900.EVS_UDTRÆK = GEM.EVS_UDTRÆK, BY NAME;              
            END;                                                        
         ELSE                                                           
            DO;                                                         
               /* INITIER DIVERSE INDIKATOR-FELTER */                   
               /* HVIS INTET EVS-UDTRÆK FOR EJER OG/ELLER ÆGTEFÆLLE */  
               IF BE900.EVS_SLUT_EJER.DCPRN = 0                         
               THEN                                                     
                  DO;                                                   
                     BE900.EVS_SLUT_EJER.FØRSTE.GPCTEJER_SW = -1;       
                     BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = -1;       
                     BE900.EVS_SLUT_EJER.FØRSTE.BBERGRL_SW  = -1;       
                     BE900.EVS_SLUT_EJER.SIDSTE.BBERGRL_SW  = -1;       
                     BE900.EVS_SLUT_EJER.FØRSTE.BBER2FAM_SW = -1;       
                     BE900.EVS_SLUT_EJER.SIDSTE.BBER2FAM_SW = -1;       
                     BE900.EVS_SLUT_EJER.FØRSTE.BNETTO_SW   = -1;       
                     BE900.EVS_SLUT_EJER.SIDSTE.BNETTO_SW   = -1;       
                     BE900.EVS_SLUT_EJER.FØRSTE.BEJERAN_SW  = -1;       
                     BE900.EVS_SLUT_EJER.SIDSTE.BEJERAN_SW  = -1;       
                     BE900.EVS_SLUT_EJER.FØRSTE.BEVSMAN_SW    = -1;     
                     BE900.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW    = -1;     
                     BE900.EVS_SLUT_EJER.FØRSTE.BEJBOL1_SW    = -1;     
                     BE900.EVS_SLUT_EJER.SIDSTE.BEJBOL1_SW    = -1;     
                     BE900.EVS_SLUT_EJER.FØRSTE.BEJBOL2_SW    = -1;     
                     BE900.EVS_SLUT_EJER.SIDSTE.BEJBOL2_SW    = -1;     
                     BE900.EVS_SLUT_EJER.FØRSTE.BBER2FAM_AKT_SW = -1;   
                     BE900.EVS_SLUT_EJER.SIDSTE.BBER2FAM_AKT_SW = -1;   
                     BE900.EVS_SLUT_EJER.FØRSTE.BSUM1_SW = -1;          
                     BE900.EVS_SLUT_EJER.SIDSTE.BSUM1_SW = -1;          
                     BE900.EVS_SLUT_EJER.FØRSTE.BSUM3_SW = -1;          
                     BE900.EVS_SLUT_EJER.SIDSTE.BSUM3_SW = -1;          
                     BE900.EVS_SLUT_EJER.FØRSTE.BUDLSKC_SW     = -1;    
                     BE900.EVS_SLUT_EJER.SIDSTE.BUDLSKC_SW     = -1;    
                     /*QEB TILFØJET DB2 OMLÆGNING */                    
                     BE900.EVS_SLUT_EJER.FØRSTE.BBERGRL_AKT_SW = -1;    
                     BE900.EVS_SLUT_EJER.SIDSTE.BBERGRL_AKT_SW = -1;    
                  END;                                                  
                                                                        
               IF BE900.EVS_SLUT_ÆGTF.DCPRN = 0                         
               THEN                                                     
                  DO;                                                   
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.GPCTEJER_SW = -1;       
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER_SW = -1;       
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BBERGRL_SW  = -1;       
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BBERGRL_SW  = -1;       
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BBER2FAM_SW = -1;       
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BBER2FAM_SW = -1;       
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BNETTO_SW   = -1;       
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BNETTO_SW   = -1;       
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BEJERAN_SW  = -1;       
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BEJERAN_SW  = -1;       
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BEVSMAN_SW    = -1;     
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW = -1;        
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BEJBOL1_SW = -1;        
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BEJBOL1_SW = -1;        
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BEJBOL2_SW = -1;        
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BEJBOL2_SW = -1;        
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BBER2FAM_AKT_SW   = -1; 
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BBER2FAM_AKT_SW   = -1; 
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BSUM1_SW = -1;          
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BSUM1_SW = -1;          
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BSUM3_SW = -1;          
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BSUM3_SW = -1;          
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BUDLSKC_SW     = -1;    
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BUDLSKC_SW     = -1;    
                     /* QEB INDSAT DB2 OMLÆGNING */                     
                     BE900.EVS_SLUT_ÆGTF.FØRSTE.BBERGRL_AKT_SW = -1;    
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.BBERGRL_AKT_SW = -1;    
                  END;                                                  
                                                                        
               IF BE900.EVS_FORSK_EJER.DCPRN = 0                        
               THEN                                                     
                  DO;                                                   
                     BE900.EVS_FORSK_EJER.B100_SW     = -1;             
                     BE900.EVS_FORSK_EJER.BBRUTTO_SW  = -1;             
                     BE900.EVS_FORSK_EJER.BEJERAN_SW  = -1;             
                     BE900.EVS_FORSK_EJER.BNYMAN_SW   = -1;             
                     BE900.EVS_FORSK_EJER.BFORSKAT_SW = -1;             
                  END;                                                  
                                                                        
               IF BE900.EVS_FORSK_ÆGTF.DCPRN = 0                        
               THEN                                                     
                  DO;                                                   
                     BE900.EVS_FORSK_ÆGTF.B100_SW     = -1;             
                     BE900.EVS_FORSK_ÆGTF.BBRUTTO_SW  = -1;             
                     BE900.EVS_FORSK_ÆGTF.BEJERAN_SW  = -1;             
                     BE900.EVS_FORSK_ÆGTF.BNYMAN_SW   = -1;             
                     BE900.EVS_FORSK_ÆGTF.BFORSKAT_SW = -1;             
                  END;                                                  
            END;                                                        
                                                                        
         BE900.SORT_CPR       = BE900.ESR.SORTCPR;                      
         BE900.SORT_KOMNR     = BE900.ESR.EKOMNR;                       
         BE900.SORT_EJDNR     = BE900.ESR.EEJDNR;                       
         BE900.SORT_ENHEDLBNR = BE900.ESR.EENHEDLBNR;                   
         BE900.SORT_CITYP = BE900.ESR.SORTCITYP;                        
                                                                        
         IF BE900.ESR.EJER.DCPRCIR > 0 &                                
            BE900.ESR.EJER.GANE    = 0 &                                
            BE900.ESR.EJER.FEJER   = 1                                  
         THEN                                                           
            BE900.ESR.EJER.GANE = 10000;                                
                                                                        
         IF BE900.ESR.ÆGTF.DCPRCIR > 0 &                                
            BE900.ESR.ÆGTF.GANE    = 0 &                                
            BE900.ESR.ÆGTF.FEJER   = 1                                  
         THEN                                                           
            BE900.ESR.ÆGTF.GANE = 10000;                                
                                                                        
                                                                        
         IF BE900.ESR.EJER.DCPRCIR > 0                                  
         THEN                                                           
            DO;                                                         
               BE900.AKT_EJER   = BE900.ESR.EJER, BY NAME;              
               BE900.CPENS_FESR = BE900.ESR.EJER.CPENS;                 
            END;                                                        
                                                                        
         IF BE900.ESR.ÆGTF.DCPRCIR > 0                                  
         THEN                                                           
            BE900.AKT_ÆGTF = BE900.ESR.ÆGTF, BY NAME;                   
                                                                        
         //CALL OPSÆT_ÆGTF_FORDEL;        US1549418 JXT                 
                                                                        
         BE900.EJENDOM.EJDBELIG = SUBSTR(BE900.ESR.ABELMAT,1,31);       
         /* Nye felter til slut 2018 */                                 
         BE900.EJENDOM.VEJK_EJD    = BE900.ESR.VEJK_EJD;                
         BE900.EJENDOM.HUSNR_EJD   = BE900.ESR.HUSNR_EJD;               
         BE900.EJENDOM.ETAGE_EJD   = BE900.ESR.ETAGE_EJD;               
         BE900.EJENDOM.SDØR_EJD    = BE900.ESR.SDØR_EJD;                
         BE900.EJENDOM.ENHEDBELIG  = BE900.ESR.ENHEDBELIG;              
         BE900.EJENDOM.VEJK_ENHED  = BE900.ESR.VEJK_ENHED;              
         BE900.EJENDOM.HUSNR_ENHED = BE900.ESR.HUSNR_ENHED;             
         BE900.EJENDOM.ETAGE_ENHED = BE900.ESR.ETAGE_ENHED;             
         BE900.EJENDOM.SDØR_ENHED  = BE900.ESR.SDØR_ENHED;              
         /* Defect 897 */                                               
         BE900.EJENDOM.BFENR        = BE900.ESR.BFENR;                  
         BE900.EJENDOM.VUREJENDOMID = BE900.ESR.VUREJENDOMID;           
                                                                        
         HJKOMNR = BE900.ESR.EKOMNR;                                    
         CALL RCPROC;       /* BEREGN RC-KODE FOR BELIGGENHEDSKOMMUNE */
         BE900.CRCKO = HJCRCKO;                                         
                                                                        
         IF BE900.AKT_EJER.FEJER = 2 &                                  
            BE900.AKT_EJER.GANE  = 0                                    
         THEN                                                           
            TV.TO_EJER_NUL = TV.TO_EJER_NUL + 1;                        
                                                                        
         IF BE900.AKT_EJER.FEJER > 2 &                                  
            BE900.AKT_EJER.GANE  = 0                                    
         THEN                                                           
            TV.FL_EJER_NUL = TV.FL_EJER_NUL + 1;                        
                                                                        
         /* KONTROLLER STATUS FOR EJERS CPRNR, D.V.S. OM DER ER   */    
         /* TALE OM ET RIGTIGT CPRNR, ET SE-NR, ET INVALIDT CPRNR */    
         /* ELLER ET LØBENR.                                      */    
                                                                        
         HJ_CPR = BE900.SORT_CPR;                                       
                                                                        
         CALL DAN_CPRNR_STATUS(HJ_CPR,BE900.AKT_EJER.CEJFORH,CRETUR);   
                                                                        
         BE900.CINVPNR = CRETUR;                                        
                                                                        
         IF BE900.AKT_EJER.CEJFORH = '50' ! /*HVIS EJEREN ER */         
            BE900.AKT_EJER.CEJFORH = '60' ! /*OFFENTLIG D.V.S.*/        
            BE900.AKT_EJER.CEJFORH = '70' ! /*KOMM./AMT/STAT */         
            BE900.AKT_EJER.CEJFORH = '80'                               
         THEN                                                           
            DO;                                                         
               IF BE900.CINVPNR = '0' /* HVIS PNR. ER VALIDT */         
               THEN                   /* BEHANDLES 'NORMALT' */         
                  TV.OFF_CPR = TV.OFF_CPR + 1;                          
               ELSE                                                     
                  DO;                                                   
                     TV.OFF_EJ_CPR = TV.OFF_EJ_CPR + 1;                 
                     CALL SKRIV_PERSON;                                 
                     RETURN;                                            
                  END;                                                  
            END;                                                        
                                                                        
         IF BE900.CINVPNR = '0'                /* PERSONNR. ER VALIDT */
         THEN                                                           
            DO;                                                         
               BE900.TIL_EVS.CPTYPSLUT = '1';  /*PERSONTYPE=ALM PERSON*/
               BE900.TIL_EVS.CPTYPFOR  = '1';                           
            END;                                                        
         ELSE                                                           
            DO;                                                         
               IF BE900.CINVPNR = '2'        /* DETTE ER VALIDT SE-NR */
               THEN                                                     
                  DO;                                                   
                     /* DETTE ER EJENDOMME SOM IKKE ER OMFATTET */      
                     /* AF EVS-REGLERNE, MEN DE SKAL OVERSENDES */      
                     /* TIL SLS PÅ CSC VIA PROGRAM BE61300L.    */      
                     TV.OVERSPR_SE  = TV.OVERSPR_SE + 1;                
                     BE900.CKUN_SLS = '1';                              
                     BE900.CSKATBER = '0';                              
                  END;                                                  
               ELSE                                                     
                  TV.OVERSPR_CPR = TV.OVERSPR_CPR + 1;                  
               CALL SKRIV_PERSON;                                       
               RETURN;                                                  
            END;                                                        
         /* OPTÆL PGF 4 VURDEREDE EJD */    /*SLUT05*/                  
         IF BE900.ESR.STAMOPL.VURDOPLNY.ÅRSVURD.BEJDVÆP4A ^= 0          
         THEN                                                           
            TV.PGF4A = TV.PGF4A + 1;                                    
         IF BE900.ESR.STAMOPL.BEJDVÆP4B ^= 0                            
         THEN                                                           
            TV.PGF4B = TV.PGF4B + 1;                                    
                                                                        
         IF BE900.ESR.VURDOPLNY.ÅRSVURD.CFORSKEL = '1' /*SLUT05*/       
         THEN                                                           
            TV.FORSKEL1 = TV.FORSKEL1 + 1;                              
         IF BE900.ESR.VURDOPLNY.ÅRSVURD.CFORSKEL = '2' /*SLUT05*/       
         THEN                                                           
            TV.FORSKEL2 = TV.FORSKEL2 + 1;                              
         IF BE900.ESR.VURDOPLNY.ÅRSVURD.CFORSKEL = '3'  /*SLUT05*/      
         THEN                                                           
            TV.FORSKEL3 = TV.FORSKEL3 + 1;                              
                                                                        
         CALL SKRIV_PERSON;                                             
 END BEHANDL;                                                           
 /*********************************************************************/
 /*      SKAF RC-KODE PÅ GRUNDLAG AF BELIGGENHEDSKOMMUNE              */
 /*                                                                   */
 /*      OPSÆTNINGEN SKAL IKKE ÆNDRES P.G.A. FLYTNING AF HADSTEN (709)*/
 /*      OG RANDERS (731) FRA KMÅ TIL KMA DA ESR-TRANSER STADIG SKAL  */
 /*      SENDES TIL KMÅ.                                              */
 /*********************************************************************/
 RCPROC: PROC;                                                          
         SELECT;                                                        
           WHEN (HJKOMNR = 0)                                           
              HJCRCKO    = 6;    /* KMB */                              
           WHEN (HJKOMNR < 129)                                         
              HJCRCKO    = 1;    /* KMV */                              
           WHEN (HJKOMNR <= 409)                                        
              HJCRCKO    = 6;    /* KMB */                              
           WHEN (HJKOMNR <= 499)                                        
              HJCRCKO    = 5;    /* KMO */                              
           WHEN (HJKOMNR = 751)                                         
              HJCRCKO    = 4;    /* KMÅ */                              
           OTHERWISE                                                    
              HJCRCKO    = 3;    /* KMA */                              
         END;                                                           
 END RCPROC;                                                            
 /********************************************************************* 
 *       BEHANDLING AF INDIVID FRA EVS UDTRÆK                         * 
 *********************************************************************/ 
 BEHANDL_EVS_UDTRÆK: PROC;                                              
                                                                        
         /* INITIER DIVERSE INDIKATOR-FELTER */                         
         /* HVIS INTET EVS-UDTRÆK FOR EJER OG/ELLER ÆGTEFÆLLE */        
                                                                        
         IF BE6122.EVS_SLUT_EJER.DCPRN = 0                              
         THEN                                                           
            DO;                                                         
               BE6122.EVS_SLUT_EJER.FØRSTE.GPCTEJER_SW = -1;            
               BE6122.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = -1;            
               BE6122.EVS_SLUT_EJER.FØRSTE.BBERGRL_SW  = -1;            
               BE6122.EVS_SLUT_EJER.SIDSTE.BBERGRL_SW  = -1;            
               BE6122.EVS_SLUT_EJER.FØRSTE.BBER2FAM_SW = -1;            
               BE6122.EVS_SLUT_EJER.SIDSTE.BBER2FAM_SW = -1;            
               BE6122.EVS_SLUT_EJER.FØRSTE.BNETTO_SW   = -1;            
               BE6122.EVS_SLUT_EJER.SIDSTE.BNETTO_SW   = -1;            
               BE6122.EVS_SLUT_EJER.FØRSTE.BEJERAN_SW  = -1;            
               BE6122.EVS_SLUT_EJER.SIDSTE.BEJERAN_SW  = -1;            
               BE6122.EVS_SLUT_EJER.FØRSTE.BEVSMAN_SW    = -1;          
               BE6122.EVS_SLUT_EJER.SIDSTE.BEVSMAN_SW    = -1;          
               BE6122.EVS_SLUT_EJER.FØRSTE.BEJBOL1_SW    = -1;          
               BE6122.EVS_SLUT_EJER.SIDSTE.BEJBOL1_SW    = -1;          
               BE6122.EVS_SLUT_EJER.FØRSTE.BEJBOL2_SW    = -1;          
               BE6122.EVS_SLUT_EJER.SIDSTE.BEJBOL2_SW    = -1;          
               BE6122.EVS_SLUT_EJER.FØRSTE.BBER2FAM_AKT_SW   = -1;      
               BE6122.EVS_SLUT_EJER.SIDSTE.BBER2FAM_AKT_SW   = -1;      
               BE6122.EVS_SLUT_EJER.FØRSTE.BSUM1_SW = -1;               
               BE6122.EVS_SLUT_EJER.SIDSTE.BSUM1_SW = -1;               
               BE6122.EVS_SLUT_EJER.FØRSTE.BSUM3_SW = -1;               
               BE6122.EVS_SLUT_EJER.SIDSTE.BSUM3_SW = -1;               
               BE6122.EVS_SLUT_EJER.FØRSTE.BUDLSKC_SW     = -1;         
               BE6122.EVS_SLUT_EJER.SIDSTE.BUDLSKC_SW     = -1;         
               /*QEB TILFØJET DB2 OMLÆGNING */                          
               BE6122.EVS_SLUT_EJER.FØRSTE.BBERGRL_AKT_SW = -1;         
               BE6122.EVS_SLUT_EJER.SIDSTE.BBERGRL_AKT_SW = -1;         
            END;                                                        
                                                                        
         IF BE6122.EVS_SLUT_ÆGTF.DCPRN = 0                              
         THEN                                                           
            DO;                                                         
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.GPCTEJER_SW = -1;            
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER_SW = -1;            
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BBERGRL_SW  = -1;            
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BBERGRL_SW  = -1;            
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BBER2FAM_SW = -1;            
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BBER2FAM_SW = -1;            
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BNETTO_SW   = -1;            
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BNETTO_SW   = -1;            
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BEJERAN_SW  = -1;            
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BEJERAN_SW  = -1;            
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BEVSMAN_SW    = -1;          
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BEVSMAN_SW    = -1;          
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BEJBOL1_SW = -1;             
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BEJBOL1_SW = -1;             
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BEJBOL2_SW = -1;             
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BEJBOL2_SW = -1;             
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BBER2FAM_AKT_SW   = -1;      
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BBER2FAM_AKT_SW   = -1;      
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BSUM1_SW = -1;               
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BSUM1_SW = -1;               
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BSUM3_SW = -1;               
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BSUM3_SW = -1;               
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BUDLSKC_SW     = -1;         
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BUDLSKC_SW     = -1;         
               /* QEB INDSAT DB2 OMLÆGNING */                           
               BE6122.EVS_SLUT_ÆGTF.FØRSTE.BBERGRL_AKT_SW = -1;         
               BE6122.EVS_SLUT_ÆGTF.SIDSTE.BBERGRL_AKT_SW = -1;         
            END;                                                        
                                                                        
         IF BE6122.EVS_FORSK_EJER.DCPRN = 0                             
         THEN                                                           
            DO;                                                         
               BE6122.EVS_FORSK_EJER.B100_SW     = -1;                  
               BE6122.EVS_FORSK_EJER.BBRUTTO_SW  = -1;                  
               BE6122.EVS_FORSK_EJER.BEJERAN_SW  = -1;                  
               BE6122.EVS_FORSK_EJER.BNYMAN_SW   = -1;                  
               BE6122.EVS_FORSK_EJER.BFORSKAT_SW = -1;                  
            END;                                                        
                                                                        
         IF BE6122.EVS_FORSK_ÆGTF.DCPRN = 0                             
         THEN                                                           
            DO;                                                         
               BE6122.EVS_FORSK_ÆGTF.B100_SW     = -1;                  
               BE6122.EVS_FORSK_ÆGTF.BBRUTTO_SW  = -1;                  
               BE6122.EVS_FORSK_ÆGTF.BEJERAN_SW  = -1;                  
               BE6122.EVS_FORSK_ÆGTF.BNYMAN_SW   = -1;                  
               BE6122.EVS_FORSK_ÆGTF.BFORSKAT_SW = -1;                  
            END;                                                        
                                                                        
         GEM.EVS_UDTRÆK = BE6122, BY NAME;                              
                                                                        
         IF BE6122.EKOMNUM = 999                                        
         THEN                                                           
            DO;                                /* UDENLANDSK EJENDOM */ 
               TV.FUDLANDSK = TV.FUDLANDSK + 1;                         
               CALL OPRET_FRA_EVS;                                      
            END;                                                        
         ELSE                             /* IKKE UDENLANDSK EJENDOM */ 
            TV.FØVREVS = TV.FØVREVS + 1;                                
                                                                        
 END BEHANDL_EVS_UDTRÆK;                                                
                                                                        
 /********************************************************************* 
 *       BEHANDLING AF INDIVID FRA EVS UDTRÆK D.V.S.                  * 
 *       NYE KØBERE KUN I EVS ELLER UDENLANDSKE EJENDOMME             * 
 *********************************************************************/ 
 OPRET_FRA_EVS: PROC;                                                   
                                                                        
    BE60101M = '';                                                      
    BE900 = '';                                                         
                                                                        
    BE900.EVS_UDTRÆK = GEM.EVS_UDTRÆK, BY NAME;                         
                                                                        
    BE900.SORT_CPR   = GEM.EVS_UDTRÆK.DCPRNUM;                          
    BE900.SORT_KOMNR = GEM.EVS_UDTRÆK.EKOMNUM;                          
    BE900.SORT_EJDNR = GEM.EVS_UDTRÆK.EEJDNUM;                          
    BE900.SORT_ENHEDLBNR = GEM.EVS_UDTRÆK.EENHEDLBNUM;                  
                                                                        
                                                                        
    BE900.SORT_CITYP = 0;                                               
                                                                        
    BE900.CINVPNR = '0'; /* PERSONNR. ER VALIDT */                      
                                                                        
    BE900.TIL_EVS.CPTYPSLUT = '1'; /* PERSONTYPE = ALM. PERSON */       
    BE900.TIL_EVS.CPTYPFOR = '1';  /* D.V.S. DEFAULT OPSAT     */       
                                                                        
    SELECT;                                                             
      WHEN (BE900.EVS_SLUT_EJER.DCPRN        >  0    &                  
            BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1')                     
        DO;                                                             
          BE900.EJENDOM.EJDBELIG = BE900.EVS_SLUT_EJER.EJDBELIG;        
          BE900.EJENDOM.CEJDTYPE = BE900.EVS_SLUT_EJER.SIDSTE.CEJDTYPE; 
          BE900.TIL_FORSKUD.COPR_CEJDTYPE = 'S';                        
          BE900.EJENDOM.CLANDEKODE = BE900.EVS_SLUT_EJER.CLANDEKODE;    
          IF BE900.EJENDOM.CLANDEKODE = 'FR' &                          
             BE900.EVS_SLUT_EJER.SIDSTE.CEKSEMP = ' '                   
          THEN                                                          
            DO;                                                         
              IF  BE900.EVS_SLUT_EJER.SIDSTE.DOVTG = '0'                
               &  BE900.EVS_SLUT_EJER.FØRSTE.CSUPPL= '4'                
              THEN                                                      
                  BE900.EJENDOM.CLANDEKODE = 'F2';                      
              ELSE                                                      
                DO;                                                     
                  IF BE900.EVS_SLUT_EJER.SIDSTE.DOVTG > '20071128'      
                  THEN                                                  
                     BE900.EJENDOM.CLANDEKODE = 'F2';                   
                  ELSE                                                  
                     BE900.EJENDOM.CLANDEKODE = 'F1';                   
                END;                                                    
           END;                                                         
          /* D1081 */                                                   
          BE900.EJENDOM.VEJK_EJD    = BE900.EVS_SLUT_EJER.VEJK_EJD;     
          BE900.EJENDOM.HUSNR_EJD   = BE900.EVS_SLUT_EJER.HUSNR_EJD;    
          BE900.EJENDOM.ETAGE_EJD   = BE900.EVS_SLUT_EJER.ETAGE_EJD;    
          BE900.EJENDOM.SDØR_EJD    = BE900.EVS_SLUT_EJER.SDØR_EJD;     
          BE900.EJENDOM.ENHEDBELIG  = BE900.EVS_SLUT_EJER.ENHEDBELIG;   
          BE900.EJENDOM.VEJK_ENHED  = BE900.EVS_SLUT_EJER.VEJK_ENHED;   
          BE900.EJENDOM.HUSNR_ENHED = BE900.EVS_SLUT_EJER.HUSNR_ENHED;  
          BE900.EJENDOM.ETAGE_ENHED = BE900.EVS_SLUT_EJER.ETAGE_ENHED;  
          BE900.EJENDOM.SDØR_ENHED  = BE900.EVS_SLUT_EJER.SDØR_ENHED;   
        END;                                                            
      WHEN (BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                             
            BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1')                     
        DO;                                                             
          BE900.EJENDOM.EJDBELIG = BE900.EVS_SLUT_ÆGTF.EJDBELIG;        
          BE900.EJENDOM.CEJDTYPE = BE900.EVS_SLUT_ÆGTF.SIDSTE.CEJDTYPE; 
          BE900.TIL_FORSKUD.COPR_CEJDTYPE = 'S';                        
          BE900.EJENDOM.CLANDEKODE =  BE900.EVS_SLUT_ÆGTF.CLANDEKODE;   
          IF BE900.EJENDOM.CLANDEKODE = 'FR' &                          
             BE900.EVS_SLUT_ÆGTF.SIDSTE.CEKSEMP = ' '                   
          THEN                                                          
             DO;                                                        
                IF BE900.EVS_SLUT_ÆGTF.SIDSTE.DOVTG > '20071128'        
                THEN                                                    
                   BE900.EJENDOM.CLANDEKODE = 'F2';                     
                ELSE                                                    
                   BE900.EJENDOM.CLANDEKODE = 'F1';                     
             END;                                                       
          /* D1081 */                                                   
          BE900.EJENDOM.VEJK_EJD    = BE900.EVS_SLUT_ÆGTF.VEJK_EJD;     
          BE900.EJENDOM.HUSNR_EJD   = BE900.EVS_SLUT_ÆGTF.HUSNR_EJD;    
          BE900.EJENDOM.ETAGE_EJD   = BE900.EVS_SLUT_ÆGTF.ETAGE_EJD;    
          BE900.EJENDOM.SDØR_EJD    = BE900.EVS_SLUT_ÆGTF.SDØR_EJD;     
          BE900.EJENDOM.ENHEDBELIG  = BE900.EVS_SLUT_ÆGTF.ENHEDBELIG;   
          BE900.EJENDOM.VEJK_ENHED  = BE900.EVS_SLUT_ÆGTF.VEJK_ENHED;   
          BE900.EJENDOM.HUSNR_ENHED = BE900.EVS_SLUT_ÆGTF.HUSNR_ENHED;  
          BE900.EJENDOM.ETAGE_ENHED = BE900.EVS_SLUT_ÆGTF.ETAGE_ENHED;  
          BE900.EJENDOM.SDØR_ENHED  = BE900.EVS_SLUT_ÆGTF.SDØR_ENHED;   
        END;                                                            
      WHEN (BE900.EVS_FORSK_EJER.DCPRN > 0)                             
        DO;                                                             
          BE900.EJENDOM.EJDBELIG = BE900.EVS_FORSK_EJER.EJDBELIG;       
          BE900.EJENDOM.CEJDTYPE = BE900.EVS_FORSK_EJER.CEJDTYPE;       
          BE900.TIL_FORSKUD.COPR_CEJDTYPE = 'F';                        
          BE900.EJENDOM.CLANDEKODE =  BE900.EVS_FORSK_EJER.CLANDEKODE;  
          IF BE900.EJENDOM.CLANDEKODE = 'FR'  &                         
             BE900.EVS_FORSK_EJER.CEKSEMP = ' '                         
          THEN                                                          
             BE900.EJENDOM.CLANDEKODE = 'F2';                           
          /* D1081 */                                                   
          BE900.EJENDOM.VEJK_EJD    = BE900.EVS_FORSK_EJER.VEJK_EJD;    
          BE900.EJENDOM.HUSNR_EJD   = BE900.EVS_FORSK_EJER.HUSNR_EJD;   
          BE900.EJENDOM.ETAGE_EJD   = BE900.EVS_FORSK_EJER.ETAGE_EJD;   
          BE900.EJENDOM.SDØR_EJD    = BE900.EVS_FORSK_EJER.SDØR_EJD;    
          BE900.EJENDOM.ENHEDBELIG  = BE900.EVS_FORSK_EJER.ENHEDBELIG;  
          BE900.EJENDOM.VEJK_ENHED  = BE900.EVS_FORSK_EJER.VEJK_ENHED;  
          BE900.EJENDOM.HUSNR_ENHED = BE900.EVS_FORSK_EJER.HUSNR_ENHED; 
          BE900.EJENDOM.ETAGE_ENHED = BE900.EVS_FORSK_EJER.ETAGE_ENHED; 
          BE900.EJENDOM.SDØR_ENHED  = BE900.EVS_FORSK_EJER.SDØR_ENHED;  
        END;                                                            
      OTHERWISE;                                                        
    END;  /* SELECT */                                                  
                                                                        
    IF BE900.EVS_FORSK_EJER.DCPRN > 0 &                                 
       BE900.EJENDOM.CEJDTYPE < '1'                                     
    THEN                                                                
       DO;                                                              
          BE900.EJENDOM.EJDBELIG = BE900.EVS_FORSK_EJER.EJDBELIG;       
          BE900.EJENDOM.CEJDTYPE = BE900.EVS_FORSK_EJER.CEJDTYPE;       
          BE900.TIL_FORSKUD.COPR_CEJDTYPE = 'F';                        
       END;                                                             
                                                                        
      /* HVIS EJENDOMSOPLYSN. ER TAGET FRA SLUT, MEN LANDEKODEN ER */   
      /* FRA FORSKUD, SKAL DET VÆRE F1, UDEN AT SPØRGE PÅ DATO     */   
                                                                        
    IF BE900.EVS_FORSK_EJER.DCPRN > 0 &                                 
       BE900.EJENDOM.CLANDEKODE = ' '                                   
    THEN                                                                
       DO;                                                              
          BE900.EJENDOM.CLANDEKODE =  BE900.EVS_FORSK_EJER.CLANDEKODE;  
          IF BE900.EJENDOM.CLANDEKODE = 'FR'                            
          THEN                                                          
             BE900.EJENDOM.CLANDEKODE = 'F1';                           
       END;                                                             
                                                                        
         /* EJENDOMSTYPE OG LAND MÅ KUN HENTES FRA SLUT ELLER FORSKUD */
         /* HVIS DER ER TALE OM EN UDENLANDSK EJENDOM                 */
                                                                        
    IF BE900.SORT_KOMNR ^= 999 !                                        
       BE900.EJENDOM.CEJDTYPE < '1'                                     
    THEN                                                                
       DO;                                                              
         BE900.TIL_FORSKUD.COPR_CEJDTYPE = ' ';                         
         BE900.EJENDOM.CEJDTYPE = ' ';                                  
       END;                                                             
                                                                        
    CALL SKRIV_PERSON;                                                  
                                                                        
    GEM = '';                                                           
                                                                        
 END OPRET_FRA_EVS;                                                     
 /********************************************************************* 
 *       BEHANDLING AF INDIVID FRA EVS UDTRÆK                         * 
 *********************************************************************/ 
 BEHANDL_EVS_TILGANG: PROC;                                             
                                                                        
         TV.FEVSOPRET = TV.FEVSOPRET + 1;                               
                                                                        
         CALL OPRET_FRA_EVS;                                            
                                                                        
 END BEHANDL_EVS_TILGANG;                                               
                                                                        
 /*********************************************************************/
 /*          OPRET EVT. ÆGTEFÆLLE SOM 'NY' ESR-EJER NÅR DER ER FORE-  */
 /*          TAGET ÆGTEFÆLLEFORDELING I EVS SLUT GL. ÅR, OG/ELLER RET */
 /*          ESR-EJERANDEL FOR ÆGTEFÆLLER JVF. EJERANDEL FRA EVS SLUT */
 /*          GL. ÅR (ANTAL EJERE OG CEJ_100 RETTES EVT. OGSÅ).        */
 /*                                                                   */
 /*          FUNKTIONEN UDFØRES KUN HVIS DEN SAMLEDE EJERANDEL JVF.   */
 /*          ESR OG GL. SLUTÅR STEMMER OVERENS SAMT  H V I S          */
 /*          ÆGTEFÆLLERNE ER SAMBESKATTET I BÅDE GL. OG NYT SLUTÅR.   */
 /*********************************************************************/
 OPSÆT_ÆGTF_FORDEL: PROC;                                               
                                                                        
 DCL ESR_SUM FIXED (5);                                                 
 DCL ESR_ANT FIXED (5);                                                 
 DCL EVS_SUM FIXED (5);                                                 
 DCL EVS_ANT FIXED (5);                                                 
                                                                        
         ESR_SUM = 0;                                                   
         ESR_ANT = 0;                                                   
         EVS_SUM = 0;                                                   
         EVS_ANT = 0;                                                   
                                                                        
         IF BE900.ESR.SORTCPR = 0                                       
         THEN                                                           
            RETURN;   /* INGEN EJERE JVF. ESR */                        
                                                                        
         /* KONTROLLER OM DE INVOLVEREDE ÆGTEFÆLLER ER              */  
         /* INDBERETTET MED KODE FOR ÆGTEFÆLLEFORDELING I GL.SLUTÅR */  
         /* DA DE ELLERS IKKE SKAL BEHANDLES HER.                   */  
                                                                        
         IF BE900.EVS_SLUT_EJER.SIDSTE.CÆGTOPR > '0' &                  
            BE900.EVS_SLUT_ÆGTF.SIDSTE.CÆGTOPR > '0'                    
         THEN;                                                          
         ELSE                                                           
            RETURN;                                                     
                                                                        
         IF (BE900.ESR.CSBSK = '2' !                                    
             BE900.ESR.CSBSK = '3' !                                    
             BE900.ESR.CSBSK = '5' !                                    
             BE900.ESR.CSBSK = '6') &                                   
            (BE900.EVS_UDTRÆK.CSBSK = '2' !                             
             BE900.EVS_UDTRÆK.CSBSK = '3' !                             
             BE900.EVS_UDTRÆK.CSBSK = '5' !                             
             BE900.EVS_UDTRÆK.CSBSK = '6')                              
         THEN;                                                          
         ELSE                                                           
            RETURN;   /* ÆGTEFÆLLERNE ER IKKE SAMBESKAT- */             
                      /* TET I BÅDE GL. OG NYT SLUTÅR    */             
                                                                        
         IF BE900.ESR.EJER.DCPRCIR > 0 &                                
           (BE900.ESR.EJER.DAFSTÅ > 0 &                                 
            BE900.ESR.EJER.DAFSTÅ <= BE900.ESR.EJER.DRGNÅRTIL)          
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF (BE900.ESR.EJER.DCPRCIR > 0 &                               
             BE900.ESR.ÆGTF.DCPRCIR > 0) &                              
            (BE900.ESR.EJER.DAFSTÅ > 0 &                                
             BE900.ESR.EJER.DAFSTÅ <= BE900.ESR.ÆGTF.DRGNÅRTIL)         
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.ESR.EJER.DCPRCIR > 0 &                                
            BE900.ESR.EJER.DOVTG > BE900.ESR.EJER.DRGNÅRFRA             
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF (BE900.ESR.EJER.DCPRCIR > 0 &                               
             BE900.ESR.ÆGTF.DCPRCIR > 0) &                              
            BE900.ESR.EJER.DOVTG > BE900.ESR.ÆGTF.DRGNÅRFRA             
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF (BE900.ESR.EJER.DCPRCIR > 0 &                               
             BE900.ESR.ÆGTF.DCPRCIR > 0) &                              
            (BE900.ESR.ÆGTF.DAFSTÅ > 0 &                                
             BE900.ESR.ÆGTF.DAFSTÅ <= BE900.ESR.EJER.DRGNÅRTIL)         
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.ESR.ÆGTF.DCPRCIR > 0 &                                
           (BE900.ESR.ÆGTF.DAFSTÅ > 0 &                                 
            BE900.ESR.ÆGTF.DAFSTÅ <= BE900.ESR.ÆGTF.DRGNÅRTIL)          
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF (BE900.ESR.EJER.DCPRCIR > 0 &                               
             BE900.ESR.ÆGTF.DCPRCIR > 0) &                              
            BE900.ESR.ÆGTF.DOVTG > BE900.ESR.EJER.DRGNÅRFRA             
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.ESR.ÆGTF.DCPRCIR > 0 &                                
            BE900.ESR.ÆGTF.DOVTG > BE900.ESR.ÆGTF.DRGNÅRFRA             
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.EVS_SLUT_EJER.DCPRN > 0 &                             
            BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                    
            BE900.EVS_SLUT_EJER.SIDSTE.DAFSTAA > 0                      
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                             
            BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &                    
            BE900.EVS_SLUT_ÆGTF.SIDSTE.DAFSTAA > 0                      
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.EVS_SLUT_EJER.DCPRN > 0 &                             
            BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                    
            BE900.EVS_SLUT_EJER.SIDSTE.DOVTG >                          
            BE900.EVS_SLUT_EJER.SIDSTE.DRGNÅRFRA                        
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                             
            BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &                    
            BE900.EVS_SLUT_ÆGTF.SIDSTE.DOVTG >                          
            BE900.EVS_SLUT_ÆGTF.SIDSTE.DRGNÅRFRA                        
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF BE900.EVS_SLUT_EJER.DCPRN > 0 &                             
            BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                    
            //BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' & US1549418     
            BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0                  
         THEN                                                           
            DO;                                                         
               EVS_ANT = EVS_ANT + 1;                                   
               EVS_SUM = EVS_SUM +                                      
               BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100;               
            END;                                                        
                                                                        
         IF BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                             
            BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &                    
            //BE900.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS ^= '9' & US1549418     
            BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER_SW = 0                  
         THEN                                                           
            DO;                                                         
               EVS_ANT = EVS_ANT + 1;                                   
               EVS_SUM = EVS_SUM +                                      
               BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER * 100;               
            END;                                                        
                                                                        
         IF BE900.ESR.EJER.DCPRCIR > 0 &                                
            BE900.ESR.EJER.GANE ^= 0                                    
         THEN                                                           
            DO;                                                         
               ESR_SUM = ESR_SUM + BE900.ESR.EJER.GANE;                 
               ESR_ANT = ESR_ANT + 1;                                   
            END;                                                        
                                                                        
         IF BE900.ESR.ÆGTF.DCPRCIR > 0 &                                
            BE900.ESR.ÆGTF.GANE ^= 0                                    
         THEN                                                           
            DO;                                                         
               ESR_SUM = ESR_SUM + BE900.ESR.ÆGTF.GANE;                 
               ESR_ANT = ESR_ANT + 1;                                   
            END;                                                        
                                                                        
         IF ESR_SUM ^= EVS_SUM                                          
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF EVS_ANT = 0 !                                               
            EVS_SUM = 0                                                 
         THEN                                                           
            RETURN;                                                     
                                                                        
         IF ESR_ANT = EVS_ANT &                                         
            ESR_ANT = 2                                                 
         THEN                                                           
            DO;                                                         
               IF BE900.EVS_SLUT_EJER.DCPRN = BE900.ESR.EJER.DCPRCIR &  
                  BE900.EVS_SLUT_ÆGTF.DCPRN = BE900.ESR.ÆGTF.DCPRCIR    
               THEN;                                                    
               ELSE                                                     
                  RETURN;                                               
               /* BEHANDL PERSONER SOM ER ÆGTEFÆLLER   */               
               /* BÅDE I GL. SLUTÅR SAMT I NYT SLUTÅR. */               
               IF (BE900.ESR.EJER.GANE =                                
                   BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100) &         
                  (BE900.ESR.ÆGTF.GANE =                                
                   BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER * 100)           
               THEN;                                                    
               ELSE                                                     
                  DO;                                                   
                     BE900.AKT_EJER.GANE =                              
                     BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100;         
                     BE900.AKT_ÆGTF.GANE =                              
                     BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER * 100;         
                     //BE900.TIL_EVS.CÆGTOPR = '4';                     
                     TV.ÆGTF_OPRET = TV.ÆGTF_OPRET + 1;                 
                  END;                                                  
               RETURN;                                                  
            END;                                                        
                                                                        
         /* KONTROLLER OM DE INVOLVEREDE PERSONER ER ÆGTEFÆLLER */      
         /* BÅDE I GL. SLUTÅR SAMT I NYT SLUTÅR.                */      
                                                                        
         IF (BE900.EVS_SLUT_EJER.DCPRN > 0 &                            
             BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                            
             BE900.ESR.EJER.DCPRCIR > 0 &                               
             BE900.EVS_SLUT_EJER.DCPRN = BE900.ESR.EJER.DCPRCIR) !      
            (BE900.EVS_SLUT_EJER.DCPRN > 0 &                            
             BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                            
             BE900.ESR.ÆGTF.DCPRCIR > 0 &                               
             BE900.EVS_SLUT_ÆGTF.DCPRN = BE900.ESR.ÆGTF.DCPRCIR)        
         THEN;                                                          
         ELSE                                                           
            RETURN;                                                     
                                                                        
         /* BEHANDL PERSONER HVOR DER ER FORETAGET */                   
         /* ÆGTEFÆLLEFORDELING I GL. SLUTÅR        */                   
                                                                        
         IF ESR_ANT = EVS_ANT &                                         
            ESR_ANT = 1                                                 
         THEN                                                           
            DO;             /* KUN EEN EJER BÅDE I ESR OG GL. SLUTÅR */ 
               CALL BEHANDL_KUN_EEN_EJER;                               
               RETURN;                                                  
            END;                                                        
                                                                        
         IF EVS_ANT = 1                                                 
         THEN                                                           
            DO;     /* KUN DEN ENE ÆGTEFÆLLE ER EJER JVF. GL. SLUTÅR */ 
                    /* MEN BEGGE JVF. ESR                            */ 
               CALL BEHANDL_EN_EJER;                                    
               RETURN;                                                  
            END;                                                        
                                                                        
 /*********************************************************************/
 /*      BEGGE ÆGTEFÆLLER ER EJERE JVF. GL. SLUTÅR                    */
 /*      MEN KUN DEN ENE JVF. ESR                                     */
 /*********************************************************************/
                                                                        
         SELECT;                                                        
           WHEN (BE900.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BE900.AKT_EJER.DCPRCIR > 0)                            
             DO;                                                        
                BE900.AKT_EJER.GANE =                                   
                BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100;              
                IF BE900.AKT_EJER.FEJER > 0                             
                THEN                                                    
                   DO;                                                  
                      BE900.AKT_EJER.CEJ_100 = '1';                     
                      BE900.AKT_EJER.FEJER = BE900.AKT_EJER.FEJER + 1;  
                   END;                                                 
                BE900.AKT_ÆGTF = BE900.AKT_EJER, BY NAME;               
                BE900.AKT_ÆGTF.DCPRCIR =                                
                BE900.EVS_SLUT_ÆGTF.DCPRN;                              
                BE900.AKT_ÆGTF.GANE =                                   
                BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER * 100;              
                //BE900.TIL_EVS.CÆGTOPR = '4';                          
                TV.ÆGTF_OPRET = TV.ÆGTF_OPRET + 1;                      
             END;                                                       
                                                                        
           WHEN (BE900.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BE900.AKT_EJER.DCPRCIR = 0)                            
             DO;                                                        
                BE900.AKT_ÆGTF.GANE =                                   
                BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER * 100;              
                IF BE900.AKT_ÆGTF.FEJER > 0                             
                THEN                                                    
                   DO;                                                  
                      BE900.AKT_ÆGTF.CEJ_100 = '1';                     
                      BE900.AKT_ÆGTF.FEJER = BE900.AKT_ÆGTF.FEJER + 1;  
                   END;                                                 
                BE900.AKT_EJER = BE900.AKT_ÆGTF, BY NAME;               
                BE900.AKT_EJER.DCPRCIR =                                
                BE900.EVS_SLUT_EJER.DCPRN;                              
                BE900.AKT_EJER.GANE =                                   
                BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100;              
                //BE900.TIL_EVS.CÆGTOPR = '3';                          
                TV.EJER_OPRET = TV.EJER_OPRET + 1;                      
             END;                                                       
                                                                        
           OTHERWISE                                                    
             DO;                                                        
                TV.ÆGTFOPR_FEJL = TV.ÆGTFOPR_FEJL + 1;                  
                PUT DATA(BE900.SORT_CPR,                                
                         BE900.SORT_KOMNR,                              
                         BE900.SORT_EJDNR);                             
                /* MÅ IKKE FORKOMME? - OPTÆL ANTAL? */                  
             END;                                                       
                                                                        
         END; /* SELECT */                                              
                                                                        
 /*********************************************************************/
 /* KUN DEN ENE ÆGTEFÆLLE ER EJER JVF. GL. SLUTÅR MEN BEGGE JVF. ESR  */
 /*********************************************************************/
 BEHANDL_EN_EJER: PROC;                                                 
                                                                        
         SELECT;                                                        
          WHEN (BE900.EVS_SLUT_EJER.DCPRN > 0 &                         
          //BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' & US1549418       
                BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1')                 
            DO;                                                         
               BE900.AKT_ÆGTF = '';                                     
               BE900.AKT_EJER.GANE =                                    
               BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100;               
               IF BE900.AKT_EJER.GANE = 10000                           
               THEN                                                     
                 DO;                                                    
                   BE900.AKT_EJER.CEJ_100 = '1';                        
                   BE900.AKT_EJER.FEJER = 1;                            
                 END;                                                   
               ELSE                                                     
                 IF BE900.AKT_EJER.FEJER > 1                            
                 THEN                                                   
                    BE900.AKT_EJER.FEJER =                              
                    BE900.AKT_EJER.FEJER - 1;                           
               //BE900.TIL_EVS.CÆGTOPR = '4';                           
               TV.ÆGTF_OPRET = TV.ÆGTF_OPRET + 1;                       
            END;                                                        
                                                                        
          WHEN (BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                         
          //BE900.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS ^= '9' & US1549418       
                BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1')                 
            DO;                                                         
               BE900.AKT_EJER.GANE = 0;                                 
               BE900.TIL_EVS.CEJBEVS = '9';                             
               BE900.AKT_ÆGTF.GANE =                                    
               BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER * 100;               
               IF BE900.AKT_ÆGTF.GANE = 10000                           
               THEN                                                     
                 DO;                                                    
                   BE900.AKT_ÆGTF.CEJ_100 = '1';                        
                   BE900.AKT_ÆGTF.FEJER = 1;                            
                 END;                                                   
               ELSE                                                     
                 IF BE900.AKT_ÆGTF.FEJER > 1                            
                 THEN                                                   
                    BE900.AKT_ÆGTF.FEJER =                              
                    BE900.AKT_ÆGTF.FEJER - 1;                           
               //BE900.TIL_EVS.CÆGTOPR = '4';                           
               TV.EJER_SLETTET = TV.EJER_SLETTET + 1;                   
            END;                                                        
                                                                        
          OTHERWISE                                                     
            DO;                                                         
               TV.ÆGTFOPR_FEJL = TV.ÆGTFOPR_FEJL + 1;                   
               PUT DATA(BE900.SORT_CPR,                                 
                        BE900.SORT_KOMNR,                               
                        BE900.SORT_EJDNR);                              
               /* MÅ IKKE FORKOMME? - OPTÆL ANTAL? */                   
            END;                                                        
                                                                        
         END; /* SELECT */                                              
                                                                        
 END BEHANDL_EN_EJER;                                                   
                                                                        
 /*********************************************************************/
 /* KUN DEN EEN EJER JVF. BÅDE ESR OG GL. SLUTÅR                      */
 /*********************************************************************/
 BEHANDL_KUN_EEN_EJER: PROC;                                            
                                                                        
         SELECT;                                                        
          WHEN ((BE900.EVS_SLUT_EJER.DCPRN > 0 &                        
          // BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' & US1549418      
                 BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1') &              
                 BE900.EVS_SLUT_EJER.DCPRN = BE900.ESR.EJER.DCPRCIR)    
            DO;                                                         
               TV.SAMME_EJER = TV.SAMME_EJER + 1;                       
            END;                                                        
                                                                        
          WHEN ((BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                        
          // BE900.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS ^= '9' & US1549418      
                 BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1') &              
                 BE900.EVS_SLUT_ÆGTF.DCPRN = BE900.ESR.ÆGTF.DCPRCIR)    
            DO;                                                         
               TV.KUN_ÆGTF = TV.KUN_ÆGTF + 1;                           
            END;                                                        
                                                                        
          WHEN (BE900.EVS_SLUT_EJER.DCPRN > 0 &                         
          // BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' &  US1549418     
                BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1')                 
            DO;                                                         
               BE900.AKT_EJER = AKT_ÆGTF, BY NAME;                      
               BE900.AKT_ÆGTF = '';                                     
               BE900.AKT_EJER.DCPRCIR =                                 
               BE900.EVS_SLUT_EJER.DCPRN;                               
               BE900.AKT_EJER.GANE =                                    
               BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100;               
               IF BE900.AKT_EJER.GANE = 10000                           
               THEN                                                     
                 DO;                                                    
                   BE900.AKT_EJER.CEJ_100 = '1';                        
                   BE900.AKT_EJER.FEJER = 1;                            
                 END;                                                   
               //BE900.TIL_EVS.CÆGTOPR = '3';                           
               TV.EJER_OPRET = TV.EJER_OPRET + 1;                       
            END;                                                        
                                                                        
          WHEN (BE900.EVS_SLUT_ÆGTF.DCPRN > 0 &                         
          // BE900.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS ^= '9' & US1549418      
                BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1')                 
            DO;                                                         
               BE900.AKT_ÆGTF = AKT_EJER, BY NAME;                      
               BE900.AKT_EJER.GANE = 0;                                 
               BE900.AKT_ÆGTF.DCPRCIR =                                 
               BE900.EVS_SLUT_ÆGTF.DCPRN;                               
               BE900.AKT_ÆGTF.GANE =                                    
               BE900.EVS_SLUT_ÆGTF.SIDSTE.GPCTEJER * 100;               
               IF BE900.AKT_ÆGTF.GANE = 10000                           
               THEN                                                     
                 DO;                                                    
                   BE900.AKT_ÆGTF.CEJ_100 = '1';                        
                   BE900.AKT_ÆGTF.FEJER = 1;                            
                 END;                                                   
               //BE900.TIL_EVS.CÆGTOPR = '4';                           
               BE900.TIL_EVS.CEJBEVS = '9';                             
               TV.EJER_SLETTET = TV.EJER_SLETTET + 1;                   
            END;                                                        
                                                                        
          OTHERWISE                                                     
            DO;                                                         
               TV.ÆGTFOPR_FEJL = TV.ÆGTFOPR_FEJL + 1;                   
               PUT DATA(BE900.SORT_CPR,                                 
                        BE900.SORT_KOMNR,                               
                        BE900.SORT_EJDNR);                              
               /* MÅ IKKE FORKOMME? - OPTÆL ANTAL? */                   
            END;                                                        
                                                                        
         END; /* SELECT */                                              
                                                                        
 END BEHANDL_KUN_EEN_EJER;                                              
                                                                        
 END OPSÆT_ÆGTF_FORDEL;                                                 
                                                                        
 /********************************************************************* 
 *       ALLE INDIVIDER SKRIVES A.H.T. OPDATERING AF EVS EJD.TABEL    * 
 *********************************************************************/ 
 SKRIV_PERSON: PROC;                                                    
                                                                        
         BE900.CEANV = ' ';          /* SLUT 2012 LKA */                
         BE900.CEANV = BE6121.CEANV; /* SLUT 2012 LKA */                
                                                                        
         IF BE900.SORT_KOMNR < 999 &                                    
            BE900.AKT_ÆGTF.DCPRCIR > 0 &                                
            BE900.AKT_ÆGTF.DCPRCIR = BE900.EVS_SLUT_ÆGTF.DCPRN &        
           (BE900.EVS_SLUT_ÆGTF.SIDSTE.BOBEHAKOD = 'B' !                
            BE900.EVS_SLUT_ÆGTF.SIDSTE.BOBEHAKOD = 'D') &               
            BE900.EVS_SLUT_ÆGTF.SIDSTE.CSLET < '1' &                    
         // BE900.EVS_SLUT_ÆGTF.SIDSTE.CEJBEVS < '9' & US1549418        
            BE900.AKT_ÆGTF.DAFSTÅ  = 0 &                                
            BE900.AKT_EJER.DAFSTÅ  = 0 &                                
          ((BE900.AKT_EJER.GANE + BE900.AKT_ÆGTF.GANE) <= 10000)        
         THEN                                                           
            DO;                                                         
               SELECT;                                                  
                 WHEN (BE900.AKT_ÆGTF.DCPRCIR > 0 &                     
                       BE900.AKT_EJER.DCPRCIR = 0)                      
                   DO;                                                  
                      /* KUN AFDØDE EJER EJENDOMMEN JVF. ESR */         
                      BE900.AKT_EJER = BE900.AKT_ÆGTF, BY NAME;         
                      BE900.AKT_EJER.DCPRCIR = BE900.SORT_CPR;          
                      BE900.AKT_ÆGTF = '';                              
                      TV.OPR_EFTERLEV = TV.OPR_EFTERLEV + 1;            
                      BE900.TIL_EVS.CDATAFRA = '4';                     
                   END;                                                 
                 OTHERWISE                                              
                   DO;                                                  
                      /* BÅDE AFDØDE OG EFTERLEVENDE ÆGTEFÆLLE */       
                      /* EJER EJENDOMMEN JVF. ESR              */       
                      BE900.AKT_EJER.GANE =                             
                      BE900.AKT_EJER.GANE + BE900.AKT_ÆGTF.GANE;        
                      BE900.AKT_ÆGTF = '';                              
                                                                        
                      IF BE900.AKT_EJER.GANE = 10000                    
                      THEN                                              
                        DO;                                             
                          BE900.AKT_EJER.CEJ_100 = '1';                 
                          BE900.AKT_EJER.FEJER = 1;                     
                        END;                                            
                      ELSE                                              
                        IF BE900.AKT_EJER.FEJER > 1                     
                        THEN                                            
                           BE900.AKT_EJER.FEJER =                       
                           BE900.AKT_EJER.FEJER - 1;                    
                                                                        
                      TV.RET_EFTERLEV = TV.RET_EFTERLEV + 1;            
                      BE900.TIL_EVS.CDATAFRA = '4';                     
                   END;                                                 
               END; /* SELECT */                                        
            END;                                                        
                                                                        
         /* CHECK OM INDENLANDSK EJENDOM SKAL VIDEREFØRES */            
         /* PÅ GRUNDLAG AF SLUT                           */            
         CALL CHECK_OM_EJD_VIDERE;                                      
         IF EJENDOM_VIDERE = JA                                         
         THEN                                                           
            DO;                                                         
               BE900.AKT_EJER.DCPRCIR = BE900.EVS_SLUT_EJER.DCPRN;      
               BE900.AKT_EJER.DOVTG = BE900.EVS_SLUT_EJER.SIDSTE.DOVTG; 
               BE900.AKT_EJER.DOVTG_GL = BE900.AKT_EJER.DOVTG;          
               BE900.AKT_EJER.CEJFORH = '10';                           
               BE900.AKT_EJER.CEJ_100 = '1';                            
                                                                        
               IF BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0            
               THEN                                                     
                  BE900.AKT_EJER.GANE =                                 
                  BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER * 100;            
                                                                        
               IF BE900.AKT_EJER.GANE = 10000                           
               THEN                                                     
                  BE900.AKT_EJER.FEJER = 1;                             
                                                                        
               SELECT (BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA);            
                 WHEN ('1','5')                                         
                   BE900.TIL_EVS.CDATAFRA = '5';                        
                 WHEN ('4')                                             
                   BE900.TIL_EVS.CDATAFRA = '4';                        
                 WHEN ('2')                                             
                   BE900.TIL_EVS.CDATAFRA = '2';                        
                 OTHERWISE                                              
                   BE900.TIL_EVS.CDATAFRA = '1';                        
               END;                                                     
                                                                        
               BE900.TIL_EVS.C5060 = '5060';                            
               TV.OPR_SLUT_EJER = TV.OPR_SLUT_EJER + 1;                 
            END;                                                        
                                                                        
         BE900.CPENS_TESR = '-';                                        
                                                                        
         SELECT;                                                        
                                                                        
           WHEN (BE900.AKT_EJER.DCPRCIR > 0)                            
            DO;                                                         
             BE900.TIL_EVS.DOVTG = BE900.AKT_EJER.DOVTG;                
             BE900.TIL_FORSKUD.COPR_DOVTG = 'E';                        
             IF BE900.AKT_EJER.DAFSTÅ > 0                               
             THEN                                                       
                DO;                                                     
                   BE900.TIL_EVS.DAFSTAA = BE900.AKT_EJER.DAFSTÅ;       
                   BE900.TIL_FORSKUD.COPR_DAFSTAA = 'E';                
                END;                                                    
            END;                                                        
                                                                        
           WHEN (BE900.EVS_SLUT_EJER.DCPRN > 0 &                        
                 BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1')                
            DO;                                                         
             BE900.TIL_EVS.DOVTG = BE900.EVS_SLUT_EJER.SIDSTE.DOVTG;    
             BE900.TIL_FORSKUD.COPR_DOVTG = 'S';                        
             IF BE900.EVS_SLUT_EJER.SIDSTE.DAFSTAA > 0                  
             THEN                                                       
                DO;                                                     
                   BE900.TIL_EVS.DAFSTAA =                              
                                  BE900.EVS_SLUT_EJER.SIDSTE.DAFSTAA;   
                   BE900.TIL_FORSKUD.COPR_DAFSTAA = 'S';                
                END;                                                    
            END;                                                        
                                                                        
           WHEN (BE900.EVS_FORSK_EJER.DCPRN > 0)                        
            DO;                                                         
             BE900.TIL_EVS.DOVTG = BE900.EVS_FORSK_EJER.DOVTG;          
             BE900.TIL_FORSKUD.COPR_DOVTG = 'F';                        
             IF BE900.EVS_FORSK_EJER.DAFSTAA > 0                        
             THEN                                                       
                DO;                                                     
                   BE900.TIL_EVS.DAFSTAA =                              
                               BE900.EVS_FORSK_EJER.DAFSTAA;            
                   BE900.TIL_FORSKUD.COPR_DAFSTAA = 'F';                
                END;                                                    
            END;                                                        
                                                                        
           OTHERWISE;                                                   
                                                                        
         END; /* SELECT */                                              
                                                                        
         IF BE900.TIL_EVS.DAFSTAA > 0                                   
         THEN                                                           
            BE900.SORT_DATO = BE900.TIL_EVS.DAFSTAA;                    
         ELSE                                                           
            BE900.SORT_DATO = 99991231;                                 
                                                                        
         IF (BE900.SORT_KOMNR = 999 &                                   
             BE900.EVS_FORSK_EJER.DCPRN > 0 &                           
                                                                        
             BE900.EVS_SLUT_EJER.DCPRN = 0      ) !                     
             //BE900.EVS_SLUT_EJER.DCPRN = 0 &          US1549418       
             //BE900.EVS_FORSK_EJER.CEJBEVS ^= '9') !                   
                                                                        
            (BE900.SORT_KOMNR = 999 &                                   
             BE900.EVS_SLUT_EJER.DCPRN > 0 &                            
             BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                   
             BE900.EVS_SLUT_EJER.SIDSTE.DAFSTAA = 0) !                  
                                                                        
            (BE900.SORT_KOMNR < 999 &                                   
             BE900.AKT_EJER.DCPRCIR = 0 &                               
                                                                        
             BE900.EVS_FORSK_EJER.DCPRN > 0     ) !                     
             //BE900.EVS_FORSK_EJER.DCPRN > 0 &        US1549418        
             //BE900.EVS_FORSK_EJER.CEJBEVS ^= '9') !                   
                                                                        
            (BE900.SORT_KOMNR < 999 &                                   
             BE900.AKT_EJER.DCPRCIR > 0) !                              
            (BE900.SORT_KOMNR < 999 &                                   
             BE900.AKT_EJER.DCPRCIR = 0 &                               
             BE900.EVS_SLUT_EJER.DCPRN > 0 &                            
             // US1549418 JXT                                           
             // BE900.EVS_SLUT_EJER.SIDSTE.CÆGTOPR  < '1' &             
             BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1' &                   
             BE900.EVS_SLUT_EJER.SIDSTE.DAFSTAA = 0 &                   
            (BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '0' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '2' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '3' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '4' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '5' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '6' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '7' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '8' !                
             //BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '9' !              
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = 'B' !    /* PBR    */
             BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = 'C' !    /* SLUT20 */
             BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = '1' !                
             BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = '2'))                
         THEN                                                           
            DO;                                                         
               TV.SKREVET = TV.SKREVET + 1;                             
               IF BE900.AKT_EJER.FEJER > 2                              
               THEN                                                     
                  TV.FL_EJER = TV.FL_EJER + 1;                          
               IF BE900.AKT_EJER.DCPRCIR = 0                            
               THEN                                                     
                  TV.FEVS = TV.FEVS + 1;                                
               WRITE FILE (BE900O) FROM (BE900);                        
               RETURN;                                                  
            END;                                                        
                                                                        
         /* ØVRIGE INDIVIDER SKAL IKKE BEHANDLES */                     
         /* I DE EFTERFØLGENDE PROGRAMMER        */                     
                                                                        
         IF BE900.EVS_SLUT_EJER.DCPRN > 0 &                             
            BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1'                      
         THEN                                                           
           DO;                                                          
             TV.EJER_FRA_SLUT = TV.EJER_FRA_SLUT + 1;                   
             IF BE900.EVS_SLUT_EJER.SIDSTE.DAFSTAA > 0                  
             THEN                                                       
                TV.SOLGT_I_SLUT = TV.SOLGT_I_SLUT + 1;                  
             ELSE                                                       
                TV.EJET_I_SLUT = TV.EJET_I_SLUT + 1;                    
           END;                                                         
                                                                        
         TV.FRASORTERET = TV.FRASORTERET + 1;                           
         WRITE FILE (BE9001O) FROM (BE900);                             
                                                                        
 END SKRIV_PERSON;                                                      
                                                                        
 /********************************************************************* 
 *         CHECK OM INDENLANDSK EJENDOM SKAL VIDEREFØRES              * 
 *         PÅ GRUNDLAG AF SLUT                                        * 
 *********************************************************************/ 
 CHECK_OM_EJD_VIDERE: PROC;                                             
                                                                        
     DCL    INDENLANDSK_EJENDOM                         BIT (1);        
     DCL    PERSON_ER_GYLDIG                            BIT (1);        
     DCL    KODE_2PROM_NEDSLAG_STØRRE_LIG_10            BIT (1);        
                                                                        
     DCL    EJER_ER_DØD                                 BIT (1);        
     DCL    EJERSKAB_ER_SLETTET                         BIT (1);        
     /* US1549418 JXT                                                   
       DCL    EJERSKAB_ER_OPRETTET_VED_ÆGTEFÆLLEFORDELING BIT (1); */   
     DCL    EJERSKAB_ER_SOLGT                           BIT (1);        
     DCL    EJERSKAB_ER_FRAFLYTTET                      BIT (1);        
     DCL    EJER_HAR_EN_EJERANDEL                       BIT (1);        
                                                                        
     DCL    GENERELLE_KRITERIER_ER_OPFYLDT              BIT (1);        
     DCL    REGEL1_KRITERIER_ER_OPFYLDT                 BIT (1);        
     DCL    REGEL2_KRITERIER_ER_OPFYLDT                 BIT (1);        
     DCL    REGEL3_KRITERIER_ER_OPFYLDT                 BIT (1);        
                                                                        
     /**************************************************/               
     /* G E N E R E L T  check for samtlige regler 1-3 */               
     /**************************************************/               
                                                                        
     /* Er ejendommen indenlandsk ? */                                  
     IF BE900.SORT_KOMNR < 999                                          
     THEN                                                               
       INDENLANDSK_EJENDOM = JA;                                        
     ELSE                                                               
       INDENLANDSK_EJENDOM = NEJ;                                       
                                                                        
     /* Er cprnr ok, og er persontypen sat i slutår ? */                
     IF BE900.AKT_EJER.DCPRCIR = 0 &                                    
        BE900.EVS_SLUT_EJER.DCPRN > 0 &                                 
        BE900.EVS_SLUT_EJER.SIDSTE.CPTYPSLUT > '0'                      
     THEN                                                               
       PERSON_ER_GYLDIG = JA;                                           
     ELSE                                                               
       PERSON_ER_GYLDIG = NEJ;                                          
                                                                        
     /* Er 2 promille nedslag større eller lig 10 ? */                  
     IF BE900.EVS_SLUT_EJER.SIDSTE.CNEDSL1 >= '10'                      
     THEN                                                               
       KODE_2PROM_NEDSLAG_STØRRE_LIG_10 = JA;                           
     ELSE                                                               
       KODE_2PROM_NEDSLAG_STØRRE_LIG_10 = NEJ;                          
                                                                        
     /* Er ejer død ? */                                                
     IF BE900.EVS_SLUT_EJER.SIDSTE.FEJLNR ^= '5004'                     
     THEN                                                               
       EJER_ER_DØD = NEJ;                                               
     ELSE                                                               
       EJER_ER_DØD = JA;                                                
                                                                        
     /* Er ejerskab slettet ? */                                        
     IF BE900.EVS_SLUT_EJER.SIDSTE.CSLET < '1'                          
     THEN                                                               
       EJERSKAB_ER_SLETTET = NEJ;                                       
     ELSE                                                               
       EJERSKAB_ER_SLETTET = JA;                                        
                                                                        
     /* Er ejerskab oprettet ved ægtefællefordeling ? */                
     /* US1549418 JXT                                                   
     IF BE900.EVS_SLUT_EJER.SIDSTE.CÆGTOPR < '1' &                      
        BE900.EVS_SLUT_EJER.SIDSTE.FEJLNR ^= '5027'                     
     THEN                                                               
       EJERSKAB_ER_OPRETTET_VED_ÆGTEFÆLLEFORDELING = NEJ;               
     ELSE                                                               
       EJERSKAB_ER_OPRETTET_VED_ÆGTEFÆLLEFORDELING = JA; */             
                                                                        
     /* Er ejerskabet solgt ? */                                        
     IF BE900.EVS_SLUT_EJER.SIDSTE.DAFSTAA = 0                          
     THEN                                                               
       EJERSKAB_ER_SOLGT = NEJ;                                         
     ELSE                                                               
       EJERSKAB_ER_SOLGT = JA;                                          
                                                                        
     /* Er ejerskabet fraflyttet ? */                                   
     IF BE900.EVS_SLUT_EJER.SIDSTE.DFRAFLYT = 0                         
     THEN                                                               
       EJERSKAB_ER_FRAFLYTTET = NEJ;                                    
     ELSE                                                               
       EJERSKAB_ER_FRAFLYTTET = JA;                                     
                                                                        
     /* har ejerskabet en ejerandel ? */                                
     /* regel for felt 158 = B slut 2020 defect 617 EBD */              
     IF (BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER_SW = 0 &                   
         BE900.EVS_SLUT_EJER.SIDSTE.GPCTEJER > 0 )  !                   
        BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = 'B'                        
     THEN                                                               
       EJER_HAR_EN_EJERANDEL = JA;                                      
     ELSE                                                               
       EJER_HAR_EN_EJERANDEL = NEJ;                                     
                                                                        
     IF INDENLANDSK_EJENDOM = JA &                                      
        PERSON_ER_GYLDIG = JA &                                         
        EJER_ER_DØD = NEJ &                                             
        EJERSKAB_ER_SLETTET = NEJ &                                     
        // US1549418 JXT                                                
        //EJERSKAB_ER_OPRETTET_VED_ÆGTEFÆLLEFORDELING = NEJ &           
        EJERSKAB_ER_SOLGT = NEJ &                                       
        EJERSKAB_ER_FRAFLYTTET = NEJ &                                  
        EJER_HAR_EN_EJERANDEL = JA &                                    
        KODE_2PROM_NEDSLAG_STØRRE_LIG_10 = JA                           
     THEN                                                               
       Generelle_kriterier_er_opfyldt = JA;                             
     ELSE                                                               
       Generelle_kriterier_er_opfyldt = NEJ;                            
                                                                        
                                                                        
     /**************************************************/               
     /* I N D I V I D U E L T  check for regel 1-3     */               
     /**************************************************/               
                                                                        
     /* REGEL 1 */                                                      
     IF BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' &                      
        BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA ^= '6'                      
     THEN                                                               
       Regel1_kriterier_er_opfyldt = JA;                                
     ELSE                                                               
       Regel1_kriterier_er_opfyldt = NEJ;                               
                                                                        
     /* REGEL 2 */                                                      
     IF BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '8' &                     
        //BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS ^= '9' &  US1549418        
       (BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = '4' !                     
        BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = '7')   /*02-34B S2019*/   
     THEN                                                               
       Regel2_kriterier_er_opfyldt = JA;                                
     ELSE                                                               
       Regel2_kriterier_er_opfyldt = NEJ;                               
                                                                        
                                                                        
     /* REGEL 3 */                                                      
     IF (BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = '1' !                    
         BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = '2' !                    
         BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = '5' !                    
         BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = ' ') &   /* D617 */      
        (BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '0' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '1' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '2' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '3' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '4' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '5' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '6' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = '7' !                     
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = 'B' !  /*Fra slut 2018*/  
         BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS = 'C')   /*Fra slut 2018*/  
     THEN                                                               
       Regel3_kriterier_er_opfyldt = JA;                                
     ELSE                                                               
       Regel3_kriterier_er_opfyldt = NEJ;                               
                                                                        
     IF BE900.EVS_SLUT_EJER.SIDSTE.CDATAFRA = ' ' &   /* D617 */        
        BE900.EVS_SLUT_EJER.SIDSTE.CEJBEVS  = '4'                       
     then                                                               
        TV.D617 = TV.D617 + 1;                                          
                                                                        
     /* Hvis de generelle kriterier samt kriterier for mindst EN af */  
     /* reglerne er opfyldt, medtages ejendommen i slut akt_år      */  
                                                                        
     IF generelle_kriterier_er_opfyldt &                                
        (Regel1_kriterier_er_opfyldt !                                  
         Regel2_kriterier_er_opfyldt !                                  
         Regel3_kriterier_er_opfyldt)                                   
     THEN                                                               
       EJENDOM_VIDERE = JA;                                             
     ELSE                                                               
       EJENDOM_VIDERE = NEJ;                                            
                                                                        
                                                                        
 END CHECK_OM_EJD_VIDERE;                                               
                                                                        
 /********************************************************************* 
 *                       TOTALER UDSKRIVES.                           * 
 *********************************************************************/ 
 TOTALLISTE: PROC;                                                      
         CALL ZZ20300(SIDELIN,'01');                                    
         CALL ZZ20300(OVERLIN1,'01');                                   
         CALL ZZ20300(OVERLIN2,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.LÆS_BE612;                                  
         DETLIN1.TEKST = 'ANTAL LÆSTE PÅ UDTRÆK FRA ESR+EVS  B.H61200D';
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆS_EVS;                                    
         DETLIN1.TEKST = '   HERAF INDIVIDER FRA EVS             ';     
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆS_EVS_F;                                  
         DETLIN1.TEKST = '         HERAF KUN FRA FORSKUD ' !!           
                                   BE55600M.INDKÅR1;                    
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆS_EVS_S;                                  
         DETLIN1.TEKST = '         HERAF KUN FRA SLUT ' !!              
                                   BE55600M.GLSLUTÅR1;                  
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SLETSLUT_EJERHDL;                           
         DETLIN1.TEKST = '      HERAF EVS-SLUT EJEROPLYSNINGER SLETTET';
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SLETSLUT_ÆGTFHDL;                           
         DETLIN1.TEKST = '      HERAF EVS-SLUT ÆGTFOPLYSNINGER SLETTET';
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SLET_FORSKUD_HDL;                           
         DETLIN1.TEKST = '      HERAF EVS-FORSKUD OPLYSNINGER SLETTET'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OVERSPR_EVSHDL;                             
         DETLIN1.TEKST = '      HERAF OVERSPRUNGNE HANDLER';            
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FUDLANDSK;                                  
         DETLIN1.TEKST = '      HERAF UDENLANDSKE EJENDOMME';           
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FØVREVS;                                    
         DETLIN1.TEKST = '      HERAF IKKE UDENLANDSKE EJENDOMME';      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FEVSOPRET;                                  
         DETLIN1.TEKST = '         HERAF OPRETTEDE KØBERE';             
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FESR_MATCH;                                 
         DETLIN1.TEKST = '         HERAF EJER+EJD OGSÅ FRA ESR';        
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.LÆS_ESR;                                    
         DETLIN1.TEKST = '   HERAF INDIVIDER FRA ESR                ';  
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = '      HERAF PGF4A VURDEREDE     ';            
         DETLIN1.ANTAL = TV.PGF4A;                                      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = '      HERAF PGF4B VURDEREDE     ';            
         DETLIN1.ANTAL = TV.PGF4B;                                      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OFF_EJ_CPR;                                 
         DETLIN1.TEKST = '      HERAF OFFENTLIGT EJET (IKKE P-NR)';     
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OFF_CPR;                                    
         DETLIN1.TEKST = '      HERAF OFFENTLIGT EJET (MED P-NR)';      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OVERSPR_CPR;                                
         DETLIN1.TEKST = '      HERAF EJ MED VALIDT PERSONNR.';         
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OVERSPR_SE;                                 
         DETLIN1.TEKST = '      HERAF SE-NUMRE KUN TIL SLS   ';         
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.TO_EJER_NUL;                                
         DETLIN1.TEKST = '      HERAF 2-EJERE UDEN EJERANDEL';          
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FL_EJER_NUL;                                
         DETLIN1.TEKST = '      HERAF MED OVER 2 EJERE UDEN EJERANDEL'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.GANE_JUSTER;                                
         DETLIN1.TEKST = '      HERAF EJERANDEL OVERFØRT FRA EVS SLUT'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.EJER_OPRET;                                 
         DETLIN1.TEKST = '      HERAF ÆGTF-FORDEL(-ESR) FRA EVS SLUT';  
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.ÆGTF_OPRET;                                 
         DETLIN1.TEKST = '      HERAF ÆGTF-FORDEL(+ESR) FRA EVS SLUT';  
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.EJER_SLETTET;                               
         DETLIN1.TEKST = '      HERAF EJER SLETTET VIA ÆGTF-FORDELING'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SAMME_EJER;                                 
         DETLIN1.TEKST = '      HERAF KUN EEN EJER OG SAMME EJER';      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.KUN_ÆGTF;                                   
         DETLIN1.TEKST = '      HERAF KUN EEN EJER=ÆGTEFÆLLE    ';      
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.ÆGTFOPR_FEJL;                               
         DETLIN1.TEKST = '      HERAF MÅSKE FEJL VEDR. ÆGTF-OPRET   ';  
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FRASORTERET;                                
         DETLIN1.TEKST = 'ANTAL FRASORTEREDE SITUATIONER    B.H90010D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.EJER_FRA_SLUT;                              
         DETLIN1.TEKST = '      HERAF EJER FRA SLUT ' !!                
                                BE55600M.INDKÅR1;                       
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.EJET_I_SLUT;                                
         DETLIN1.TEKST = '            HERAF IKKE SOLGT JVF. UDTRÆK   '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SOLGT_I_SLUT;                               
         DETLIN1.TEKST = '            HERAF SOLGT JVF. UDTRÆK        '; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.SKREVET;                                    
         DETLIN1.TEKST = 'ANTAL SKREVNE INDIVIDER           B.H90000D'; 
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OPR_EFTERLEV;                               
         DETLIN1.TEKST = '      HERAF EFTERLEVENDE OPRETTET SOM EJER';  
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.RET_EFTERLEV;                               
         DETLIN1.TEKST = '      HERAF EFTERLEVENDES EJERANDEL JUSTERET';
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.OPR_SLUT_EJER;                              
         DETLIN1.TEKST = '      HERAF EJER OPRETTET FRA SLUT';          
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.ANTAL = TV.FEVS;                                       
         DETLIN1.TEKST = '      HERAF FRA EVS          ';               
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS2;                                           
         DETLIN1.ANTAL = TV.FL_EJER;                                    
         DETLIN1.TEKST = '      HERAF MED FLERE END 2 EJERE';           
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
                                                                        
         DETLIN1.TEKST = 'ANTAL CFORSKEL=1 (EVT. REDUCERET I ' !!       
                         BE55600M.INDKÅR1 !! ')  ';                     
         DETLIN1.ANTAL = TV.FORSKEL1;                                   
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
         DETLIN1.TEKST = 'ANTAL CFORSKEL=2 (EJ REDUKTION-BYGGERI>100';  
         DETLIN1.ANTAL = TV.FORSKEL2;                                   
         CALL ZZ20300 (DETLIN1,'01');                                   
         DETLIN1.CCA = ZZWS1;                                           
                                                                        
         DETLIN1.TEKST = 'ANTAL CFORSKEL=3 (BENYT ' !!                  
                          BE55600M.INDKÅR1 !! ' - BYGGERI<101';         
         DETLIN1.ANTAL = TV.FORSKEL3;                                   
         CALL ZZ20300 (DETLIN1,'01');                                   
                                                                        
         DETLIN1.CCA = ZZWS1;              /* D617 */                   
         DETLIN1.TEKST = 'ANTAL SAGER MED CDATAFRA = BLANK ' !!         
                         'OG CEJBEVS = 4 (D617)';                       
         DETLIN1.ANTAL = TV.D617;                                       
         CALL ZZ20300 (DETLIN1,'01');                                   
  END TOTALLISTE;                                                       
 /********************************************************************* 
 *       SKRIVNING AF OPTÆLLINGSINDIVID                               * 
 *********************************************************************/ 
 SKRIV_OPTÆLLING: PROC;                                                 
                                                                        
         BE90099            = '';                                       
         BE90099.SORT_CPR   = 99999999999;                              
         BE90099.SORT_KOMNR = 999;                                      
         BE90099.SORT_EJDNR = 9999999;                                  
         BE90099.ANT_INDV   = TV.SKREVET;                               
         WRITE FILE (BE900O) FROM (BE90099);                            
                                                                        
 END SKRIV_OPTÆLLING;                                                   
 /********************************************************************* 
 *       AFSLUT PROGRAM                                               * 
 *********************************************************************/ 
 AFSLUT: PROC;                                                          
         CALL TOTALLISTE;                                               
         CALL SKRIV_OPTÆLLING;                                          
         CALL ZZ20300((133)' ','99');                                   
         CLOSE FILE (BE612I),                                           
               FILE (BE900O),                                           
               FILE (BE9001O);                                          
 END AFSLUT;                                                            
 %INCLUDE BE60105M; /* UNDERSØG STATUS FOR EJERENS CPRNR */             
 %INCLUDE BE32221M; /* OPSÆT REGNSKABS- OG INDKOMSTÅR */                
 END  BE90000;                                                          
