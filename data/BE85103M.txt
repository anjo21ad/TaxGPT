 /*********************************************************************/
 /* Bruges i BE85100, BE85200, BE85400 og BE85500                     */
 /* Dannelse af load-grundlag til Forskud:                            */
 /*   EVS Ejerrelation (BS01600T)                                     */
 /*   EVS Ejerforhold  (BS01700T)                                     */
 /*   EVS Basisrabat   (BS01800T)                                     */
 /* I BE85500T Beregn Basis rabat og Faktisk rabat                    */
 /*                                                                   */
 /* Har sammenhæng med BE85202M hvor tælleværker er erklæret          */
 /*                                                                   */
 /* Ved indlæsning af EVS Resultat (BE78000T).                        */
 /* Betingelser for, at det springes over.                            */
 /* Derudover laves diverse optællinger                               */
 /*                                                                   */
 /* FORSKUD 2024: Tina Carstens (TIC)   BF17 Marts 2022               */
 /* FORSKUD 2024: Esben Brodersen (EBD) Defect 1910 Maj 2023          */
 /*********************************************************************/
                                                                        
        /* Frasorter ikke relevante resultater                        */
        /* Dan diverse optællinger                                    */
                                                                        
        /* IKKE EVS RELEVANT EJD. SKULLE HAVDE VÆRET    */              
        /* OVERLÆST I BH31800L.                         */              
        IF DCLBE78000T.TILEVS_A_V_CBENYT = '78'                         
        THEN                                                            
           RETURN;                                                      
                                                                        
        IF DCLBE78000T.TILEVS_A_EJ_COMPLA = '1'                         
        THEN                                                            
           RETURN;                                                      
                                                                        
        IF DCLBE76000T.CSTATUS = '2'           /* OMPLACERET */         
        THEN                                                            
           RETURN;                                                      
                                                                        
        IF DCLBE76000T.CCIVS = 'D'            /* ALTID HVIS DØD */      
        THEN                                                            
           RETURN;                                                      
                                                                        
        /* Disse skal ikke oprettes fejlnummer 5060 findes */           
        /* kun internt i EVS oprettelsen se BH85000        */           
        IF DCLBE78000T.FEJLNR = 5060                                    
        THEN                                                            
           RETURN;                                                      
                                                                        
        /* Disse skal ikke oprettes fejlnummer 5500 findes */           
        /* kun internt i EVS oprettelsen se BH85000 KS25   */           
        IF DCLBE78000T.FEJLNR = 5500 &                                  
           DCLBE78000T.EKOMNR = 999                                     
        THEN                                                            
           RETURN;                                                      
                                                                        
        //* Forskud 2023 de skal nu oprettes med CSLET lig 1            
        /* Disse skal ikke oprettes fejlnummer 5502 findes */           
        /* kun internt i EVS oprettelsen se BH85000  D864  */           
        //IF DCLBE78000T.FEJLNR = 5502                                  
        //THEN                                                          
        //   RETURN;                                                    
                                                                        
                                                                        
        /* Disse skal ikke oprettes fejlnummer 5503 findes */           
        /* kun internt i EVS oprettelsen se BH85000  D782  */           
        IF DCLBE78000T.FEJLNR = 5503                                    
        THEN                                                            
           RETURN;                                                      
                                                                        
        /* Optælling af fejl                                          */
        IF DCLBE78000T.FEJLNR > 0                                       
        THEN                                                            
           DO;                                                          
              INDEX = DCLBE78000T.FEJLNR;                               
              LÆST_FEJLNR(INDEX).ANTAL = LÆST_FEJLNR(INDEX).ANTAL + 1;  
           END;                                                         
                                                                        
        IF DCLBE78000T.TILEVS_CEJBEVS ^= 'A' &                          
          (DCLBE78000T.FEJLNR = 5001 !                                  
           DCLBE78000T.FEJLNR = 5020)                                   
        THEN                                                            
           RETURN; /* HVIS IKKE FREMSKREVET */                          
                                                                        
        IF DCLBE78000T.TILEVS_CINVPNR ^= '0'                            
        THEN                                                            
           RETURN;                                                      
                                                                        
        IF DCLBE78000T.TILEVS_A_EJ_DCPRCIR > 0 &                        
          (DCLBE78000T.TILEVS_A_EJ_DAFSTÅ  > 0 &                        
           DCLBE78000T.TILEVS_A_EJ_DAFSTÅ  <= DCLBE76000T.DRGNÅRTIL)    
        THEN                                                            
           RETURN;                                                      
                                                                        
        /* F2005 */                                                     
        IF DCLBE78000T.TILEVS_A_EJ_DCPRCIR > 0 &                        
          (DCLBE78000T.TILEVS_CEJBEVS = '0' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '1' !/*Forskud 2020 defect 15*/ 
           DCLBE78000T.TILEVS_CEJBEVS = '2' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '3' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '7' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '8' !                           
           DCLBE78000T.TILEVS_CEJBEVS = 'A' ! /* defect 1910 F24 */     
           DCLBE78000T.TILEVS_CEJBEVS = 'B' !                           
           DCLBE78000T.TILEVS_CEJBEVS = 'C') &                          
           DCLBE77000T.EVSSEJ_DCPRN > 0 &                               
           DCLBE77000T.EVSSEJ_SID_CSLET < '1' &                         
          (DCLBE77000T.EVSSEJ_SID_CEJBEVS = '0' !                       
           DCLBE77000T.EVSSEJ_SID_CEJBEVS = '4' !                       
           DCLBE77000T.EVSSEJ_SID_CEJBEVS = '5') &                      
         ((DCLBE77000T.EVSSEJ_SID_DAFSTAA > 0 &                         
           DCLBE77000T.EVSSEJ_SID_DAFSTAA <=                            
                                        DCLBE76000T.DRGNÅRTIL) !        
          (DCLBE77000T.EVSSEJ_SID_DFRAFLYT > 0 &                        
           DCLBE77000T.EVSSEJ_SID_DFRAFLYT <=                           
                                        DCLBE76000T.DRGNÅRTIL))         
        THEN                                                            
           RETURN;                                                      
                                                                        
        /* F2005 */                                                     
        IF DCLBE78000T.TILEVS_A_EJ_DCPRCIR > 0 &                        
          (DCLBE78000T.TILEVS_CEJBEVS = '0' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '1' !/*Forskud 2020 defect 15*/ 
           DCLBE78000T.TILEVS_CEJBEVS = '2' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '3' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '7' !                           
           DCLBE78000T.TILEVS_CEJBEVS = '8' !                           
           DCLBE78000T.TILEVS_CEJBEVS = 'A' ! /* defect 1910 F24 */     
           DCLBE78000T.TILEVS_CEJBEVS = 'B' !                           
           DCLBE78000T.TILEVS_CEJBEVS = 'C') &                          
           DCLBE77000T.EVSFEJ_DCPRN > 0 &                               
          (DCLBE77000T.EVSFEJ_CEJBEVS = '0' !                           
           DCLBE77000T.EVSFEJ_CEJBEVS = '4') &                          
         ((DCLBE77000T.EVSFEJ_DAFSTAA > 0 &                             
           DCLBE77000T.EVSFEJ_DAFSTAA <=                                
                                      DCLBE76000T.DRGNÅRTIL) !          
          (DCLBE77000T.EVSFEJ_DFRAFLYT > 0 &                            
           DCLBE77000T.EVSFEJ_DFRAFLYT <=                               
                                      DCLBE76000T.DRGNÅRTIL))           
        THEN                                                            
           RETURN;                                                      
                                                                        
        /* F2005 */                                                     
        IF DCLBE78000T.TILEVS_A_EJ_DCPRCIR = 0 &                        
           DCLBE78000T.EKOMNR < 999                                     
        THEN                                                            
          DO;                                                           
            IF (DCLBE77000T.EVSSEJ_DCPRN > 0 &                          
                DCLBE77000T.EVSSEJ_SID_CSLET < '1' &                    
               (DCLBE77000T.EVSSEJ_SID_CEJBEVS = '0' !                  
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = '4' !                  
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = '5' !                  
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = '6' !                  
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = '7' !                  
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = '8' !                  
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = 'A' ! /* defect 1910 */
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = 'B' !                  
                DCLBE77000T.EVSSEJ_SID_CEJBEVS = 'C')) !                
               (DCLBE77000T.EVSFEJ_DCPRN > 0 &                          
               (DCLBE77000T.EVSFEJ_CEJBEVS = '0' !                      
                DCLBE77000T.EVSFEJ_CEJBEVS = '4' !                      
                DCLBE77000T.EVSFEJ_CEJBEVS = '5' !                      
                DCLBE77000T.EVSFEJ_CEJBEVS = '6' !                      
                DCLBE77000T.EVSFEJ_CEJBEVS = '7' !                      
                DCLBE77000T.EVSFEJ_CEJBEVS = '8' !                      
                DCLBE77000T.EVSFEJ_CEJBEVS = 'A' !  /* defect 1910 */   
                DCLBE77000T.EVSFEJ_CEJBEVS = 'B' !                      
                DCLBE77000T.EVSFEJ_CEJBEVS = 'C'))                      
            THEN                                                        
              DO;                                                       
                IF DCLBE77000T.EVSSEJ_DCPRN > 0 &                       
                   DCLBE77000T.EVSSEJ_SID_CSLET < '1' &                 
                 ((DCLBE77000T.EVSSEJ_SID_DAFSTAA  > 0 &                
                   DCLBE77000T.EVSSEJ_SID_DAFSTAA  <=                   
                                           DCLBE76000T.DRGNÅRTIL) !     
                  (DCLBE77000T.EVSSEJ_SID_DFRAFLYT > 0 &                
                   DCLBE77000T.EVSSEJ_SID_DFRAFLYT <=                   
                                           DCLBE76000T.DRGNÅRTIL))      
                THEN                                                    
                   RETURN;                                              
                                                                        
                IF DCLBE77000T.EVSFEJ_DCPRN > 0 &                       
                 ((DCLBE77000T.EVSFEJ_DAFSTAA  > 0 &                    
                   DCLBE77000T.EVSFEJ_DAFSTAA  <=                       
                                           DCLBE76000T.DRGNÅRTIL) !     
                  (DCLBE77000T.EVSFEJ_DFRAFLYT > 0 &                    
                   DCLBE77000T.EVSFEJ_DFRAFLYT <=                       
                                           DCLBE76000T.DRGNÅRTIL))      
                THEN                                                    
                   RETURN;                                              
              END;                                                      
            ELSE                                                        
               RETURN;                                                  
          END;                                                          
                                                                        
        IF DCLBE78000T.EKOMNR = 999 &                                   
          (DCLBE78000T.TILEVS_DAFSTAA > 0 !                             
           DCLBE78000T.TILEVS_DFRAFLYT > 0)                             
        THEN                                                            
           RETURN;                                                      
                                                                        
       /* ny kode til Forskud 2020 defect 15 */                         
       IF DCLBE78000T.FEJLNR = 5001 !                                   
          DCLBE78000T.FEJLNR = 5014 !                                   
          DCLBE78000T.FEJLNR = 5055                                     
       THEN                                                             
          RETURN;                                                       
                                                                        
       /* defect 285 frasortering af ejendomme med benyttelse 34 */     
       IF  DCLBE78000T.TILEVS_A_V_CBENYT = '34'  &                      
          (DCLBE78000T.TILEVS_A_V_ANT_FOR_4 +                           
           DCLBE78000T.TILEVS_A_V_ANT_FOR_5 +                           
           DCLBE78000T.TILEVS_A_V_ANT_FOR_6 +                           
           DCLBE78000T.TILEVS_A_V_ANT_FOR_8 +                           
           DCLBE78000T.TILEVS_A_V_ANT_FOR_9) = 0                        
       THEN                                                             
           RETURN;                                                      
                                                                        
        HJ_CHAR1 = DCLBE78000T.EJENDOM_CEJDTYPE;                        
                                                                        
        IF HJ_CHAR1 < '1'                                               
        THEN                                                            
           INDEX = 0;                                                   
        ELSE                                                            
           INDEX = HJ_PIC1;                                             
                                                                        
        LÆST_EJDTYP(INDEX).ANTAL = LÆST_EJDTYP(INDEX).ANTAL + 1;        
                                                                        
        HJ_CHAR1 = DCLBE78000T.EJENDOM_CBERGRL;                         
                                                                        
        IF HJ_CHAR1 < '1'                                               
        THEN                                                            
           INDEX = 0;                                                   
        ELSE                                                            
           INDEX = HJ_PIC1;                                             
                                                                        
        LÆST_BERGRL(INDEX).ANTAL = LÆST_BERGRL(INDEX).ANTAL + 1;        
                                                                        
         /* FIA - 4 nye tællere herunder pr. 2021-06-17 */              
         /* LÆST_VURMARK */                                             
         HJ_P3 = DCLBE78000T.EJERSKAB_VURMARK;                          
         INDEX = HJ_P3;                                                 
         LÆST_VURMARK(INDEX).ANTAL = LÆST_VURMARK(INDEX).ANTAL + 1;     
                                                                        
         /* LÆST_DVURDÅR */                                             
         HJ_CHAR_4 = DCLBE75000T.OPL_VURDGL_DVURDÅR;                    
         INDEX = HJ_CHAR_4_PIC;                                         
         IF INDEX = 0                                                   
            ! INDEX <= 2000                                             
            ! INDEX > 2050 THEN                                         
           LÆST_DVURDÅR(2000).ANTAL = LÆST_DVURDÅR(2000).ANTAL + 1;     
         ELSE                                                           
           LÆST_DVURDÅR(INDEX).ANTAL = LÆST_DVURDÅR(INDEX).ANTAL + 1;   
                                                                        
         /* LÆST_FORSIGT */                                             
         IF DCLBE78000T.EJERSKAB_FORSIGT_EVS = 'N' THEN                 
           INDEX = 10;                                                  
         ELSE IF DCLBE78000T.EJERSKAB_FORSIGT_EVS = 'J' THEN            
           INDEX = 11;                                                  
         ELSE                                                           
           INDEX = 12;                                                  
         LÆST_FORSIGT(INDEX).ANTAL = LÆST_FORSIGT(INDEX).ANTAL + 1;     
                                                                        
         /* LÆST_BESKAT */                                              
         IF DCLBE78000T.EJERSKAB_BESKAT = 'N' THEN                      
           INDEX = 10;                                                  
         ELSE IF DCLBE78000T.EJERSKAB_BESKAT = 'J' THEN                 
           INDEX = 11;                                                  
         ELSE                                                           
           INDEX = 12;                                                  
         LÆST_BESKAT(INDEX).ANTAL = LÆST_BESKAT(INDEX).ANTAL + 1;       
                                                                        
         TV.ANT_BEHANDLES = TV.ANT_BEHANDLES + 1;                       
                                                                        
